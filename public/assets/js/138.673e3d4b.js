(window.webpackJsonp=window.webpackJsonp||[]).push([[138],{13909:function(s,n,t){"use strict";t.r(n);var a=t(2),e=Object(a.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h3",{attrs:{id:"_1-什么是高可用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-什么是高可用"}},[s._v("#")]),s._v(" 1，什么是高可用")]),s._v(" "),n("p",[s._v("一般是指2台机器启动着完全相同的业务系统，当有一台机器down机了，另外一台服务器就能快速的接管，对于访问的用户是无感知的。")]),s._v(" "),n("p",[n("img",{attrs:{src:t(6030),alt:"1724847146605"}})]),s._v(" "),n("p",[s._v("先看网络中的VRRP协议，看一个场景：")]),s._v(" "),n("p",[n("img",{attrs:{src:t(6031),alt:"1724847705320"}})]),s._v(" "),n("p",[s._v("keepalived软件是基于VRRP协议实现的，VRRP虚拟路由冗余协议：")]),s._v(" "),n("p",[n("img",{attrs:{src:t(6032),alt:"1724848067779"}})]),s._v(" "),n("p",[s._v("高可用通常使用什么软件？")]),s._v(" "),n("ul",[n("li",[s._v("硬件通常使用 F5软件通常使用 keepalived")])]),s._v(" "),n("p",[s._v("keepalived是如何实现高可用的？")]),s._v(" "),n("ul",[n("li",[s._v("keepalived软件是基于VRRP协议实现的，VRRP虚拟路由冗余协议，主要用于解决单点故障问题")])]),s._v(" "),n("p",[s._v("VRRP是如何诞生的，原理又是什么？比如公司的网络是通过网关进行上网的，那么如果该路由器故障了，网关无法转发报文了，此时所有人都无法上网了，怎么办？")]),s._v(" "),n("p",[n("img",{attrs:{src:t(6033),alt:"1724847191188"}})]),s._v(" "),n("p",[s._v("通常做法是给路由器增加一台备用点，但是问题是，如果我们的主网关master故障了，用户是需要手动指向backup的，如果用户过多修改起来会非常麻烦。")]),s._v(" "),n("ul",[n("li",[s._v("问题一：假设用户将指向都修改为backup路由器，那么master路由器修好了怎么办？")]),s._v(" "),n("li",[s._v("问题二：假设Master网关故障，我们将backup网关配置为master网关的ip是否可以？")])]),s._v(" "),n("p",[s._v("其实是不行的，因为PC第一次通过ARP广播寻找到Master网关的MAC地址与IP地址后，会将信息写到ARP的缓存表中，那么PC之后连接都是通过那个缓存表的信息去连接，然后进行数据包的转发，即使我们修改了IP但是Mac地址是唯一的，pc的数据包依然会发送给master。（除非是PC的ARP缓存表过期，再次发起ARP广播的时候才能获取新的backup对应的Mac地址与IP地址）")]),s._v(" "),n("p",[n("img",{attrs:{src:t(6034),alt:"1724847298690"}})]),s._v(" "),n("p",[s._v("如何才能做到出现故障自动转移，此时VRRP就出现了，我们的VRRP其实是通过软件或者硬件的形式在Master和Backup外面增加一个虚拟的MAC地址（VMAC）与虚拟IP地址（VIP），那么在这种情况下，PC请求VIP的时候，无论是Master处理还是Backup处理，PC仅会在ARP缓存表中记录VMAC与VIP的信息。")]),s._v(" "),n("p",[s._v("关于负载均衡中的keepalived:")]),s._v(" "),n("p",[n("img",{attrs:{src:t(6035),alt:"1724848866405"}})]),s._v(" "),n("h3",{attrs:{id:"_2-配置基础架构"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-配置基础架构"}},[s._v("#")]),s._v(" 2，配置基础架构")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("克隆一台LB02  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.6\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),s._v("上面有什么，0.6上面就要有什么。\n\n负载均衡\nLB01  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.5  负载均衡  worpdress\nLB02  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.6  负载均衡  wordpress\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.6")]),s._v("也可以使用yum安装nginx，非常方便。\n安装Nginx\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02-6:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#scp 10.0.0.7:/etc/yum.repos.d/nginx.repo /etc/yum.repos.d/")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02-6:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#yum -y install nginx")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),s._v("上面有什么，0.6上面就要有什么。\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02-6:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#scp 10.0.0.5:/etc/nginx/conf.d/* /etc/nginx/conf.d/")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("测试：")]),s._v(" "),n("p",[n("img",{attrs:{src:t(6036),alt:"1724914673811"}})]),s._v(" "),n("p",[s._v("lb02配置：")]),s._v(" "),n("p",[n("img",{attrs:{src:t(6037),alt:"1724914989338"}})]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02-6:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx -t")]),s._v("\nnginx: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("emerg"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" open"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/nginx/proxy_params"')]),s._v(" failed "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(": No such "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" or directory"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /etc/nginx/conf.d/proxy.conf:13\nnginx: configuration "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /etc/nginx/nginx.conf "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" failed\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02-6:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#scp 10.0.0.5:/etc/nginx/proxy_params /etc/nginx/")]),s._v("\nroot@10.0.0.5"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'s password: \nproxy_params                                                                                     100%  257   174.2KB/s   00:00    \n[root@lb02-6:~]#nginx -t\nnginx: [emerg] unknown directive "check" in /etc/nginx/conf.d/up.conf:4\nnginx: configuration file /etc/nginx/nginx.conf test failed\n[root@lb02-6:~]#rm -rf /etc/nginx/conf.d/up.conf \n[root@lb02-6:~]#nginx -t\nnginx: [emerg] cannot load certificate "/etc/nginx/ssl/server.crt": BIO_new_file() failed (SSL: error:02001002:system library:fopen:No such file or directory:fopen(\'')]),s._v("/etc/nginx/ssl/server.crt"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("','")]),s._v("r"),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("') error:2006D080:BIO routines:BIO_new_file:no such file)\nnginx: configuration file /etc/nginx/nginx.conf test failed\n[root@lb02-6:~]#scp 10.0.0.5:/etc/nginx/ssl/server.* /etc/nginx/ssl/\nroot@10.0.0.5'")]),s._v("s password: \n/etc/nginx/ssl/: Not a directory\n/etc/nginx/ssl/: Not a directory\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02-6:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mkdir /etc/nginx/ssl")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02-6:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#scp 10.0.0.5:/etc/nginx/ssl/server.* /etc/nginx/ssl/")]),s._v("\nroot@10.0.0.5's password: \nserver.crt                                                                                       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3830")]),s._v("     "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".9MB/s   00:00    \nserver.key                                                                                       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("% "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1675")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("497")]),s._v(".3KB/s   00:00    \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02-6:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#nginx -t")]),s._v("\nnginx: the configuration "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /etc/nginx/nginx.conf syntax is ok\nnginx: configuration "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" /etc/nginx/nginx.conf "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v(" is successful\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02-6:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl start nginx")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])]),n("p",[s._v("到目前为止，web01的配置：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:conf.d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat wordpress.conf ")]),s._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name www.wp.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        root /code/wp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                index index.php index.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        location ~ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".php$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                fastcgi_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                fastcgi_param SCRIPT_FILENAME "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$document_root")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$fastcgi_script_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\tinclude fastcgi_params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t        fastcgi_param HTTPS on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[s._v("到目前为止，web02的配置：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web02-8:conf.d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat wordpress.conf ")]),s._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name www.wp.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        root /code/wp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                index index.php index.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        location ~ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v(".php$ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                fastcgi_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:9000"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                fastcgi_param SCRIPT_FILENAME "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$document_root")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$fastcgi_script_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\t\tinclude fastcgi_params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                fastcgi_param HTTPS on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("p",[s._v("到目前为止，lb01的配置：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01-5:conf.d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat proxy.conf")]),s._v("\nupstream webs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.7"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name www.wp.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ssl_certificate   /etc/nginx/ssl/server.crt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        ssl_certificate_key  /etc/nginx/ssl/server.key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        proxy_pass http://webs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    include proxy_params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置将用户访问http请求强制跳转https")]),s._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name www.wp.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("302")]),s._v(" https://"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_name")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("p",[s._v("到目前为止，lb02的配置：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02-6:conf.d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat proxy.conf ")]),s._v("\nupstream webs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.7"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.8"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" ssl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name www.wp.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    ssl_certificate   /etc/nginx/ssl/server.crt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        ssl_certificate_key  /etc/nginx/ssl/server.key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        proxy_pass http://webs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    include proxy_params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#配置将用户访问http请求强制跳转https")]),s._v("\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name www.wp.com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("302")]),s._v(" https://"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$server_name")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("p",[s._v("现在的构架图：")]),s._v(" "),n("p",[n("img",{attrs:{src:t(6038),alt:"1724916763713"}})]),s._v(" "),n("h3",{attrs:{id:"_3-配置keepalived"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-配置keepalived"}},[s._v("#")]),s._v(" 3，配置keepalived")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("LB01安装部署\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#yum -y install keepalived")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /etc/keepalived/keepalived.conf")]),s._v("\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#全局配置")]),s._v("\n    router_id lb01              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#标识身份->名称")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance VI_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state MASTER                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#标识角色状态")]),s._v("\n    interface ens33              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网卡绑定接口")]),s._v("\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#虚拟路由id")]),s._v("\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("150")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#优先级")]),s._v("\n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#监测间隔时间")]),s._v("\n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证")]),s._v("\n        auth_type PASS          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证方式")]),s._v("\n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证密码")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("         \n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.3                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#虚拟的VIP地址")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl start keepalived")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl enable keepalived")]),s._v("\n\n测试hosts解析虚拟IP地址（0.3是虚拟的IP地址）\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.3  www.wp.com\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.5")]),s._v("上面 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-tnulp")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("和443都是监听在本地任意IP上。只要你能访问我主机上任意IP地址，都可以访问80和443。那么我本机上有的IP有（ip add）：\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.5\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.3  对应了一个虚拟的MCA地址，window上可以通过arp -a查看0.3的mac地址\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.5\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("配置LB02\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#yum -y install keepalived")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /etc/keepalived/keepalived.conf")]),s._v("\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#全局配置")]),s._v("\n    router_id lb02              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#标识身份->名称")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance VI_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state BACKUP                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#标识角色状态")]),s._v("\n    interface ens33              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网卡绑定接口")]),s._v("\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#虚拟路由id")]),s._v("\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#优先级")]),s._v("\n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#监测间隔时间")]),s._v("\n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证")]),s._v("\n        auth_type PASS          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证方式")]),s._v("\n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证密码")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("         \n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.3                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#虚拟的VIP地址")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n启动服务\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl start keepalived")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl enable keepalived")]),s._v("\n\n\n\n主和备的区别: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("个位置\n主:\nrouter_id lb01\nstate MASTER \npriority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("150")]),s._v("\n\n备:\nrouter_id lb02 \nstate BACKUP \npriority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])]),n("h3",{attrs:{id:"_4-测试vip漂移"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-测试vip漂移"}},[s._v("#")]),s._v(" 4，测试VIP漂移")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("停止主服务器服务,看IP地址是否漂移到备份服务器\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl stop keepalived")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ip add|grep 10.0.0.3")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n\nLB02查看IP:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ip add|grep 10.0.0.3")]),s._v("\n    inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.3/32 scope global ens33\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n\n测试业务是否可以正常访问。IP地址漂移了，MAC地址也会变，在win上通过arp -a看一下mac地址。\n\n默认是抢占式的，如果lb01活了，它会自动抢过来，ip地址还是会漂移到lb01上面的。大家可以再测试一下。\n\n如果大家会抓包的话，可以抓一下，搜索栏：vrrp  arp\n\n需要注意的时，nginx如果挂了，ip是不会漂移的。业务就访问不了了。我们需要想办法，当nginx挂了，你得漂移。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("h3",{attrs:{id:"_5-keepalived集成nginx服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_5-keepalived集成nginx服务"}},[s._v("#")]),s._v(" 5，keepalived集成nginx服务")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("keepalived的日志是系统日志:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tail -f /var/log/messages")]),s._v("\n\n\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".脚本检查Nginx服务是否正常运行，如果挂掉，会自动杀死keepalived\n\n-------------------判断nginx是否运行中----------------\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl start nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl status nginx &>/dev/null")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#echo $?       # 如果nginx运行则返回0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl stop nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl status nginx &>/dev/null")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#echo $?       # 如果nginx未运行返回非0的结果")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n-----------------------------------------------------------\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#netstat -tnulp|grep nginx|wc -l")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl stop nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#netstat -tnulp|grep nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#netstat -tnulp|grep nginx|wc -l")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl start nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#netstat -tnulp|grep nginx|wc -l")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n----------------------------------------------------------\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl stop nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ps axu|grep nginx|wc -l")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ps axu|grep nginx")]),s._v("\nroot        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9360")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("213136")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("888")]),s._v(" pts/1    R+   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":40   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl start nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ps axu|grep nginx|wc -l")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n-------------------------------------------------------------\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#curl -I 127.0.0.1")]),s._v("\nHTTP/1.1 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" OK\nServer: nginx/1.26.1\nDate: Fri, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" Aug "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v(" 03:41:35 GMT\nContent-Type: text/html\nContent-Length: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("739")]),s._v("\nLast-Modified: Tue, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" Aug "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v(" 02:59:14 GMT\nConnection: keep-alive\nETag: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"66bacc02-2e3"')]),s._v("\nAccept-Ranges: bytes\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#echo $?")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl stop nginx")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#curl -I 127.0.0.1")]),s._v("\ncurl: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Failed to connect to "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 port "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(": Connection refused\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#echo $?")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\n\n检测脚本:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat check_web.sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/sh")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ng_port")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token variable"}},[n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" -tnulp"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.判断Nginx是否存活,如果不存活则关闭keepalived")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$ng_port")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-eq")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("then")]),s._v("\n   systemctl stop keepalived\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("fi")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#chmod +x check_web.sh")]),s._v("\n\n\n集成到keepalived服务中\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /etc/keepalived/keepalived.conf ")]),s._v("\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#全局配置")]),s._v("\n    router_id lb01              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#标识身份->名称")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_script check_web "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调用脚本")]),s._v("\n    script "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/root/check_web.sh"')]),s._v("\n    interval "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance VI_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state MASTER                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#标识角色状态")]),s._v("\n    interface ens33              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网卡绑定接口")]),s._v("\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#虚拟路由id")]),s._v("\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("150")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#优先级")]),s._v("\n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#监测间隔时间")]),s._v("\n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证")]),s._v("\n        auth_type PASS          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证方式")]),s._v("\n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证密码")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("         \n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.3                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#虚拟的VIP地址")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     track_script "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("             "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 调用脚本")]),s._v("\n       check_web\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n重启服务：\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01-5:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl restart keepalived")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br")])]),n("p",[s._v("测试nginx如果挂了，是否漂移：")]),s._v(" "),n("p",[n("img",{attrs:{src:t(6039),alt:"1724920458620"}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(6040),alt:"1724920704504"}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(6041),alt:"1724920716052"}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(6042),alt:"1724920726696"}})]),s._v(" "),n("p",[s._v("如果把nginx启动：")]),s._v(" "),n("p",[n("img",{attrs:{src:t(6043),alt:"1724921030836"}})]),s._v(" "),n("p",[s._v("目前来说，想让它漂移过来，需要手动启动keepalived。")]),s._v(" "),n("h3",{attrs:{id:"_6-模拟脑裂"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-模拟脑裂"}},[s._v("#")]),s._v(" 6，模拟脑裂")]),s._v(" "),n("p",[s._v("现在是lib02在提供服务：")]),s._v(" "),n("p",[n("img",{attrs:{src:t(6044),alt:"1724921195113"}})]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("LB01和LB02开启firewalld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("备用开启就行"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02-6:conf.d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl start firewalld")]),s._v("\n\n测试：业务不能访问了\n\n测试放行80和443端口:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#firewall-cmd --add-port={443/tcp,80/udp}")]),s._v("\nsuccess\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#firewall-cmd --add-service=http")]),s._v("\nsuccess\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#firewall-cmd --add-service=https")]),s._v("\nsuccess\n\n测试：业务可以访问了\n\n现在让lb01活：\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01-5:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl start keepalived")]),s._v("\n\n出现脑裂:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01-5:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ip add | grep 10.0.0.3")]),s._v("\n    inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.3/32 scope global ens33\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02-6:conf.d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ip add | grep 10.0.0.3")]),s._v("\n    inet "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.3/32 scope global ens33\n    \n解决脑裂:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01-5:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl stop keepalived")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01-5:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ip add | grep 10.0.0.3")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01-5:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02-6:conf.d"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl stop firewalld")]),s._v("\n\n\n解决脑裂:\n 杀死一个keepalived"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("IP冲突了"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",查找原因。\n 服务器硬件\n 网络\n 软件 防火墙 安全策略\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br")])]),n("h3",{attrs:{id:"_7-配置非抢占式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-配置非抢占式"}},[s._v("#")]),s._v(" 7，配置非抢占式")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("在负载均衡两台服务器配置相同的情况下使用非抢占式。\n\nLB01的配置\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /etc/keepalived/keepalived.conf ")]),s._v("\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#全局配置")]),s._v("\n    router_id lb01              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#标识身份->名称")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_script check_web "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    script "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/root/check_web.sh"')]),s._v("\n    interval "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance VI_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state BACKUP               "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#标识角色状态          # 修改为BACKUP")]),s._v("\n    interface ens33              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网卡绑定接口")]),s._v("\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#虚拟路由id")]),s._v("\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("150")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#优先级")]),s._v("\n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#监测间隔时间")]),s._v("\n    nopreempt                                       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加一条不抢占")]),s._v("\n\n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证")]),s._v("\n        auth_type PASS          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证方式")]),s._v("\n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证密码")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("         \n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.3                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#虚拟的VIP地址")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n     track_script "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n       check_web\n     "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\nLB02配置:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@lb02:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /etc/keepalived/keepalived.conf ")]),s._v("\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#全局配置")]),s._v("\n    router_id lb02              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#标识身份->名称")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance VI_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    state BACKUP                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#标识角色状态")]),s._v("\n    interface ens33              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#网卡绑定接口")]),s._v("\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#虚拟路由id")]),s._v("\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#优先级")]),s._v("\n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#监测间隔时间")]),s._v("\n    nopreempt                                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加一条配置不抢占")]),s._v("\n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证")]),s._v("\n        auth_type PASS          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证方式")]),s._v("\n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#认证密码")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("         \n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.3                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#虚拟的VIP地址")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br")])])])}),[],!1,null,null,null);n.default=e.exports},6030:function(s,n,t){s.exports=t.p+"assets/img/1724847146605.641a800c.png"},6031:function(s,n,t){s.exports=t.p+"assets/img/1724847705320.51bb6ecf.png"},6032:function(s,n,t){s.exports=t.p+"assets/img/1724848067779.a7b7bd01.png"},6033:function(s,n,t){s.exports=t.p+"assets/img/1724847191188.0784df35.png"},6034:function(s,n,t){s.exports=t.p+"assets/img/1724847298690.c24c24c0.png"},6035:function(s,n,t){s.exports=t.p+"assets/img/1724848866405.ca90f6ae.png"},6036:function(s,n,t){s.exports=t.p+"assets/img/1724914673811.23c5a40c.png"},6037:function(s,n,t){s.exports=t.p+"assets/img/1724914989338.002672ea.png"},6038:function(s,n,t){s.exports=t.p+"assets/img/1724916763713.578c51d8.png"},6039:function(s,n,t){s.exports=t.p+"assets/img/1724920458620.ed60fb1b.png"},6040:function(s,n,t){s.exports=t.p+"assets/img/1724920704504.6d098923.png"},6041:function(s,n,t){s.exports=t.p+"assets/img/1724920716052.0d938942.png"},6042:function(s,n,t){s.exports=t.p+"assets/img/1724920726696.1396789b.png"},6043:function(s,n,t){s.exports=t.p+"assets/img/1724921030836.1656f2a0.png"},6044:function(s,n,t){s.exports=t.p+"assets/img/1724921195113.228f4ba0.png"}}]);