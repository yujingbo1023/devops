<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>47-EFLK | devops</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/devops/public/favicon.ico">
    <meta name="description" content="快来玩devops">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/devops/public/assets/css/0.styles.4a69f283.css" as="style"><link rel="preload" href="/devops/public/assets/js/app.7d569ec8.js" as="script"><link rel="preload" href="/devops/public/assets/js/118.ceed6ab6.js" as="script"><link rel="preload" href="/devops/public/assets/js/1.774fca24.js" as="script"><link rel="preload" href="/devops/public/assets/js/101.4f407383.js" as="script"><link rel="prefetch" href="/devops/public/assets/js/10.4b3dc242.js"><link rel="prefetch" href="/devops/public/assets/js/100.7e9737a0.js"><link rel="prefetch" href="/devops/public/assets/js/102.88df873d.js"><link rel="prefetch" href="/devops/public/assets/js/103.232cdd53.js"><link rel="prefetch" href="/devops/public/assets/js/104.63edad81.js"><link rel="prefetch" href="/devops/public/assets/js/105.94b75f04.js"><link rel="prefetch" href="/devops/public/assets/js/106.6373983a.js"><link rel="prefetch" href="/devops/public/assets/js/107.67cb9c57.js"><link rel="prefetch" href="/devops/public/assets/js/108.0e591817.js"><link rel="prefetch" href="/devops/public/assets/js/109.441c2844.js"><link rel="prefetch" href="/devops/public/assets/js/11.06fc3f92.js"><link rel="prefetch" href="/devops/public/assets/js/110.39a7ec3f.js"><link rel="prefetch" href="/devops/public/assets/js/111.fded3579.js"><link rel="prefetch" href="/devops/public/assets/js/112.51b1c07d.js"><link rel="prefetch" href="/devops/public/assets/js/113.cbde1400.js"><link rel="prefetch" href="/devops/public/assets/js/114.54c309a6.js"><link rel="prefetch" href="/devops/public/assets/js/115.c26a1569.js"><link rel="prefetch" href="/devops/public/assets/js/116.4255514c.js"><link rel="prefetch" href="/devops/public/assets/js/117.9d1c6533.js"><link rel="prefetch" href="/devops/public/assets/js/119.e3285804.js"><link rel="prefetch" href="/devops/public/assets/js/12.63c3c1f3.js"><link rel="prefetch" href="/devops/public/assets/js/120.cf720ee7.js"><link rel="prefetch" href="/devops/public/assets/js/121.dbfa8623.js"><link rel="prefetch" href="/devops/public/assets/js/122.e7cdec31.js"><link rel="prefetch" href="/devops/public/assets/js/123.09b7084c.js"><link rel="prefetch" href="/devops/public/assets/js/124.de003a1c.js"><link rel="prefetch" href="/devops/public/assets/js/125.a50dcdf1.js"><link rel="prefetch" href="/devops/public/assets/js/126.88d2a88b.js"><link rel="prefetch" href="/devops/public/assets/js/127.fb481961.js"><link rel="prefetch" href="/devops/public/assets/js/128.f9790158.js"><link rel="prefetch" href="/devops/public/assets/js/129.ca6d8d1e.js"><link rel="prefetch" href="/devops/public/assets/js/13.ae18e270.js"><link rel="prefetch" href="/devops/public/assets/js/130.d4397eb5.js"><link rel="prefetch" href="/devops/public/assets/js/131.8a8751be.js"><link rel="prefetch" href="/devops/public/assets/js/132.e98fc40e.js"><link rel="prefetch" href="/devops/public/assets/js/133.46139fda.js"><link rel="prefetch" href="/devops/public/assets/js/134.76167714.js"><link rel="prefetch" href="/devops/public/assets/js/135.5adcd3ae.js"><link rel="prefetch" href="/devops/public/assets/js/136.31fabd54.js"><link rel="prefetch" href="/devops/public/assets/js/137.770dcb44.js"><link rel="prefetch" href="/devops/public/assets/js/138.d4d75a71.js"><link rel="prefetch" href="/devops/public/assets/js/139.9b2c0400.js"><link rel="prefetch" href="/devops/public/assets/js/14.846ec1ae.js"><link rel="prefetch" href="/devops/public/assets/js/140.ba28df97.js"><link rel="prefetch" href="/devops/public/assets/js/141.c592e630.js"><link rel="prefetch" href="/devops/public/assets/js/142.1dcaafb9.js"><link rel="prefetch" href="/devops/public/assets/js/143.1f4482aa.js"><link rel="prefetch" href="/devops/public/assets/js/144.8079a63b.js"><link rel="prefetch" href="/devops/public/assets/js/145.ccd6ab9a.js"><link rel="prefetch" href="/devops/public/assets/js/146.8fea1826.js"><link rel="prefetch" href="/devops/public/assets/js/147.0cc3f908.js"><link rel="prefetch" href="/devops/public/assets/js/148.bd25ee49.js"><link rel="prefetch" href="/devops/public/assets/js/149.abbd5278.js"><link rel="prefetch" href="/devops/public/assets/js/15.4d3a65ab.js"><link rel="prefetch" href="/devops/public/assets/js/150.f8e586e7.js"><link rel="prefetch" href="/devops/public/assets/js/151.eb4608fb.js"><link rel="prefetch" href="/devops/public/assets/js/152.6fe48680.js"><link rel="prefetch" href="/devops/public/assets/js/153.fb81e647.js"><link rel="prefetch" href="/devops/public/assets/js/154.1dd41cd6.js"><link rel="prefetch" href="/devops/public/assets/js/155.7386b9d0.js"><link rel="prefetch" href="/devops/public/assets/js/156.905e683b.js"><link rel="prefetch" href="/devops/public/assets/js/157.9e6bcc59.js"><link rel="prefetch" href="/devops/public/assets/js/158.36be0417.js"><link rel="prefetch" href="/devops/public/assets/js/159.631e0344.js"><link rel="prefetch" href="/devops/public/assets/js/16.a8b5e9a2.js"><link rel="prefetch" href="/devops/public/assets/js/160.fda7f4b2.js"><link rel="prefetch" href="/devops/public/assets/js/161.b3c13652.js"><link rel="prefetch" href="/devops/public/assets/js/162.d7fe03d5.js"><link rel="prefetch" href="/devops/public/assets/js/163.09534a90.js"><link rel="prefetch" href="/devops/public/assets/js/164.7d75373f.js"><link rel="prefetch" href="/devops/public/assets/js/165.23f70364.js"><link rel="prefetch" href="/devops/public/assets/js/166.3d1cde51.js"><link rel="prefetch" href="/devops/public/assets/js/167.0dca6275.js"><link rel="prefetch" href="/devops/public/assets/js/168.71a8b2fd.js"><link rel="prefetch" href="/devops/public/assets/js/169.ee61c785.js"><link rel="prefetch" href="/devops/public/assets/js/17.0be8e72a.js"><link rel="prefetch" href="/devops/public/assets/js/170.fb4e3bc0.js"><link rel="prefetch" href="/devops/public/assets/js/171.4abe3ecb.js"><link rel="prefetch" href="/devops/public/assets/js/172.4104fd87.js"><link rel="prefetch" href="/devops/public/assets/js/173.355a3afc.js"><link rel="prefetch" href="/devops/public/assets/js/174.6b396fee.js"><link rel="prefetch" href="/devops/public/assets/js/175.a907bc60.js"><link rel="prefetch" href="/devops/public/assets/js/176.1b2086ee.js"><link rel="prefetch" href="/devops/public/assets/js/177.9fa24bdc.js"><link rel="prefetch" href="/devops/public/assets/js/178.5f5e1279.js"><link rel="prefetch" href="/devops/public/assets/js/179.ec4875a4.js"><link rel="prefetch" href="/devops/public/assets/js/18.b1b29ad5.js"><link rel="prefetch" href="/devops/public/assets/js/180.e6976024.js"><link rel="prefetch" href="/devops/public/assets/js/181.32906757.js"><link rel="prefetch" href="/devops/public/assets/js/182.09691c46.js"><link rel="prefetch" href="/devops/public/assets/js/183.00199713.js"><link rel="prefetch" href="/devops/public/assets/js/184.e0c72fe0.js"><link rel="prefetch" href="/devops/public/assets/js/185.67b6b9d4.js"><link rel="prefetch" href="/devops/public/assets/js/186.7045b54c.js"><link rel="prefetch" href="/devops/public/assets/js/187.4649fa5f.js"><link rel="prefetch" href="/devops/public/assets/js/188.796ce41e.js"><link rel="prefetch" href="/devops/public/assets/js/189.809ffb5e.js"><link rel="prefetch" href="/devops/public/assets/js/19.39c3a2ff.js"><link rel="prefetch" href="/devops/public/assets/js/190.83e3881c.js"><link rel="prefetch" href="/devops/public/assets/js/191.6b715782.js"><link rel="prefetch" href="/devops/public/assets/js/192.cf6a4017.js"><link rel="prefetch" href="/devops/public/assets/js/193.f98ae362.js"><link rel="prefetch" href="/devops/public/assets/js/194.5246dc3c.js"><link rel="prefetch" href="/devops/public/assets/js/195.428e9bf0.js"><link rel="prefetch" href="/devops/public/assets/js/196.d076a50c.js"><link rel="prefetch" href="/devops/public/assets/js/197.55c2ac67.js"><link rel="prefetch" href="/devops/public/assets/js/198.ed0cde4d.js"><link rel="prefetch" href="/devops/public/assets/js/199.dd2dc49f.js"><link rel="prefetch" href="/devops/public/assets/js/20.59cbe9ee.js"><link rel="prefetch" href="/devops/public/assets/js/200.afa56a7b.js"><link rel="prefetch" href="/devops/public/assets/js/201.44c3622b.js"><link rel="prefetch" href="/devops/public/assets/js/202.2c42452a.js"><link rel="prefetch" href="/devops/public/assets/js/203.8299dd5d.js"><link rel="prefetch" href="/devops/public/assets/js/204.de069d66.js"><link rel="prefetch" href="/devops/public/assets/js/205.5ab0783c.js"><link rel="prefetch" href="/devops/public/assets/js/206.74754152.js"><link rel="prefetch" href="/devops/public/assets/js/207.41f0d4bf.js"><link rel="prefetch" href="/devops/public/assets/js/208.0483952b.js"><link rel="prefetch" href="/devops/public/assets/js/209.1aca4a3b.js"><link rel="prefetch" href="/devops/public/assets/js/21.23a83f02.js"><link rel="prefetch" href="/devops/public/assets/js/210.d0341dbd.js"><link rel="prefetch" href="/devops/public/assets/js/211.72dd5390.js"><link rel="prefetch" href="/devops/public/assets/js/212.e59e466c.js"><link rel="prefetch" href="/devops/public/assets/js/213.1373aac1.js"><link rel="prefetch" href="/devops/public/assets/js/214.d307ec31.js"><link rel="prefetch" href="/devops/public/assets/js/215.4a0a213e.js"><link rel="prefetch" href="/devops/public/assets/js/216.81ad789b.js"><link rel="prefetch" href="/devops/public/assets/js/217.33796242.js"><link rel="prefetch" href="/devops/public/assets/js/218.23843efb.js"><link rel="prefetch" href="/devops/public/assets/js/219.623b1168.js"><link rel="prefetch" href="/devops/public/assets/js/22.58c6461b.js"><link rel="prefetch" href="/devops/public/assets/js/220.381ab176.js"><link rel="prefetch" href="/devops/public/assets/js/221.deb3d1a8.js"><link rel="prefetch" href="/devops/public/assets/js/222.96ec6a5e.js"><link rel="prefetch" href="/devops/public/assets/js/223.7954bc0b.js"><link rel="prefetch" href="/devops/public/assets/js/224.16208c8d.js"><link rel="prefetch" href="/devops/public/assets/js/225.b805f0e3.js"><link rel="prefetch" href="/devops/public/assets/js/226.d2669939.js"><link rel="prefetch" href="/devops/public/assets/js/227.e72b90c5.js"><link rel="prefetch" href="/devops/public/assets/js/228.d072128c.js"><link rel="prefetch" href="/devops/public/assets/js/229.69495a9e.js"><link rel="prefetch" href="/devops/public/assets/js/23.59f9044f.js"><link rel="prefetch" href="/devops/public/assets/js/230.9c66543d.js"><link rel="prefetch" href="/devops/public/assets/js/231.7ab60f29.js"><link rel="prefetch" href="/devops/public/assets/js/232.fc6e5785.js"><link rel="prefetch" href="/devops/public/assets/js/233.0a0d2736.js"><link rel="prefetch" href="/devops/public/assets/js/234.a49950b6.js"><link rel="prefetch" href="/devops/public/assets/js/235.71140234.js"><link rel="prefetch" href="/devops/public/assets/js/236.6b828578.js"><link rel="prefetch" href="/devops/public/assets/js/237.9549e649.js"><link rel="prefetch" href="/devops/public/assets/js/238.1657f6b5.js"><link rel="prefetch" href="/devops/public/assets/js/239.289ab239.js"><link rel="prefetch" href="/devops/public/assets/js/24.be9ada1f.js"><link rel="prefetch" href="/devops/public/assets/js/240.fc170ba3.js"><link rel="prefetch" href="/devops/public/assets/js/241.43426c9a.js"><link rel="prefetch" href="/devops/public/assets/js/242.8afb0c9d.js"><link rel="prefetch" href="/devops/public/assets/js/243.2fdaef18.js"><link rel="prefetch" href="/devops/public/assets/js/244.2d9089b1.js"><link rel="prefetch" href="/devops/public/assets/js/245.6b4f42e0.js"><link rel="prefetch" href="/devops/public/assets/js/246.9d904f58.js"><link rel="prefetch" href="/devops/public/assets/js/247.99c2e8c5.js"><link rel="prefetch" href="/devops/public/assets/js/248.c877bb00.js"><link rel="prefetch" href="/devops/public/assets/js/249.946e5fde.js"><link rel="prefetch" href="/devops/public/assets/js/25.d209b773.js"><link rel="prefetch" href="/devops/public/assets/js/250.57c4d59a.js"><link rel="prefetch" href="/devops/public/assets/js/251.9c50e024.js"><link rel="prefetch" href="/devops/public/assets/js/252.5e1e216a.js"><link rel="prefetch" href="/devops/public/assets/js/253.bca6a43e.js"><link rel="prefetch" href="/devops/public/assets/js/254.32f9a9e4.js"><link rel="prefetch" href="/devops/public/assets/js/255.aa4f14d3.js"><link rel="prefetch" href="/devops/public/assets/js/256.0c175cdf.js"><link rel="prefetch" href="/devops/public/assets/js/257.2e86393d.js"><link rel="prefetch" href="/devops/public/assets/js/258.5b4e2b8d.js"><link rel="prefetch" href="/devops/public/assets/js/259.9b5ea8a1.js"><link rel="prefetch" href="/devops/public/assets/js/26.37cff05a.js"><link rel="prefetch" href="/devops/public/assets/js/260.11200c5e.js"><link rel="prefetch" href="/devops/public/assets/js/261.b8c7584a.js"><link rel="prefetch" href="/devops/public/assets/js/262.a917d897.js"><link rel="prefetch" href="/devops/public/assets/js/263.47e5f082.js"><link rel="prefetch" href="/devops/public/assets/js/264.1da268c2.js"><link rel="prefetch" href="/devops/public/assets/js/265.6cfa0237.js"><link rel="prefetch" href="/devops/public/assets/js/266.b03f016c.js"><link rel="prefetch" href="/devops/public/assets/js/267.1abc3909.js"><link rel="prefetch" href="/devops/public/assets/js/27.17674ffe.js"><link rel="prefetch" href="/devops/public/assets/js/28.8675ef43.js"><link rel="prefetch" href="/devops/public/assets/js/29.1bbb3c84.js"><link rel="prefetch" href="/devops/public/assets/js/3.35a3f762.js"><link rel="prefetch" href="/devops/public/assets/js/30.e3c5f1e5.js"><link rel="prefetch" href="/devops/public/assets/js/31.e96cf53b.js"><link rel="prefetch" href="/devops/public/assets/js/32.6d39a578.js"><link rel="prefetch" href="/devops/public/assets/js/33.19fff795.js"><link rel="prefetch" href="/devops/public/assets/js/34.7d131903.js"><link rel="prefetch" href="/devops/public/assets/js/35.69f1e115.js"><link rel="prefetch" href="/devops/public/assets/js/36.962c3523.js"><link rel="prefetch" href="/devops/public/assets/js/37.8a283b7c.js"><link rel="prefetch" href="/devops/public/assets/js/38.fcdfdbf3.js"><link rel="prefetch" href="/devops/public/assets/js/39.08499321.js"><link rel="prefetch" href="/devops/public/assets/js/4.66c9c5f3.js"><link rel="prefetch" href="/devops/public/assets/js/40.ecd69e9f.js"><link rel="prefetch" href="/devops/public/assets/js/41.991b6203.js"><link rel="prefetch" href="/devops/public/assets/js/42.56bacc28.js"><link rel="prefetch" href="/devops/public/assets/js/43.54713f51.js"><link rel="prefetch" href="/devops/public/assets/js/44.5aebcd50.js"><link rel="prefetch" href="/devops/public/assets/js/45.bde76db1.js"><link rel="prefetch" href="/devops/public/assets/js/46.9ccbd788.js"><link rel="prefetch" href="/devops/public/assets/js/47.00d25425.js"><link rel="prefetch" href="/devops/public/assets/js/48.ec5edda8.js"><link rel="prefetch" href="/devops/public/assets/js/49.c64c870e.js"><link rel="prefetch" href="/devops/public/assets/js/5.8e21f9d3.js"><link rel="prefetch" href="/devops/public/assets/js/50.38e1ea84.js"><link rel="prefetch" href="/devops/public/assets/js/51.1a911c4e.js"><link rel="prefetch" href="/devops/public/assets/js/52.92139cf1.js"><link rel="prefetch" href="/devops/public/assets/js/53.89b06a8f.js"><link rel="prefetch" href="/devops/public/assets/js/54.6c248a88.js"><link rel="prefetch" href="/devops/public/assets/js/55.45770749.js"><link rel="prefetch" href="/devops/public/assets/js/56.41b65466.js"><link rel="prefetch" href="/devops/public/assets/js/57.eaec9e9b.js"><link rel="prefetch" href="/devops/public/assets/js/58.a9a07b8c.js"><link rel="prefetch" href="/devops/public/assets/js/59.d7a5afc3.js"><link rel="prefetch" href="/devops/public/assets/js/6.9150baff.js"><link rel="prefetch" href="/devops/public/assets/js/60.66cf40bb.js"><link rel="prefetch" href="/devops/public/assets/js/61.e089eb14.js"><link rel="prefetch" href="/devops/public/assets/js/62.ce34e7ad.js"><link rel="prefetch" href="/devops/public/assets/js/63.c4dba709.js"><link rel="prefetch" href="/devops/public/assets/js/64.d2520c76.js"><link rel="prefetch" href="/devops/public/assets/js/65.ece2cc2e.js"><link rel="prefetch" href="/devops/public/assets/js/66.12cb968c.js"><link rel="prefetch" href="/devops/public/assets/js/67.c7ab28aa.js"><link rel="prefetch" href="/devops/public/assets/js/68.72df026a.js"><link rel="prefetch" href="/devops/public/assets/js/69.1951131c.js"><link rel="prefetch" href="/devops/public/assets/js/7.e4e8b6c2.js"><link rel="prefetch" href="/devops/public/assets/js/70.d8c73257.js"><link rel="prefetch" href="/devops/public/assets/js/71.ade4bf7c.js"><link rel="prefetch" href="/devops/public/assets/js/72.e48ba840.js"><link rel="prefetch" href="/devops/public/assets/js/73.3951cd3c.js"><link rel="prefetch" href="/devops/public/assets/js/74.cc4a2931.js"><link rel="prefetch" href="/devops/public/assets/js/75.65e448ff.js"><link rel="prefetch" href="/devops/public/assets/js/76.d13793b7.js"><link rel="prefetch" href="/devops/public/assets/js/77.6bb99700.js"><link rel="prefetch" href="/devops/public/assets/js/78.f306fed8.js"><link rel="prefetch" href="/devops/public/assets/js/79.47710d29.js"><link rel="prefetch" href="/devops/public/assets/js/8.5e170c36.js"><link rel="prefetch" href="/devops/public/assets/js/80.dddd989f.js"><link rel="prefetch" href="/devops/public/assets/js/81.cec9077e.js"><link rel="prefetch" href="/devops/public/assets/js/82.79a7325c.js"><link rel="prefetch" href="/devops/public/assets/js/83.6ed1bf3b.js"><link rel="prefetch" href="/devops/public/assets/js/84.6cdba99d.js"><link rel="prefetch" href="/devops/public/assets/js/85.37401841.js"><link rel="prefetch" href="/devops/public/assets/js/86.e71bb44f.js"><link rel="prefetch" href="/devops/public/assets/js/87.914543b0.js"><link rel="prefetch" href="/devops/public/assets/js/88.df906855.js"><link rel="prefetch" href="/devops/public/assets/js/89.ec43c2d4.js"><link rel="prefetch" href="/devops/public/assets/js/9.8e2307c4.js"><link rel="prefetch" href="/devops/public/assets/js/90.3a6d82e0.js"><link rel="prefetch" href="/devops/public/assets/js/91.1ad4d666.js"><link rel="prefetch" href="/devops/public/assets/js/92.ddc90ed2.js"><link rel="prefetch" href="/devops/public/assets/js/93.be43f77f.js"><link rel="prefetch" href="/devops/public/assets/js/94.d6f0bc7d.js"><link rel="prefetch" href="/devops/public/assets/js/95.e6846831.js"><link rel="prefetch" href="/devops/public/assets/js/96.5a7d5ba0.js"><link rel="prefetch" href="/devops/public/assets/js/97.5da431ca.js"><link rel="prefetch" href="/devops/public/assets/js/98.d063cf07.js"><link rel="prefetch" href="/devops/public/assets/js/99.34847663.js">
    <link rel="stylesheet" href="/devops/public/assets/css/0.styles.4a69f283.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>devops</h3> <p class="description" data-v-59e6cb88>快来玩devops</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>devops</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/devops/public/" class="home-link router-link-active"><img src="/devops/public/logo.png" alt="devops" class="logo"> <span class="site-name">devops</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/devops/public/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      devops
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/public/categories/前端技术栈/" class="nav-link"><i class="undefined"></i>
  前端技术栈
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/HarmonyOS/" class="nav-link"><i class="undefined"></i>
  HarmonyOS
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/data analysis/" class="nav-link"><i class="undefined"></i>
  data analysis
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/devops/" class="nav-link"><i class="undefined"></i>
  devops
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/每日一题/" class="nav-link"><i class="undefined"></i>
  每日一题
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/javabase/" class="nav-link"><i class="undefined"></i>
  javabase
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/javaweb/" class="nav-link"><i class="undefined"></i>
  javaweb
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/linux/" class="nav-link"><i class="undefined"></i>
  linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/pybase/" class="nav-link"><i class="undefined"></i>
  pybase
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/springcloud/" class="nav-link"><i class="undefined"></i>
  springcloud
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/spider/" class="nav-link"><i class="undefined"></i>
  spider
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/springcloudalibaba/" class="nav-link"><i class="undefined"></i>
  springcloudalibaba
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/ssm/" class="nav-link"><i class="undefined"></i>
  ssm
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/storage/" class="nav-link"><i class="undefined"></i>
  storage
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/zhifu/" class="nav-link"><i class="undefined"></i>
  zhifu
</a></li></ul></div></div><div class="nav-item"><a href="/devops/public/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/devops/public/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/public/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/devops/public/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    devops
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>243</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>43</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/devops/public/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      devops
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/public/categories/前端技术栈/" class="nav-link"><i class="undefined"></i>
  前端技术栈
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/HarmonyOS/" class="nav-link"><i class="undefined"></i>
  HarmonyOS
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/data analysis/" class="nav-link"><i class="undefined"></i>
  data analysis
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/devops/" class="nav-link"><i class="undefined"></i>
  devops
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/每日一题/" class="nav-link"><i class="undefined"></i>
  每日一题
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/javabase/" class="nav-link"><i class="undefined"></i>
  javabase
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/javaweb/" class="nav-link"><i class="undefined"></i>
  javaweb
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/linux/" class="nav-link"><i class="undefined"></i>
  linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/pybase/" class="nav-link"><i class="undefined"></i>
  pybase
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/springcloud/" class="nav-link"><i class="undefined"></i>
  springcloud
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/spider/" class="nav-link"><i class="undefined"></i>
  spider
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/springcloudalibaba/" class="nav-link"><i class="undefined"></i>
  springcloudalibaba
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/ssm/" class="nav-link"><i class="undefined"></i>
  ssm
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/storage/" class="nav-link"><i class="undefined"></i>
  storage
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/zhifu/" class="nav-link"><i class="undefined"></i>
  zhifu
</a></li></ul></div></div><div class="nav-item"><a href="/devops/public/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/devops/public/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/public/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>47-EFLK</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>devops</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">47-EFLK</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>devops</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>12/15/2028</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>devops</span></i></div></div> <div class="theme-reco-content content__default"><h3 id="_1-单机部署es"><a href="#_1-单机部署es" class="header-anchor">#</a> 1，单机部署ES</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.下载ES软件包
<span class="token function">wget</span> https://artifacts.elastic.co/downloads/elasticsearch/elasticsearch-7.17.23-amd64.deb

<span class="token number">2</span>.安装ES软件包 
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># dpkg -i elasticsearch-7.17.23-amd64.deb </span>

<span class="token number">3</span>.添加别名<span class="token punctuation">(</span>可选操作<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># vim .bashrc </span>
<span class="token punctuation">..</span>.
	<span class="token builtin class-name">alias</span> <span class="token assign-left variable">yy</span><span class="token operator">=</span><span class="token string">'egrep -v &quot;^.*#|^$&quot;'</span> 

<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># source .bashrc</span>

<span class="token number">4</span>.修改ES的配置文件
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/elasticsearch/elasticsearch.yml </span>
<span class="token punctuation">..</span>.
<span class="token comment"># 指定集群的名称</span>
cluster.name: maluedu
<span class="token comment"># 指定数据的路径</span>
path.data: /var/lib/elasticsearch
<span class="token comment"># 指定日志的路径</span>
path.logs: /var/log/elasticsearch
<span class="token comment"># 指定监听的IP地址</span>
network.host: <span class="token number">0.0</span>.0.0
<span class="token comment"># 指定监听的端口号</span>
http.port: <span class="token number">9200</span>
<span class="token comment"># 指定当前节点是一个单点而非集群</span>
discovery.type: single-node

<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># yy /etc/elasticsearch/elasticsearch.yml </span>
cluster.name: oldboyedu-linux94
path.data: /var/lib/elasticsearch
path.logs: /var/log/elasticsearch
network.host: <span class="token number">0.0</span>.0.0
http.port: <span class="token number">9200</span>
discovery.type: single-node
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">5</span>.启动ES服务
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable --now elasticsearch.service</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># ss -ntl | egrep &quot;9200|9300&quot;</span>
LISTEN <span class="token number">0</span>      <span class="token number">4096</span>               *:9300            *:*          
LISTEN <span class="token number">0</span>      <span class="token number">4096</span>               *:9200            *:*          
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>

	
<span class="token number">6</span>.访问测试 
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># curl 10.0.0.91:9200</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;elk91&quot;</span>,
  <span class="token string">&quot;cluster_name&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;maluedu&quot;</span>,
  <span class="token string">&quot;cluster_uuid&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;Kb3MqlwYTmqFfQ8Kw_u57A&quot;</span>,
  <span class="token string">&quot;version&quot;</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;number&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;7.17.23&quot;</span>,
    <span class="token string">&quot;build_flavor&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;default&quot;</span>,
    <span class="token string">&quot;build_type&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;deb&quot;</span>,
    <span class="token string">&quot;build_hash&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;61d76462eecaf09ada684d1b5d319b5ff6865a83&quot;</span>,
    <span class="token string">&quot;build_date&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;2024-07-25T14:37:42.448799567Z&quot;</span>,
    <span class="token string">&quot;build_snapshot&quot;</span> <span class="token builtin class-name">:</span> false,
    <span class="token string">&quot;lucene_version&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;8.11.3&quot;</span>,
    <span class="token string">&quot;minimum_wire_compatibility_version&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;6.8.0&quot;</span>,
    <span class="token string">&quot;minimum_index_compatibility_version&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;6.0.0-beta1&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;tagline&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;You Know, for Search&quot;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># curl 10.0.0.91:9200/_cat/nodes</span>
<span class="token number">10.0</span>.0.91 <span class="token number">8</span> <span class="token number">97</span> <span class="token number">15</span> <span class="token number">0.27</span> <span class="token number">0.14</span> <span class="token number">0.05</span> cdfhilmrstw * elk91
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><h3 id="_2-单节点升级为es集群"><a href="#_2-单节点升级为es集群" class="header-anchor">#</a> 2，单节点升级为ES集群</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.拷贝安装包到其他节点
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp elasticsearch-7.17.23-amd64.deb 10.0.0.92:~</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp elasticsearch-7.17.23-amd64.deb 10.0.0.93:~</span>

<span class="token number">2</span>.其他节点安装ES服务
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># dpkg -i elasticsearch-7.17.23-amd64.deb </span>
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># dpkg -i elasticsearch-7.17.23-amd64.deb </span>


<span class="token number">3</span>.elk93节点停止服务
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop elasticsearch.service </span>

<span class="token number">4</span>.修改配置文件 
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># yy /etc/elasticsearch/elasticsearch.yml </span>
cluster.name: maluedu
path.data: /var/lib/elasticsearch
path.logs: /var/log/elasticsearch
network.host: <span class="token number">0.0</span>.0.0
http.port: <span class="token number">9200</span>
discovery.seed_hosts: <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.91&quot;</span>, <span class="token string">&quot;10.0.0.92&quot;</span>,<span class="token string">&quot;10.0.0.93&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">5</span>.将配置文件同步到其他节点 
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp /etc/elasticsearch/elasticsearch.yml 10.0.0.92:/etc/elasticsearch/</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp /etc/elasticsearch/elasticsearch.yml 10.0.0.93:/etc/elasticsearch/</span>


<span class="token number">6</span>.启动服务
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable --now elasticsearch</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable --now elasticsearch</span>
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable --now elasticsearch</span>


<span class="token number">7</span>.验证服务是否启动成功
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># curl 10.0.0.93:9200/_cat/nodes</span>
<span class="token number">10.0</span>.0.93  <span class="token number">4</span> <span class="token number">97</span> <span class="token number">22</span> <span class="token number">0.49</span> <span class="token number">0.21</span> <span class="token number">0.07</span> cdfhilmrstw - elk93
<span class="token number">10.0</span>.0.92 <span class="token number">29</span> <span class="token number">97</span> <span class="token number">24</span> <span class="token number">0.57</span> <span class="token number">0.22</span> <span class="token number">0.08</span> cdfhilmrstw - elk92
<span class="token number">10.0</span>.0.91 <span class="token number">14</span> <span class="token number">97</span> <span class="token number">24</span> <span class="token number">0.60</span> <span class="token number">0.21</span> <span class="token number">0.07</span> cdfhilmrstw * elk91
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># for i in  91 92 93; do curl -s 10.0.0.$i:9200 | grep cluster_uuid;done</span>
  <span class="token string">&quot;cluster_uuid&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;Kb3MqlwYTmqFfQ8Kw_u57A&quot;</span>,
  <span class="token string">&quot;cluster_uuid&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;Kb3MqlwYTmqFfQ8Kw_u57A&quot;</span>,
  <span class="token string">&quot;cluster_uuid&quot;</span> <span class="token builtin class-name">:</span> <span class="token string">&quot;Kb3MqlwYTmqFfQ8Kw_u57A&quot;</span>,
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="_3-es常见术语"><a href="#_3-es常见术语" class="header-anchor">#</a> 3，ES常见术语</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>ES常见术语:
	索引:  index
		一个ES集群可以有多个索引，索引是用户进行数据读写的逻辑单元。
		
	分片: shard
		一个索引最少对应一个分片，实际工作中一个索引尽量对应多个分片，以便于数据的分布式存储。
		同一个分片只能属于同一个节点。
		
	副本: replica
		对分片进行备份的副本分片。副本和分片不能在同一个节点上。
		
	文档: document
		实际用户存储的数据。
		
		源数据:
			用户实际存储的数据。
	
		元数据:
			用于描述源数据的数据。
	
	分配: allocation
		指的是将索引的不同分片分配到整个集群的过程。
	
	
面试题讲解:
	Q1: ES集群监听哪些端口，协议及作用？
		<span class="token number">9200</span>：
			http<span class="token operator">|</span>https，对外提供服务的端口。
			
		<span class="token number">9300</span>:
			tcp，ES集群内部数据传输的端口。
			
		
	Q2: ES集群的颜色有哪些？
		Green：
			表示所有的主分片和副本分片均可以正常访问。
			
		Yellow：
			表示部分副本分片无法访问。
			
		Red：
			表示副本主分片无法访问，如果主分片没有对应的副本，则数据丢失！
			一般情况下不会遇到这种情况，除非在ES集群重启时会短暂出现。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br></div></div><h3 id="_4-es的索引api管理实战"><a href="#_4-es的索引api管理实战" class="header-anchor">#</a> 4，ES的索引API管理实战</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>创建索引:

ES默认创建1分片和1副本 
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># curl -X PUT 10.0.0.92:9200/maluedu-linux001</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># curl 10.0.0.92:9200/_cat/indices?v</span>
health status index              uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  <span class="token function">open</span>   .geoip_databases   wo00ecWxQFuqvDBImZpA8A   <span class="token number">1</span>   <span class="token number">1</span>         <span class="token number">38</span>            <span class="token number">0</span>     <span class="token number">73</span>.5mb         <span class="token number">36</span>.7mb
green  <span class="token function">open</span>   oldboyedu-linux001 bgQCZL8XTXazjuSTj9tDew   <span class="token number">1</span>   <span class="token number">1</span>          <span class="token number">0</span>            <span class="token number">0</span>       454b           227b
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>

ES创建索引时可以自定义分片和副本
<span class="token function">curl</span> <span class="token parameter variable">-X</span> PUT <span class="token string">'http://10.0.0.91:9200/maluedu-linux002'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-H</span> <span class="token string">'Content-Type: application/json'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token string">'{
    &quot;settings&quot;: {
        &quot;number_of_shards&quot;: 3,
        &quot;number_of_replicas&quot;: 0
    }
}'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>查看索引：
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># curl 10.0.0.92:9200/_cat/indices?v</span>
health status index              uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  <span class="token function">open</span>   .geoip_databases   wo00ecWxQFuqvDBImZpA8A   <span class="token number">1</span>   <span class="token number">1</span>         <span class="token number">38</span>            <span class="token number">0</span>     <span class="token number">73</span>.5mb         <span class="token number">36</span>.7mb
green  <span class="token function">open</span>   maluedu-linux002 Re4FJJSuRSuv0a9gOn22-g   <span class="token number">3</span>   <span class="token number">0</span>          <span class="token number">0</span>            <span class="token number">0</span>       681b           681b
green  <span class="token function">open</span>   maluedu-linux001 bgQCZL8XTXazjuSTj9tDew   <span class="token number">1</span>   <span class="token number">1</span>          <span class="token number">0</span>            <span class="token number">0</span>       454b           227b
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>删除索引:
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># curl  -X DELETE 'http://10.0.0.91:9200/maluedu-linux001' </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># curl 10.0.0.92:9200/_cat/indices?v</span>
health status index              uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  <span class="token function">open</span>   .geoip_databases   wo00ecWxQFuqvDBImZpA8A   <span class="token number">1</span>   <span class="token number">1</span>         <span class="token number">38</span>            <span class="token number">0</span>     <span class="token number">73</span>.5mb         <span class="token number">36</span>.7mb
green  <span class="token function">open</span>   maluedu-linux002 Re4FJJSuRSuv0a9gOn22-g   <span class="token number">3</span>   <span class="token number">0</span>          <span class="token number">0</span>            <span class="token number">0</span>       681b           681b
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>修改索引:
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># curl  -X PUT 'http://10.0.0.91:9200/maluedu-linux002/_settings' \</span>
<span class="token parameter variable">-H</span> <span class="token string">'Content-Type: application/json'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token string">'{
    &quot;number_of_replicas&quot;: 1
}'</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># curl 10.0.0.92:9200/_cat/indices?v</span>
health status index              uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  <span class="token function">open</span>   .geoip_databases   wo00ecWxQFuqvDBImZpA8A   <span class="token number">1</span>   <span class="token number">1</span>         <span class="token number">38</span>            <span class="token number">0</span>     <span class="token number">73</span>.5mb         <span class="token number">36</span>.7mb
green  <span class="token function">open</span>   maluedu-linux002 Re4FJJSuRSuv0a9gOn22-g   <span class="token number">3</span>   <span class="token number">1</span>          <span class="token number">0</span>            <span class="token number">0</span>      <span class="token number">1</span>.3kb           681b
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>删除所有索引:（生产环境中要禁用此功能！）
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># curl  -X DELETE 'http://10.0.0.91:9200/*' </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>- ES的API验证数据的存储和读取

- 写入测试数据
<span class="token function">curl</span> <span class="token parameter variable">--location</span> <span class="token parameter variable">--request</span> POST <span class="token string">'http://10.0.0.91:9200/_bulk'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">--header</span> <span class="token string">'Content-Type: application/json'</span> <span class="token punctuation">\</span>
--data-raw <span class="token string">'{&quot;index&quot; : { &quot;_index&quot; : &quot;maluedu-xiyouji&quot;} }
{&quot;name&quot;: &quot;孙悟空&quot;,&quot;hobby&quot;: [&quot;蟠桃&quot;,&quot;紫霞仙子&quot;,&quot;人参果&quot;]} 
{&quot;index&quot; : { &quot;_index&quot; : &quot;maluedu-xiyouji&quot;} }
{&quot;name&quot;: &quot;猪八戒&quot;,&quot;hobby&quot;: [&quot;嫦娥&quot;,&quot;高小姐&quot;,&quot;蜘蛛精&quot;]}
{&quot;index&quot; : { &quot;_index&quot; : &quot;maluedu-xiyouji&quot;} }
{&quot;name&quot;: &quot;沙和尚&quot;,&quot;hobby&quot;: [&quot;唐僧肉&quot;,&quot;挑行李&quot;]}
{&quot;index&quot; : { &quot;_index&quot; : &quot;maluedu-xiyouji&quot;} }
{&quot;name&quot;: &quot;唐三藏&quot;,&quot;hobby&quot;: [&quot;女儿国&quot;,&quot;人参果&quot;]} 
'</span>



- 查询数据
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># curl 10.0.0.92:9200/_cat/indices?v</span>
health status index                     uuid                   pri rep docs.count docs.deleted store.size pri.store.size
green  <span class="token function">open</span>   .geoip_databases          wo00ecWxQFuqvDBImZpA8A   <span class="token number">1</span>   <span class="token number">1</span>         <span class="token number">38</span>            <span class="token number">0</span>     <span class="token number">73</span>.5mb         <span class="token number">36</span>.7mb
green  <span class="token function">open</span>   maluedu-xiyouji KRluEy-1SDKIqprlHIOlfA   <span class="token number">1</span>   <span class="token number">1</span>          <span class="token number">4</span>            <span class="token number">0</span>     <span class="token number">10</span>.4kb          <span class="token number">5</span>.1kb
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">1</span>.查询所有数据
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># apt -y install jq</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># curl -s http://10.0.0.91:9200/maluedu-xiyouji/_search | jq</span>
<span class="token punctuation">..</span>.

<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">2</span>.查询爱好包含<span class="token string">&quot;人参果&quot;</span>的人物有哪些
<span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token parameter variable">-X</span> GET <span class="token string">'http://10.0.0.91:9200/maluedu-xiyouji/_search'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-H</span> <span class="token string">'Content-Type: application/json'</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-d</span> <span class="token string">'{
    &quot;query&quot;: {
        &quot;match&quot;: {
            &quot;hobby&quot;: &quot;人参果&quot;
        }
    }
}'</span>  <span class="token operator">|</span> jq
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_5-部署kibana软件"><a href="#_5-部署kibana软件" class="header-anchor">#</a> 5，部署kibana软件</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.下载kibana
<span class="token function">wget</span> https://artifacts.elastic.co/downloads/kibana/kibana-7.17.23-amd64.deb


<span class="token number">2</span>.安装kibana 
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># dpkg -i kibana-7.17.23-amd64.deb </span>


<span class="token number">3</span>.修改kibana的配置文件 
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/kibana/kibana.yml </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># yy /etc/kibana/kibana.yml </span>
server.port: <span class="token number">5601</span>
server.host: <span class="token string">&quot;0.0.0.0&quot;</span>
elasticsearch.hosts: <span class="token punctuation">[</span><span class="token string">&quot;http://10.0.0.91:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.92:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.93:9200&quot;</span><span class="token punctuation">]</span>
i18n.locale: <span class="token string">&quot;zh-CN&quot;</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">4</span>.启动kibana 
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># systemctl enable --now kibana.service </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># ss -ntl | grep 5601</span>
LISTEN <span class="token number">0</span>      <span class="token number">511</span>          <span class="token number">0.0</span>.0.0:5601      <span class="token number">0.0</span>.0.0:*          
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">5</span>.访问kibana的WebUI
http://10.0.0.91:5601/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><img src="/devops/public/assets/img/1730097081964.193a782c.png" alt="1730097081964"></p> <p><img src="/devops/public/assets/img/1730097095757.421d4a16.png" alt="1730097095757"></p> <h3 id="_6-扩展与面试题"><a href="#_6-扩展与面试题" class="header-anchor">#</a> 6，扩展与面试题**</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>调研<span class="token string">&quot;Grafana Loki&quot;</span>日志采集方案.
调研禁用索引的批量删除功能<span class="token punctuation">;</span>
调研VPN翻墙功能<span class="token punctuation">;</span>
- windows翻墙
- 虚拟机翻墙
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>第一次模拟面试:
Q1:ES集群颜色有哪些?分别代表什么含义?
绿色 <span class="token punctuation">(</span>Green<span class="token punctuation">)</span>：

意义：集群状态良好。
说明：所有的主分片和副本分片都处于活动状态，数据完整且可用。
黄色 <span class="token punctuation">(</span>Yellow<span class="token punctuation">)</span>：

意义：集群状态警告。
说明：所有的主分片都处于活动状态，但某些副本分片没有分配。这可能意味着数据仍然可用，但在高负载或故障情况下，可能会面临数据丢失的风险。
红色 <span class="token punctuation">(</span>Red<span class="token punctuation">)</span>：

意义：集群状态严重问题。
说明：至少有一个主分片不可用，意味着相关的数据不可用。这是最严重的状态，需要立即处理。
通过这些颜色，用户可以快速判断集群的健康状况，并采取相应的措施来解决潜在问题。

------------------------------

Q2:ES集群的端口号及协议作用说明?

在Elasticsearch（ES）集群中，主要使用以下几个端口和协议来进行通信和数据传输：

HTTP端口（默认端口：9200）：
协议：HTTP/REST
作用：主要用于与客户端（如浏览器、API调用、Kibana等）进行通信。用户可以通过HTTP请求发送查询、索引数据、管理集群等操作。该端口也可以用于监控集群的健康状态和获取统计信息。

Transport端口（默认端口：9300）：
协议：Transport（自定义协议）
作用：用于节点之间的内部通信，包括主节点选举、分片的分配与迁移、数据复制等。这个端口主要用于集群中的节点之间的交互，而不是与外部客户端直接通信。

其他常见端口
Kibana（如果使用）：默认端口是5601，使用HTTP协议，提供图形化界面用于与Elasticsearch进行交互和可视化数据。
Beats（如Filebeat、Metricbeat等）：通常使用不同的端口（如5044）将数据发送到Elasticsearch，具体取决于配置。

安全性考虑
在生产环境中，建议通过设置防火墙或使用VPN等方式来保护这些端口，确保只有授权的用户和应用能够访问集群。同时，Elasticsearch也支持安全特性（如TLS/SSL加密和基本认证）来增强数据传输的安全性。

------------------------------

Q3:MySQL主从同步的原理?什么情况会导致MySQL主从数据延迟呢?

MySQL主从数据延迟是指从数据库（Slave）上的数据更新滞后于主数据库（Master）的情况。导致这种延迟的原因可能有多种，以下是一些常见的因素：
<span class="token number">1</span>. 网络延迟
网络带宽不足：主库和从库之间的网络连接速度较慢，导致数据无法及时传输。
网络不稳定：网络波动或丢包可能导致数据包无法顺利传递，增加延迟。
<span class="token number">2</span>. 主库负载过高
高写入负载：如果主库上有大量的写入操作，生成的二进制日志（binlog）会迅速增加，从库处理这些日志的速度可能跟不上。
CPU或内存资源不足：主库的CPU或内存资源紧张，影响其处理请求的速度，从而影响数据的记录和传输。
<span class="token number">3</span>. 从库负载过高
读取操作繁重：如果从库上同时有大量的读取操作（如查询），可能会影响其处理复制日志的速度。
资源竞争：如果从库的CPU、内存或IO资源被其他进程占用，可能导致复制延迟。
<span class="token number">4</span>. 配置问题
复制参数配置不当：如slave_net_timeout、slave_parallel_workers等参数设置不合理，可能导致从库处理复制日志的效率降低。
binlog格式问题：如果使用基于语句的复制（SBR），可能会因为某些复杂的SQL语句而导致从库执行速度变慢。
<span class="token number">6</span>. 主从不一致
数据不一致：如果在复制过程中出现错误，导致某些数据未能成功复制，从库可能需要重新同步数据，增加了延迟。
<span class="token number">7</span>. 使用表锁
表锁争用：如果主库在执行写入操作时使用了表锁，可能会导致从库在应用对应的操作时无法有效并发处理。
<span class="token number">8</span>. 心跳机制
心跳机制不频繁：如果主从之间的心跳机制配置不合理，可能导致从库无法及时获取主库的最新状态。
解决方法
优化网络：确保主从之间的网络连接稳定，带宽充足。
监控负载：定期监控主库和从库的负载情况，确保资源的合理分配。
调整配置：根据实际情况调整MySQL的复制参数，优化性能。
数据分片：如果数据量很大，可以考虑数据分片或分库分表来减轻负载。
通过综合考虑这些因素并采取相应的优化措施，可以有效减少MySQL主从复制的延迟。

------------------------------

Q4:简单陈述下<span class="token string">&quot;0SI七层模型&quot;</span>和<span class="token string">&quot;TCP/IP协议&quot;</span>的区别?

OSI七层模型：
由国际标准化组织（ISO）提出，分为七层：
应用层（Application Layer）
表示层（Presentation Layer）
会话层（Session Layer）
传输层（Transport Layer）
网络层（Network Layer）
数据链路层（Data Link Layer）
物理层（Physical Layer）

TCP/IP协议：
由美国国防部开发的网络协议，通常被称为四层模型：
应用层（Application Layer）
传输层（Transport Layer）
网络层（Internet Layer）
数据链路层（Link Layer）

层次数量
OSI七层模型：有七个层次，较为详细。
TCP/IP协议：通常被简化为四个层次，层次较少。

协议标准
OSI七层模型：是一个理论模型，定义了不同层次的功能和服务，但没有具体的标准协议。
TCP/IP协议：是一个实际应用的协议族，包括TCP、IP、UDP等具体协议，广泛用于互联网。

层之间的依赖关系
OSI七层模型：层与层之间有更明确的功能划分和依赖关系，每一层都与其上下层有清晰的接口。
TCP/IP协议：层与层之间的界限不如OSI模型那么严格，某些层次的功能可能会重叠。

应用
OSI七层模型：主要用于教学和理论研究，帮助理解网络通信的各个方面。
TCP/IP协议：广泛应用于实际的网络通信中，是现代互联网的基础。

OSI七层模型是一个理论框架，强调标准化，而TCP/IP协议是一个实际的协议栈，更加注重实际应用。两者在层次结构、协议标准及应用背景等方面存在显著差异。

------------------------------

Q5:TCP报文的监听端口范围是多少?为什么是这个端口范围呢?

TCP报文的监听端口范围是从 <span class="token number">0</span> 到 <span class="token number">65535</span>。这个范围是因为TCP协议使用16位的端口号字段来标识每个连接的端口，16位的二进制数可以表示的最大值为 <span class="token punctuation">(</span><span class="token number">2</span>^<span class="token punctuation">{</span><span class="token number">16</span><span class="token punctuation">}</span> - <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">65535</span><span class="token punctuation">)</span>。

公认端口（Well-Known Ports）：
范围：0 - <span class="token number">1023</span>
这些端口被预定义并通常用于特定的服务或协议。例如，HTTP使用80端口，HTTPS使用443端口，FTP使用21端口等。

注册端口（Registered Ports）：
范围：1024 - <span class="token number">49151</span>
这些端口可以被用户或应用程序注册以供特定应用使用。虽然没有强制性规定，但许多应用程序会选择这些端口号。

动态和私有端口（Dynamic/Private Ports）：
范围：49152 - <span class="token number">65535</span>
这些端口通常用于临时或私有用途，常见于客户端应用程序在与服务器通信时动态分配的端口。

TCP报文的监听端口范围从0到65535，主要是由于16位字段的限制，以及为网络服务的管理和标准化提供便利。

------------------------------

Q6:简单陈述下两台主机进程之间通信原理过程?数据报文是如何封装的?

两台主机之间的进程通信通常通过网络协议（如TCP/IP协议族）来实现。以下是通信原理过程的简单陈述，以及数据报文的封装过程：

通信原理过程
应用层：
用户在一台主机上运行应用程序（如Web浏览器、邮件客户端等），该应用程序生成要发送的数据（如HTTP请求、电子邮件内容等）。
这些数据在应用层进行处理，准备发送。

传输层：
应用层的数据被传递给传输层（如TCP或UDP）。
传输层在数据前添加头部信息，包括源端口号、目标端口号、序列号（对于TCP）、校验和等。
这部分数据被称为“段”（对于TCP）或“数据报”（对于UDP）。

网络层：
传输层的段被传递给网络层（如IP协议）。
网络层在段前添加IP头部信息，包括源IP地址、目标IP地址、TTL（生存时间）、协议类型等。
此时，数据被称为“数据报”（datagram）。

数据链路层：
数据报被传递到数据链路层（如以太网协议）。
数据链路层在数据报前添加链路层头部和尾部信息，例如MAC地址、帧校验序列（FCS）等。
此时，数据被称为“帧”（frame）。

物理层：
最后，数据链路层的帧被传递到物理层，进行实际的物理传输（如电信号、光信号等）。
主机通过物理介质（如网线、无线信号等）将数据发送到目标主机。
数据报文的封装过程
数据在传输过程中会经历以下封装过程：

数据（应用层）：
原始数据（如HTTP请求）被应用层处理。
传输层段：

在原始数据前添加传输层头部，形成传输层段。
+---------------------------------------+
<span class="token operator">|</span>          TCP/UDP Header               <span class="token operator">|</span>
+---------------------------------------+
<span class="token operator">|</span>          Application Data             <span class="token operator">|</span>
+---------------------------------------+
      
网络层数据报：

在传输层段前添加网络层头部，形成网络层数据报。
+---------------------------------------+
<span class="token operator">|</span>           IP Header                   <span class="token operator">|</span>
+---------------------------------------+
<span class="token operator">|</span>          TCP/UDP Header               <span class="token operator">|</span>
+---------------------------------------+
<span class="token operator">|</span>          Application Data             <span class="token operator">|</span>
+---------------------------------------+
      
数据链路层帧：

在网络层数据报前添加数据链路层头部和尾部，形成数据链路层帧。
+---------------------------------------+
<span class="token operator">|</span>       Data Link Layer Header          <span class="token operator">|</span>
+---------------------------------------+
<span class="token operator">|</span>           IP Header                   <span class="token operator">|</span>
+---------------------------------------+
<span class="token operator">|</span>          TCP/UDP Header               <span class="token operator">|</span>
+---------------------------------------+
<span class="token operator">|</span>          Application Data             <span class="token operator">|</span>
+---------------------------------------+
<span class="token operator">|</span>       Data Link Layer Trailer         <span class="token operator">|</span>
+---------------------------------------+
      
通过上述步骤，数据在发送之前被一层层封装，形成相应的报文，最终通过网络传输到目标主机，目标主机在接收到数据后会进行解封装，提取出原始数据进行处理。

------------------------------

Q7:你了解过哪些抓包工具?
<span class="token number">1</span>. Wireshark
简介：Wireshark 是一个流行的开源网络协议分析工具，支持实时抓包和离线分析。
特点：提供丰富的协议解析功能，有图形用户界面，支持多种操作系统（Windows、Linux、macOS）。
用途：常用于网络故障排查、性能分析和安全审计。
<span class="token number">2</span>. Fiddler
简介：Fiddler 是一个用于调试Web应用程序的代理抓包工具。
特点：能够捕获HTTP和HTTPS流量，具有友好的用户界面，支持请求/响应修改。
用途：主要用于Web开发和调试，检查API请求和响应。
<span class="token number">3</span>. Charles Proxy
简介：Charles 是一个商业化的HTTP代理抓包工具，提供图形用户界面。
特点：支持HTTP/HTTPS抓包，能够修改请求和响应，提供性能分析功能。
用途：常用于Web和移动应用开发调试。
<span class="token number">4</span>. Burp Suite
简介：Burp Suite 是一个集成的Web应用程序安全测试工具，包含抓包功能。
特点：提供各种安全测试工具，支持HTTP和HTTPS流量捕获和修改。
用途：主要用于Web应用的安全测试和漏洞扫描。
<span class="token number">5</span>. Nmap
简介：Nmap 是一个网络扫描和安全审计工具，虽然主要用于网络探测，但也可以用于抓包。
特点：强大的网络扫描功能，能够发现网络中的设备和服务。
用途：用于网络安全评估和管理。

------------------------------

Q8:了解过哪些缓存技术呢?最少说出三种?
<span class="token number">1</span>. Memcached
<span class="token number">2</span>. Redis
<span class="token number">3</span>. CDN（内容分发网络）
<span class="token number">4</span>. 其它缓存
	浏览器内置缓存
	http缓存
	mybatis缓存
	
------------------------------

Q9:简单陈述下在http场景中的cookie和session的区别?

<span class="token number">1</span>. 存储位置
Cookie：
存储在用户的浏览器中。
由服务器通过HTTP响应头设置，并在后续请求中由浏览器自动发送给服务器。

Session：
存储在服务器端。
服务器为每个用户创建一个唯一的会话ID，并通过Cookie或URL重写等方式将该会话ID发送回客户端。

<span class="token number">2</span>. 数据存储大小
Cookie：


每个Cookie的大小限制通常为4KB（浏览器不同可能有所差异），并且每个域名可以存储多个Cookie，数量也有限制（通常为20-50个）。

Session：
可以存储更多的数据，没有固定大小限制，通常只受服务器内存和存储限制的影响。

<span class="token number">3</span>. 安全性
Cookie：
因为存储在客户端，容易受到XSS（跨站脚本）和CSRF（跨站请求伪造）攻击，因此需要设置适当的安全属性（如HttpOnly和Secure）。

Session：
由于数据存储在服务器端，相对更安全。会话ID可以设置为短期有效，并且可以采用HTTPS等安全协议进行传输。

<span class="token number">4</span>. 生命周期
Cookie：
可以设置过期时间（如Expires或Max-Age），可以是持久的（在关闭浏览器后依然存在）或会话级的（浏览器关闭后失效）。

Session：
通常在用户关闭浏览器后失效，或在服务器上设置的超时时间到达后失效。也可以通过主动登出来结束会话。

<span class="token number">5</span>. 使用场景
Cookie：
适合存储小量的用户偏好、认证信息（如记住我功能）等。

Session：
适合存储用户状态信息、购物车内容、用户登录状态等需要在会话期间保持的较大数据。
总结
Cookie和Session都是用于管理用户状态的技术，但它们在存储位置、安全性、生命周期等方面存在显著差异。根据应用需求选择合适的技术可以提高应用的性能和安全性。

------------------------------

Q10:分析nginx访问日志的IP字段数量并统计TOP10的IP地址列表?请写出对应的命令?
<span class="token function">awk</span> <span class="token string">'{print $1}'</span> access.log <span class="token operator">|</span> <span class="token function">sort</span> <span class="token operator">|</span> <span class="token function">uniq</span> <span class="token parameter variable">-c</span> <span class="token operator">|</span> <span class="token function">sort</span> <span class="token parameter variable">-nr</span> <span class="token operator">|</span> <span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">10</span>

<span class="token function">awk</span> <span class="token string">'{print $1}'</span> access.log：使用awk提取日志中的第一个字段，通常Nginx日志的第一个字段是客户端IP地址。

sort：将提取出的IP地址进行排序，以便后续统计。
<span class="token function">uniq</span> -c：统计每个唯一IP地址的出现次数，并在每行前加上出现次数。
<span class="token function">sort</span> -nr：对IP地址及其出现次数进行降序排序（-n为数字排序，-r为逆序）。
<span class="token function">head</span> <span class="token parameter variable">-n</span> <span class="token number">10</span>：只输出前10行，即前10个访问频率最高的IP地址。
------------------------------
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br></div></div><h3 id="_7-filebeat环境搭建"><a href="#_7-filebeat环境搭建" class="header-anchor">#</a> 7，filebeat环境搭建</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.下载filebeat软件包 
<span class="token function">wget</span> https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-7.17.23-amd64.deb

<span class="token number">2</span>.安装filebeat 
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># dpkg -i filebeat-7.17.23-amd64.deb </span>

<span class="token number">3</span>.编写配置文件
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># cd /etc/filebeat/</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 01-stdin-to-console.yaml </span>
<span class="token comment"># 指定filebeat的输入类型</span>
filebeat.inputs:
  <span class="token comment"># 指定类型为标准输入</span>
- type: stdin

<span class="token comment"># 指定输出类型是console表示控制台</span>
output.console:
  <span class="token comment"># 以漂亮的格式输出，而非扁平化输出。</span>
  pretty: <span class="token boolean">true</span>
  
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 01-stdin-to-console.yaml</span>
<span class="token punctuation">..</span>.
<span class="token number">2024</span>-10-28T10:57:12.535+0800	INFO	<span class="token punctuation">[</span>crawler<span class="token punctuation">]</span>	beater/crawler.go:106	Loading and starting Inputs completed. Enabled inputs: <span class="token number">1</span>
<span class="token number">111111111111111111111111</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;@timestamp&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2024-10-28T02:57:42.149Z&quot;</span>,
  <span class="token string">&quot;@metadata&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;beat&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;filebeat&quot;</span>,
    <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;_doc&quot;</span>,
    <span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;7.17.23&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;input&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;stdin&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;ecs&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;1.12.0&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;elk93&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;agent&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;ephemeral_id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;8a4148ba-5317-42eb-b8d0-2ad721273645&quot;</span>,
    <span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;2d8b2474-e977-4dda-a98f-4782dafbc44f&quot;</span>,
    <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;elk93&quot;</span>,
    <span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;filebeat&quot;</span>,
    <span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;7.17.23&quot;</span>,
    <span class="token string">&quot;hostname&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;elk93&quot;</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;log&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;offset&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
    <span class="token string">&quot;file&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;path&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  <span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;111111111111111111111111&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h3 id="_8-filebeat的基本使用"><a href="#_8-filebeat的基本使用" class="header-anchor">#</a> 8，filebeat的基本使用</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.编写配置文件
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 02-log-to-console.yaml </span>
filebeat.inputs:
  <span class="token comment"># 指定类型为log</span>
- type: log
  <span class="token comment"># 指定日志文件的路径，注意:</span>
  <span class="token comment">#		1.默认按行读取;</span>
  <span class="token comment">#		2.每次采集都会记录偏移量到指定文件中:</span>
  <span class="token comment">#  		/var/lib/filebeat/registry/filebeat/log.json</span>
  paths:
  - /tmp/malu.log
  - /tmp/*.txt

output.console:
  pretty: <span class="token boolean">true</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>

	
<span class="token number">2</span>.启动filebeat实例
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 02-log-to-console.yaml </span>


<span class="token number">3</span>.写入测试数据到/tmp/malu.log文件中。在另一个终端中测试
<span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> abc <span class="token operator">&gt;&gt;</span>/tmp/malu.log
<span class="token comment"># 解释 -n表示去掉换行符。filebeat是按换行符截取数据的。</span>

<span class="token builtin class-name">echo</span> <span class="token number">123</span> <span class="token operator">&gt;&gt;</span>/tmp/malu.log  <span class="token comment"># 看另一个终端。已经采集过的数据不会再采集。在log.json中会有记录</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><h3 id="_9-filebeat采集nginx日志"><a href="#_9-filebeat采集nginx日志" class="header-anchor">#</a> 9，filebeat采集nginx日志</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.安装nginx
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># apt -y install nginx</span>


<span class="token number">2</span>.启动nginx服务
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># systemctl enable --now nginx</span>

<span class="token number">3</span>.访问nginx并测试
略。

<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># cat /var/log/nginx/access.log </span>
<span class="token number">10.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:11:51:57 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">10.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:11:51:57 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET /favicon.ico HTTP/1.1&quot;</span> <span class="token number">404</span> <span class="token number">197</span> <span class="token string">&quot;http://10.0.0.93/&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">4</span>.使用filebeat采集nginx的访问日志
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 03-nginx-to-console.yaml </span>
filebeat.inputs:
- type: log
  paths:
  - /var/log/nginx/access.log*

output.console:
  pretty: <span class="token boolean">true</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">5</span>.启动filebeat实例
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 03-nginx-to-console.yaml </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_10-efk架构"><a href="#_10-efk架构" class="header-anchor">#</a> 10，EFK架构</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.编写配置文件
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 04-nginx-to-elasticsearch.yaml</span>
filebeat.inputs:
- type: log
  paths:
  - /var/log/nginx/access.log*

<span class="token comment"># 将数据输出到ES集群</span>
output.elasticsearch:
  <span class="token comment"># 指定ES集群的地址</span>
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;http://10.0.0.91:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.92:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.93:9200&quot;</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">2</span>.清楚缓存并启动实例
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 04-nginx-to-elasticsearch.yaml </span>


<span class="token number">3</span>.发送测试数据
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># while true;do curl -s 10.0.0.93/malu.html;sleep 0.5;done</span>


<span class="token number">4</span>.kibana添加索引并查看数据

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p><img src="/devops/public/assets/img/1730118031232.222a5906.png" alt="1730118031232"></p> <p><img src="/devops/public/assets/img/1730118096322.2b815fbc.png" alt="1730118096322"></p> <p><img src="/devops/public/assets/img/1730118164506.58a4bffc.png" alt="1730118164506"></p> <h3 id="_11-filebeat采集tomcat"><a href="#_11-filebeat采集tomcat" class="header-anchor">#</a> 11，filebeat采集tomcat</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.下载tomcat 
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># wget https://dlcdn.apache.org/tomcat/tomcat-10/v10.1.31/bin/apache-tomcat-10.1.31.tar.gz</span>


<span class="token number">2</span>.创建自定义目录
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># mkdir -pv /malu/softwares</span>


<span class="token number">3</span>.解压tomcat到指定目录
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># tar xf apache-tomcat-10.1.31.tar.gz -C /malu/softwares</span>


<span class="token number">4</span>.配置JDK环境变量<span class="token punctuation">(</span>ES自带JDK<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/profile.d/jdk.sh</span>
<span class="token comment">#!/bin/bash</span>

<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/share/elasticsearch/jdk
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">${JAVA_HOME}</span>/bin
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># source  /etc/profile.d/jdk.sh</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># java -version</span>
openjdk version <span class="token string">&quot;22.0.1&quot;</span> <span class="token number">2024</span>-04-16
OpenJDK Runtime Environment <span class="token punctuation">(</span>build <span class="token number">22.0</span>.1+8-16<span class="token punctuation">)</span>
OpenJDK <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">22.0</span>.1+8-16, mixed mode, sharing<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">5</span>.启动tomcat
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># /malu/softwares/apache-tomcat-10.1.31/bin/startup.sh </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># ss -ntl | grep 8080</span>
LISTEN <span class="token number">0</span>      <span class="token number">100</span>                     *:8080            *:*          
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">6</span>.浏览器访问测试
http://10.0.0.92:8080/

<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># cat /malu/softwares/apache-tomcat-10.1.31/logs/localhost_access_log.2024-10-28.txt </span>
<span class="token number">10.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:07:05:18 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">11239</span>
<span class="token number">10.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:07:05:18 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /tomcat.svg HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">67795</span>
<span class="token number">10.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:07:05:18 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /tomcat.css HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">5584</span>
<span class="token number">10.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:07:05:18 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /bg-nav.png HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">1401</span>
<span class="token number">10.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:07:05:18 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /bg-upper.png HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">3103</span>
<span class="token number">10.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:07:05:18 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /bg-button.png HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">713</span>
<span class="token number">10.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:07:05:18 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /bg-middle.png HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">1918</span>
<span class="token number">10.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:07:05:18 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /asf-logo-wide.svg HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">27235</span>
<span class="token number">10.0</span>.0.1 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:07:05:18 +0000<span class="token punctuation">]</span> <span class="token string">&quot;GET /favicon.ico HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">21630</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># wc -l /malu/softwares/apache-tomcat-10.1.31/logs/localhost_access_log.2024-10-28.txt </span>
<span class="token number">9</span> /malu/softwares/apache-tomcat-10.1.31/logs/localhost_access_log.2024-10-28.txt
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">7</span>.filebeat采集tomcat的访问日志
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># dpkg -i filebeat-7.17.23-amd64.deb </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># cat  /etc/filebeat/05-tomcat-to-es.yaml</span>
filebeat.inputs:
- type: log
  paths:
  -  /mlau/softwares/apache-tomcat-10.1.31/logs/*.txt

output.elasticsearch:
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;http://10.0.0.91:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.92:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.93:9200&quot;</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c  /etc/filebeat/05-tomcat-to-es.yaml</span>


<span class="token number">8</span>.kibana查看数据
略
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br></div></div><p><img src="/devops/public/assets/img/1730119769240.36477fc2.png" alt="1730119769240"></p> <h3 id="_12-filebeat写入es自定义索引"><a href="#_12-filebeat写入es自定义索引" class="header-anchor">#</a> 12，filebeat写入ES自定义索引</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.编写配置文件
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 06-nginx-to-custom-index-es.yaml </span>
filebeat.inputs:
- type: log
  paths:
  - /var/log/nginx/access.log*

output.elasticsearch:
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;http://10.0.0.91:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.92:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.93:9200&quot;</span><span class="token punctuation">]</span> 
  <span class="token comment"># 写入ES时指定索引的名称</span>
  index: <span class="token string">&quot;malu-nginx-elk93-%{+yyyy.MM.dd}&quot;</span> 

<span class="token comment"># 禁用索引声明周期，若不禁用，则自定义的索引配置不生效</span>
setup.ilm.enabled: <span class="token boolean">false</span>
<span class="token comment"># 定义索引的模板的名称</span>
setup.template.name: <span class="token string">&quot;malu-nginx&quot;</span>
<span class="token comment"># 定义索引模板的匹配模式（作用就是用来匹配索引的名称）</span>
setup.template.pattern: <span class="token string">&quot;malu-nginx*&quot;</span>
<span class="token comment"># 如果索引模板存在，是否覆盖原有的索引模板配置</span>
setup.template.overwrite: <span class="token boolean">false</span>
<span class="token comment"># 定义索引模板的设置</span>
setup.template.settings:
  <span class="token comment"># 自定义索引的分片数量</span>
  index.number_of_shards: <span class="token number">3</span>
  <span class="token comment"># 自定义索引的副本数量</span>
  index.number_of_replicas: <span class="token number">0</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>

	
<span class="token number">2</span>.启动filebeat实例
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 06-nginx-to-custom-index-es.yaml</span>

<span class="token number">3</span>.tomcat自定义索引案例
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/filebeat/06-tomcat-to-es-cusom-index.yaml</span>
filebeat.inputs:
- type: log
  paths:
  -  /malu/softwares/apache-tomcat-10.1.31/logs/*.txt

output.elasticsearch:
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;http://10.0.0.91:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.92:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.93:9200&quot;</span><span class="token punctuation">]</span> 
  index: <span class="token string">&quot;malu-tomcat-elk92-%{+yyyy.MM.dd}&quot;</span> 

<span class="token comment"># 禁用索引声明周期，若不禁用，则自定义的索引配置不生效</span>
setup.ilm.enabled: <span class="token boolean">false</span>
<span class="token comment"># 定义索引的模板的名称</span>
setup.template.name: <span class="token string">&quot;malu-tomcat&quot;</span>
<span class="token comment"># 定义索引模板的匹配模式（作用就是用来匹配索引的名称）</span>
setup.template.pattern: <span class="token string">&quot;malu-tomcat*&quot;</span>
<span class="token comment"># 如果索引模板存在，是否覆盖原有的索引模板配置</span>
setup.template.overwrite: <span class="token boolean">true</span>
<span class="token comment"># 定义索引模板的设置</span>
setup.template.settings:
  <span class="token comment"># 自定义索引的分片数量</span>
  index.number_of_shards: <span class="token number">8</span>
  <span class="token comment"># 自定义索引的副本数量</span>
  index.number_of_replicas: <span class="token number">0</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c /etc/filebeat/07-tomcat-to-es-cusom-index.yaml</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><p><img src="/devops/public/assets/img/1730122103022.f66a1cf6.png" alt="1730122103022"></p> <h3 id="_13-filebeat的模块处理"><a href="#_13-filebeat的模块处理" class="header-anchor">#</a> 13，filebeat的模块处理</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.启动模块
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat modules enable nginx</span>
Enabled nginx
Enabled tomcat
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># ll modules.d/*.yml</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">784</span> Jul <span class="token number">25</span> <span class="token number">21</span>:41 modules.d/nginx.yml
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">623</span> Jul <span class="token number">25</span> <span class="token number">21</span>:41 modules.d/tomcat.yml
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
 
<span class="token number">2</span>.查看启用和禁用模块的列表
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat modules list</span>
Enabled:
nginx
tomcat

Disabled:
activemq
apache
auditd
aws
<span class="token punctuation">..</span>.

<span class="token number">3</span>.禁用模块 
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat modules disable tomcat</span>
Disabled tomcat
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># ll modules.d/*.yml</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">784</span> Jul <span class="token number">25</span> <span class="token number">21</span>:41 modules.d/nginx.yml
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># ll modules.d/*.yml.disabled | grep tomcat</span>
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">623</span> Jul <span class="token number">25</span> <span class="token number">21</span>:41 modules.d/tomcat.yml.disabled
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">4</span>.编写配置文件 
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 08-nginx-modules-to-es.yaml </span>
<span class="token comment"># 启用nginx的模块管理</span>

filebeat.config.modules:
 path: <span class="token variable">${path.config}</span>/modules.d/*.yml
 reload.enabled: <span class="token boolean">false</span>

output.elasticsearch:
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;http://10.0.0.91:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.92:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.93:9200&quot;</span><span class="token punctuation">]</span> 
  index: <span class="token string">&quot;malu-nginx-modules-%{+yyyy.MM.dd}&quot;</span> 

setup.ilm.enabled: <span class="token boolean">false</span>
setup.template.name: <span class="token string">&quot;malu-nginx&quot;</span>
setup.template.pattern: <span class="token string">&quot;malu-nginx*&quot;</span>
setup.template.overwrite: <span class="token boolean">false</span>
setup.template.settings:
  index.number_of_shards: <span class="token number">3</span>
  index.number_of_replicas: <span class="token number">0</span>
  
<span class="token number">5</span>.启动filebeat实例
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 08-nginx-modules-to-es.yaml </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div><h3 id="_14-常见报错"><a href="#_14-常见报错" class="header-anchor">#</a> 14，常见报错</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>常见的报错分析:
    - <span class="token number">1</span>.es集群未启动正常<span class="token punctuation">;</span>
    - <span class="token number">2</span>.filebeat的配置文件缩进错误<span class="token punctuation">;</span>
    - <span class="token number">3</span>.缺失filebeat.yml文件导致模块功能无法使用<span class="token punctuation">;</span>
    - <span class="token number">4</span>.无法启动tomcat，原因是启动了gitlab等类似相关服务，造成了端口占用<span class="token punctuation">;</span>
    - <span class="token number">5</span>.虚拟机开了<span class="token string">&quot;代理&quot;</span>？导致无法访问ES<span class="token punctuation">;</span>
    - <span class="token number">6</span>.连接ES失败<span class="token punctuation">;</span>
    - <span class="token number">7</span>.没有删除缓存数据<span class="token string">&quot;/var/lib/filebeat/&quot;</span>
    - <span class="token punctuation">..</span>.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="_15-案例-efk架构分析nginx日志并kibana出图展示"><a href="#_15-案例-efk架构分析nginx日志并kibana出图展示" class="header-anchor">#</a> 15，案例（EFK架构分析nginx日志并kibana出图展示）</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.模拟生产环境产生的日志文件
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># cat /var/log/nginx/access.log</span>
<span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">21.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:26 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1&quot;</span>
<span class="token number">22.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:37 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1&quot;</span>
<span class="token number">221.218</span>.209.11 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:50 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.0 Safari/605.1.15&quot;</span>
<span class="token number">221.218</span>.209.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>



	<span class="token number">2</span>.基于模块启动filebeat实例采集数据
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 08-nginx-modules-to-es.yaml </span>
<span class="token comment"># 启用nginx的模块管理</span>
filebeat.config.modules:
 path: <span class="token variable">${path.config}</span>/modules.d/*.yml
 reload.enabled: <span class="token boolean">false</span>

output.elasticsearch:
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;http://10.0.0.91:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.92:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.93:9200&quot;</span><span class="token punctuation">]</span> 
  index: <span class="token string">&quot;malu-nginx-modules-%{+yyyy.MM.dd}&quot;</span> 

setup.ilm.enabled: <span class="token boolean">false</span>
setup.template.name: <span class="token string">&quot;malu-nginx&quot;</span>
setup.template.pattern: <span class="token string">&quot;malu-nginx*&quot;</span>
setup.template.overwrite: <span class="token boolean">false</span>
setup.template.settings:
  index.number_of_shards: <span class="token number">3</span>
  index.number_of_replicas: <span class="token number">0</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 08-nginx-modules-to-es.yaml </span>

- kibana分析PV
- kibana分析IP统计
- kibana分析带宽
- kibana分析设备类型
- kibana分析城市访问量排名
- 分析商品的类型数量统计
- kibana的dashboard制作
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h3 id="_16-filebeat多实例"><a href="#_16-filebeat多实例" class="header-anchor">#</a> 16，filebeat多实例</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>所谓的filebeat多实例就是在同一个服务器上启动多个filebeat实例，有点类似于MySQL多实例。
	
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 01-stdin-to-console.yaml --path.data /tmp/xixi</span>

<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 02-log-to-console.yaml --path.data /tmp/haha</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="_17-扩展与面试题"><a href="#_17-扩展与面试题" class="header-anchor">#</a> 17，扩展与面试题**</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>- 使用filebeat采集Ubuntu系统日志:
/var/log/syslog
/var/log/auth.log
/var/log/bootstrap.log

- 使用ansible剧本实现一键部署EFK架构

- 扩展: filebeat自定义NGINX的JSON格式日志
- 扩展: filebeat自定义tomcat的JSON格式日志
- 扩展: filebeat的多行处理
- 扩展: filebeat的多实例
- 扩展: filestream实战
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>第2次模拟面试:
Q11:简单陈述下EFK的含义及数据流走向?
EFK 是一种用于日志管理和分析的技术栈，由以下三个组件组成：
Elasticsearch：一个分布式的搜索和分析引擎，用于存储和查询日志数据。
Logstash：Logstash 是 Elastic Stack 的一部分，用于日志收集和处理。
Kibana：一个用于数据可视化的前端工具，可以与Elasticsearch集成，以便用户能够通过图形界面查看和分析存储在Elasticsearch中的日志数据。

EFK 数据流的走向通常如下：
日志生成：
应用程序或系统产生日志信息。

日志收集：
Fluentd 或 Logstash 作为日志收集器，负责从不同来源（如应用程序、服务器、容器等）收集日志数据。它可以通过多种输入插件（如文件、HTTP、TCP等）获取日志。

数据处理：
收集到的日志数据在 Fluentd 或 Logstash 中进行处理，可以进行格式化、过滤、数据解析等操作，以便将日志数据转换为结构化格式。

数据存储：
处理后的日志数据被发送到 Elasticsearch，在这里进行存储和索引，以便后续的搜索和分析。Elasticsearch 提供了强大的搜索功能，可以快速查询和分析大量的日志数据。

数据可视化：
用户通过 Kibana 连接到 Elasticsearch，使用其图形界面来可视化和分析日志数据。Kibana 提供了仪表板、图表和搜索功能，帮助用户深入了解日志数据，快速发现问题和趋势。

总结
EFK 是一种强大的日志管理解决方案，结合了日志收集、存储和可视化的功能，适用于实时日志分析和监控。数据流从日志生成到收集、处理、存储，最后到可视化，为用户提供了完整的日志管理流程。

-----------------------------

Q12:kibana在ES中查询不到业务数据时，可能时哪些原因导致的，你如何排查呢?

数据未索引到Elasticsearch：
数据可能未正确发送到Elasticsearch，或者在传输过程中出现了问题。

索引模式不匹配：
Kibana可能没有正确配置索引模式，导致查询的索引不存在或不匹配。

数据已过期或被删除：
Elasticsearch中存储的数据可能根据设置的过期策略被删除。

时间范围设置不正确：
Kibana的查询可能设置了错误的时间范围，导致没有数据返回。

权限问题：
如果使用了安全插件，可能存在权限不足的问题，导致无法查看特定索引或数据。

数据格式问题：
数据可能没有按照预期的格式存储，导致无法在Kibana中进行查询。

Kibana与Elasticsearch连接问题：
Kibana可能无法正确连接到Elasticsearch，导致无法获取数据。

-----------------------------

Q13:filebeat在下午4点挂掉，6点后重启启动?那么请问如何査询4-6点之间的数据呢?

-----------------------------

Q14:你用过ansible吗?用过ansible的哪些模块呢?简单陈述下其作用?最少说出8种?
是的，Ansible 是一个非常流行的自动化和配置管理工具，它使用简单的 YAML 语言来描述自动化任务。以下是我熟悉的一些 Ansible 模块及其作用：

shell：
作用：在远程主机上运行 shell 命令。可以执行任何有效的 shell 命令，但不推荐用于简单的命令，因为它不提供安全性和可读性。

command：
作用：在远程主机上运行命令，与 shell 模块类似，但不支持 shell 特性（如管道、重定向等）。适用于简单的命令执行。

copy：
作用：将本地文件复制到远程主机。您可以设置文件的权限和所有权。

template：
作用：从本地模板文件（通常是 Jinja2 模板）生成文件并将其复制到远程主机。适用于动态生成配置文件。

yum：
作用：在基于 RPM 的 Linux 发行版（如 CentOS 和 RHEL）上管理软件包。可以安装、更新和删除软件包。

apt：
作用：在基于 Debian 的 Linux 发行版（如 Ubuntu）上管理软件包。功能与 yum 类似，但针对 Debian 系统。

file：
作用：用于管理文件和目录的属性，包括权限、所有权和是否存在等。可以创建、删除或修改文件和目录的属性。

service：
作用：用于管理系统服务。可以启动、停止、重启服务，或设置服务在系统启动时是否自动启动。

其他常用模块
git：
作用：从 Git 存储库克隆或拉取代码。适用于自动化代码部署和版本管理。

user：
作用：用于管理系统用户。可以创建、删除或修改用户的属性。

cron：
作用：用于管理定时任务。可以添加、修改或删除 <span class="token function">crontab</span> 任务。
以上模块只是 Ansible 提供的一小部分，Ansible 还有许多其他模块可以用于不同的任务和场景，使其成为一个灵活而强大的自动化工具。

-----------------------------

Q15:解释下ansible的剧本，角色，模块之间的关系是啥?
在 Ansible 中，剧本（Playbooks）、角色（Roles）和模块（Modules）是构建自动化任务的核心概念。它们之间的关系和作用如下：

<span class="token number">1</span>. 模块（Modules）
定义：模块是执行特定任务的单元，Ansible 提供了许多内置模块，可以管理系统的各个方面，例如文件操作、软件包管理、用户管理、服务管理等。
作用：模块是 Ansible 进行操作的实际执行者。每个模块执行一个特定的功能，例如安装软件包、复制文件、管理服务等。
使用方式：模块通常在剧本中调用，也可以通过命令行直接使用 ansible 命令。

<span class="token number">2</span>. 剧本（Playbooks）
定义：剧本是 Ansible 的主要配置文件，用于定义要在目标主机上执行的任务。剧本使用 YAML 格式编写。
作用：剧本描述了要执行的任务、目标主机的组、任务的执行顺序等。它可以包含多个“剧本”，每个剧本可以包含多个“任务”。
任务：每个任务通常调用一个模块来执行特定的操作。任务可以按顺序执行，并且可以定义条件（如 when）来控制任务的执行。

<span class="token number">3</span>. 角色（Roles）
定义：角色是 Ansible 中用于组织和重用剧本内容的一种结构。角色将相关的任务、变量、文件、模板和处理器组织在一起，形成一个可重用的单元。
作用：角色使得剧本的结构更加清晰和模块化，支持更好的代码重用和共享。通过角色，可以方便地将一个角色应用于多个剧本或项目。
目录结构：角色通常具有预定义的目录结构，包括 tasks（任务）、handlers（处理器）、templates（模板）、files（文件）、vars（变量）等。

关系总结
模块和任务：剧本中的每个任务通常调用一个模块，通过模块来执行具体的操作。
剧本和角色：剧本可以由多个角色组成，角色中可以定义一组任务和其他相关内容。角色是对剧本的进一步抽象和组织，便于重用。
模块和角色：角色中的任务会使用模块来具体执行操作，因此模块是角色实现功能的基础。
示例
以下是一个简单的例子，展示了剧本、角色和模块之间的关系：

<span class="token comment"># 示例剧本：site.yml</span>
- hosts: webservers
  roles:
    - webserver

<span class="token comment"># 示例角色：webserver/tasks/main.yml</span>
- name: Install Apache
  yum:
    name: httpd
    state: present

- name: Start Apache <span class="token function">service</span>
  service:
    name: httpd
    state: started

在这个例子中：
site.yml 是一个剧本，它指定了要在 webservers 组的主机上执行的操作，并调用了 webserver 角色。
webserver 角色中的 main.yml 文件包含了具体的任务，每个任务调用了一个模块（如 yum 和 service）来安装和启动 Apache。
这种结构使得 Ansible 的自动化代码更具可读性、可维护性和可重用性。
-----------------------------

Q16:nginx如何实现动静分离吗?
以下是一个基本的 Nginx 配置示例，展示了如何实现动静分离：
server <span class="token punctuation">{</span>
    listen <span class="token number">80</span><span class="token punctuation">;</span>
    server_name example.com<span class="token punctuation">;</span>

    <span class="token comment"># 指定静态文件目录</span>
    root /var/www/html<span class="token punctuation">;</span>

    <span class="token comment"># 处理静态文件</span>
    location /static/ <span class="token punctuation">{</span>
        <span class="token builtin class-name">alias</span> /var/www/html/static/<span class="token punctuation">;</span>  <span class="token comment"># 静态文件目录</span>
        expires 30d<span class="token punctuation">;</span>                  <span class="token comment"># 缓存30天</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 处理动态请求</span>
    location / <span class="token punctuation">{</span>
        try_files <span class="token variable">$uri</span> <span class="token variable">$uri</span>/ @backend<span class="token punctuation">;</span>  <span class="token comment"># 尝试查找静态文件，找不到则转发到后端处理</span>
    <span class="token punctuation">}</span>

    location @backend <span class="token punctuation">{</span>
        proxy_pass http://127.0.0.1:9000<span class="token punctuation">;</span>  <span class="token comment"># 转发到后端应用服务器，例如 PHP-FPM</span>
        proxy_set_header Host <span class="token variable">$host</span><span class="token punctuation">;</span>
        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
        proxy_set_header X-Forwarded-Proto <span class="token variable">$scheme</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
配置解析:
server 块：定义了一个虚拟主机，监听 HTTP 请求。

root 指令：指定了网站的根目录。

location /static/：
处理静态文件的请求，将 /static/ 路径下的请求映射到 /var/www/html/static/ 目录。
使用 expires 指令设置缓存时间，提高静态文件的访问速度。

location /：
首先尝试查找请求的 URI 是否对应静态文件（<span class="token variable">$uri</span> 和 <span class="token variable">$uri</span>/），如果找不到，则将请求转发到 @backend。

location @backend：
定义了一个内部重定向的块，将请求转发到后端应用服务器（如 PHP-FPM）。这里的 proxy_pass 指令指定了后端服务器的地址。

<span class="token number">4</span>. 动静分离的优势
性能优化：静态内容可以直接由 Nginx 提供，不需要经过应用服务器，减少了服务器的负载，提高了响应速度。
资源利用：动态请求交给应用服务器处理，充分利用了各自的优势。
缓存效果：静态文件可以通过设置缓存提高访问效率，减少对后端的请求。

<span class="token number">5</span>. 其他注意事项
SSL 配置：如果您的网站使用 HTTPS，您需要在 server 块中配置 SSL 证书。
负载均衡：可以在 Nginx 中配置负载均衡，将动态请求分发到多个应用服务器。
安全性：确保对静态文件和动态请求的访问控制，以防止未经授权的访问。
通过以上方法，您可以在 Nginx 中实现有效的动静分离，从而优化网站的性能和可维护性。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br></div></div><h3 id="_18-logstash环境搭建"><a href="#_18-logstash环境搭建" class="header-anchor">#</a> 18，logstash环境搭建</h3> <div class="language-ba line-numbers-mode"><pre class="language-text"><code>1.下载Logstash 
wget https://artifacts.elastic.co/downloads/logstash/logstash-7.17.23-amd64.deb

2.安装Logstash 
[root@elk92 ~]# dpkg -i logstash-7.17.23-amd64.deb 

3.创建软连接，可以基于PATH变量访问logstash程序
[root@elk92 ~]# ln -svf /usr/share/logstash/bin/logstash /usr/local/bin/

4.查看帮助信息
[root@elk92 ~]# logstash -h
...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_19-logstash架构"><a href="#_19-logstash架构" class="header-anchor">#</a> 19，logstash架构</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>logstash服务器:
	指的是部署了Logstash环境的服务器。
		
Logstash实例:
	指的是运行了对应Logstash的进程。
		
pipeline:
	同一个Logstash实例可以有多个pipeline，若干未定义，则默认只有一个main pipeline。
		
	同一个pipeline中有多个插件:
		- input:
			必须有，数据从哪来。
				
		- filter:
			该插件可选操作，数据做哪些处理，处理后再流向output插件。
				
		- output:
			必须有，数据到哪去。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_20-logstash两种启动方法"><a href="#_20-logstash两种启动方法" class="header-anchor">#</a> 20，logstash两种启动方法</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>- 基于命令行方式启动: <span class="token punctuation">(</span>不推荐，可读性差<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># logstash -e &quot;input { stdin { type =&gt; stdin } }  output { stdout { codec =&gt; rubydebug } }&quot;</span>
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>INFO <span class="token punctuation">]</span> <span class="token number">2024</span>-10-29 02:29:39.740 <span class="token punctuation">[</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span>-pipeline-manager<span class="token punctuation">]</span> javapipeline - Pipeline started <span class="token punctuation">{</span><span class="token string">&quot;pipeline.id&quot;</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">}</span>
The stdin plugin is now waiting <span class="token keyword">for</span> input:
<span class="token number">11111111111111111111111111</span>
<span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;stdin&quot;</span>,
      <span class="token string">&quot;@version&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;1&quot;</span>,
    <span class="token string">&quot;@timestamp&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">2024</span>-10-29T02:30:26.141Z,
          <span class="token string">&quot;host&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;elk92&quot;</span>,
       <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;11111111111111111111111111&quot;</span>
<span class="token punctuation">}</span>

	
	
- 基于配置文件方式启动:
参考案例1：
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment">#  pwd</span>
/etc/logstash/conf.d

<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 01-stdin-to-stdout.conf</span>
input <span class="token punctuation">{</span> 
  stdin <span class="token punctuation">{</span> 
     <span class="token builtin class-name">type</span> <span class="token operator">=</span><span class="token operator">&gt;</span> stdin 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>  

output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -f 01-stdin-to-stdout.conf</span>
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>INFO <span class="token punctuation">]</span> <span class="token number">2024</span>-10-29 02:34:19.164 <span class="token punctuation">[</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span>-pipeline-manager<span class="token punctuation">]</span> javapipeline - Pipeline started <span class="token punctuation">{</span><span class="token string">&quot;pipeline.id&quot;</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">}</span>
The stdin plugin is now waiting <span class="token keyword">for</span> input:
<span class="token number">2222222222222222222222222</span>
<span class="token punctuation">{</span>
          <span class="token string">&quot;type&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;stdin&quot;</span>,
          <span class="token string">&quot;host&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;elk92&quot;</span>,
    <span class="token string">&quot;@timestamp&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">2024</span>-10-29T02:35:40.516Z,
       <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;2222222222222222222222222&quot;</span>,
      <span class="token string">&quot;@version&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;1&quot;</span>
<span class="token punctuation">}</span>



参考案例2：
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 01-stdin-to-stdout.conf</span>
input <span class="token punctuation">{</span> 
  stdin <span class="token punctuation">{</span> 
     <span class="token builtin class-name">type</span> <span class="token operator">=</span><span class="token operator">&gt;</span> stdin 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>  

output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    <span class="token comment"># codec =&gt; rubydebug </span>
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> json
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -f 01-stdin-to-stdout.conf </span>

<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>INFO <span class="token punctuation">]</span> <span class="token number">2024</span>-10-29 02:37:00.068 <span class="token punctuation">[</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span>-pipeline-manager<span class="token punctuation">]</span> javapipeline - Pipeline started <span class="token punctuation">{</span><span class="token string">&quot;pipeline.id&quot;</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">&quot;main&quot;</span><span class="token punctuation">}</span>
The stdin plugin is now waiting <span class="token keyword">for</span> input:
<span class="token number">3333333333333333333</span>
<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;stdin&quot;</span>,<span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;elk92&quot;</span>,<span class="token string">&quot;@version&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;1&quot;</span>,<span class="token string">&quot;@timestamp&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2024-10-29T02:37:16.958Z&quot;</span>,<span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;3333333333333333333&quot;</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br></div></div><h3 id="_21-logstash采集日志"><a href="#_21-logstash采集日志" class="header-anchor">#</a> 21，logstash采集日志</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.编写Python脚本
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># cat generate_log.py </span>
<span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: UTF-8 -*-</span>
<span class="token comment"># @author : Malu</span>

<span class="token function">import</span> datetime
<span class="token function">import</span> random
<span class="token function">import</span> logging
<span class="token function">import</span> <span class="token function">time</span>
<span class="token function">import</span> sys

LOG_FORMAT <span class="token operator">=</span> <span class="token string">&quot;%(levelname)s %(asctime)s [com.malu.%(module)s] - %(message)s &quot;</span>
DATE_FORMAT <span class="token operator">=</span> <span class="token string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>

<span class="token comment"># 配置root的logging.Logger实例的基本配置</span>
logging.basicConfig<span class="token punctuation">(</span>level<span class="token operator">=</span>logging.INFO, <span class="token assign-left variable">format</span><span class="token operator">=</span>LOG_FORMAT, <span class="token assign-left variable">datefmt</span><span class="token operator">=</span>DATE_FORMAT, <span class="token assign-left variable">filename</span><span class="token operator">=</span>sys.argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
, <span class="token assign-left variable">filemode</span><span class="token operator">=</span><span class="token string">'a'</span>,<span class="token punctuation">)</span>
actions <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;浏览页面&quot;</span>, <span class="token string">&quot;评论商品&quot;</span>, <span class="token string">&quot;加入收藏&quot;</span>, <span class="token string">&quot;加入购物车&quot;</span>, <span class="token string">&quot;提交订单&quot;</span>, <span class="token string">&quot;使用优惠券&quot;</span>, <span class="token string">&quot;领取优惠券&quot;</span>,
 <span class="token string">&quot;搜索&quot;</span>, <span class="token string">&quot;查看订单&quot;</span>, <span class="token string">&quot;付款&quot;</span>, <span class="token string">&quot;清空购物车&quot;</span><span class="token punctuation">]</span>

<span class="token keyword">while</span> True:
    time.sleep<span class="token punctuation">(</span>random.randint<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">5</span><span class="token punctuation">))</span>
    user_id <span class="token operator">=</span> random.randint<span class="token punctuation">(</span><span class="token number">1</span>, <span class="token number">10000</span><span class="token punctuation">)</span>
    <span class="token comment"># 对生成的浮点数保留2位有效数字.</span>
    price <span class="token operator">=</span> round<span class="token punctuation">(</span>random.uniform<span class="token punctuation">(</span><span class="token number">15000</span>, <span class="token number">30000</span><span class="token punctuation">)</span>,2<span class="token punctuation">)</span>
    action <span class="token operator">=</span> random.choice<span class="token punctuation">(</span>actions<span class="token punctuation">)</span>
    svip <span class="token operator">=</span> random.choice<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0,1</span>,2<span class="token punctuation">]</span><span class="token punctuation">)</span>
    logging.info<span class="token punctuation">(</span><span class="token string">&quot;DAU|{0}|{1}|{2}|{3}&quot;</span>.format<span class="token punctuation">(</span>user_id, action,svip,price<span class="token punctuation">))</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">2</span>.启动生成日志的脚本
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># python3 generate_log.py /tmp/apps.log</span>



<span class="token number">3</span>.采集日志
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 02-file-to-stdout.conf </span>
input <span class="token punctuation">{</span> 
  <span class="token function">file</span> <span class="token punctuation">{</span> 
     <span class="token comment"># 指定采集文件的路径</span>
     path <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;/tmp/apps.log&quot;</span>
     
 	 <span class="token comment"># 指定&quot;首次&quot;采集文件时从哪个位置读取: beginning, end(默认值)。</span>
     start_position <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;beginning&quot;</span>
  
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>  

output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 02-file-to-stdout.conf </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h3 id="_22-mutate插件"><a href="#_22-mutate插件" class="header-anchor">#</a> 22，mutate插件</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.编写配置文件
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 03-file-mutate-stdout.conf </span>
input <span class="token punctuation">{</span> 
  <span class="token function">file</span> <span class="token punctuation">{</span> 
     path <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;/tmp/apps.log&quot;</span>

     start_position <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;beginning&quot;</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>  


filter <span class="token punctuation">{</span>
  mutate <span class="token punctuation">{</span>
    <span class="token comment"># 将message字段按照&quot;|&quot;进行切割</span>
    <span class="token function">split</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;|&quot;</span> <span class="token punctuation">}</span>

    <span class="token comment"># 添加字段</span>
    add_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> 
       <span class="token string">&quot;userId&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{[message][1]}&quot;</span>
       <span class="token string">&quot;action&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{[message][2]}&quot;</span>
       <span class="token string">&quot;svip&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{[message][3]}&quot;</span>
       <span class="token string">&quot;price&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{[message][4]}&quot;</span>
       <span class="token string">&quot;other&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{[message][0]}&quot;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 移除字段</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;message&quot;</span>,<span class="token string">&quot;@version&quot;</span>,<span class="token string">&quot;host&quot;</span> <span class="token punctuation">]</span>

  <span class="token punctuation">}</span>

  mutate <span class="token punctuation">{</span>
    <span class="token comment"># 转换字段的数据类型</span>
    convert <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;userId&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;integer&quot;</span>
      <span class="token string">&quot;price&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;float&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">2</span>.启动Logstash实例
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 03-file-mutate-stdout.conf </span>


<span class="token number">3</span>.验证测试

<span class="token punctuation">{</span>
    <span class="token string">&quot;@timestamp&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">2024</span>-10-29T03:58:55.848Z,
          <span class="token string">&quot;svip&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;2&quot;</span>,
         <span class="token string">&quot;price&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">16933.16</span>,
          <span class="token string">&quot;path&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;/tmp/apps.log&quot;</span>,
        <span class="token string">&quot;userId&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">9102</span>,
         <span class="token string">&quot;other&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;INFO 2024-10-29 11:58:55 [com.oldboyedu.generate_log] - DAU&quot;</span>,
        <span class="token string">&quot;action&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;清空购物车&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><h3 id="_23-date插件"><a href="#_23-date插件" class="header-anchor">#</a> 23，date插件</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>使用date插件准备处理日期格式案例
<span class="token number">1</span>.编写配置文件
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 03-file-mutate-stdout.conf </span>
input <span class="token punctuation">{</span> 
  <span class="token function">file</span> <span class="token punctuation">{</span> 
     path <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;/tmp/apps.log&quot;</span>

     start_position <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;beginning&quot;</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>  


filter <span class="token punctuation">{</span>
  mutate <span class="token punctuation">{</span>
    <span class="token comment"># 将message字段按照&quot;|&quot;进行切割</span>
    <span class="token function">split</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;|&quot;</span> <span class="token punctuation">}</span>

    <span class="token comment"># 添加字段</span>
    add_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> 
       <span class="token string">&quot;userId&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{[message][1]}&quot;</span>
       <span class="token string">&quot;action&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{[message][2]}&quot;</span>
       <span class="token string">&quot;svip&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{[message][3]}&quot;</span>
       <span class="token string">&quot;price&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{[message][4]}&quot;</span>
       <span class="token string">&quot;other&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{[message][0]}&quot;</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>

  mutate <span class="token punctuation">{</span>
    <span class="token comment"># 转换字段的数据类型</span>
    convert <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
      <span class="token string">&quot;userId&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;integer&quot;</span>
      <span class="token string">&quot;price&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;float&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>


  mutate <span class="token punctuation">{</span>
    <span class="token function">split</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token string">&quot;other&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot; &quot;</span> <span class="token punctuation">}</span>

    add_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> 
       <span class="token string">&quot;dt&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{[other][1]} %{[other][2]}&quot;</span>
    <span class="token punctuation">}</span>

    <span class="token comment"># 移除字段</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;message&quot;</span>,<span class="token string">&quot;@version&quot;</span>,<span class="token string">&quot;host&quot;</span>,<span class="token string">&quot;other&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>


  <span class="token function">date</span> <span class="token punctuation">{</span>
    <span class="token comment"># 2024-10-29 14:43:21</span>
    <span class="token comment"># 语法参考:</span>
    <span class="token comment">#   https://www.elastic.co/guide/en/logstash/current/plugins-filters-date.html#plugins-filters-date-match</span>
    match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;dt&quot;</span>, <span class="token string">&quot;yyyy-MM-dd HH:mm:ss&quot;</span> <span class="token punctuation">]</span>

    <span class="token comment"># 将转换的数据存储在指定的字段中，若不指定，则默认会覆盖&quot;@timestamp&quot;字段</span>
    <span class="token comment">#target =&gt; &quot;malu-datetime&quot;</span>

    <span class="token comment"># 定义时区的配置,参考地址:</span>
    <span class="token comment">#  https://joda-time.sourceforge.net/timezones.html</span>
    timezone <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Asia/Shanghai&quot;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 

  elasticsearch <span class="token punctuation">{</span>
      <span class="token comment"># 指定ES集群的地址</span>
      hosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.91:9200&quot;</span>,<span class="token string">&quot;10.0.0.92:9200&quot;</span>,<span class="token string">&quot;10.0.0.93:9200&quot;</span><span class="token punctuation">]</span>
      <span class="token comment"># 指定ES集群的索引名称</span>
      index <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu-logstash-%{+yyyy.MM.dd}&quot;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">2</span>.启动Logstash实例 
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># sed  -i 's#2024#2023#g' /tmp/apps.log </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># rm -rf /usr/share/logstash/data/</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 03-file-mutate-stdout.conf </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br></div></div><p>大屏显示：</p> <p><img src="/devops/public/assets/img/1730270433681.a33aaeef.png" alt="1730270433681"></p> <h3 id="_24-logstash对接filebeat"><a href="#_24-logstash对接filebeat" class="header-anchor">#</a> 24，Logstash对接filebeat</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>- Logstash对接filebeat 
<span class="token number">1</span>.编写Logstash配置文件 
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 04-beats-grok-stdout.conf</span>
input <span class="token punctuation">{</span> 
  beats <span class="token punctuation">{</span>
    <span class="token comment"># 监听的端口号</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">8888</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  

filter <span class="token punctuation">{</span>
  mutate <span class="token punctuation">{</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;@version&quot;</span>,<span class="token string">&quot;log&quot;</span>,<span class="token string">&quot;tags&quot;</span>,<span class="token string">&quot;agent&quot;</span>,<span class="token string">&quot;ecs&quot;</span>,<span class="token string">&quot;input&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>

	
<span class="token number">2</span>.启动Logstash 
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 04-beats-grok-stdout.conf</span>
<span class="token punctuation">..</span>.	
<span class="token punctuation">[</span>INFO <span class="token punctuation">]</span> <span class="token number">2024</span>-10-29 08:14:11.367 <span class="token punctuation">[</span><span class="token punctuation">[</span>main<span class="token punctuation">]</span><span class="token operator">&lt;</span>beats<span class="token punctuation">]</span> Server - Starting server on port: <span class="token number">8888</span>


<span class="token number">3</span>.编写filebeat配置文件 
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 09-nginx-to-logstash.yaml</span>
filebeat.inputs:
- type: log
  paths:
  - /var/log/nginx/access.log*


<span class="token comment"># 输出地址为Logstash的8888端口</span>
output.logstash:
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.92:8888&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">4</span>.启动filebeat采集数据到Logstash节点
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 09-nginx-to-logstash.yaml</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">10240000000</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">10240000000000</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">10240000000000</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET /mac HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">10240000000000</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET /mac HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">10240000000000</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET /mac HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">10240000000000</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET /game HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">10240000000000</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET /game HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">10240000000000</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET /game HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">10240000000000</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET /game HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">10240000000000</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET /game HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">10240000000000</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">221.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:10 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/130.0.0.0 Safari/537.36&quot;</span>
<span class="token number">21.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:26 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1&quot;</span>
<span class="token number">22.218</span>.209.136 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:37 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (iPhone; CPU iPhone OS 16_6 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.6 Mobile/15E148 Safari/604.1&quot;</span>
<span class="token number">221.218</span>.209.11 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:11:50 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.0 Safari/605.1.15&quot;</span>
<span class="token number">221.218</span>.209.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
<span class="token number">221.218</span>.55.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
<span class="token number">221.218</span>.66.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
<span class="token number">55.77</span>.66.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
<span class="token number">55.88</span>.66.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
<span class="token number">99.88</span>.66.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
<span class="token number">222.88</span>.66.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
<span class="token number">110.88</span>.66.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
<span class="token number">120.88</span>.66.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
<span class="token number">130.88</span>.66.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
<span class="token number">140.88</span>.66.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET / HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
<span class="token number">150.88</span>.66.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET /iphone HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
<span class="token number">150.88</span>.66.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET /iphone HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
<span class="token number">150.88</span>.66.22 - - <span class="token punctuation">[</span><span class="token number">28</span>/Oct/2024:17:12:27 +0800<span class="token punctuation">]</span> <span class="token string">&quot;GET /iphone HTTP/1.1&quot;</span> <span class="token number">200</span> <span class="token number">396</span> <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><h3 id="_25-logstash基于grok分析nginx的访问日志"><a href="#_25-logstash基于grok分析nginx的访问日志" class="header-anchor">#</a> 25，Logstash基于grok分析nginx的访问日志</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.编写Logstash配置文件
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 04-beats-grok-stdout.conf </span>
input <span class="token punctuation">{</span> 
  beats <span class="token punctuation">{</span>
    <span class="token comment"># 监听的端口号</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">8888</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  

filter <span class="token punctuation">{</span>
  mutate <span class="token punctuation">{</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;@version&quot;</span>,<span class="token string">&quot;log&quot;</span>,<span class="token string">&quot;tags&quot;</span>,<span class="token string">&quot;agent&quot;</span>,<span class="token string">&quot;ecs&quot;</span>,<span class="token string">&quot;input&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  <span class="token comment"># 基于正则提取任意文本</span>
  grok <span class="token punctuation">{</span>
     <span class="token comment"># 分析message字段的访问日志，基于内置的变量: HTTPD_COMMONLOG</span>
     match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{HTTPD_COMMONLOG}&quot;</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span>


<span class="token punctuation">}</span>


output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">2</span>.启动filebeat 
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 09-nginx-to-logstash.yaml </span>



测试数据效果：
<span class="token punctuation">{</span>
      <span class="token string">&quot;timestamp&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;28/Oct/2024:17:12:27 +0800&quot;</span>,
          <span class="token string">&quot;ident&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;-&quot;</span>,
       <span class="token string">&quot;clientip&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;150.88.66.22&quot;</span>,
        <span class="token string">&quot;request&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;/iphone&quot;</span>,
          <span class="token string">&quot;bytes&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;396&quot;</span>,
           <span class="token string">&quot;auth&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;-&quot;</span>,
           <span class="token string">&quot;verb&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;GET&quot;</span>,
        <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;150.88.66.22 - - [28/Oct/2024:17:12:27 +0800] <span class="token entity" title="\&quot;">\&quot;</span>GET /iphone HTTP/1.1<span class="token entity" title="\&quot;">\&quot;</span> 200 396 <span class="token entity" title="\&quot;">\&quot;</span>-<span class="token entity" title="\&quot;">\&quot;</span> <span class="token entity" title="\&quot;">\&quot;</span>Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36<span class="token entity" title="\&quot;">\&quot;</span>&quot;</span>,
           <span class="token string">&quot;host&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;name&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;elk93&quot;</span>
    <span class="token punctuation">}</span>,
    <span class="token string">&quot;httpversion&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;1.1&quot;</span>,
     <span class="token string">&quot;@timestamp&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">2024</span>-10-29T09:03:55.600Z,
       <span class="token string">&quot;response&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;200&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h3 id="_26-基于geoip分析nginx的ip地址经纬度"><a href="#_26-基于geoip分析nginx的ip地址经纬度" class="header-anchor">#</a> 26，基于geoip分析nginx的IP地址经纬度</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.编写Logstash配置文件
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 05-beats-geoip-stdout.conf </span>
input <span class="token punctuation">{</span> 
  beats <span class="token punctuation">{</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">8888</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  

filter <span class="token punctuation">{</span>
  mutate <span class="token punctuation">{</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;@version&quot;</span>,<span class="token string">&quot;log&quot;</span>,<span class="token string">&quot;tags&quot;</span>,<span class="token string">&quot;agent&quot;</span>,<span class="token string">&quot;ecs&quot;</span>,<span class="token string">&quot;input&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  grok <span class="token punctuation">{</span>
     match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{HTTPD_COMMONLOG}&quot;</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

  <span class="token comment"># 基于指定公网IP地址字段分析用户的经纬度，城市，国家等相关信息。</span>
  geoip <span class="token punctuation">{</span>
    <span class="token builtin class-name">source</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;clientip&quot;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">2</span>.filebeat启动实例 
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 09-nginx-to-logstash.yaml </span>

 

测试数据效果：
<span class="token punctuation">{</span>
        <span class="token string">&quot;request&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;/iphone&quot;</span>,
       <span class="token string">&quot;clientip&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;150.88.66.22&quot;</span>,
       <span class="token string">&quot;response&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;200&quot;</span>,
          <span class="token string">&quot;ident&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;-&quot;</span>,
     <span class="token string">&quot;@timestamp&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">2024</span>-10-29T09:13:33.643Z,
          <span class="token string">&quot;bytes&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;396&quot;</span>,
        <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;150.88.66.22 - - [28/Oct/2024:17:12:27 +0800] <span class="token entity" title="\&quot;">\&quot;</span>GET /iphone HTTP/1.1<span class="token entity" title="\&quot;">\&quot;</span> 200 396 <span class="token entity" title="\&quot;">\&quot;</span>-<span class="token entity" title="\&quot;">\&quot;</span> <span class="token entity" title="\&quot;">\&quot;</span>Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36<span class="token entity" title="\&quot;">\&quot;</span>&quot;</span>,
           <span class="token string">&quot;host&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;name&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;elk93&quot;</span>
    <span class="token punctuation">}</span>,
      <span class="token string">&quot;timestamp&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;28/Oct/2024:17:12:27 +0800&quot;</span>,
           <span class="token string">&quot;verb&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;GET&quot;</span>,
    <span class="token string">&quot;httpversion&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;1.1&quot;</span>,
          <span class="token string">&quot;geoip&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
             <span class="token string">&quot;longitude&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">139.6895</span>,
        <span class="token string">&quot;continent_code&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;AS&quot;</span>,
          <span class="token string">&quot;country_name&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Japan&quot;</span>,
              <span class="token string">&quot;latitude&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">35.6897</span>,
              <span class="token string">&quot;location&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;lat&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">35.6897</span>,
            <span class="token string">&quot;lon&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">139.6895</span>
        <span class="token punctuation">}</span>,
         <span class="token string">&quot;country_code3&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;JP&quot;</span>,
                    <span class="token string">&quot;ip&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;150.88.66.22&quot;</span>,
         <span class="token string">&quot;country_code2&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;JP&quot;</span>,
              <span class="token string">&quot;timezone&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Asia/Tokyo&quot;</span>
    <span class="token punctuation">}</span>,
           <span class="token string">&quot;auth&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;-&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br></div></div><h3 id="_27-基于useragent分析用户的设备类型"><a href="#_27-基于useragent分析用户的设备类型" class="header-anchor">#</a> 27，基于useragent分析用户的设备类型</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.编写Logstash配置文件
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 06-beats-useragent-stdout.conf </span>
input <span class="token punctuation">{</span> 
  beats <span class="token punctuation">{</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">8888</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  

filter <span class="token punctuation">{</span>
  mutate <span class="token punctuation">{</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;@version&quot;</span>,<span class="token string">&quot;log&quot;</span>,<span class="token string">&quot;tags&quot;</span>,<span class="token string">&quot;agent&quot;</span>,<span class="token string">&quot;ecs&quot;</span>,<span class="token string">&quot;input&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  grok <span class="token punctuation">{</span>
     match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{HTTPD_COMMONLOG}&quot;</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

  geoip <span class="token punctuation">{</span>
    <span class="token builtin class-name">source</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;clientip&quot;</span>
  <span class="token punctuation">}</span>

  useragent <span class="token punctuation">{</span>
    <span class="token comment"># 基于哪个字段分析用户的设备类型</span>
    <span class="token builtin class-name">source</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;message&quot;</span>
   
    <span class="token comment"># 将分析的结果存储在哪个字段中</span>
    target <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu-useragent&quot;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 06-beats-useragent-stdout.conf </span>



	<span class="token number">2</span>.filebeat启动实例
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 09-nginx-to-logstash.yaml </span>

 

	
	
	测试数据效果：
<span class="token punctuation">{</span>
                          <span class="token string">&quot;geoip&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
         <span class="token string">&quot;country_code3&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;JP&quot;</span>,
             <span class="token string">&quot;longitude&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">139.6895</span>,
              <span class="token string">&quot;timezone&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Asia/Tokyo&quot;</span>,
         <span class="token string">&quot;country_code2&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;JP&quot;</span>,
              <span class="token string">&quot;location&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;lon&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">139.6895</span>,
            <span class="token string">&quot;lat&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">35.6897</span>
        <span class="token punctuation">}</span>,
          <span class="token string">&quot;country_name&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Japan&quot;</span>,
        <span class="token string">&quot;continent_code&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;AS&quot;</span>,
                    <span class="token string">&quot;ip&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;150.88.66.22&quot;</span>,
              <span class="token string">&quot;latitude&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">35.6897</span>
    <span class="token punctuation">}</span>,
                        <span class="token string">&quot;request&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;/iphone&quot;</span>,
                           <span class="token string">&quot;auth&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;-&quot;</span>,
                          <span class="token string">&quot;ident&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;-&quot;</span>,
                           <span class="token string">&quot;verb&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;GET&quot;</span>,
                       <span class="token string">&quot;clientip&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;150.88.66.22&quot;</span>,
    <span class="token string">&quot;oldboyedu-linux94-useragent&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;device&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Samsung SM-G955U&quot;</span>,
           <span class="token string">&quot;version&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;116.0.0.0&quot;</span>,
        <span class="token string">&quot;os_version&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;8.0.0&quot;</span>,
             <span class="token string">&quot;minor&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;0&quot;</span>,
           <span class="token string">&quot;os_name&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Android&quot;</span>,
           <span class="token string">&quot;os_full&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Android 8.0.0&quot;</span>,
          <span class="token string">&quot;os_major&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;8&quot;</span>,
                <span class="token string">&quot;os&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Android&quot;</span>,
             <span class="token string">&quot;major&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;116&quot;</span>,
          <span class="token string">&quot;os_minor&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;0&quot;</span>,
             <span class="token string">&quot;patch&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;0&quot;</span>,
          <span class="token string">&quot;os_patch&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;0&quot;</span>,
              <span class="token string">&quot;name&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Chrome Mobile&quot;</span>
    <span class="token punctuation">}</span>,
                      <span class="token string">&quot;timestamp&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;28/Oct/2024:17:12:27 +0800&quot;</span>,
                          <span class="token string">&quot;bytes&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;396&quot;</span>,
                        <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;150.88.66.22 - - [28/Oct/2024:17:12:27 +0800] <span class="token entity" title="\&quot;">\&quot;</span>GET /iphone HTTP/1.1<span class="token entity" title="\&quot;">\&quot;</span> 200 396 <span class="token entity" title="\&quot;">\&quot;</span>-<span class="token entity" title="\&quot;">\&quot;</span> <span class="token entity" title="\&quot;">\&quot;</span>Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36<span class="token entity" title="\&quot;">\&quot;</span>&quot;</span>,
                           <span class="token string">&quot;host&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;name&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;elk93&quot;</span>
    <span class="token punctuation">}</span>,
                     <span class="token string">&quot;@timestamp&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">2024</span>-10-29T09:19:23.109Z,
                    <span class="token string">&quot;httpversion&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;1.1&quot;</span>,
                       <span class="token string">&quot;response&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;200&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br></div></div><h3 id="_28-基于date分析nginx的访问时间"><a href="#_28-基于date分析nginx的访问时间" class="header-anchor">#</a> 28，基于date分析nginx的访问时间</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.编写Logstash配置文件
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 07-beats-date-stdout.conf</span>
input <span class="token punctuation">{</span> 
  beats <span class="token punctuation">{</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">8888</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  

filter <span class="token punctuation">{</span>
  mutate <span class="token punctuation">{</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;@version&quot;</span>,<span class="token string">&quot;log&quot;</span>,<span class="token string">&quot;tags&quot;</span>,<span class="token string">&quot;agent&quot;</span>,<span class="token string">&quot;ecs&quot;</span>,<span class="token string">&quot;input&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  grok <span class="token punctuation">{</span>
     match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{HTTPD_COMMONLOG}&quot;</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

  geoip <span class="token punctuation">{</span>
    <span class="token builtin class-name">source</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;clientip&quot;</span>
  <span class="token punctuation">}</span>

  useragent <span class="token punctuation">{</span>
    <span class="token builtin class-name">source</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;message&quot;</span>
   
    target <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu-useragent&quot;</span>
  <span class="token punctuation">}</span>

  <span class="token function">date</span> <span class="token punctuation">{</span>
    <span class="token comment"># 28/Oct/2024:17:12:27 +0800</span>
    match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;timestamp&quot;</span>, <span class="token string">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 07-beats-date-stdout.conf</span>


<span class="token number">2</span>.filebeat启动实例
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 09-nginx-to-logstash.yaml </span>

 
测试数据效果：
<span class="token punctuation">{</span>
                        <span class="token string">&quot;request&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;/iphone&quot;</span>,
                           <span class="token string">&quot;verb&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;GET&quot;</span>,
                      <span class="token string">&quot;timestamp&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;28/Oct/2024:17:12:27 +0800&quot;</span>,
                          <span class="token string">&quot;geoip&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
         <span class="token string">&quot;country_code2&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;JP&quot;</span>,
              <span class="token string">&quot;location&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
            <span class="token string">&quot;lat&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">35.6897</span>,
            <span class="token string">&quot;lon&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">139.6895</span>
        <span class="token punctuation">}</span>,
         <span class="token string">&quot;country_code3&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;JP&quot;</span>,
              <span class="token string">&quot;latitude&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">35.6897</span>,
                    <span class="token string">&quot;ip&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;150.88.66.22&quot;</span>,
             <span class="token string">&quot;longitude&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">139.6895</span>,
          <span class="token string">&quot;country_name&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Japan&quot;</span>,
        <span class="token string">&quot;continent_code&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;AS&quot;</span>,
              <span class="token string">&quot;timezone&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Asia/Tokyo&quot;</span>
    <span class="token punctuation">}</span>,
                           <span class="token string">&quot;auth&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;-&quot;</span>,
                          <span class="token string">&quot;bytes&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;396&quot;</span>,
                       <span class="token string">&quot;clientip&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;150.88.66.22&quot;</span>,
                     <span class="token string">&quot;@timestamp&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">2024</span>-10-28T09:12:27.000Z,
                       <span class="token string">&quot;response&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;200&quot;</span>,
                    <span class="token string">&quot;httpversion&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;1.1&quot;</span>,
                        <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;150.88.66.22 - - [28/Oct/2024:17:12:27 +0800] <span class="token entity" title="\&quot;">\&quot;</span>GET /iphone HTTP/1.1<span class="token entity" title="\&quot;">\&quot;</span> 200 396 <span class="token entity" title="\&quot;">\&quot;</span>-<span class="token entity" title="\&quot;">\&quot;</span> <span class="token entity" title="\&quot;">\&quot;</span>Mozilla/5.0 (Linux; Android 8.0.0; SM-G955U Build/R16NW) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.0.0 Mobile Safari/537.36<span class="token entity" title="\&quot;">\&quot;</span>&quot;</span>,
    <span class="token string">&quot;oldboyedu-linux94-useragent&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
           <span class="token string">&quot;version&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;116.0.0.0&quot;</span>,
             <span class="token string">&quot;patch&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;0&quot;</span>,
          <span class="token string">&quot;os_patch&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;0&quot;</span>,
            <span class="token string">&quot;device&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Samsung SM-G955U&quot;</span>,
          <span class="token string">&quot;os_major&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;8&quot;</span>,
             <span class="token string">&quot;major&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;116&quot;</span>,
                <span class="token string">&quot;os&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Android&quot;</span>,
             <span class="token string">&quot;minor&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;0&quot;</span>,
           <span class="token string">&quot;os_name&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Android&quot;</span>,
          <span class="token string">&quot;os_minor&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;0&quot;</span>,
        <span class="token string">&quot;os_version&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;8.0.0&quot;</span>,
           <span class="token string">&quot;os_full&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Android 8.0.0&quot;</span>,
              <span class="token string">&quot;name&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;Chrome Mobile&quot;</span>
    <span class="token punctuation">}</span>,
                           <span class="token string">&quot;host&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
        <span class="token string">&quot;name&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;elk93&quot;</span>
    <span class="token punctuation">}</span>,
                          <span class="token string">&quot;ident&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;-&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br></div></div><h3 id="_29-将数据写入到es集群"><a href="#_29-将数据写入到es集群" class="header-anchor">#</a> 29，将数据写入到ES集群</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.编写Logstash配置文件
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 08-beats-filter-es.conf</span>
input <span class="token punctuation">{</span> 
  beats <span class="token punctuation">{</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">8888</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  

filter <span class="token punctuation">{</span>
  mutate <span class="token punctuation">{</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;@version&quot;</span>,<span class="token string">&quot;log&quot;</span>,<span class="token string">&quot;tags&quot;</span>,<span class="token string">&quot;agent&quot;</span>,<span class="token string">&quot;ecs&quot;</span>,<span class="token string">&quot;input&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  grok <span class="token punctuation">{</span>
     match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{HTTPD_COMMONLOG}&quot;</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

  geoip <span class="token punctuation">{</span>
    <span class="token builtin class-name">source</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;clientip&quot;</span>
  <span class="token punctuation">}</span>

  useragent <span class="token punctuation">{</span>
    <span class="token builtin class-name">source</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;message&quot;</span>
   
    target <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu-useragent&quot;</span>
  <span class="token punctuation">}</span>

  <span class="token function">date</span> <span class="token punctuation">{</span>
    <span class="token comment"># 28/Oct/2024:17:12:27 +0800</span>
    match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;timestamp&quot;</span>, <span class="token string">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 

  elasticsearch <span class="token punctuation">{</span>
      hosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.91:9200&quot;</span>,<span class="token string">&quot;10.0.0.92:9200&quot;</span>,<span class="token string">&quot;10.0.0.93:9200&quot;</span><span class="token punctuation">]</span>
      index <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu-elfk-nginx-%{+yyyy.MM.dd}&quot;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 08-beats-filter-es.conf</span>


<span class="token number">2</span>.filebeat启动实例
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 09-nginx-to-logstash.yaml </span>

 
 
<span class="token number">3</span>.kibana查询数据并验证


- ELFK架构数据映射之地图故障案例讲解

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><h3 id="_30-扩展与面试题"><a href="#_30-扩展与面试题" class="header-anchor">#</a> 30，扩展与面试题**</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>- <span class="token number">1</span>.编写一个shell脚本模拟nginx访问日志5w~30w条记录，并使用ELFK架构分享数据，访问日志要求如下:
- 要求客户端地址必须是公网地址<span class="token punctuation">;</span>
- 要求访问日志的年限是2018~2014的日志<span class="token punctuation">;</span>

- 扩展: logstash的pipeline
- 扩展: logstash自定义正则
- 扩展: filebeat自定义NGINX的JSON格式日志
- 扩展: filebeat自定义tomcat的JSON格式日志
- 扩展: filebeat的多行处理
- 扩展: filebeat的多实例
- 扩展: filestream实战
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>第3次模拟面试:
Q17:简单陈述下EFK含义及数据流走向?
上面有这个题目。

------------------------------------

Q18:1ogstash用过哪些filter插件及其作用?最少说出5个?

Logstash 是一个强大的数据处理管道，能够从多种来源接收数据，进行处理和转换，然后将数据发送到目标存储（如 Elasticsearch）。在 Logstash 中，filter 插件用于对输入的数据进行解析和转换。以下是常用的五个 filter 插件及其作用：

grok：
作用：用于解析和结构化日志数据。Grok 通过使用预定义的模式（如 IP 地址、日期、时间等）来提取字段，适合处理文本格式的日志。它是 Logstash 中最常用的过滤插件之一。
示例：将日志行解析为多个字段，例如从 ERROR <span class="token punctuation">[</span><span class="token number">2023</span>-10-01 <span class="token number">12</span>:00:00<span class="token punctuation">]</span> Something went wrong 中提取错误级别和时间戳。

mutate：
作用：用于对事件数据进行各种变换和操作，包括重命名字段、删除字段、添加字段、修改字段内容等。它是一个通用的过滤插件，适用于各种数据处理需求。
示例：您可以使用 mutate 插件来将字段名称从 old_name 更改为 new_name，或者删除不必要的字段。

date：
作用：用于将日期和时间字符串解析为 Logstash 中的时间戳对象。它允许您将自定义格式的日期字符串转换为标准的 @timestamp 字段，以便进行时间序列分析。
示例：将字符串 <span class="token number">2023</span>-10-01 <span class="token number">12</span>:00:00 转换为标准的时间戳格式。

geoip：
作用：根据 IP 地址为事件添加地理位置信息。它使用 MaxMind 的 GeoLite2 数据库来解析 IP 地址并附加国家、城市等地理信息。
示例：从访问日志中提取用户的 IP 地址，并使用 geoip 插件添加用户的国家和城市信息。

csv：
作用：用于解析 CSV 格式的数据，将 CSV 行转换为结构化的事件。通过指定分隔符和字段名称，csv 插件可以将每一行 CSV 数据转换为 Logstash 事件的字段。
示例：将 CSV 文件中的数据行（如 name,age,city）转换为结构化的字段（name、age、city）。

总结
这些 filter 插件通过对输入的数据进行解析和转换，帮助用户将非结构化或半结构化的数据转换为结构化的格式，便于后续的分析和存储。这些插件的组合使用可以极大地增强 Logstash 的数据处理能力。

------------------------------------

Q19:你们公司Es集群多大规模?硬件配置是啥呢?
集群规模：
节点数量：根据数据量和查询负载，集群可以从几台节点到数十甚至数百台节点。一般来说，至少需要三个主节点来实现高可用性。
数据节点：数据节点的数量取决于要存储的数据量、查询性能要求和可用性需求。对于小型应用，可能只需要一台数据节点，而大型应用可能需要几十台。

硬件配置：
CPU：通常，Elasticsearch 对 CPU 的需求较高，特别是在处理复杂查询时。建议使用多核处理器，常见配置是 <span class="token number">8</span> 核或更高。
内存：Elasticsearch 的性能受内存影响很大。一般建议每个节点至少配置 16GB 的 RAM，最好是 32GB 或更多。Elasticsearch 的 JVM 堆大小应设置为物理内存的一半，但不超过 32GB，以避免 JVM 的指针压缩限制。
存储：使用 SSD 硬盘可以显著提高 Elasticsearch 的性能，特别是在读写操作频繁时。存储容量需要根据数据增长率来确定，通常建议留有一定的冗余空间。
网络：确保节点之间有快速的网络连接，通常建议使用千兆以太网或更快的网络。

其他考虑：
冗余和备份：配置副本分片，以确保数据的高可用性和负载均衡。
监控和调优：使用监控工具（如 Elastic Stack 中的 Kibana 和 X-Pack）来监控集群的性能，并根据负载动态调整配置。
示例配置

以下是一个中等规模的 Elasticsearch 集群的示例硬件配置：
节点数量：3 个主节点、5 个数据节点
CPU：每个节点 <span class="token number">8</span> 核 CPU
内存：每个节点 32GB RAM（其中 16GB 用于 JVM 堆）
存储：每个节点 1TB SSD
网络：千兆以太网
总结
设计和配置 Elasticsearch 集群时，必须根据实际的工作负载、数据量和查询复杂性来选择合适的硬件和规模。定期监控集群性能，并根据需要进行扩展和优化，是确保集群高效运行的关键。如果您有具体的需求或问题，建议咨询专业的 Elasticsearch 解决方案架构师。
------------------------------------

Q20:你们公司ES集群有多少个索引?每个索引的分片数量，副本数量是多少?

索引（Index）：
在 Elasticsearch 中，索引是存储文档的结构化集合，可以理解为数据库中的表。每个索引可以包含大量的文档。

分片（Shard）：
每个索引在物理上被分割成若干个分片。分片是 Elasticsearch 存储和检索数据的基本单元。分片的数量可以根据数据量和查询需求进行配置。
默认情况下，每个索引的初始分片数量为 <span class="token number">5</span> 个，但可以在创建索引时进行调整。

副本（Replica）：
副本是主分片的副本，用于提高可用性和负载均衡。副本分片可以在主分片不可用时提供数据访问。
默认情况下，每个主分片有 <span class="token number">1</span> 个副本，但可以根据需求进行调整。

建议的配置
索引数量：
索引的数量应根据数据的使用场景、生命周期和查询频率来决定。避免创建过多的索引，因为这会影响集群的性能。
一般建议对相同类型的数据使用单个索引，并根据时间（如按日、按月）或数据类型进行分割。

分片数量：
分片的数量应根据数据量和查询负载来调整。通常，每个分片的大小应该在 10GB 到 50GB 之间，以确保良好的性能。
对于小型索引，建议不要使用过多的分片，因为这会增加管理开销。

副本数量：
副本数量应根据可用性和负载需求来设定。一般建议至少有一个副本，以确保在主分片不可用时仍能访问数据。
如果查询负载较高，可以增加副本数量，以分担查询请求。

示例配置
以下是一个简单的示例配置：
索引数量：2 个索引（如 logs-2023-01 和 logs-2023-02）
每个索引的分片数量：5 个主分片
每个索引的副本数量：1 个副本（即每个主分片有一个副本）

监控和管理
使用 Elasticsearch 自带的 API 或监控工具（如 Kibana）来查看当前集群中的索引数量、分片状态和副本状态，以便及时调整和优化配置。
通过这些信息，您可以根据自己的需求设计和管理 Elasticsearch 集群的索引、分片和副本。对于具体的配置和优化，建议根据实际的数据和查询需求进行测试和调整。

------------------------------------

Q21:你在EK架构中，有遇到过什么印象比较深刻的故障吗?

------------------------------------

022:你们工作中，nginx做过哪些优化?最少说出3~5种?
<span class="token number">1</span>. Gzip 压缩
作用：启用 Gzip 压缩可以减少传输数据的大小，从而加快页面加载速度和减少带宽使用。
配置示例：
http <span class="token punctuation">{</span>
    <span class="token function">gzip</span> on<span class="token punctuation">;</span>
    gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript<span class="token punctuation">;</span>
    gzip_min_length <span class="token number">1000</span><span class="token punctuation">;</span>  <span class="token comment"># 最小压缩文件大小</span>
<span class="token punctuation">}</span>

<span class="token number">2</span>. 缓存静态内容
作用：通过缓存静态内容（如图片、CSS 和 JavaScript 文件）来减少对后端服务器的请求，从而提高响应速度。
配置示例：
location /static/ <span class="token punctuation">{</span>
    root /var/www/html<span class="token punctuation">;</span>  <span class="token comment"># 指定静态文件目录</span>
    expires 30d<span class="token punctuation">;</span>         <span class="token comment"># 设置缓存过期时间</span>
<span class="token punctuation">}</span>

<span class="token number">3</span>. 使用反向代理和负载均衡
作用：将请求分发到多个后端服务器，提高应用程序的可用性和性能。Nginx 可以作为反向代理服务器来处理所有传入的请求。
配置示例：
upstream backend <span class="token punctuation">{</span>
    server backend1.example.com<span class="token punctuation">;</span>
    server backend2.example.com<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

server <span class="token punctuation">{</span>
    location / <span class="token punctuation">{</span>
        proxy_pass http://backend<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token number">4</span>. 调整连接和请求限制
作用：通过调整连接数和请求数限制，防止单个用户占用过多资源，保障服务的稳定性和可用性。
配置示例：
http <span class="token punctuation">{</span>
    limit_conn_zone <span class="token variable">$binary_remote_addr</span> <span class="token assign-left variable">zone</span><span class="token operator">=</span>addr:10m<span class="token punctuation">;</span>  <span class="token comment"># 定义连接限制区</span>
    limit_conn addr <span class="token number">10</span><span class="token punctuation">;</span>  <span class="token comment"># 每个 IP 地址限制 10 个连接</span>
<span class="token punctuation">}</span>

<span class="token number">5</span>. 启用 HTTP/2
作用：HTTP/2 提供了更高效的请求/响应机制，允许多个请求并行在同一个连接中发送，从而提高页面加载速度。
配置示例：
server <span class="token punctuation">{</span>
    listen <span class="token number">443</span> ssl http2<span class="token punctuation">;</span>  <span class="token comment"># 启用 HTTP/2</span>
    ssl_certificate /path/to/cert.pem<span class="token punctuation">;</span>
    ssl_certificate_key /path/to/key.pem<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

总结
这些优化方法可以帮助提高 Nginx 的性能和响应速度，同时保证服务的稳定性和安全性。根据具体的应用场景和需求，可以选择合适的优化策略进行配置和调整。通过定期监控和性能测试，您可以进一步优化 Nginx 配置，以满足不断变化的流量需求。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br></div></div><h3 id="_31-数据映射之带宽统计案例"><a href="#_31-数据映射之带宽统计案例" class="header-anchor">#</a> 31，数据映射之带宽统计案例</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">0</span>.修改带宽关于<span class="token string">&quot;bytes&quot;</span>字段的数据映射

<span class="token number">1</span>.编写Logstash配置文件
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 08-beats-filter-es.conf </span>
input <span class="token punctuation">{</span> 
  beats <span class="token punctuation">{</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">8888</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  

filter <span class="token punctuation">{</span>
  mutate <span class="token punctuation">{</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;@version&quot;</span>,<span class="token string">&quot;log&quot;</span>,<span class="token string">&quot;tags&quot;</span>,<span class="token string">&quot;agent&quot;</span>,<span class="token string">&quot;ecs&quot;</span>,<span class="token string">&quot;input&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

  grok <span class="token punctuation">{</span>
     match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{HTTPD_COMMONLOG}&quot;</span><span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

<span class="token comment">#  geoip {</span>
<span class="token comment">#    source =&gt; &quot;clientip&quot;</span>
<span class="token comment">#  }</span>

  useragent <span class="token punctuation">{</span>
    <span class="token builtin class-name">source</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;message&quot;</span>
   
    target <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;oldboyedu-linux94-useragent&quot;</span>
  <span class="token punctuation">}</span>

  <span class="token function">date</span> <span class="token punctuation">{</span>
    <span class="token comment"># 28/Oct/2024:17:12:27 +0800</span>
    match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;timestamp&quot;</span>, <span class="token string">&quot;dd/MMM/yyyy:HH:mm:ss Z&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>


output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 

  elasticsearch <span class="token punctuation">{</span>
      hosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.91:9200&quot;</span>,<span class="token string">&quot;10.0.0.92:9200&quot;</span>,<span class="token string">&quot;10.0.0.93:9200&quot;</span><span class="token punctuation">]</span>
      index <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;oldboyedu-linux94-elfk-nginx-%{+yyyy.MM.dd}&quot;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 08-beats-filter-es.conf </span>


<span class="token number">2</span>.启动filebeat实例
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 09-nginx-to-logstash.yaml </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><h3 id="_32-logstash的多实例"><a href="#_32-logstash的多实例" class="header-anchor">#</a> 32，Logstash的多实例</h3> <p><img src="/devops/public/assets/img/1730342528099.6b88d6d3.png" alt="1730342528099"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.启动第一个实例
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -f 01-stdin-to-stdout.conf </span>

<span class="token number">2</span>.启动第二个实例
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -f 02-file-to-stdout.conf --path.data /tmp/logstash-data</span>

温馨提示:
- <span class="token number">1</span>.如果不指定数据路径<span class="token punctuation">(</span>若路径不存在会自动创建<span class="token punctuation">)</span>，则Logstash默认的数据路径在安装目录的data目录下。比如: <span class="token string">&quot;/usr/share/logstash/data/&quot;</span>
- <span class="token number">2</span>.如果同一个节点启动了多个Logstash实例，不指定数据路径，则会报错：
Logstash could not be started because there is already another instance using the configured data directory.  If you wish to run multiple instances, you must change the <span class="token string">&quot;path.data&quot;</span> setting.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>- Logstash多实例实战 

<span class="token number">1</span>.启动Logstash实例1
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 09-multiple-tcp-to-es.conf </span>
input <span class="token punctuation">{</span> 
  <span class="token comment"># 监听本地的tcp端口，用于接受数据</span>
  tcp <span class="token punctuation">{</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">7777</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  


filter <span class="token punctuation">{</span>
  mutate <span class="token punctuation">{</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;@version&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 

 elasticsearch <span class="token punctuation">{</span>
      hosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.91:9200&quot;</span>,<span class="token string">&quot;10.0.0.92:9200&quot;</span>,<span class="token string">&quot;10.0.0.93:9200&quot;</span><span class="token punctuation">]</span>
      index <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu-elfk-multiple-tcp-%{+yyyy.MM.dd}&quot;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 09-multiple-tcp-to-es.conf </span>


<span class="token number">2</span>.启动Logstash实例2 
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 10-multiple-beats-to-es.conf </span>
input <span class="token punctuation">{</span> 
  beats <span class="token punctuation">{</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">8888</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  

filter <span class="token punctuation">{</span>
  mutate <span class="token punctuation">{</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;@version&quot;</span>,<span class="token string">&quot;log&quot;</span>,<span class="token string">&quot;tags&quot;</span>,<span class="token string">&quot;agent&quot;</span>,<span class="token string">&quot;ecs&quot;</span>,<span class="token string">&quot;input&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 

  elasticsearch <span class="token punctuation">{</span>
      hosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.91:9200&quot;</span>,<span class="token string">&quot;10.0.0.92:9200&quot;</span>,<span class="token string">&quot;10.0.0.93:9200&quot;</span><span class="token punctuation">]</span>
      index <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu-elfk-multiple-beats-%{+yyyy.MM.dd}&quot;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 10-multiple-beats-to-es.conf --path.data /tmp/logstash-data</span>

	
<span class="token number">3</span>.启动filebeat 
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 10-tcp-to-logstash.yaml</span>
filebeat.inputs:
- type: tcp
  host: <span class="token string">&quot;0.0.0.0:9000&quot;</span>

output.logstash:
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.92:8888&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 10-tcp-to-logstash.yaml</span>

<span class="token number">4</span>.发送测试数据到实例1
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># echo www.malu.com | nc 10.0.0.92 7777</span>


<span class="token number">5</span>.发送测试数据到filebeat 
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># echo linux | nc 10.0.0.93 9000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br></div></div><h3 id="_33-logstash的if多分支语法"><a href="#_33-logstash的if多分支语法" class="header-anchor">#</a> 33，Logstash的if多分支语法</h3> <p><img src="/devops/public/assets/img/1730342548063.c187b556.png" alt="1730342548063"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.启动Logstash实例 
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 11-if-logstash.conf </span>
input <span class="token punctuation">{</span> 
  tcp <span class="token punctuation">{</span>
    <span class="token builtin class-name">type</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu-tcp&quot;</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">7777</span>
  <span class="token punctuation">}</span>


  beats <span class="token punctuation">{</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">8888</span>
    <span class="token builtin class-name">type</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu-beats&quot;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  


filter <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;malu-tcp&quot;</span> <span class="token punctuation">{</span>
    mutate <span class="token punctuation">{</span>
      remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;@version&quot;</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    mutate <span class="token punctuation">{</span>
      remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;@version&quot;</span>,<span class="token string">&quot;log&quot;</span>,<span class="token string">&quot;tags&quot;</span>,<span class="token string">&quot;agent&quot;</span>,<span class="token string">&quot;ecs&quot;</span>,<span class="token string">&quot;input&quot;</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 

  <span class="token keyword">if</span> <span class="token punctuation">[</span>type<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">&quot;malu-tcp&quot;</span> <span class="token punctuation">{</span>
    elasticsearch <span class="token punctuation">{</span>
         hosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.91:9200&quot;</span>,<span class="token string">&quot;10.0.0.92:9200&quot;</span>,<span class="token string">&quot;10.0.0.93:9200&quot;</span><span class="token punctuation">]</span>
         index <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu-elfk-if-tcp-%{+yyyy.MM.dd}&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>else <span class="token punctuation">{</span>
    elasticsearch <span class="token punctuation">{</span>
        hosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.91:9200&quot;</span>,<span class="token string">&quot;10.0.0.92:9200&quot;</span>,<span class="token string">&quot;10.0.0.93:9200&quot;</span><span class="token punctuation">]</span>
        index <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu-elfk-if-beats-%{+yyyy.MM.dd}&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 11-if-logstash.conf </span>


<span class="token number">2</span>.启动filebeat实例
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 10-tcp-to-logstash.yaml</span>


<span class="token number">3</span>.发送测试数据
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># echo xixi | nc 10.0.0.92 7777</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># echo haha | nc 10.0.0.93 9000</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">4</span>.kibana验证数据查看
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><h3 id="_34-logstash的pipeline实战"><a href="#_34-logstash的pipeline实战" class="header-anchor">#</a> 34，logstash的pipeline实战</h3> <p><img src="/devops/public/assets/img/1730342567847.6e44592c.png" alt="1730342567847"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.修改Logstash的配置文件
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/etc/logstash/conf.d
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 12-pipeline-tcp-to-es.conf </span>
input <span class="token punctuation">{</span> 
  tcp <span class="token punctuation">{</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">7777</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  


filter <span class="token punctuation">{</span>
  mutate <span class="token punctuation">{</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;@version&quot;</span><span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 

 elasticsearch <span class="token punctuation">{</span>
      hosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.91:9200&quot;</span>,<span class="token string">&quot;10.0.0.92:9200&quot;</span>,<span class="token string">&quot;10.0.0.93:9200&quot;</span><span class="token punctuation">]</span>
      index <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu-elfk-pipeline-tcp-%{+yyyy.MM.dd}&quot;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 13-pipeline-beats-to-es.conf </span>
input <span class="token punctuation">{</span> 
  beats <span class="token punctuation">{</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">8888</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  

filter <span class="token punctuation">{</span>
  mutate <span class="token punctuation">{</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;@version&quot;</span>,<span class="token string">&quot;log&quot;</span>,<span class="token string">&quot;tags&quot;</span>,<span class="token string">&quot;agent&quot;</span>,<span class="token string">&quot;ecs&quot;</span>,<span class="token string">&quot;input&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 

  elasticsearch <span class="token punctuation">{</span>
      hosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.91:9200&quot;</span>,<span class="token string">&quot;10.0.0.92:9200&quot;</span>,<span class="token string">&quot;10.0.0.93:9200&quot;</span><span class="token punctuation">]</span>
      index <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu-elfk-pipeline-beats-%{+yyyy.MM.dd}&quot;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>

	
<span class="token number">2</span>.修改pipeline配置文件
<span class="token punctuation">[</span>root@elk92 logstash<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/etc/logstash
<span class="token punctuation">[</span>root@elk92 logstash<span class="token punctuation">]</span><span class="token comment">#  </span>
<span class="token punctuation">[</span>root@elk92 logstash<span class="token punctuation">]</span><span class="token comment"># tail -5 pipelines.yml </span>
- pipeline.id: malu-tcp
  path.config: /etc/logstash/conf.d/12-pipeline-tcp-to-es.conf

- pipeline.id: malu-beats
  path.config: /etc/logstash/conf.d/13-pipeline-beats-to-es.conf
<span class="token punctuation">[</span>root@elk92 logstash<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">3</span>.创建pipeline的软连接
<span class="token punctuation">[</span>root@elk92 logstash<span class="token punctuation">]</span><span class="token comment"># mkdir /usr/share/logstash/config</span>
<span class="token punctuation">[</span>root@elk92 logstash<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 logstash<span class="token punctuation">]</span><span class="token comment"># ln -svf /etc/logstash/pipelines.yml /usr/share/logstash/config/</span>

	
<span class="token number">4</span>.启动Logstash 
<span class="token punctuation">[</span>root@elk92 logstash<span class="token punctuation">]</span><span class="token comment"># logstash -r</span>

<span class="token number">5</span>.启动filebeat 
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 10-tcp-to-logstash.yaml</span>

<span class="token number">6</span>.发送测试数据
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># echo docker  | nc 10.0.0.92 7777</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># echo K8S | nc 10.0.0.93 9000</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><h3 id="_35-logstash自定义正则"><a href="#_35-logstash自定义正则" class="header-anchor">#</a> 35，logstash自定义正则</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.准备自定义的patterns
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># mkdir malu-patterns</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat  malu-patterns/linux</span>
YEAR <span class="token punctuation">\</span>d<span class="token punctuation">{</span><span class="token number">4</span><span class="token punctuation">}</span>
SCHOOL <span class="token punctuation">[</span>a-z<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">9</span><span class="token punctuation">}</span>
CLASS <span class="token punctuation">[</span>a-z0-9<span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token number">7</span><span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">2</span>.编写配置文件 
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 14-tcp-grok_custom_patterns-es.conf </span>
input <span class="token punctuation">{</span> 
  tcp <span class="token punctuation">{</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">7777</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  


filter <span class="token punctuation">{</span>
   grok <span class="token punctuation">{</span>
      <span class="token comment"># 指定自定义patterns目录，会自动加载该目录下的所有文件内容相关的patterns模式</span>
      patterns_dir <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;/etc/logstash/conf.d/malu-patterns&quot;</span><span class="token punctuation">]</span>

      <span class="token comment"># 2024码路欢迎你: https://www.malu.com 班级: linux</span>
      match <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span> <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;%{YEAR:year}码路欢迎你: https://www.%{SCHOOL:School}.com 班级: %{CLASS:cLaSs}&quot;</span> <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 

<span class="token comment"># elasticsearch {</span>
<span class="token comment">#      hosts =&gt; [&quot;10.0.0.91:9200&quot;,&quot;10.0.0.92:9200&quot;,&quot;10.0.0.93:9200&quot;]</span>
<span class="token comment">#      index =&gt; &quot;oldboyedu-linux94-elfk-grok-custom-%{+yyyy.MM.dd}&quot;</span>
<span class="token comment">#  }</span>

<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 14-tcp-grok_custom_patterns-es.conf </span>

	
<span class="token number">3</span>.发送测试数据 
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># echo &quot;2024码路欢迎你: https://www.mlau.com 班级: linux110&quot; | nc 10.0.0.92 7777</span>



接收的数据效果如下：
<span class="token punctuation">{</span>
          <span class="token string">&quot;port&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">35044</span>,
      <span class="token string">&quot;@version&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;1&quot;</span>,
       <span class="token string">&quot;message&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;2024码路欢迎你: https://www.malu.com 班级: linux94&quot;</span>,
    <span class="token string">&quot;@timestamp&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">2024</span>-10-30T07:26:07.469Z,
          <span class="token string">&quot;year&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;2024&quot;</span>,
          <span class="token string">&quot;host&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;10.0.0.93&quot;</span>,
        <span class="token string">&quot;School&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu&quot;</span>,
         <span class="token string">&quot;cLaSs&quot;</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;linux110&quot;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><h3 id="_36-logstash的jvm优化"><a href="#_36-logstash的jvm优化" class="header-anchor">#</a> 36，Logstash的JVM优化</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>- SDK:
	英文全称为<span class="token string">&quot;Software development kit&quot;</span>，表示软件开发工具包，指的是程序员所需的开发环境工具包，比如Java，Go，C++，Python，Ruby，PHP等程序员依赖的开发环境。


- JDK:
	英文全称为: Java Development Kit ，表示Java开发的工具包集合，针对Java开发员的软件开发工具包。JDK就是典型的Java程序员所使用的SDK。用于编写<span class="token string">&quot;*.java&quot;</span>文件，对应的编译程序是<span class="token string">&quot;javac&quot;</span>工具。
	
- JRE:
	英文全称为： Java Runtime Environment，表示Java的运行环境，相比JDK而言更轻量级，软件包会更小，只能保证程序能够运行，缺少开发的工具包。
	
- JVM:
	英文全称为： Java Virtual Machine，表示Java的虚拟机，一般用于执行Java程序编译后的字节码文件<span class="token string">&quot;*.class&quot;</span>，对应的运行程序是<span class="token string">&quot;java&quot;</span>工具。

	JVM虚拟机又细分为多个存储区域：
		- 对外内存 
		- 方法区
		- <span class="token punctuation">..</span>.
		- 堆内存
			- 伊甸区：
				表示对象产生的内存。
			- 幸存区：
				经过GC时在伊甸区没有结束生命周期的对象会经过幸存区过滤到年老区。
			- 年老区：
				长期存在的对象。
				
<span class="token number">1</span>.查看Logstash实例启动时占用的heap堆内存大小
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># ps -ef | grep logstash</span>
root       <span class="token number">78620</span>   <span class="token number">76171</span> <span class="token number">99</span> <span class="token number">15</span>:32 pts/1    00:00:02 /usr/share/elasticsearch/jdk/bin/java <span class="token parameter variable">-Xms1g</span> <span class="token parameter variable">-Xmx1g</span> <span class="token punctuation">..</span>.


<span class="token number">2</span>.修改Logstash的堆内存大小
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># head /etc/logstash/jvm.options </span>
<span class="token comment">## JVM configuration</span>

<span class="token comment"># Xms represents the initial size of total heap space</span>
<span class="token comment"># Xmx represents the maximum size of total heap space</span>

<span class="token comment">#-Xms1g</span>
<span class="token comment">#-Xmx1g</span>

<span class="token parameter variable">-Xms256m</span>
<span class="token parameter variable">-Xmx256m</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">3</span>.启动Logstash实例测试 
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 14-tcp-grok_custom_patterns-es.conf </span>

<span class="token number">4</span>.查看JVM占用内存情况
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment">#  ps -ef | grep logstash</span>
root       <span class="token number">79108</span>   <span class="token number">76171</span> <span class="token number">99</span> <span class="token number">15</span>:55 pts/1    00:00:17 /usr/share/elasticsearch/jdk/bin/java <span class="token parameter variable">-Xms256m</span> <span class="token parameter variable">-Xmx256m</span> <span class="token punctuation">..</span>.



温馨提示:
	java.lang.OutOfMemoryError: Java heap space
	表示内存不足，仅需要添加内存即可，工作中如何不设置Logstash的堆内存大小，默认为1GB。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br></div></div><h3 id="_37-filebeat自定义nginx的json格式日志"><a href="#_37-filebeat自定义nginx的json格式日志" class="header-anchor">#</a> 37，filebeat自定义NGINX的JSON格式日志</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.清空nginx访问日志
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># &gt; /var/log/nginx/access.log</span>

	
<span class="token number">2</span>.修改nginx的配置文件
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># vim /etc/nginx/nginx.conf </span>
<span class="token punctuation">..</span>.
  <span class="token comment"># 注释原有的配置行</span>
  <span class="token comment"># access_log /var/log/nginx/access.log;</span>

  log_format malu_nginx_json <span class="token string">'{&quot;@timestamp&quot;:&quot;$time_iso8601&quot;,'</span>
                              <span class="token string">'&quot;host&quot;:&quot;$server_addr&quot;,'</span>
                              <span class="token string">'&quot;clientip&quot;:&quot;$remote_addr&quot;,'</span>
                              <span class="token string">'&quot;SendBytes&quot;:$body_bytes_sent,'</span>
                              <span class="token string">'&quot;responsetime&quot;:$request_time,'</span>
                              <span class="token string">'&quot;upstreamtime&quot;:&quot;$upstream_response_time&quot;,'</span>
                              <span class="token string">'&quot;upstreamhost&quot;:&quot;$upstream_addr&quot;,'</span>
                              <span class="token string">'&quot;http_host&quot;:&quot;$host&quot;,'</span>
                              <span class="token string">'&quot;uri&quot;:&quot;$uri&quot;,'</span>
                              <span class="token string">'&quot;domain&quot;:&quot;$host&quot;,'</span>
                              <span class="token string">'&quot;xff&quot;:&quot;$http_x_forwarded_for&quot;,'</span>
                              <span class="token string">'&quot;referer&quot;:&quot;$http_referer&quot;,'</span>
                              <span class="token string">'&quot;tcp_xff&quot;:&quot;$proxy_protocol_addr&quot;,'</span>
                              <span class="token string">'&quot;http_user_agent&quot;:&quot;$http_user_agent&quot;,'</span>
                              <span class="token string">'&quot;status&quot;:&quot;$status&quot;}'</span><span class="token punctuation">;</span>

    access_log  /var/log/nginx/access.log  malu_nginx_json<span class="token punctuation">;</span>
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># nginx -t</span>
nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> is successful
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># systemctl reload nginx</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">3</span>.访问测试 
<span class="token punctuation">[</span>root@elk91 logstash<span class="token punctuation">]</span><span class="token comment"># curl 10.0.0.93</span>

<span class="token number">4</span>.查看日志格式
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># tail -f /var/log/nginx/access.log</span>
<span class="token punctuation">{</span><span class="token string">&quot;@timestamp&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2024-10-30T16:24:57+08:00&quot;</span>,<span class="token string">&quot;host&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.0.0.93&quot;</span>,<span class="token string">&quot;clientip&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.0.0.91&quot;</span>,<span class="token string">&quot;SendBytes&quot;</span>:612,<span class="token string">&quot;responsetime&quot;</span>:0.000,<span class="token string">&quot;upstreamtime&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;-&quot;</span>,<span class="token string">&quot;upstreamhost&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;-&quot;</span>,<span class="token string">&quot;http_host&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.0.0.93&quot;</span>,<span class="token string">&quot;uri&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;/index.nginx-debian.html&quot;</span>,<span class="token string">&quot;domain&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.0.0.93&quot;</span>,<span class="token string">&quot;xff&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;-&quot;</span>,<span class="token string">&quot;referer&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;-&quot;</span>,<span class="token string">&quot;tcp_xff&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;-&quot;</span>,<span class="token string">&quot;http_user_agent&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;curl/7.81.0&quot;</span>,<span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;200&quot;</span><span class="token punctuation">}</span>


<span class="token number">5</span>.使用filebeat采集nginx访问日志
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 11-log-to-es.yaml </span>
filebeat.inputs:
- type: log
  paths:
  - /var/log/nginx/access.log
  <span class="token comment"># 解析message字段的JSON格式，并将键值对放在顶级字段中</span>
  json.keys_under_root: <span class="token boolean">true</span>


<span class="token comment">#output.console:</span>
<span class="token comment">#  pretty: true</span>

output.elasticsearch:
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;http://10.0.0.91:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.92:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.93:9200&quot;</span><span class="token punctuation">]</span> 
  index: <span class="token string">&quot;malu-nginx-json-%{+yyyy.MM.dd}&quot;</span> 

setup.ilm.enabled: <span class="token boolean">false</span>
setup.template.name: <span class="token string">&quot;malu-nginx&quot;</span>
setup.template.pattern: <span class="token string">&quot;malu-nginx*&quot;</span>
setup.template.overwrite: <span class="token boolean">false</span>
setup.template.settings:
  index.number_of_shards: <span class="token number">3</span>
  index.number_of_replicas: <span class="token number">0</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 11-log-to-es.yaml </span>


<span class="token number">6</span>.kibana查看数据
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br></div></div><h3 id="_38-配置kibana的安全认证"><a href="#_38-配置kibana的安全认证" class="header-anchor">#</a> 38，配置kibana的安全认证</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.温馨提示
做本实验之前，请务必提前快照！


<span class="token number">2</span>.配置ES集群加密
<span class="token number">2.1</span> 生成证书文件
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># /usr/share/elasticsearch/bin/elasticsearch-certutil cert -out /etc/elasticsearch/elastic-certificates.p12 -pass &quot;&quot;</span>
<span class="token punctuation">..</span>.

Note: Generating certificates without providing a CA certificate is deprecated.
      A CA certificate will become mandatory <span class="token keyword">in</span> the next major release.


Certificates written to /etc/elasticsearch/elastic-certificates.p12

This <span class="token function">file</span> should be properly secured as it contains the private key <span class="token keyword">for</span> 
your instance.

This <span class="token function">file</span> is a self contained <span class="token function">file</span> and can be copied and used <span class="token string">'as is'</span>
For each Elastic product that you wish to configure, you should copy
this <span class="token string">'.p12'</span> <span class="token function">file</span> to the relevant configuration directory
and <span class="token keyword">then</span> follow the SSL configuration instructions <span class="token keyword">in</span> the product guide.

<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># ll /etc/elasticsearch/elastic-certificates.p12 </span>
-rw------- <span class="token number">1</span> root elasticsearch <span class="token number">3596</span> Oct <span class="token number">30</span> <span class="token number">16</span>:57 /etc/elasticsearch/elastic-certificates.p12
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>



<span class="token number">2.2</span> 同步证书文件到其他节点
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp /etc/elasticsearch/elastic-certificates.p12 10.0.0.92:/etc/elasticsearch/</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp /etc/elasticsearch/elastic-certificates.p12 10.0.0.93:/etc/elasticsearch/</span>


<span class="token number">2.3</span> 修改ES集群的配置文件
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/elasticsearch/elasticsearch.yml </span>
<span class="token punctuation">..</span>.
<span class="token comment"># 在最后一行添加以下内容</span>
xpack.security.enabled: <span class="token boolean">true</span>
xpack.security.transport.ssl.enabled: <span class="token boolean">true</span>
xpack.security.transport.ssl.verification_mode: certificate
xpack.security.transport.ssl.keystore.path: elastic-certificates.p12
xpack.security.transport.ssl.truststore.path: elastic-certificates.p12


<span class="token number">2.4</span> 同步ES配置文件到其他节点
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp /etc/elasticsearch/elasticsearch.yml 10.0.0.92:/etc/elasticsearch/</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment">#</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp /etc/elasticsearch/elasticsearch.yml 10.0.0.93:/etc/elasticsearch/</span>


<span class="token number">2.5</span> <span class="token string">&quot;ES集群所有节点&quot;</span>修改证书文件的权限信息
<span class="token function">chown</span> elasticsearch:elasticsearch /etc/elasticsearch/elastic-certificates.p12
 
		
<span class="token number">2.6</span> <span class="token string">&quot;ES集群所有节点&quot;</span>重启ES服务
systemctl restart elasticsearch.service 


<span class="token number">2.7</span> 生成随机密码【请保留密码，下一个步骤要用！】
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># /usr/share/elasticsearch/bin/elasticsearch-setup-passwords auto</span>
Initiating the setup of passwords <span class="token keyword">for</span> reserved <span class="token function">users</span> elastic,apm_system,kibana,kibana_system,logstash_system,beats_system,remote_monitoring_user.
The passwords will be randomly generated and printed to the console.
Please confirm that you would like to <span class="token builtin class-name">continue</span> <span class="token punctuation">[</span>y/N<span class="token punctuation">]</span>y


Changed password <span class="token keyword">for</span> user apm_system
PASSWORD apm_system <span class="token operator">=</span> cJbTLyuk3r66DFY2cNPu

Changed password <span class="token keyword">for</span> user kibana_system
PASSWORD kibana_system <span class="token operator">=</span> TsbQC5otepUy7E1U3nkJ

Changed password <span class="token keyword">for</span> user kibana
PASSWORD kibana <span class="token operator">=</span> TsbQC5otepUy7E1U3nkJ

Changed password <span class="token keyword">for</span> user logstash_system
PASSWORD logstash_system <span class="token operator">=</span> vzEMD1ROjM7Mjp40URIa

Changed password <span class="token keyword">for</span> user beats_system
PASSWORD beats_system <span class="token operator">=</span> By6YDBKA0RSHGqPOOKsb

Changed password <span class="token keyword">for</span> user remote_monitoring_user
PASSWORD remote_monitoring_user <span class="token operator">=</span> l52I7n3YhmXV9OW6PTRM

Changed password <span class="token keyword">for</span> user elastic
PASSWORD elastic <span class="token operator">=</span> Ll0PiRUt7QNboiVOPsxj


<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">2.8</span> 验证集群是否正常【注意，elastic是ES集群的管理员用户，密码根据自己的系统生成使用即可】
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># curl -u elastic:y8vaUaMFCpSZuZxWjxCT 10.0.0.91:9200/_cat/nodes</span>
<span class="token number">10.0</span>.0.93 <span class="token number">25</span> <span class="token number">97</span> <span class="token number">6</span> <span class="token number">0.02</span> <span class="token number">0.13</span> <span class="token number">0.07</span> cdfhilmrstw * elk93
<span class="token number">10.0</span>.0.92  <span class="token number">9</span> <span class="token number">90</span> <span class="token number">5</span> <span class="token number">0.05</span> <span class="token number">0.17</span> <span class="token number">0.13</span> cdfhilmrstw - elk92
<span class="token number">10.0</span>.0.91 <span class="token number">21</span> <span class="token number">96</span> <span class="token number">6</span> <span class="token number">0.07</span> <span class="token number">0.14</span> <span class="token number">0.11</span> cdfhilmrstw - elk91
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br></div></div><h3 id="_39-配置kibana访问es加密集群"><a href="#_39-配置kibana访问es加密集群" class="header-anchor">#</a> 39，配置kibana访问ES加密集群</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.修改kibana的配置文件
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># vim /etc/kibana/kibana.yml </span>
<span class="token punctuation">..</span>.
<span class="token comment"># 根据你自己环境生成的&quot;kibana_system&quot;的随机密码做相应的修改即可</span>
elasticsearch.username: <span class="token string">&quot;kibana_system&quot;</span>
elasticsearch.password: <span class="token string">&quot;TsbQC5otepUy7E1U3nkJ&quot;</span>
	
	
<span class="token number">2</span>.重启kibana服务
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># systemctl restart kibana</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># ss -ntl | grep 5601</span>
LISTEN <span class="token number">0</span>      <span class="token number">511</span>          <span class="token number">0.0</span>.0.0:5601      <span class="token number">0.0</span>.0.0:*          
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">3</span>.访问kibana的WebUI
将<span class="token string">&quot;elastic&quot;</span>的用户名和密码进行修改！ 我修改的密码：123456Abc.com
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_40-zabbix监控es集群-filebeat-logstash-kibana程序"><a href="#_40-zabbix监控es集群-filebeat-logstash-kibana程序" class="header-anchor">#</a> 40，zabbix监控ES集群，filebeat，Logstash,kibana程序</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>补充知识:
<span class="token punctuation">[</span>root@elk91 cloud-computing-stack<span class="token punctuation">]</span><span class="token comment"># curl -s -u elastic:123456 10.0.0.91:9200/_cluster/health/ | jq .status</span>
<span class="token string">&quot;green&quot;</span>
<span class="token punctuation">[</span>root@elk91 cloud-computing-stack<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 cloud-computing-stack<span class="token punctuation">]</span><span class="token comment"># curl -s -u elastic:123456 10.0.0.91:9200/_cluster/health/ | jq .active_shards_percent_as_number</span>
<span class="token number">100</span>
<span class="token punctuation">[</span>root@elk91 cloud-computing-stack<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 cloud-computing-stack<span class="token punctuation">]</span><span class="token comment"># curl -s -u elastic:123456 10.0.0.91:9200/_cluster/health/ | jq .number_of_nodes</span>
<span class="token number">3</span>
<span class="token punctuation">[</span>root@elk91 cloud-computing-stack<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 cloud-computing-stack<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 cloud-computing-stack<span class="token punctuation">]</span><span class="token comment"># curl -s -u elastic:123456 10.0.0.91:9200/_cluster/health/ | jq .active_shards</span>
<span class="token number">76</span>
<span class="token punctuation">[</span>root@elk91 cloud-computing-stack<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="_41-虚拟机科学上网"><a href="#_41-虚拟机科学上网" class="header-anchor">#</a> 41，虚拟机科学上网</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>一款免费的VPN:
地址：ikuuu.one
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>独立的一台linux如何翻墙：
https://clashx2.com/38942.html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>虚拟机翻墙：
https://skfwe.cn/p/clash%E8%AE%A9%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%B3%BB%E7%BB%9Flinux-%E5%85%B1%E4%BA%AB%E4%B8%BB%E6%9C%BA%E7%9A%84%E4%BB%A3%E7%90%86/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/devops/public/assets/img/1730619060934.a6fe6c58.png" alt="1730619060934"></p> <p><img src="/devops/public/assets/img/1730619074659.56d26376.png" alt="1730619074659"></p> <p><img src="/devops/public/assets/img/1730619083811.958f2328.png" alt="1730619083811"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>下载两个文件：
https://github.com/v2rayA/v2raya-apt/tree/master/pool/main/v/v2ray

v2raya_2.2.6.2_amd64.deb
v2ray_5.21.0_amd64.deb

上传虚拟机并安装
root@elk93:~<span class="token comment"># dpkg -i v2raya_2.2.6.2_amd64.deb v2ray_5.21.0_amd64.deb</span>

启动v2raya
root@elk93:~<span class="token comment"># systemctl start v2raya.service</span>

访问本机2017端口：
http://10.0.0.93:2017/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p><img src="/devops/public/assets/img/1730299788092.85a32931.png" alt="1730299788092"></p> <p>搜索宝贝云：</p> <p><img src="/devops/public/assets/img/1730299885546.2cdf777a.png" alt="1730299885546"></p> <p><img src="/devops/public/assets/img/1730300008552.9d6a8d8f.png" alt="1730300008552"></p> <p><img src="/devops/public/assets/img/1730300117221.0c36365e.png" alt="1730300117221"></p> <p><img src="/devops/public/assets/img/1730300133692.020892b7.png" alt="1730300133692"></p> <p><img src="/devops/public/assets/img/1730300181047.2ddf66e2.png" alt="1730300181047"></p> <p><img src="/devops/public/assets/img/1730300194907.620ac3a1.png" alt="1730300194907"></p> <p><img src="/devops/public/assets/img/1730300227244.17e07937.png" alt="1730300227244"></p> <p><img src="/devops/public/assets/img/1730300232884.d56c2553.png" alt="1730300232884"></p> <p><img src="/devops/public/assets/img/1730300582320.4b0fca1c.png" alt="1730300582320"></p> <p><img src="/devops/public/assets/img/1730300311610.2787d0fc.png" alt="1730300311610"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>root@elk92:~<span class="token comment"># vim .bashrc</span>
<span class="token punctuation">..</span>.
<span class="token number">100</span> <span class="token builtin class-name">export</span> <span class="token assign-left variable">http_proxy</span><span class="token operator">=</span><span class="token string">&quot;http://10.0.0.93:20171&quot;</span>
<span class="token number">101</span> <span class="token builtin class-name">export</span> <span class="token assign-left variable">https_proxy</span><span class="token operator">=</span><span class="token string">&quot;http://10.0.0.93:20171&quot;</span>  

root@elk92:~<span class="token comment"># source .bashrc</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/devops/public/assets/img/1730300540607.ac8820d1.png" alt="1730300540607"></p> <h3 id="_42-扩展与面试题"><a href="#_42-扩展与面试题" class="header-anchor">#</a> 42，扩展与面试题**</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>扩展:
扩展采集windows的系统日志输出到ES集群并使用kibana进行数据的查看。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code>第4次模拟面试:
Q23:如何检查Es集群是否处于健康状态?换句话说，Es集群是否正常工作?
 
<span class="token number">1</span>. 使用 _cluster/health API
这是最常用的方法，可以直接查询集群的健康状态。
请求示例
您可以通过以下命令使用 <span class="token function">curl</span> 来查询集群健康状态：
<span class="token function">curl</span> <span class="token parameter variable">-X</span> GET <span class="token string">&quot;http://&lt;your_elasticsearch_host&gt;:9200/_cluster/health?pretty&quot;</span>
请将 <span class="token operator">&lt;</span>your_elasticsearch_host<span class="token operator">&gt;</span> 替换为您的 Elasticsearch 主机地址。
返回示例
响应将包含以下信息：
<span class="token punctuation">{</span>
  <span class="token string">&quot;cluster_name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;your_cluster_name&quot;</span>,
  <span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;green&quot;</span>,  <span class="token comment"># 状态可以是 &quot;green&quot;, &quot;yellow&quot;, &quot;red&quot;</span>
  <span class="token string">&quot;timed_out&quot;</span><span class="token builtin class-name">:</span> false,
  <span class="token string">&quot;number_of_nodes&quot;</span><span class="token builtin class-name">:</span> <span class="token number">3</span>,
  <span class="token string">&quot;number_of_data_nodes&quot;</span><span class="token builtin class-name">:</span> <span class="token number">3</span>,
  <span class="token string">&quot;active_primary_shards&quot;</span><span class="token builtin class-name">:</span> <span class="token number">5</span>,
  <span class="token string">&quot;active_shards&quot;</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
  <span class="token string">&quot;relocating_shards&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;initializing_shards&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;unassigned_shards&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;delayed_unassigned_shards&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;number_of_pending_tasks&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;number_of_in_flight_fetch&quot;</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
  <span class="token string">&quot;task_max_wait_time&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;0s&quot;</span>,
  <span class="token string">&quot;active_shards_percent_as_number&quot;</span><span class="token builtin class-name">:</span> <span class="token number">100.0</span>
<span class="token punctuation">}</span>
<span class="token number">2</span>. 健康状态说明
green：所有主分片和副本分片都正常，集群处于健康状态。
yellow：所有主分片正常，但某些副本分片不可用。数据仍然可用，但没有副本。
red：某些主分片不可用，数据不可用。

<span class="token number">3</span>. 其他检查方法
除了 _cluster/health API，还有其他一些方法可以帮助您进一步检查集群状态：
<span class="token number">1</span>. 检查节点状态
您可以使用 _cat/nodes API 查看集群中每个节点的状态：
<span class="token function">curl</span> <span class="token parameter variable">-X</span> GET <span class="token string">&quot;http://&lt;your_elasticsearch_host&gt;:9200/_cat/nodes?v&quot;</span>
<span class="token number">2</span>. 检查索引状态
使用 _cat/indices API 查看所有索引的状态，以便了解是否有任何索引处于问题状态：
<span class="token function">curl</span> <span class="token parameter variable">-X</span> GET <span class="token string">&quot;http://&lt;your_elasticsearch_host&gt;:9200/_cat/indices?v&quot;</span>
<span class="token number">3</span>. 查看集群日志
检查 Elasticsearch 的日志文件（通常位于 /var/log/elasticsearch/ 或根据您的配置文件设置），以获取有关集群状态和潜在问题的详细信息。
<span class="token number">4</span>. 使用 Kibana
如果您使用 Kibana，您可以在 Kibana 的管理界面中查看集群健康状态、节点信息和索引状态。这提供了一个用户友好的图形界面来监控集群。

总结
通过以上方法，您可以有效地检查 Elasticsearch 集群的健康状态，确保集群正常工作。如果发现集群处于不健康状态（例如，yellow 或 red），您需要进一步调查并采取措施解决问题。
----------------------------------

Q24:如何判断ES各节点是否在同一个集群呢?或者说如何判断Es集群处于<span class="token string">&quot;脑裂&quot;</span>状态呢?
    cur1 <span class="token number">10.0</span>.0.91:9200/cat/nodes
    <span class="token keyword">for</span> i in'seg 9l <span class="token number">93</span>`<span class="token punctuation">;</span> <span class="token keyword">do</span> <span class="token function">curl</span> <span class="token parameter variable">-s</span> <span class="token number">10.0</span>.0.<span class="token variable">$i</span> l <span class="token function">grep</span> uuid<span class="token punctuation">;</span><span class="token keyword">done</span>
    
----------------------------------

Q25:当kibana页面访问不到时，可能是什么原因导致的?如何排查?
    -1.查看日志<span class="token punctuation">;</span>
        <span class="token function">tail</span> <span class="token parameter variable">-100f</span> /var/log/kibana/kibana.log
    -2.查看监听端口是否存在<span class="token punctuation">;</span>
    -3.检查kibana的配置文件
		连接Es集群的认证信息是否正确，权限正常。
    -4.检查Es集群是否正常，因为kibana启动时数据存储在ES中，若无法访问Es，则导致kibana启动不成功。

----------------------------------

Q26:网站站点出现了502时，该如何排查?

----------------------------------

Q27:403，404，401，400，405的区别是啥?

----------------------------------

Q28:你在上家公司用过哪些中间件?最少说出10种。

----------------------------------

Q29:简单陈述下浏览器输入<span class="token string">&quot;www.baidu.com&quot;</span>底层的原理?越详细越好?
    <span class="token number">1</span>.DNS
    <span class="token number">2</span>.访问百度的web
    <span class="token number">3</span>.iptables的规则转发
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br></div></div><h3 id="_43-filebeat对接es加密集群"><a href="#_43-filebeat对接es加密集群" class="header-anchor">#</a> 43，filebeat对接ES加密集群</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>编写ElasticStack相关程序的巡检脚本，比如ES集群是否正常，kibana服务是否正常，Logstash，filebeat等<span class="token punctuation">;</span>

巡检一下ES集群：
root@elk91:~<span class="token comment"># curl 10.0.0.91:9200/_cat/nodes -u elastic:123456Abc.com</span>
<span class="token number">10.0</span>.0.92 <span class="token number">37</span> <span class="token number">83</span>  <span class="token number">5</span> <span class="token number">0.02</span> <span class="token number">0.12</span> <span class="token number">0.13</span> cdfhilmrstw * elk92
<span class="token number">10.0</span>.0.93 <span class="token number">37</span> <span class="token number">83</span>  <span class="token number">4</span> <span class="token number">0.01</span> <span class="token number">0.11</span> <span class="token number">0.11</span> cdfhilmrstw - elk93
<span class="token number">10.0</span>.0.91  <span class="token number">9</span> <span class="token number">97</span> <span class="token number">49</span> <span class="token number">1.20</span> <span class="token number">1.03</span> <span class="token number">0.46</span> cdfhilmrstw - elk91
root@elk91:~<span class="token comment"># </span>

<span class="token number">1</span>.编写配置文件
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 12-log-to-es_tls.yaml </span>
filebeat.inputs:
- type: log
  paths:
  - /var/log/nginx/access.log*
  json.keys_under_root: <span class="token boolean">true</span>
  <span class="token comment"># 不采集以&quot;.gz&quot;结尾的文件</span>
  exclude_files: <span class="token punctuation">[</span><span class="token string">'\.gz$'</span><span class="token punctuation">]</span>

output.elasticsearch:
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;http://10.0.0.91:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.92:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.93:9200&quot;</span><span class="token punctuation">]</span> 
  index: <span class="token string">&quot;malu-linux94-nginx-tls-%{+yyyy.MM.dd}&quot;</span> 
  <span class="token comment"># 指定连接ES集群的用户名</span>
  username: elastic
  <span class="token comment"># 指定连接ES集群的密码</span>
  password: <span class="token string">&quot;123456Abc.com&quot;</span>
 
setup.ilm.enabled: <span class="token boolean">false</span>
setup.template.name: <span class="token string">&quot;malu-linux94-nginx&quot;</span>
setup.template.pattern: <span class="token string">&quot;malu-linux94-nginx*&quot;</span>
setup.template.overwrite: <span class="token boolean">false</span>
setup.template.settings:
  index.number_of_shards: <span class="token number">3</span>
  index.number_of_replicas: <span class="token number">0</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">2</span>.启动filebeat实例 
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 12-log-to-es_tls.yaml </span>

共5行数据：
root@elk93:/etc/filebeat<span class="token comment"># wc -l /var/log/nginx/access.log.1</span>
<span class="token number">4</span> /var/log/nginx/access.log.1
root@elk93:/etc/filebeat<span class="token comment"># wc -l /var/log/nginx/access.log</span>
<span class="token number">1</span> /var/log/nginx/access.log
root@elk93:/etc/filebeat<span class="token comment">#</span>

<span class="token number">3</span>.查看Kibana的WebUI
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br></div></div><p><img src="/devops/public/assets/img/1731459359472.c6c44900.png" alt="1731459359472"></p> <h3 id="_44-logstash对接es加密集群"><a href="#_44-logstash对接es加密集群" class="header-anchor">#</a> 44，Logstash对接ES加密集群</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.启动Logstash实例
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># pwd</span>
/etc/logstash/conf.d

<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 15-beats-filter-es.conf </span>
input <span class="token punctuation">{</span> 
  beats <span class="token punctuation">{</span>
    port <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token number">8888</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>  

filter <span class="token punctuation">{</span>
  mutate <span class="token punctuation">{</span>
    remove_field <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span> <span class="token string">&quot;@version&quot;</span>,<span class="token string">&quot;log&quot;</span>,<span class="token string">&quot;tags&quot;</span>,<span class="token string">&quot;agent&quot;</span>,<span class="token string">&quot;ecs&quot;</span>,<span class="token string">&quot;input&quot;</span> <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> rubydebug 
  <span class="token punctuation">}</span> 

  elasticsearch <span class="token punctuation">{</span>
      hosts <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.91:9200&quot;</span>,<span class="token string">&quot;10.0.0.92:9200&quot;</span>,<span class="token string">&quot;10.0.0.93:9200&quot;</span><span class="token punctuation">]</span>
      index <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;malu-linux94-elfk-tls-%{+yyyy.MM.dd}&quot;</span>
      <span class="token comment"># 指定用户名</span>
      user <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;elastic&quot;</span>
      <span class="token comment"># 指定密码</span>
      password <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;123456Abc.com&quot;</span>
  <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 15-beats-filter-es.conf </span>

	
	
<span class="token number">2</span>.启动filebeat实例
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 13-log-to-logstash.yaml</span>
filebeat.inputs:
- type: log
  paths:
  - /var/log/nginx/access.log*
  json.keys_under_root: <span class="token boolean">true</span>
  exclude_files: <span class="token punctuation">[</span><span class="token string">'\.gz$'</span><span class="token punctuation">]</span>


output.logstash:
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;10.0.0.92:8888&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 13-log-to-logstash.yaml</span>

<span class="token number">3</span>.kibana查看数据验证
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br></div></div><p><img src="/devops/public/assets/img/1731460330001.b3322d74.png" alt="1731460330001"></p> <h3 id="_45-kibana实现rbac"><a href="#_45-kibana实现rbac" class="header-anchor">#</a> 45，kibana实现RBAC</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>参考：https://blog.csdn.net/qq_37510195/article/details/130987787?spm<span class="token operator">=</span><span class="token number">1001.2014</span>.3001.5502
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h3 id="_46-filestream输入类型采集tomcat的json格式日志"><a href="#_46-filestream输入类型采集tomcat的json格式日志" class="header-anchor">#</a> 46，filestream输入类型采集tomcat的JSON格式日志</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.修改tomcat的配置文件
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># vim /malu/softwares/apache-tomcat-10.1.31/conf/server.xml </span>
<span class="token punctuation">..</span>.

<span class="token operator">&lt;</span><span class="token operator">!</span>-- 删除原有的hosts文件 --<span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>Host <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">&quot;tomcat.malu.com&quot;</span>  <span class="token assign-left variable">appBase</span><span class="token operator">=</span><span class="token string">&quot;webapps&quot;</span>
                <span class="token assign-left variable">unpackWARs</span><span class="token operator">=</span><span class="token string">&quot;true&quot;</span> <span class="token assign-left variable">autoDeploy</span><span class="token operator">=</span><span class="token string">&quot;true&quot;</span><span class="token operator">&gt;</span>

		<span class="token operator">&lt;</span>Valve <span class="token assign-left variable">className</span><span class="token operator">=</span><span class="token string">&quot;org.apache.catalina.valves.AccessLogValve&quot;</span> <span class="token assign-left variable">directory</span><span class="token operator">=</span><span class="token string">&quot;logs&quot;</span>
            <span class="token assign-left variable">prefix</span><span class="token operator">=</span><span class="token string">&quot;tomcat.malu.com_access_log&quot;</span> <span class="token assign-left variable">suffix</span><span class="token operator">=</span><span class="token string">&quot;.json&quot;</span>
<span class="token assign-left variable">pattern</span><span class="token operator">=</span><span class="token string">&quot;{&amp;quot;clientip&amp;quot;:&amp;quot;%h&amp;quot;,&amp;quot;ClientUser&amp;quot;:&amp;quot;%l&amp;quot;,&amp;quot;authenticated&amp;quot;:&amp;quot;%u&amp;quot;,&amp;quot;AccessTime&amp;quot;:&amp;quot;%t&amp;quot;,&amp;quot;request&amp;quot;:&amp;quot;%r&amp;quot;,&amp;quot;status&amp;quot;:&amp;quot;%s&amp;quot;,&amp;quot;SendBytes&amp;quot;:&amp;quot;%b&amp;quot;,&amp;quot;Query?string&amp;quot;:&amp;quot;%q&amp;quot;,&amp;quot;partner&amp;quot;:&amp;quot;%{Referer}i&amp;quot;,&amp;quot;http_user_agent&amp;quot;:&amp;quot;%{User-Agent}i&amp;quot;}&quot;</span>/<span class="token operator">&gt;</span>

          <span class="token operator">&lt;</span>/Host<span class="token operator">&gt;</span>
		  
		  
<span class="token number">2</span>.重启tomcat服务 
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># /malu/softwares/apache-tomcat-10.1.31/bin/shutdown.sh </span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># /malu/softwares/apache-tomcat-10.1.31/bin/startup.sh </span>


<span class="token number">3</span>.访问测试
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># curl -H 'host: tomcat.malu.com' 10.0.0.92:8080</span>


<span class="token number">4</span>.查看日志格式
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># tail -f /malu/softwares/apache-tomcat-10.1.31/logs/tomcat.malu._access_log.2024-11-13.json</span>
<span class="token punctuation">{</span><span class="token string">&quot;clientip&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.0.0.91&quot;</span>,<span class="token string">&quot;ClientUser&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;-&quot;</span>,<span class="token string">&quot;authenticated&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;-&quot;</span>,<span class="token string">&quot;AccessTime&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;[31/Oct/2024:03:51:28 +0000]&quot;</span>,<span class="token string">&quot;request&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;GET / HTTP/1.1&quot;</span>,<span class="token string">&quot;status&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;200&quot;</span>,<span class="token string">&quot;SendBytes&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;11239&quot;</span>,<span class="token string">&quot;Query?string&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;&quot;</span>,<span class="token string">&quot;partner&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;-&quot;</span>,<span class="token string">&quot;http_user_agent&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;curl/7.81.0&quot;</span><span class="token punctuation">}</span>


<span class="token number">5</span>.启动filebeat实例 
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 14-filestream-to-es.yaml </span>
filebeat.inputs:
- type: filestream
  paths:
    - /malu/softwares/apache-tomcat-10.1.31/logs/tomcat.malu.com_access_log*json 

  <span class="token comment"># 配置解析器</span>
  parsers:
      <span class="token comment"># 对JSON格式进行解析</span>
    - ndjson:
        <span class="token comment"># 将解析的记录放在指定字段，若指定字段为空(&quot;&quot;)，则表示将解析的字段放在顶级字段中</span>
        target: <span class="token string">&quot;&quot;</span>
        <span class="token comment">#target: &quot;mlau-linux94&quot;</span>
        <span class="token comment"># 对指定字段进行解析</span>
        message_key: message


output.elasticsearch:
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;http://10.0.0.91:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.92:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.93:9200&quot;</span><span class="token punctuation">]</span> 
  index: <span class="token string">&quot;malu-linux94-tomcat-filestream-%{+yyyy.MM.dd}&quot;</span> 
  username: elastic
  password: <span class="token string">&quot;123456Abc.com&quot;</span>

setup.ilm.enabled: <span class="token boolean">false</span>
setup.template.name: <span class="token string">&quot;malu-linux94-tomcat&quot;</span>
setup.template.pattern: <span class="token string">&quot;malu-linux94-tomcat*&quot;</span>
setup.template.overwrite: <span class="token boolean">true</span>
setup.template.settings:
  index.number_of_shards: <span class="token number">5</span>
  index.number_of_replicas: <span class="token number">0</span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c  14-filestream-to-es.yaml </span>


<span class="token number">6</span>.kibana查看数据
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br></div></div><p><img src="/devops/public/assets/img/1731464134350.a024bd93.png" alt="1731464134350"></p> <p><img src="/devops/public/assets/img/1731464182192.742bac7f.png" alt="1731464182192"></p> <h3 id="_47-filebeat的多行处理采集tomcat错误日志案例"><a href="#_47-filebeat的多行处理采集tomcat错误日志案例" class="header-anchor">#</a> 47，filebeat的多行处理采集tomcat错误日志案例</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.创建错误 
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># /malu/softwares/apache-tomcat-10.1.31/bin/shutdown.sh </span>

<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># vim /malu/softwares/apache-tomcat-10.1.31/conf/server.xml </span>
<span class="token punctuation">..</span>.
<span class="token number">150</span>           <span class="token operator">&lt;</span>/Host111<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>   
<span class="token punctuation">..</span>.

修改配置文件出错即可，启动服务时发现出错了
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># /malu/softwares/apache-tomcat-10.1.31/bin/startup.sh</span>


发现报错如下:
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># tail -100f tail -100f /malu/softwares/apache-tomcat-10.1.31/logs/catalina.out </span>

<span class="token punctuation">..</span>.
<span class="token number">31</span>-Oct-2024 06:38:40.446 WARNING <span class="token punctuation">[</span>main<span class="token punctuation">]</span> org.apache.catalina.startup.Catalina.parseServerXml Unable to load server configuration from <span class="token punctuation">[</span>/malu/softwares/apache-tomcat-10.1.31/conf/server.xml<span class="token punctuation">]</span>
	org.xml.sax.SAXParseException<span class="token punctuation">;</span> systemId: file:/oldboyedu/softwares/apache-tomcat-10.1.31/conf/server.xml<span class="token punctuation">;</span> lineNumber: <span class="token number">151</span><span class="token punctuation">;</span> columnNumber: <span class="token number">17</span><span class="token punctuation">;</span> The end-tag <span class="token keyword">for</span> element <span class="token builtin class-name">type</span> <span class="token string">&quot;Host&quot;</span> must end with a <span class="token string">'&gt;'</span> delimiter.
		at java.xml/com.sun.org.apache.xerces.internal.parsers.AbstractSAXParser.parse<span class="token punctuation">(</span>AbstractSAXParser.java:1252<span class="token punctuation">)</span>
		at java.xml/com.sun.org.apache.xerces.internal.jaxp.SAXParserImpl<span class="token variable">$JAXPSAXParser</span>.parse<span class="token punctuation">(</span>SAXParserImpl.java:643<span class="token punctuation">)</span>
		at org.apache.tomcat.util.digester.Digester.parse<span class="token punctuation">(</span>Digester.java:1522<span class="token punctuation">)</span>
		at org.apache.catalina.startup.Catalina.parseServerXml<span class="token punctuation">(</span>Catalina.java:603<span class="token punctuation">)</span>
		at org.apache.catalina.startup.Catalina.load<span class="token punctuation">(</span>Catalina.java:693<span class="token punctuation">)</span>
		at org.apache.catalina.startup.Catalina.load<span class="token punctuation">(</span>Catalina.java:731<span class="token punctuation">)</span>
		at java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke<span class="token punctuation">(</span>DirectMethodHandleAccessor.java:103<span class="token punctuation">)</span>
		at java.base/java.lang.reflect.Method.invoke<span class="token punctuation">(</span>Method.java:580<span class="token punctuation">)</span>
		at org.apache.catalina.startup.Bootstrap.load<span class="token punctuation">(</span>Bootstrap.java:302<span class="token punctuation">)</span>
		at org.apache.catalina.startup.Bootstrap.main<span class="token punctuation">(</span>Bootstrap.java:472<span class="token punctuation">)</span>


<span class="token number">2</span>.filebeat采集错误日志
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 15-filestream-to-es.yaml </span>
filebeat.inputs:
- type: filestream
  paths:
    - /malu/softwares/apache-tomcat-10.1.31/logs/catalina.out 
  <span class="token comment"># 配置解析器</span>
  parsers:
    <span class="token comment"># 配置多行匹配</span>
  - multiline:
      <span class="token comment"># 指定多行匹配的类型，有效值: pattern 和 count</span>
      <span class="token comment">#   pattern:</span>
      <span class="token comment">#    	表示基于正则匹配将多行合并为一个事件(event)。</span>
      <span class="token comment">#   count:</span>
      <span class="token comment">#		表示基于固定行数合并为一个事件(event)。</span>
      type: pattern
      <span class="token comment"># 当type为pattern时，则需要定义对应的正则表达式</span>
      pattern: <span class="token string">'^\d{2}'</span>
      <span class="token comment"># 下面2个选项参考官网示例: </span>
      <span class="token comment">#		https://www.elastic.co/guide/en/beats/filebeat/7.17/multiline-examples.html#multiline</span>
      negate: <span class="token boolean">true</span>
      match: after

output.elasticsearch:
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;http://10.0.0.91:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.92:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.93:9200&quot;</span><span class="token punctuation">]</span> 
  index: <span class="token string">&quot;malu-linux94-tomcat-multiline-%{+yyyy.MM.dd}&quot;</span> 
  username: elastic
  password: <span class="token string">&quot;123456Abc.com&quot;</span>

setup.ilm.enabled: <span class="token boolean">false</span>
setup.template.name: <span class="token string">&quot;malu-linux94-tomcat&quot;</span>
setup.template.pattern: <span class="token string">&quot;malu-linux94-tomcat*&quot;</span>
setup.template.overwrite: <span class="token boolean">true</span>
setup.template.settings:
  index.number_of_shards: <span class="token number">5</span>
  index.number_of_replicas: <span class="token number">0</span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 15-filestream-to-es.yaml </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br></div></div><p><img src="/devops/public/assets/img/1731466071435.72657462.png" alt="1731466071435"></p> <h3 id="_48-多行匹配按行数匹配案例"><a href="#_48-多行匹配按行数匹配案例" class="header-anchor">#</a> 48，多行匹配按行数匹配案例</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.源数据准备
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># cat /tmp/student.info</span>
<span class="token punctuation">{</span>
  <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;sy&quot;</span>,
  <span class="token string">&quot;hobby&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;hobby01&quot;</span>,<span class="token string">&quot;hobby02&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token punctuation">{</span>
   <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;jh&quot;</span>,
   <span class="token string">&quot;hobby&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;hobby03&quot;</span>,<span class="token string">&quot;hobby04&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token punctuation">{</span>
   <span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span> <span class="token string">&quot;yj&quot;</span>,
   <span class="token string">&quot;hobby&quot;</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token string">&quot;hobby05&quot;</span>,<span class="token string">&quot;hobby06&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>

	
<span class="token number">2</span>.编写filebeat配置文件 
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 16-filestream-to-es.yaml </span>
filebeat.inputs:
- type: filestream
  paths:
    - /tmp/student.info
  <span class="token comment"># 配置解析器</span>
  parsers:
    - multiline:
        type: count
        count_lines: <span class="token number">4</span>
    - ndjson:
        target: <span class="token string">&quot;&quot;</span>
        message_key: message

output.elasticsearch:
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;http://10.0.0.91:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.92:9200&quot;</span>,<span class="token string">&quot;http://10.0.0.93:9200&quot;</span><span class="token punctuation">]</span> 
  index: <span class="token string">&quot;malu-linux94-tomcat-student-%{+yyyy.MM.dd}&quot;</span> 
  username: elastic
  password: <span class="token string">&quot;123456Abc.com&quot;</span>

setup.ilm.enabled: <span class="token boolean">false</span>
setup.template.name: <span class="token string">&quot;malu-linux94-tomcat&quot;</span>
setup.template.pattern: <span class="token string">&quot;malu-linux94-tomcat*&quot;</span>
setup.template.overwrite: <span class="token boolean">true</span>
setup.template.settings:
  index.number_of_shards: <span class="token number">5</span>
  index.number_of_replicas: <span class="token number">0</span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># rm -rf /var/lib/filebeat/</span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 16-filestream-to-es.yaml </span>


<span class="token number">3</span>.kibana查看数据 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br></div></div><p><img src="/devops/public/assets/img/1731467452507.ea8843ce.png" alt="1731467452507"></p> <h3 id="_49-elasticsearch的jvm调优"><a href="#_49-elasticsearch的jvm调优" class="header-anchor">#</a> 49，elasticsearch的JVM调优</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.ES集群的堆内存配置
推荐设置为物理内存的一半，但是不能超过32GB。


<span class="token number">2</span>.查看默认的JVM<span class="token punctuation">(</span>物理机4G，默认是一半，就是2个G<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># free -h</span>
               total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:           <span class="token number">3</span>.8Gi       <span class="token number">2</span>.3Gi       921Mi       <span class="token number">0</span>.0Ki       646Mi       <span class="token number">1</span>.3Gi
Swap:          <span class="token number">3</span>.8Gi       432Mi       <span class="token number">3</span>.4Gi
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># ps -ef | egrep &quot;Xmx|Xms&quot;</span>
elastic+   <span class="token number">79781</span>       <span class="token number">1</span>  <span class="token number">1</span> Oct30 ?        00:24:21 /usr/share/elasticsearch/jdk/bin/java <span class="token punctuation">..</span>. <span class="token parameter variable">-Xms1937m</span> <span class="token parameter variable">-Xmx1937m</span> 



<span class="token number">3</span>.修改所有节点的ES配置（91，92， <span class="token number">93</span>）
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># vim /etc/elasticsearch/jvm.options</span>
<span class="token punctuation">..</span>.
<span class="token parameter variable">-Xms256m</span>  
<span class="token parameter variable">-Xmx256m</span>

	
<span class="token number">4</span>.重启ES服务
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># systemctl restart elasticsearch.service </span>


<span class="token number">5</span>.验证是否修改成功
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># ps -ef | egrep &quot;Xmx|Xms&quot;</span>
elastic+   <span class="token number">88026</span>       <span class="token number">1</span> <span class="token number">99</span> <span class="token number">15</span>:56 ?        00:00:37 /usr/share/elasticsearch/jdk/bin/java <span class="token punctuation">..</span>. <span class="token parameter variable">-Xms256m</span> <span class="token parameter variable">-Xmx256m</span> 

<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># free -h</span>
               total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:           <span class="token number">3</span>.8Gi       842Mi       <span class="token number">2</span>.2Gi       <span class="token number">0</span>.0Ki       800Mi       <span class="token number">2</span>.7Gi
Swap:          <span class="token number">3</span>.8Gi        50Mi       <span class="token number">3</span>.7Gi
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">6</span>.所有节点重复上述步骤
	
验证：
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># curl -u elastic:123456Abc.com 10.0.0.91:9200/_cat/nodes</span>
<span class="token number">10.0</span>.0.92 <span class="token number">68</span> <span class="token number">43</span> <span class="token number">15</span> <span class="token number">0.79</span> <span class="token number">0.38</span> <span class="token number">0.14</span> cdfhilmrstw * elk92
<span class="token number">10.0</span>.0.91 <span class="token number">73</span> <span class="token number">59</span> <span class="token number">83</span> <span class="token number">1.19</span> <span class="token number">0.35</span> <span class="token number">0.12</span> cdfhilmrstw - elk91
<span class="token number">10.0</span>.0.93 <span class="token number">58</span> <span class="token number">51</span> <span class="token number">28</span> <span class="token number">0.57</span> <span class="token number">0.23</span> <span class="token number">0.08</span> cdfhilmrstw - elk93
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><h3 id="_50-zookeeper单点部署"><a href="#_50-zookeeper单点部署" class="header-anchor">#</a> 50，zookeeper单点部署</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.下载zookeeper
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># wget https://dlcdn.apache.org/zookeeper/zookeeper-3.8.4/apache-zookeeper-3.8.4-bin.tar.gz</span>


<span class="token number">2</span>.解压软件包
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># mkdir -pv /malu/softwares</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># tar xf apache-zookeeper-3.8.4-bin.tar.gz -C /malu/softwares</span>

<span class="token number">3</span>.准备配置文件
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># cp /malu/softwares/apache-zookeeper-3.8.4-bin/conf/zoo{_sample,}.cfg </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># ll /malu/softwares/apache-zookeeper-3.8.4-bin/conf/zoo{_sample,}.cfg</span>
-rw-r--r-- <span class="token number">1</span> root        root        <span class="token number">1183</span> Oct <span class="token number">31</span> <span class="token number">19</span>:06 /oldboyedu/softwares/apache-zookeeper-3.8.4-bin/conf/zoo.cfg
-rw-r--r-- <span class="token number">1</span> yinzhengjie yinzhengjie <span class="token number">1183</span> Feb <span class="token number">13</span>  <span class="token number">2024</span> /oldboyedu/softwares/apache-zookeeper-3.8.4-bin/conf/zoo_sample.cfg
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">4</span>.添加环境变量
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/profile.d/zk.sh </span>
<span class="token comment">#!/bin/bash</span>

<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/share/elasticsearch/jdk
<span class="token builtin class-name">export</span> <span class="token assign-left variable">ZK_HOME</span><span class="token operator">=</span>/malu/softwares/apache-zookeeper-3.8.4-bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">${ZK_HOME}</span>/bin:<span class="token variable">$JAVA_HOME</span>/bin
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># source /etc/profile.d/zk.sh</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">5</span>.启动zookeeper单点 
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># zkServer.sh start</span>
ZooKeeper JMX enabled by default
Using config: /malu/softwares/apache-zookeeper-3.8.4-bin/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Starting zookeeper <span class="token punctuation">..</span>. STARTED
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">6</span>.查看服务状态
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># zkServer.sh status</span>
ZooKeeper JMX enabled by default
Using config: /malu/softwares/apache-zookeeper-3.8.4-bin/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Client port found: <span class="token number">2181</span>. Client address: localhost. Client SSL: false.
Mode: standalone
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">7</span>.连接本地的zookeeper服务
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># zkCli.sh </span>
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token function">ls</span> /
<span class="token punctuation">[</span>zookeeper<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: localhost:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">]</span> 


<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># zkCli.sh -server 10.0.0.91:2181</span>
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token function">ls</span> /
<span class="token punctuation">[</span>zookeeper<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">]</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br></div></div><h3 id="_51-zookeeper集群搭建"><a href="#_51-zookeeper集群搭建" class="header-anchor">#</a> 51，zookeeper集群搭建</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.停止单点服务
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># zkServer.sh stop</span>
ZooKeeper JMX enabled by default
Using config: /malu/softwares/apache-zookeeper-3.8.4-bin/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Stopping zookeeper <span class="token punctuation">..</span>. STOPPED
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># zkServer.sh status</span>
ZooKeeper JMX enabled by default
Using config: /malu/softwares/apache-zookeeper-3.8.4-bin/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Client port found: <span class="token number">2181</span>. Client address: localhost. Client SSL: false.
Error contacting service. It is probably not running.
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">2</span>.修改zookeeper的配置文件
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># cat /malu/softwares/apache-zookeeper-3.8.4-bin/conf/zoo.cfg </span>
<span class="token comment"># 定义最小单元的时间范围tick。</span>
<span class="token assign-left variable">tickTime</span><span class="token operator">=</span><span class="token number">2000</span>
<span class="token comment"># 启动时最长等待tick数量。</span>
<span class="token assign-left variable">initLimit</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token comment"># 数据同步时最长等待的tick时间进行响应ACK</span>
<span class="token assign-left variable">syncLimit</span><span class="token operator">=</span><span class="token number">2</span>
<span class="token comment"># 指定数据目录</span>
<span class="token assign-left variable">dataDir</span><span class="token operator">=</span>/malu/data/zk
<span class="token comment"># 监听端口</span>
<span class="token assign-left variable">clientPort</span><span class="token operator">=</span><span class="token number">2181</span>
<span class="token comment"># 开启四字命令允许所有的节点访问。</span>
<span class="token assign-left variable">4lw.commands.whitelist</span><span class="token operator">=</span>*
<span class="token comment"># server.ID=A:B:C[:D]</span>
<span class="token comment"># ID:</span>
<span class="token comment">#    zk的唯一编号。</span>
<span class="token comment"># A:</span>
<span class="token comment">#    zk的主机地址。</span>
<span class="token comment"># B:</span>
<span class="token comment">#    leader的选举端口，是谁leader角色，就会监听该端口。</span>
<span class="token comment"># C: </span>
<span class="token comment">#    数据通信端口。</span>
<span class="token comment"># D:</span>
<span class="token comment">#    可选配置，指定角色。(leader,follower,observer)</span>
<span class="token assign-left variable">server.91</span><span class="token operator">=</span><span class="token number">10.0</span>.0.91:2888:3888
<span class="token assign-left variable">server.92</span><span class="token operator">=</span><span class="token number">10.0</span>.0.92:2888:3888
<span class="token assign-left variable">server.93</span><span class="token operator">=</span><span class="token number">10.0</span>.0.93:2888:3888

<span class="token comment">## Metrics Providers</span>
<span class="token comment">#</span>
<span class="token comment"># https://prometheus.io Metrics Exporter</span>
<span class="token comment">#metricsProvider.className=org.apache.zookeeper.metrics.prometheus.PrometheusMetricsProvider</span>
<span class="token comment">#metricsProvider.httpHost=0.0.0.0</span>
<span class="token comment">#metricsProvider.httpPort=7000</span>
<span class="token comment">#metricsProvider.exportJvmInfo=true</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">3</span>.同步zookeeper的程序到其他节点<span class="token punctuation">(</span>前提是其他节点有<span class="token string">&quot;/malu/softwares&quot;</span>目录<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp -r /malu/softwares/apache-zookeeper-3.8.4-bin/ 10.0.0.92:/malu/softwares/</span>

<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp -r /malu/softwares/apache-zookeeper-3.8.4-bin/ 10.0.0.93:/malu/softwares/</span>

<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># ll /malu/softwares/</span>
total <span class="token number">12</span>
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Oct <span class="token number">31</span> <span class="token number">19</span>:06 ./
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Oct <span class="token number">31</span> <span class="token number">19</span>:06 <span class="token punctuation">..</span>/
drwxr-xr-x <span class="token number">7</span> root root <span class="token number">4096</span> Oct <span class="token number">31</span> <span class="token number">19</span>:10 apache-zookeeper-3.8.4-bin/
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># ll /malu/softwares/</span>
total <span class="token number">16</span>
drwxr-xr-x <span class="token number">4</span> root root <span class="token number">4096</span> Oct <span class="token number">31</span> <span class="token number">19</span>:42 ./
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Oct <span class="token number">28</span> <span class="token number">14</span>:58 <span class="token punctuation">..</span>/
drwxr-xr-x <span class="token number">9</span> root root <span class="token number">4096</span> Oct <span class="token number">28</span> <span class="token number">14</span>:58 apache-tomcat-10.1.31/
drwxr-xr-x <span class="token number">7</span> root root <span class="token number">4096</span> Oct <span class="token number">31</span> <span class="token number">19</span>:42 apache-zookeeper-3.8.4-bin/
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># ll /malu/softwares/</span>
total <span class="token number">12</span>
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Oct <span class="token number">31</span> <span class="token number">19</span>:43 ./
drwxr-xr-x <span class="token number">3</span> root root <span class="token number">4096</span> Oct <span class="token number">31</span> <span class="token number">19</span>:42 <span class="token punctuation">..</span>/
drwxr-xr-x <span class="token number">7</span> root root <span class="token number">4096</span> Oct <span class="token number">31</span> <span class="token number">19</span>:43 apache-zookeeper-3.8.4-bin/
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">4</span>.准备myid文件
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p /malu/data/zk</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># echo 91 &gt; /malu/data/zk/myid</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># more /malu/data/zk/myid</span>
<span class="token number">91</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p /malu/data/zk</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># echo 92 &gt; /malu/data/zk/myid</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># more /malu/data/zk/myid</span>
<span class="token number">92</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># mkdir -p /malu/data/zk</span>
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># echo 93 &gt; /malu/data/zk/myid</span>
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># more /malu/data/zk/myid</span>
<span class="token number">93</span>
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">5</span>.同步环境变量
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp /etc/profile.d/zk.sh 10.0.0.92:/etc/profile.d</span>

<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp /etc/profile.d/zk.sh 10.0.0.93:/etc/profile.d</span>

	
<span class="token number">6</span>.所有节点启动zookeeper集群
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># source /etc/profile.d/zk.sh ; zkServer.sh start</span>

<span class="token number">7</span>.查看集群的状态
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># zkServer.sh status</span>
ZooKeeper JMX enabled by default
Using config: /malu/softwares/apache-zookeeper-3.8.4-bin/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Client port found: <span class="token number">2181</span>. Client address: localhost. Client SSL: false.
Mode: follower
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># zkServer.sh status</span>
ZooKeeper JMX enabled by default
Using config: /oldboyedu/softwares/apache-zookeeper-3.8.4-bin/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Client port found: <span class="token number">2181</span>. Client address: localhost. Client SSL: false.
Mode: leader
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>



<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># zkServer.sh status</span>
ZooKeeper JMX enabled by default
Using config: /oldboyedu/softwares/apache-zookeeper-3.8.4-bin/bin/<span class="token punctuation">..</span>/conf/zoo.cfg
Client port found: <span class="token number">2181</span>. Client address: localhost. Client SSL: false.
Mode: follower
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">8</span>.连接zookeeper集群
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># zkCli.sh -server 10.0.0.91:2181,10.0.0.92:2181,10.0.0.93:2181</span>
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token function">ls</span> /
<span class="token punctuation">[</span>zookeeper<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">]</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br></div></div><h3 id="_52-zookeeper的使用"><a href="#_52-zookeeper的使用" class="header-anchor">#</a> 52，zookeeper的使用</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.zookeeper的结构
zookeeper的存储结构和Linux文件系统类似，Linux中有目录和文件的区分，而Linux并不叫文件，而是教zookeeper node，简称<span class="token string">&quot;znode&quot;</span>。

每个znode有点类似于Linux文件系统中的目录。

<span class="token number">2</span>.基于znode实现基础管理
<span class="token number">2.1</span> 查看znode列表
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token function">ls</span> /
<span class="token punctuation">[</span>zookeeper<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">3</span><span class="token punctuation">]</span> 


<span class="token number">2.2</span> 创建znode
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token function">ls</span> /
<span class="token punctuation">[</span>zookeeper<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">]</span> create /malu
Created /malu
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token function">ls</span> /
<span class="token punctuation">[</span>malu, zookeeper<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token function">ls</span> /malu
<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">4</span><span class="token punctuation">]</span> 

		
<span class="token number">2.3</span> 查看znode的数据
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token function">ls</span> /malu
<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">4</span><span class="token punctuation">]</span> get /malu
null
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">5</span><span class="token punctuation">]</span> <span class="token builtin class-name">set</span> /malu sy
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">6</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">7</span><span class="token punctuation">]</span> get /malu
sy



<span class="token number">2.4</span> 修改数据 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">7</span><span class="token punctuation">]</span> get /malu
sy
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">8</span><span class="token punctuation">]</span> <span class="token builtin class-name">set</span> /malu jh
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">9</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">9</span><span class="token punctuation">]</span> get /malu
jh
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">10</span><span class="token punctuation">]</span> 


<span class="token number">2.5</span> 删除znode
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">10</span><span class="token punctuation">]</span> <span class="token function">ls</span> /
<span class="token punctuation">[</span>malu, zookeeper<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">11</span><span class="token punctuation">]</span> delete /malu
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">12</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">12</span><span class="token punctuation">]</span> <span class="token function">ls</span> /
<span class="token punctuation">[</span>zookeeper<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">13</span><span class="token punctuation">]</span> 



<span class="token number">2.6</span> 多级znode管理
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">14</span><span class="token punctuation">]</span> create /aaa
Created /aaa
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">16</span><span class="token punctuation">]</span> create /aaa/bbb
Created /aaa/bbb
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">17</span><span class="token punctuation">]</span> create /aaa/bbb/ccc
Created /aaa/bbb/ccc
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">18</span><span class="token punctuation">]</span> create /aaa/bbb/ccc/1
Created /aaa/bbb/ccc/1
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">19</span><span class="token punctuation">]</span> create /aaa/bbb/ccc/2
Created /aaa/bbb/ccc/2
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">20</span><span class="token punctuation">]</span> create /aaa/bbb/ccc/3
Created /aaa/bbb/ccc/3
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">21</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">22</span><span class="token punctuation">]</span> <span class="token function">ls</span> /aaa
<span class="token punctuation">[</span>bbb<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">23</span><span class="token punctuation">]</span> <span class="token function">ls</span> /aaa/bbb
<span class="token punctuation">[</span>ccc<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">24</span><span class="token punctuation">]</span> <span class="token function">ls</span> /aaa/bbb/ccc
<span class="token punctuation">[</span><span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">25</span><span class="token punctuation">]</span> create /aaa/bbb/ccc/1/sy <span class="token number">10</span>
Created /aaa/bbb/ccc/1/sy
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">26</span><span class="token punctuation">]</span> <span class="token function">ls</span> /aaa/bbb/ccc/1/sy 
<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">27</span><span class="token punctuation">]</span> get /aaa/bbb/ccc/1/sy
<span class="token number">10</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">28</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">29</span><span class="token punctuation">]</span> delete /aaa/bbb/ccc/1
Node not empty: /aaa/bbb/ccc/1
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">30</span><span class="token punctuation">]</span> delete /aaa/bbb/ccc/2
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">31</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">32</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">32</span><span class="token punctuation">]</span> deleteall /aaa 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">33</span><span class="token punctuation">]</span> <span class="token function">ls</span> /aaa
Node does not exist: /aaa
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">34</span><span class="token punctuation">]</span> 


<span class="token number">2.7</span> zookeeper的node类型
有临时的znode，和永久的znode，临时的znode会随着会话的结束，在默认30s内自动删除。

<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># zkCli.sh -server 10.0.0.91:2181,10.0.0.92:2181,10.0.0.93:2181</span>
<span class="token number">2024</span>-10-31 <span class="token number">12</span>:20:58,453 <span class="token punctuation">[</span>myid:10.0.0.91:2181<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main-SendThread<span class="token punctuation">(</span><span class="token number">10.0</span>.0.91:2181<span class="token punctuation">)</span>:o.a.z.ClientCnxn<span class="token variable">$SendThread</span>@1453<span class="token punctuation">]</span> - Session establishment complete on server elk91/10.0.0.91:2181, session <span class="token function">id</span> <span class="token operator">=</span> 0x5b000005af140000, negotiated <span class="token function">timeout</span> <span class="token operator">=</span> <span class="token number">30000</span>

WATCHER::

WatchedEvent state:SyncConnected type:None path:null
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">]</span> create <span class="token parameter variable">-e</span> /malu
Created /malu
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">]</span> create /sy
Created /sy
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">2</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token function">ls</span> /
<span class="token punctuation">[</span>sy, malu, zookeeper<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">3</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">3</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token function">stat</span> /sy 
cZxid <span class="token operator">=</span> 0x40000001a
ctime <span class="token operator">=</span> Thu Oct <span class="token number">31</span> <span class="token number">12</span>:21:16 UTC <span class="token number">2024</span>
mZxid <span class="token operator">=</span> 0x40000001a
mtime <span class="token operator">=</span> Thu Oct <span class="token number">31</span> <span class="token number">12</span>:21:16 UTC <span class="token number">2024</span>
pZxid <span class="token operator">=</span> 0x40000001a
cversion <span class="token operator">=</span> <span class="token number">0</span>
dataVersion <span class="token operator">=</span> <span class="token number">0</span>
aclVersion <span class="token operator">=</span> <span class="token number">0</span>
ephemeralOwner <span class="token operator">=</span> 0x0
dataLength <span class="token operator">=</span> <span class="token number">0</span>
numChildren <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">4</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token function">stat</span> /malu 
cZxid <span class="token operator">=</span> 0x400000019
ctime <span class="token operator">=</span> Thu Oct <span class="token number">31</span> <span class="token number">12</span>:21:11 UTC <span class="token number">2024</span>
mZxid <span class="token operator">=</span> 0x400000019
mtime <span class="token operator">=</span> Thu Oct <span class="token number">31</span> <span class="token number">12</span>:21:11 UTC <span class="token number">2024</span>
pZxid <span class="token operator">=</span> 0x400000019
cversion <span class="token operator">=</span> <span class="token number">0</span>
dataVersion <span class="token operator">=</span> <span class="token number">0</span>
aclVersion <span class="token operator">=</span> <span class="token number">0</span>
ephemeralOwner <span class="token operator">=</span> 0x5b000005af140000   <span class="token comment"># 如果不为0，表示时一个临时的znode，会随着会话的生命周期而结束！</span>
dataLength <span class="token operator">=</span> <span class="token number">0</span>
numChildren <span class="token operator">=</span> <span class="token number">0</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">5</span><span class="token punctuation">]</span> 
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">5</span><span class="token punctuation">]</span> quit 

WATCHER::

WatchedEvent state:Closed type:None path:null
<span class="token number">2024</span>-10-31 <span class="token number">12</span>:21:55,144 <span class="token punctuation">[</span>myid:<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main:o.a.z.ZooKeeper@1232<span class="token punctuation">]</span> - Session: 0x5b000005af140000 closed

<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


等待30s再次链接时，发现自动删除了临时znode为<span class="token string">&quot;malu&quot;</span>

<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># zkCli.sh -server 10.0.0.91:2181,10.0.0.92:2181,10.0.0.93:2181</span>
<span class="token punctuation">..</span>.
<span class="token number">2024</span>-10-31 <span class="token number">12</span>:22:20,121 <span class="token punctuation">[</span>myid:10.0.0.92:2181<span class="token punctuation">]</span> - INFO  <span class="token punctuation">[</span>main-SendThread<span class="token punctuation">(</span><span class="token number">10.0</span>.0.92:2181<span class="token punctuation">)</span>:o.a.z.ClientCnxn<span class="token variable">$SendThread</span>@1453<span class="token punctuation">]</span> - Session establishment complete on server <span class="token number">10.0</span>.0.92/10.0.0.92:2181, session <span class="token function">id</span> <span class="token operator">=</span> 0x5c000005a4b40000, negotiated <span class="token function">timeout</span> <span class="token operator">=</span> <span class="token number">30000</span>

WATCHER::

WatchedEvent state:SyncConnected type:None path:null
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token function">ls</span> /
<span class="token punctuation">[</span>sy, zookeeper<span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">1</span><span class="token punctuation">]</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br></div></div><h3 id="_52-zookeeper的watch机制-了解-和图形化管理"><a href="#_52-zookeeper的watch机制-了解-和图形化管理" class="header-anchor">#</a> 52，zookeeper的watch机制(了解)和图形化管理</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>watch机制的特征：
    - zookeeper的watch机制是一次性的，当被监控的事件发生时会触发给对应订阅者发送信息<span class="token punctuation">;</span>
    - zookeeper支持监控znode下子节点及znode本身的数据变化<span class="token punctuation">;</span>
    
案例1:
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.92:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token function">ls</span> <span class="token parameter variable">-w</span> /jh 
<span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.92:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">3</span><span class="token punctuation">]</span> 
WATCHER::

WatchedEvent state:SyncConnected type:NodeChildrenChanged path:/jh


案例2:
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.92:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">7</span><span class="token punctuation">]</span> get <span class="token parameter variable">-w</span> /jh 
xxx
<span class="token punctuation">[</span>zk: <span class="token number">10.0</span>.0.92:2181<span class="token punctuation">(</span>CONNECTED<span class="token punctuation">)</span> <span class="token number">8</span><span class="token punctuation">]</span> 
WATCHER::

WatchedEvent state:SyncConnected type:NodeDataChanged path:/jh
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.下载JDK
官网地址:
	https://www.oracle.com/java/technologies/downloads/archive/


<span class="token number">2</span>.解压软件包
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># tar xf jdk-8u291-linux-x64.tar.gz -C /malu/softwares/</span>


<span class="token number">3</span>.下载zkWeb
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># ll zkWeb-v1.2.1.jar </span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">28575779</span> Nov <span class="token number">13</span> <span class="token number">13</span>:45 zkWeb-v1.2.1.jar
root@elk91:~<span class="token comment"># </span>



<span class="token number">4</span>.启动zkWeb
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># /malu/softwares/jdk1.8.0_291/bin/java -version</span>
<span class="token function">java</span> version <span class="token string">&quot;1.8.0_291&quot;</span>
Java<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span>.0_291-b10<span class="token punctuation">)</span>
Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.291</span>-b10, mixed mode<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># nohup /malu/softwares/jdk1.8.0_291/bin/java -jar  zkWeb-v1.2.1.jar &amp;&gt; /tmp/zkweb.log &amp;</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token number">7145</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># tail -100f  /tmp/zkweb.log </span>
<span class="token punctuation">..</span>.
<span class="token punctuation">[</span><span class="token number">2024</span>-11-01 01:56:44 INFO  main  TomcatWebServer.java:206<span class="token punctuation">]</span> o.s.b.w.e.tomcat.TomcatWebServer --<span class="token operator">&gt;</span> Tomcat started on port<span class="token punctuation">(</span>s<span class="token punctuation">)</span>: <span class="token number">8099</span> <span class="token punctuation">(</span>http<span class="token punctuation">)</span> with context path <span class="token string">''</span>
<span class="token punctuation">[</span><span class="token number">2024</span>-11-01 01:56:44 INFO  main  StartupInfoLogger.java:59<span class="token punctuation">]</span> c.y.zkweb.ZkWebSpringBootApplication --<span class="token operator">&gt;</span> Started ZkWebSpringBootApplication <span class="token keyword">in</span> <span class="token number">3.482</span> seconds <span class="token punctuation">(</span>JVM running <span class="token keyword">for</span> <span class="token number">3.885</span><span class="token punctuation">)</span>


<span class="token number">5</span>.访问zkWebUI
http://10.0.0.91:8099/<span class="token comment">#</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br></div></div><p><img src="/devops/public/assets/img/1731477052745.8c94aae0.png" alt="1731477052745"></p> <p><img src="/devops/public/assets/img/1731477092819.978f5fd9.png" alt="1731477092819"></p> <p><img src="/devops/public/assets/img/1731477132782.65578468.png" alt="1731477132782"></p> <h3 id="_53-zookeeper的jvm配置"><a href="#_53-zookeeper的jvm配置" class="header-anchor">#</a> 53，zookeeper的JVM配置</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>温馨提示:
	生产环境中，推荐调优到2G~4G之间即可。学习环境建议128MB即可。
	
<span class="token number">1</span>.修改前查看zookeeper的堆内存配置
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># ps -ef | grep zookeeper </span>
root        <span class="token number">1652</span>       <span class="token number">1</span>  <span class="token number">0</span> Oct31 pts/0    00:00:39 /usr/share/elasticsearch/jdk/bin/java  <span class="token punctuation">..</span>.  <span class="token parameter variable">-Xmx1000m</span> <span class="token punctuation">..</span>.
	
	
<span class="token number">2</span>.修改zookeeper的环境变量脚本
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># vim /malu/softwares/apache-zookeeper-3.8.4-bin/bin/zkEnv.sh </span>
<span class="token punctuation">..</span>.
<span class="token comment"># ZK_SERVER_HEAP=&quot;${ZK_SERVER_HEAP:-1000}&quot;</span>
<span class="token assign-left variable">ZK_SERVER_HEAP</span><span class="token operator">=</span><span class="token string">&quot;<span class="token variable">${ZK_SERVER_HEAP<span class="token operator">:-</span>128}</span>&quot;</span>    


<span class="token number">3</span>.重启zookeeper服务
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># zkServer.sh restart</span>


<span class="token number">4</span>.再次查看ZK的堆内存配置
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># ps -ef | grep zookeeper</span>
root        <span class="token number">7530</span>       <span class="token number">1</span>  <span class="token number">4</span> <span class="token number">10</span>:33 pts/0    00:00:01 /usr/share/elasticsearch/jdk/bin/java <span class="token punctuation">..</span>. <span class="token parameter variable">-Xmx128m</span> <span class="token parameter variable">-Xmx128m</span> <span class="token punctuation">..</span>.


<span class="token number">5</span>.其他节点重复1-4步骤
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="_54-常见的mq对比"><a href="#_54-常见的mq对比" class="header-anchor">#</a> 54，常见的MQ对比</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>为了减轻Logstash压力以及Logstash和filebeat的耦合性，我们可以考虑在Logstash前面加一套MQ集群。


所谓的MQ，指的是Message Queue，即消息队列。但是这种架构无疑是给系统增加了负担:
    - <span class="token number">1</span>.MQ不能存在单点问题<span class="token punctuation">;</span>
    - <span class="token number">2</span>.MQ具有很强的处理数据能力<span class="token punctuation">;</span> 
    - <span class="token number">3</span>.增加了集群的整体复杂性，运维和开发的同学都得增加学习成本<span class="token punctuation">;</span>


也就是说，这意味消息队列要提供以下特性:
     - <span class="token number">1</span>.MQ集群吞吐量大，能够承担数据的读写<span class="token punctuation">;</span>     
     - <span class="token number">2</span>.MQ集群要提供非常强的高可用性，不能是单点的故障<span class="token punctuation">;</span>
     - <span class="token number">3</span>.文档丰富，社区资源丰富<span class="token punctuation">;</span>



市面上有很多MQ产品，典型代表有:
- RocketMQ【阿里巴巴，有社区版本<span class="token punctuation">(</span>功能较差，文档不够丰富，仅支持Java相关的API<span class="token punctuation">)</span>和SAAS版本<span class="token punctuation">(</span>功能强，需要花钱<span class="token punctuation">)</span>，性能很好，单机每秒能够处理10w+/s】

- ActiveMQ【老牌系统，文档相对丰富，性能一般，单机每秒处理1w+/s】

- Kafka【日志收集，大数据分析，性能非常好，单机每秒处理10w+/s，存在丢失数据的风险，但可以忽略不计，API文档非常丰富，基于Java和Scala语言研发。二次开发比较方便，社区完善了Golang，Python等API】

- RabbitMQ【金融公司，文档丰富，性能较好，单机每秒处理1w+/s，有丰富的WebUI，可以做到数据不丢失。API开发相对来说不太友好。基于Erlang语言研发，国内并不流行，因此二次开发招人比较困难。】
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_55-kafka单点部署"><a href="#_55-kafka单点部署" class="header-anchor">#</a> 55，kafka单点部署</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.准备zookeeper集群
已准备好了。
	
    
<span class="token number">2</span>.下载kafka的软件包 
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># wget https://downloads.apache.org/kafka/3.8.1/kafka_2.13-3.8.1.tgz</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># ll kafka_2.13-3.8.1.tgz </span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">121178579</span> Nov  <span class="token number">1</span> <span class="token number">22</span>:11 kafka_2.13-3.8.1.tgz

<span class="token number">3</span>.解压软件包 
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># tar xf kafka_2.13-3.8.1.tgz -C /malu/softwares/</span>


<span class="token number">4</span>.修改kafka的配置文件
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># vim /malu/softwares/kafka_2.13-3.8.1/config/server.properties </span>
<span class="token punctuation">..</span>.
<span class="token comment"># 修改kafka的broker的唯一标识</span>
<span class="token assign-left variable">broker.id</span><span class="token operator">=</span><span class="token number">91</span>

<span class="token comment"># 修改kafka的数据目录，自己手动创建出这个目录</span>
<span class="token assign-left variable">log.dirs</span><span class="token operator">=</span>/malu/data/kafka

<span class="token comment"># 指定zookeeper集群地址信息</span>
<span class="token assign-left variable">zookeeper.connect</span><span class="token operator">=</span><span class="token number">10.0</span>.0.91:2181,10.0.0.92:2181,10.0.0.93:2181/malu-kafka381

<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
	
<span class="token number">5</span>.配置环境变量
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/profile.d/kafka.sh</span>
<span class="token comment">#!/bin/bash</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/share/elasticsearch/jdk
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KAFKA_HOME</span><span class="token operator">=</span>/malu/softwares/kafka_2.13-3.8.1
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$KAFKA_HOME</span>/bin:<span class="token variable">$JAVA_HOME</span>/bin

<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># . /etc/profile.d/kafka.sh</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
 
	
<span class="token number">6</span>.启动kafka服务
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># kafka-server-start.sh -daemon $KAFKA_HOME/config/server.properties </span>


<span class="token number">7</span>.zookeeper验证broker是否在线
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br></div></div><p><img src="/devops/public/assets/img/1731483575787.e7859075.png" alt="1731483575787"></p> <h3 id="_56-kafka集群环境搭建"><a href="#_56-kafka集群环境搭建" class="header-anchor">#</a> 56，kafka集群环境搭建</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.拷贝kafka程序到其他节点
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp -r /malu/softwares/kafka_2.13-3.8.1 10.0.0.92:/malu/softwares</span>

<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp -r /malu/softwares/kafka_2.13-3.8.1 10.0.0.93:/malu/softwares</span>


<span class="token number">2</span>.拷贝环境变量到其他节点
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp /etc/profile.d/kafka.sh 10.0.0.92:/etc/profile.d/</span>

<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># scp /etc/profile.d/kafka.sh 10.0.0.93:/etc/profile.d/</span>


<span class="token number">3</span>.修改对应节点的borker ID
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># grep ^broker.id /malu/softwares/kafka_2.13-3.8.1/config/server.properties </span>
<span class="token assign-left variable">broker.id</span><span class="token operator">=</span><span class="token number">91</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># sed -i '/^broker.id/s#91#92#' /malu/softwares/kafka_2.13-3.8.1/config/server.properties </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># grep ^broker.id /malu/softwares/kafka_2.13-3.8.1/config/server.properties </span>
<span class="token assign-left variable">broker.id</span><span class="token operator">=</span><span class="token number">92</span>
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># grep ^broker.id /malu/softwares/kafka_2.13-3.8.1/config/server.properties </span>
<span class="token assign-left variable">broker.id</span><span class="token operator">=</span><span class="token number">91</span>
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># sed -i '/^broker.id/s#91#93#' /malu/softwares/kafka_2.13-3.8.1/config/server.properties </span>
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># grep ^broker.id /malu/softwares/kafka_2.13-3.8.1/config/server.properties </span>
<span class="token assign-left variable">broker.id</span><span class="token operator">=</span><span class="token number">93</span>
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">4</span>.各节点启动kafka服务
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># source /etc/profile.d/kafka.sh ; kafka-server-start.sh -daemon $KAFKA_HOME/config/server.properties </span>


<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># source /etc/profile.d/kafka.sh ; kafka-server-start.sh -daemon $KAFKA_HOME/config/server.properties </span>

	
<span class="token number">5</span>.验证zookeeper中是否有broker上线 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><p><img src="/devops/public/assets/img/1731483895445.e8e0cce4.png" alt="1731483895445"></p> <h3 id="_57-kafka常见术语"><a href="#_57-kafka常见术语" class="header-anchor">#</a> 57，kafka常见术语</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Producer：
	生产者，往kafka集群写入数据的角色。
		
Consumer：
	消费者，从kafka读取数据的角色。
		
broker list：
	表示MQ列表，此处特折kafka cluster。
		
borker <span class="token function">id</span> 
	表示kafka的唯一标识。
		
topic:
	是逻辑的存储单元，是Producer和Consumer进行读写的逻辑单元。类似于ES集群的index。
		
partition:
	分区，也是逻辑的存储单元，将topic的数据分成多个分区进行存储，类似于ES的分片概念。
		
replica:
	副本，是实际的存储单元，一个partition可以有多个replica。
		
	当replica数量大于1时，表示一个分区有多个副本，则会出现leader和follower之分。
		
	其中leader负责数据的读写，而follower仅用于从leader同步数据，并不会被Producer和Consumer看到。
		
	当leader挂掉时，follower会被接管，成为新的leader。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="_58-topic管理"><a href="#_58-topic管理" class="header-anchor">#</a> 58，topic管理</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.创建topic  <span class="token number">3</span>个分区，1个分区上两个副本
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server 10.0.0.91:9092 --create --topic malu-linux --partitions 3 --replication-factor 2</span>
 
<span class="token number">2</span>.查看topic列表 
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server 10.0.0.91:9092 --topic malu-linux --list</span>
malu-linux
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">3</span>.查看topic的详细信息
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server 10.0.0.91:9092 --topic malu-linux --describe</span>
Topic: malu-linux	TopicId: 7yej52WnTXmcqSGs_Q-ArQ	PartitionCount: <span class="token number">3</span>	ReplicationFactor: <span class="token number">2</span>	Configs: 
	Topic: malu-linux	Partition: <span class="token number">0</span>	Leader: <span class="token number">92</span>	Replicas: <span class="token number">92,93</span>	Isr: <span class="token number">92,93</span>	Elr: N/A	LastKnownElr: N/A
	Topic: malu-linux	Partition: <span class="token number">1</span>	Leader: <span class="token number">93</span>	Replicas: <span class="token number">93,91</span>	Isr: <span class="token number">93,91</span>	Elr: N/A	LastKnownElr: N/A
	Topic: malu-linux	Partition: <span class="token number">2</span>	Leader: <span class="token number">91</span>	Replicas: <span class="token number">91,92</span>	Isr: <span class="token number">91,92</span>	Elr: N/A	LastKnownElr: N/A
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">4</span>.修改topic的分区数
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server 10.0.0.91:9092 --topic malu-linux --alter --partitions 5</span>
<span class="token punctuation">[</span><span class="token number">2024</span>-11-01 04:12:17,040<span class="token punctuation">]</span> WARN <span class="token punctuation">[</span>AdminClient <span class="token assign-left variable">clientId</span><span class="token operator">=</span>adminclient-1<span class="token punctuation">]</span> The DescribeTopicPartitions API is not supported, using Metadata API to describe topics. <span class="token punctuation">(</span>org.apache.kafka.clients.admin.KafkaAdminClient<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server 10.0.0.91:9092 --topic malu-linux --describe</span>
<span class="token punctuation">[</span><span class="token number">2024</span>-11-01 04:12:24,581<span class="token punctuation">]</span> WARN <span class="token punctuation">[</span>AdminClient <span class="token assign-left variable">clientId</span><span class="token operator">=</span>adminclient-1<span class="token punctuation">]</span> The DescribeTopicPartitions API is not supported, using Metadata API to describe topics. <span class="token punctuation">(</span>org.apache.kafka.clients.admin.KafkaAdminClient<span class="token punctuation">)</span>
Topic: malu-linux	TopicId: 7yej52WnTXmcqSGs_Q-ArQ	PartitionCount: <span class="token number">5</span>	ReplicationFactor: <span class="token number">2</span>	Configs: 
	Topic: malu-linux	Partition: <span class="token number">0</span>	Leader: <span class="token number">92</span>	Replicas: <span class="token number">92,93</span>	Isr: <span class="token number">92,93</span>	Elr: N/A	LastKnownElr: N/A
	Topic: malu-linux	Partition: <span class="token number">1</span>	Leader: <span class="token number">93</span>	Replicas: <span class="token number">93,91</span>	Isr: <span class="token number">93,91</span>	Elr: N/A	LastKnownElr: N/A
	Topic: malu-linux	Partition: <span class="token number">2</span>	Leader: <span class="token number">91</span>	Replicas: <span class="token number">91,92</span>	Isr: <span class="token number">91,92</span>	Elr: N/A	LastKnownElr: N/A
	Topic: malu-linux	Partition: <span class="token number">3</span>	Leader: <span class="token number">92</span>	Replicas: <span class="token number">92,93</span>	Isr: <span class="token number">92,93</span>	Elr: N/A	LastKnownElr: N/A
	Topic: malu-linux	Partition: <span class="token number">4</span>	Leader: <span class="token number">93</span>	Replicas: <span class="token number">93,91</span>	Isr: <span class="token number">93,91</span>	Elr: N/A	LastKnownElr: N/A
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">5</span>.删除topic
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server 10.0.0.91:9092 --topic malu-linux --delete</span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server 10.0.0.91:9092 --list</span>

<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># ll /malu/data/kafka/  # 删除数据时，不会立刻删除。默认是1min后删除（metadata.max.retention.bytes）</span>
total <span class="token number">40</span>
drwxr-xr-x <span class="token number">5</span> root root <span class="token number">4096</span> Nov  <span class="token number">1</span> <span class="token number">12</span>:15 ./
drwxr-xr-x <span class="token number">4</span> root root <span class="token number">4096</span> Nov  <span class="token number">1</span> <span class="token number">11</span>:22 <span class="token punctuation">..</span>/
-rw-r--r-- <span class="token number">1</span> root root    <span class="token number">4</span> Nov  <span class="token number">1</span> <span class="token number">12</span>:15 cleaner-offset-checkpoint
-rw-r--r-- <span class="token number">1</span> root root    <span class="token number">0</span> Nov  <span class="token number">1</span> <span class="token number">11</span>:22 .lock
-rw-r--r-- <span class="token number">1</span> root root    <span class="token number">4</span> Nov  <span class="token number">1</span> <span class="token number">12</span>:15 log-start-offset-checkpoint
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">89</span> Nov  <span class="token number">1</span> <span class="token number">11</span>:22 meta.properties
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> Nov  <span class="token number">1</span> <span class="token number">12</span>:05 malu-linux-1.82c7b13541a24be7a42c9a877d8ecddd-delete/
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> Nov  <span class="token number">1</span> <span class="token number">12</span>:05 malu-linux-2.bbf28a99431b4127be286386025cab06-delete/
drwxr-xr-x <span class="token number">2</span> root root <span class="token number">4096</span> Nov  <span class="token number">1</span> <span class="token number">12</span>:12 malu-linux-4.4fb34c1921fb46128474e00eb419ff3a-delete/
-rw-r--r-- <span class="token number">1</span> root root    <span class="token number">4</span> Nov  <span class="token number">1</span> <span class="token number">12</span>:15 recovery-point-offset-checkpoint
-rw-r--r-- <span class="token number">1</span> root root   <span class="token number">64</span> Nov  <span class="token number">1</span> <span class="token number">12</span>:14 replication-offset-checkpoint
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


参考链接:
	https://kafka.apache.org/documentation/<span class="token comment">#brokerconfigs_metadata.max.retention.bytes</span>
	
	
可能会出现的错误1:
<span class="token punctuation">[</span><span class="token number">2024</span>-11-01 04:06:01,175<span class="token punctuation">]</span> WARN <span class="token punctuation">[</span>AdminClient <span class="token assign-left variable">clientId</span><span class="token operator">=</span>adminclient-1<span class="token punctuation">]</span> Error connecting to <span class="token function">node</span> elk93:9092 <span class="token punctuation">(</span>id: <span class="token number">93</span> rack: null<span class="token punctuation">)</span> <span class="token punctuation">(</span>org.apache.kafka.clients.NetworkClient<span class="token punctuation">)</span>
java.net.UnknownHostException: elk93: Temporary failure <span class="token keyword">in</span> name resolution
	at java.base/java.net.Inet6AddressImpl.lookupAllHostAddr<span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span>
	at java.base/java.net.Inet6AddressImpl.lookupAllHostAddr<span class="token punctuation">(</span>Inet6AddressImpl.java:52<span class="token punctuation">)</span>
	at java.base/java.net.InetAddress<span class="token variable">$PlatformResolver</span>.lookupByName<span class="token punctuation">(</span>InetAddress.java:1221<span class="token punctuation">)</span>
	at java.base/java.net.InetAddress.getAddressesFromNameService<span class="token punctuation">(</span>InetAddress.java:1816<span class="token punctuation">)</span>
	at java.base/java.net.InetAddress<span class="token variable">$NameServiceAddresses</span>.get<span class="token punctuation">(</span>InetAddress.java:1149<span class="token punctuation">)</span>
	at java.base/java.net.InetAddress.getAllByName0<span class="token punctuation">(</span>InetAddress.java:1806<span class="token punctuation">)</span>
	at java.base/java.net.InetAddress.getAllByName<span class="token punctuation">(</span>InetAddress.java:1676<span class="token punctuation">)</span>


解决方案 ： 所有节点添加解析
<span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/hosts <span class="token operator">&lt;&lt;</span><span class="token string">EOF
10.0.0.91 elk91 
10.0.0.92 elk92 
10.0.0.93 elk93 
EOF</span>
	
	
可能出现的错误2：
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server 10.0.0.91:9092 --topic malu-linux --alter --partitions 3</span>
Error <span class="token keyword">while</span> executing topic <span class="token builtin class-name">command</span> <span class="token builtin class-name">:</span> Topic currently has <span class="token number">5</span> partitions, <span class="token function">which</span> is higher than the requested <span class="token number">3</span>.

解决方案:
	topic的分区数只能扩容，不能缩容，因为缩容时，会面临数据丢失的风险。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br></div></div><h3 id="_58-生产者和消费者案例"><a href="#_58-生产者和消费者案例" class="header-anchor">#</a> 58，生产者和消费者案例</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>所有节点添加解析
<span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/hosts <span class="token operator">&lt;&lt;</span><span class="token string">EOF
10.0.0.91 elk91 
10.0.0.92 elk92 
10.0.0.93 elk93 
EOF</span>

<span class="token number">1</span>.概念补充说明
    - <span class="token number">1</span>.同一个partition中，数据是有序的；
    - <span class="token number">2</span>.当一个topic有多个partition时，可能会出现写入和读取顺序不一致的情况；
			 
<span class="token number">2</span>.启动生产者
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># kafka-console-producer.sh --bootstrap-server 10.0.0.91:9092 --topic malu-linux </span>
<span class="token operator">&gt;</span><span class="token number">11111111111111111111111111111</span>
<span class="token punctuation">[</span><span class="token number">2024</span>-11-01 06:58:21,392<span class="token punctuation">]</span> WARN <span class="token punctuation">[</span>Producer <span class="token assign-left variable">clientId</span><span class="token operator">=</span>console-producer<span class="token punctuation">]</span> Error <span class="token keyword">while</span> fetching metadata with correlation <span class="token function">id</span> <span class="token number">7</span> <span class="token builtin class-name">:</span> <span class="token punctuation">{</span>malu-linux<span class="token operator">=</span>LEADER_NOT_AVAILABLE<span class="token punctuation">}</span> <span class="token punctuation">(</span>org.apache.kafka.clients.NetworkClient<span class="token punctuation">)</span>
<span class="token operator">&gt;</span><span class="token number">222222222222222222222222</span>
<span class="token operator">&gt;</span>


温馨提示：
	若topic不存在，则会自动创建topic，生产环境中建议禁用此功能。
	
	
<span class="token number">3</span>.启动消费者 
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># kafka-console-consumer.sh --bootstrap-server 10.0.0.91:9092 --topic malu-linux  --from-beginning </span>
<span class="token number">11111111111111111111111111111</span>
<span class="token number">222222222222222222222222</span>
<span class="token number">33333333333333333</span>
aaaaaaaaaaaa
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_59-消费者组-扩展"><a href="#_59-消费者组-扩展" class="header-anchor">#</a> 59，消费者组(扩展)</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.术语补充
Consumer group：
	消费者组，任何一个消费者都隶属于某个消费者组。
			
offset:
	partition中数据存储的偏移量。


温馨提示:
	- <span class="token number">1</span>.同一个消费者组内的消费者无法同时对同一个topic的partition进行数据消费<span class="token punctuation">;</span>
	- <span class="token number">2</span>.一个消费者组可以有多个消费者<span class="token punctuation">;</span>
	
	
<span class="token number">2</span>.消费者案例
<span class="token number">2.1</span> 创建一个5分区1副本的topic
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server 10.0.0.91:9092 --create --topic sy --partitions 5 --replication-factor 1</span>
Created topic sy.
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># kafka-topics.sh --bootstrap-server 10.0.0.91:9092 --describe --topic sy </span>
<span class="token punctuation">[</span><span class="token number">2024</span>-11-01 07:11:17,019<span class="token punctuation">]</span> WARN <span class="token punctuation">[</span>AdminClient <span class="token assign-left variable">clientId</span><span class="token operator">=</span>adminclient-1<span class="token punctuation">]</span> The DescribeTopicPartitions API is not supported, using Metadata API to describe topics. <span class="token punctuation">(</span>org.apache.kafka.clients.admin.KafkaAdminClient<span class="token punctuation">)</span>
Topic: sy	TopicId: aG_FXJPVQkOvr2RMFd8a4Q	PartitionCount: <span class="token number">5</span>	ReplicationFactor: <span class="token number">1</span>	Configs: 
	Topic: sy	Partition: <span class="token number">0</span>	Leader: <span class="token number">93</span>	Replicas: <span class="token number">93</span>	Isr: <span class="token number">93</span>	Elr: N/A	LastKnownElr: N/A
	Topic: sy	Partition: <span class="token number">1</span>	Leader: <span class="token number">91</span>	Replicas: <span class="token number">91</span>	Isr: <span class="token number">91</span>	Elr: N/A	LastKnownElr: N/A
	Topic: sy	Partition: <span class="token number">2</span>	Leader: <span class="token number">92</span>	Replicas: <span class="token number">92</span>	Isr: <span class="token number">92</span>	Elr: N/A	LastKnownElr: N/A
	Topic: sy	Partition: <span class="token number">3</span>	Leader: <span class="token number">93</span>	Replicas: <span class="token number">93</span>	Isr: <span class="token number">93</span>	Elr: N/A	LastKnownElr: N/A
	Topic: sy	Partition: <span class="token number">4</span>	Leader: <span class="token number">91</span>	Replicas: <span class="token number">91</span>	Isr: <span class="token number">91</span>	Elr: N/A	LastKnownElr: N/A
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">2.2</span> 创建生产者
<span class="token punctuation">[</span>root@elk91 ~<span class="token punctuation">]</span><span class="token comment"># kafka-console-producer.sh --bootstrap-server 10.0.0.91:9092 --topic sy</span>
<span class="token operator">&gt;</span><span class="token number">1111111111111111111111</span>
<span class="token operator">&gt;</span><span class="token number">22222222222222222222222</span>
<span class="token operator">&gt;</span><span class="token number">3333333333333333333333333</span>
<span class="token operator">&gt;</span>


<span class="token number">2.3</span> 启动消费者并指定消费者组，若不指定则默认会生成一个随机的消费者组名称
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># kafka-console-consumer.sh --bootstrap-server 10.0.0.91:9092 --topic sy  --from-beginning --consumer-property group.id=linux94</span>
<span class="token number">1111111111111111111111</span>
<span class="token number">22222222222222222222222</span>
<span class="token number">3333333333333333333333333</span>


<span class="token number">2.4</span> 查看消费者组列表信息
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># kafka-consumer-groups.sh   --bootstrap-server 10.0.0.91:9092 --list</span>
linux94
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">2.5</span> 查看消费者组详细信息
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># kafka-consumer-groups.sh   --bootstrap-server 10.0.0.91:9092 --describe --group linux94 | more </span>

GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                           HOST            CLIENT-ID
linux94         sy       <span class="token number">0</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               console-consumer-bc1e9b4a-ebb0-4c27-8807-eac5c8fa3651 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">4</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               console-consumer-bc1e9b4a-ebb0-4c27-8807-eac5c8fa3651 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">3</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               console-consumer-bc1e9b4a-ebb0-4c27-8807-eac5c8fa3651 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">2</span>          <span class="token number">3</span>               <span class="token number">3</span>               <span class="token number">0</span>               console-consumer-bc1e9b4a-ebb0-4c27-8807-eac5c8fa3651 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">1</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               console-consumer-bc1e9b4a-ebb0-4c27-8807-eac5c8fa3651 /10.0.0.92      console-consumer 
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>

相关字段说明:
	GROUP：
		消费者组 
	TOPIC:
		消费的topic名称 
	PARTITION:
		topic对应的分区编号。
	CURRENT-OFFSET:
		当前消费的offset位置。
	LOG-END-OFFSET:
		partition的最后一个offset位置。 
	LAG:
		数据延迟的条数，0代表没有数据延迟。
	CONSUMER-ID:
		消费者ID 
	HOST:
		消费者的主机IP 
	CLIENT-ID:
		客户端ID类型。 
		
		
		
		
<span class="token number">2.6</span> 再次启动一个新的生产者 
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># kafka-console-producer.sh --bootstrap-server 10.0.0.91:9092 --topic sy</span>
<span class="token operator">&gt;</span>aaaaaaaaaaaaaaaaaaa
<span class="token operator">&gt;</span>bbbbbbbbbbbbbbbbbbbbb
<span class="token operator">&gt;</span>ccccccccccccccccccccc
<span class="token operator">&gt;</span>ddddddddddddddddddddddddd
<span class="token operator">&gt;</span>

<span class="token number">2.7</span> 再次查看消费者组信息（不难发现，新启动的生产者将数据写入到了1号分区）
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># kafka-consumer-groups.sh   --bootstrap-server 10.0.0.91:9092 --describe --group linux94 | more </span>

GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                           HOST            CLIENT-ID
linux94         sy       <span class="token number">0</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               console-consumer-bc1e9b4a-ebb0-4c27-8807-eac5c8fa3651 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">4</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               console-consumer-bc1e9b4a-ebb0-4c27-8807-eac5c8fa3651 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">3</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               console-consumer-bc1e9b4a-ebb0-4c27-8807-eac5c8fa3651 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">2</span>          <span class="token number">3</span>               <span class="token number">3</span>               <span class="token number">0</span>               console-consumer-bc1e9b4a-ebb0-4c27-8807-eac5c8fa3651 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">1</span>          <span class="token number">4</span>               <span class="token number">4</span>               <span class="token number">0</span>               console-consumer-bc1e9b4a-ebb0-4c27-8807-eac5c8fa3651 /10.0.0.92      console-consumer
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>



<span class="token number">2.8</span> 再次启动一个新的消费者
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># kafka-console-consumer.sh --bootstrap-server 10.0.0.91:9092 --topic sy  --from-beginning --consumer-property group.id=linux94</span>


温馨提示: 尽管使用了 <span class="token string">&quot;--from-beginning&quot;</span>选项，也会发现没有数据出来！这是因为数据被linux94这个消费者组消费过了！


<span class="token number">2.9</span> 再次观察消费组信息（不难发现，新启动消费者后，同一个消费者组的消费者占据不同的paritition）
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># kafka-consumer-groups.sh   --bootstrap-server 10.0.0.91:9092 --describe --group linux94 | more </span>

GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                           HOST            CLIENT-ID
linux94         sy       <span class="token number">0</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               console-consumer-03c0224d-f7a1-4f38-9cf0-ff85bd7d3063 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">2</span>          <span class="token number">3</span>               <span class="token number">3</span>               <span class="token number">0</span>               console-consumer-03c0224d-f7a1-4f38-9cf0-ff85bd7d3063 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">1</span>          <span class="token number">4</span>               <span class="token number">4</span>               <span class="token number">0</span>               console-consumer-03c0224d-f7a1-4f38-9cf0-ff85bd7d3063 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">4</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               console-consumer-bc1e9b4a-ebb0-4c27-8807-eac5c8fa3651 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">3</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               console-consumer-bc1e9b4a-ebb0-4c27-8807-eac5c8fa3651 /10.0.0.92      console-consumer
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">2.10</span> 在之前的2个旧的生产者的终端分别输入数据
AAAAAAAAAAAAAAAAAAAAAAAAAA

BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB


<span class="token number">2.11</span> 再次观察消费组信息
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># kafka-consumer-groups.sh   --bootstrap-server 10.0.0.91:9092 --describe --group linux94 | more </span>

GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID                                           HOST            CLIENT-ID
linux94         sy       <span class="token number">0</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               console-consumer-03c0224d-f7a1-4f38-9cf0-ff85bd7d3063 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">2</span>          <span class="token number">4</span>               <span class="token number">4</span>               <span class="token number">0</span>               console-consumer-03c0224d-f7a1-4f38-9cf0-ff85bd7d3063 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">1</span>          <span class="token number">5</span>               <span class="token number">5</span>               <span class="token number">0</span>               console-consumer-03c0224d-f7a1-4f38-9cf0-ff85bd7d3063 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">4</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               console-consumer-bc1e9b4a-ebb0-4c27-8807-eac5c8fa3651 /10.0.0.92      console-consumer
linux94         sy       <span class="token number">3</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               console-consumer-bc1e9b4a-ebb0-4c27-8807-eac5c8fa3651 /10.0.0.92      console-consumer
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>


<span class="token number">2.12</span> 后续可以重复此步骤，观察偏移量的变化情况


<span class="token number">2.13</span> 观察数据延迟
先停止所有的消费者。

<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># kafka-consumer-groups.sh   --bootstrap-server 10.0.0.91:9092 --describe --group linux94 | more </span>

Consumer group <span class="token string">'linux94'</span> has no active members.

GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
linux94         sy       <span class="token number">0</span>          <span class="token number">1</span>               <span class="token number">1</span>               <span class="token number">0</span>               -               -               -
linux94         sy       <span class="token number">4</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               -               -               -
linux94         sy       <span class="token number">3</span>          <span class="token number">1</span>               <span class="token number">1</span>               <span class="token number">0</span>               -               -               -
linux94         sy       <span class="token number">2</span>          <span class="token number">4</span>               <span class="token number">4</span>               <span class="token number">0</span>               -               -               -
linux94         sy       <span class="token number">1</span>          <span class="token number">5</span>               <span class="token number">5</span>               <span class="token number">0</span>               -               -               -
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>


再次在生产者写入测试数据：
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># kafka-consumer-groups.sh   --bootstrap-server 10.0.0.91:9092 --describe --group linux94 | more </span>

Consumer group <span class="token string">'linux94'</span> has no active members.

GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
linux94         sy       <span class="token number">0</span>          <span class="token number">1</span>               <span class="token number">6</span>               <span class="token number">5</span>               -               -               -
linux94         sy       <span class="token number">4</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               -               -               -
linux94         sy       <span class="token number">3</span>          <span class="token number">1</span>               <span class="token number">1</span>               <span class="token number">0</span>               -               -               -
linux94         sy       <span class="token number">2</span>          <span class="token number">4</span>               <span class="token number">5</span>               <span class="token number">1</span>               -               -               -
linux94         sy       <span class="token number">1</span>          <span class="token number">5</span>               <span class="token number">8</span>               <span class="token number">3</span>               -               -               -
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>



再次启动测试，发现数据被接收了:
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># kafka-console-consumer.sh --bootstrap-server 10.0.0.91:9092 --topic sy  --from-beginning --consumer-property group.id=linux94</span>
<span class="token number">11111111</span>
<span class="token number">2</span>
<span class="token number">3</span>
<span class="token number">4</span>
<span class="token number">5</span>
aaaaaaaaaaaaaaaaaaaaaaaaaaaaa
aaaaaaaaaaaaaaaaaaaaaaaaa
bbbbbbbbbbbbbbbbbbbbbbbbbb
ccccccccccccccccccccccccccccc



再次查看消费者的信息：
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># kafka-consumer-groups.sh   --bootstrap-server 10.0.0.91:9092 --describe --group linux94 | more </span>

Consumer group <span class="token string">'linux94'</span> has no active members.

GROUP           TOPIC           PARTITION  CURRENT-OFFSET  LOG-END-OFFSET  LAG             CONSUMER-ID     HOST            CLIENT-ID
linux94         sy       <span class="token number">0</span>          <span class="token number">6</span>               <span class="token number">6</span>               <span class="token number">0</span>               -               -               -
linux94         sy       <span class="token number">4</span>          <span class="token number">0</span>               <span class="token number">0</span>               <span class="token number">0</span>               -               -               -
linux94         sy       <span class="token number">3</span>          <span class="token number">1</span>               <span class="token number">1</span>               <span class="token number">0</span>               -               -               -
linux94         sy       <span class="token number">2</span>          <span class="token number">5</span>               <span class="token number">5</span>               <span class="token number">0</span>               -               -               -
linux94         sy       <span class="token number">1</span>          <span class="token number">8</span>               <span class="token number">8</span>               <span class="token number">0</span>               -               -               -
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br></div></div><h3 id="_60-kafka集群起不来的原因"><a href="#_60-kafka集群起不来的原因" class="header-anchor">#</a> 60，kafka集群起不来的原因</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>常见的问题:
    - 主机名称和笔记不一致<span class="token punctuation">;</span>
    - 执行顺序颠倒导致集群起不来<span class="token punctuation">;</span>
    - 配置hosts解析
	
	
	
- kafka集群起不来快速解决问题
- <span class="token number">1</span>.恢复快照<span class="token punctuation">;</span>
- <span class="token number">2</span>.清空数据并重启kafka<span class="token punctuation">;</span>
<span class="token number">2.1</span> 检查配置文件是否正确
主要是<span class="token string">&quot;broker.id&quot;</span>，<span class="token string">&quot;log.data&quot;</span>，<span class="token string">&quot;zookeeper&quot;</span>等<span class="token string">&quot;

[root@elk93 ~]# grep ^[a-z] /malu/softwares/kafka_2.13-3.8.1/config/server.properties 
broker.id=93
num.network.threads=3
num.io.threads=8
socket.send.buffer.bytes=102400
socket.receive.buffer.bytes=102400
socket.request.max.bytes=104857600
log.dirs=/malu/data/kafka
num.partitions=1
num.recovery.threads.per.data.dir=1
offsets.topic.replication.factor=1
transaction.state.log.replication.factor=1
transaction.state.log.min.isr=1
log.retention.hours=168
log.retention.check.interval.ms=300000
zookeeper.connect=10.0.0.91:2181,10.0.0.92:2181,10.0.0.93:2181/oldboyedu-kafka381
zookeeper.connection.timeout.ms=18000
group.initial.rebalance.delay.ms=0
[root@elk93 ~]# 
  
2.2 先所有节点停止kafka服务
kafka-server-stop.sh 
	
2.3 所有节点删除本地数据
rm -rf /malu/data/kafka/


2.4 删除zookeeper的元数据信息
使用zkWeb删除&quot;</span>/malu-kafka381&quot;即可


<span class="token number">2.5</span> 重新启动集群即可
kafka-server-start.sh <span class="token parameter variable">-daemon</span> <span class="token variable">$KAFKA_HOME</span>/config/server.properties
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div><h3 id="_61-kafka为何丢失数据"><a href="#_61-kafka为何丢失数据" class="header-anchor">#</a> 61，kafka为何丢失数据</h3> <p><img src="/devops/public/assets/img/1731500652031.cea00a2c.png" alt="1731500652031"></p> <h3 id="_62-kafka压测"><a href="#_62-kafka压测" class="header-anchor">#</a> 62，kafka压测</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>参考案例:
	https://www.cnblogs.com/yinzhengjie/p/9953212.html
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_64-filebeat写入数据到kafka集群实战"><a href="#_64-filebeat写入数据到kafka集群实战" class="header-anchor">#</a> 64，filebeat写入数据到kafka集群实战</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.编写filebeat的配置文件
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># cat 17-tcp-to-kafka.yaml </span>
filebeat.inputs:
- type: tcp
  host: <span class="token string">&quot;0.0.0.0:9000&quot;</span>


output.kafka:
  <span class="token comment"># 指定kafka的集群地址</span>
  hosts: <span class="token punctuation">[</span><span class="token string">&quot;elk91:9092&quot;</span>, <span class="token string">&quot;elk92:9092&quot;</span>, <span class="token string">&quot;elk93:9092&quot;</span><span class="token punctuation">]</span>

  <span class="token comment"># 指定写入的topic名称</span>
  topic: <span class="token string">'malu-linux94-filebeat'</span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk92 filebeat<span class="token punctuation">]</span><span class="token comment"># filebeat -e -c 17-tcp-to-kafka.yaml </span>



<span class="token number">2</span>.发送测试数据
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># echo www.xxxx.com | nc 10.0.0.92 9000</span>
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@elk93 ~<span class="token punctuation">]</span><span class="token comment"># echo 1111111111111111111111111111111111 | nc 10.0.0.92 9000</span>

	
	
<span class="token number">3</span>.查看kafka的数据
<span class="token punctuation">[</span>root@elk92 ~<span class="token punctuation">]</span><span class="token comment"># kafka-console-consumer.sh --bootstrap-server 10.0.0.91:9092 --topic malu-linux94-filebeat  --from-beginning </span>
<span class="token punctuation">{</span><span class="token string">&quot;@timestamp&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2024-11-01T08:36:47.733Z&quot;</span>,<span class="token string">&quot;@metadata&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;beat&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;filebeat&quot;</span>,<span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;_doc&quot;</span>,<span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;7.17.23&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;www.oldboyedu.com&quot;</span>,<span class="token string">&quot;log&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;source&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;address&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.0.0.93:45960&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>,<span class="token string">&quot;input&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;tcp&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;ecs&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;1.12.0&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;host&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;elk92&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;agent&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;ephemeral_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ba1b4ee9-d2dd-4d9a-a65d-8eefbe104105&quot;</span>,<span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;8c3e49f6-3d47-4c65-a0b6-ec95a28c6114&quot;</span>,<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;elk92&quot;</span>,<span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;filebeat&quot;</span>,<span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;7.17.23&quot;</span>,<span class="token string">&quot;hostname&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;elk92&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token string">&quot;@timestamp&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;2024-11-01T08:37:32.466Z&quot;</span>,<span class="token string">&quot;@metadata&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;beat&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;filebeat&quot;</span>,<span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;_doc&quot;</span>,<span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;7.17.23&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;input&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;tcp&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;ecs&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;1.12.0&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;host&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;elk92&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;agent&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;type&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;filebeat&quot;</span>,<span class="token string">&quot;version&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;7.17.23&quot;</span>,<span class="token string">&quot;hostname&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;elk92&quot;</span>,<span class="token string">&quot;ephemeral_id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;ba1b4ee9-d2dd-4d9a-a65d-8eefbe104105&quot;</span>,<span class="token string">&quot;id&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;8c3e49f6-3d47-4c65-a0b6-ec95a28c6114&quot;</span>,<span class="token string">&quot;name&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;elk92&quot;</span><span class="token punctuation">}</span>,<span class="token string">&quot;message&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;1111111111111111111111111111111111&quot;</span>,<span class="token string">&quot;log&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;source&quot;</span>:<span class="token punctuation">{</span><span class="token string">&quot;address&quot;</span><span class="token builtin class-name">:</span><span class="token string">&quot;10.0.0.93:35546&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><h3 id="_65-logstash从kafka集群拉取数据"><a href="#_65-logstash从kafka集群拉取数据" class="header-anchor">#</a> 65，logstash从kafka集群拉取数据</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.编写Logstash的配置文件
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># cat 16-kafka-to-stdout.conf</span>
input <span class="token punctuation">{</span> 
  kafka <span class="token punctuation">{</span> 
     <span class="token comment"># 指定kafka的地址</span>
     bootstrap_servers <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;10.0.0.91:9092,10.0.0.92:9092,10.0.0.93:9092&quot;</span>
     
     <span class="token comment"># 指定topic列表</span>
     topics <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token string">&quot; malu-linux94-filebeat&quot;</span><span class="token punctuation">]</span>

     <span class="token comment"># 指定消费者组</span>
     group_id <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;linux94-01&quot;</span>

     <span class="token comment"># 指定从哪里消费数据，&quot;latest&quot;表示从最新位置消费,&quot;earliest&quot;表示从头消费数据。</span>
     <span class="token comment"># 此参数仅针对消费者id首次生效，后续的offset在kafka集群中“__consumer_offsets”有记录</span>
     auto_offset_reset <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token string">&quot;earliest&quot;</span>
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>  

output <span class="token punctuation">{</span> 
  stdout <span class="token punctuation">{</span> 
    <span class="token comment"># codec =&gt; rubydebug </span>
    codec <span class="token operator">=</span><span class="token operator">&gt;</span> json
  <span class="token punctuation">}</span> 
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># </span>

<span class="token number">2</span>.启动Logstash 
<span class="token punctuation">[</span>root@elk92 conf.d<span class="token punctuation">]</span><span class="token comment"># logstash -rf 16-kafka-to-stdout.conf</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br></div></div><p><img src="/devops/public/assets/img/1731501718412.857ce4e0.png" alt="1731501718412"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>笔记:
	https://gitee.com/jasonyin2020/cloud-computing-stack/tree/linux94/linux94
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_66-扩展与面试题"><a href="#_66-扩展与面试题" class="header-anchor">#</a> 66，扩展与面试题</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Q30:你们公司是如何使用ELEK架构，数据流走向是啥?ES存储了哪些业务?

Q31:你们公司kibana都展示了哪些数据呢?
    IP
    PV
    带宽
    设备类型分析
    全球用户分布
    访问量排名
    业务访问排名
    交易额
    <span class="token punctuation">..</span>.
Q32:简单陈述下zookeeper的leader选举流程?

Q33:301和302的区别是啥，及应用场景说明?

Q34:filebeat如何采集多行数据呢?

Q35:现在3个web集群，每个nginx都的200M+的日志，想要分析最近20分钟内产生的日志，请问你该如何操作呢?
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h3 id="_67-扩展与面试题"><a href="#_67-扩展与面试题" class="header-anchor">#</a> 67，扩展与面试题</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Q36:了解过哪些MQ技术栈?你用过哪个MQ呢?

Q37:你们公司kafka集群规模多大?什么配置?每天自数据量有多少呢?

Q38:简单陈述下kafka的topic,partition,replica, isr的含义?

Q39:假设一个topic有20个paritition，一个linux94的消费者组有10个消费者，但是数据采集出现了延迟，如何解决呢?


Q40:接上一题案例，假设同一个消费者组的消费者数量达到50个会有解决延迟的问题吗?请说明原因

Q41:简单陈述下EFK架构引入kafka有哪些好处?
    <span class="token number">1</span>.降低fi1ebeat和Logstash的耦合性<span class="token punctuation">;</span>
    <span class="token number">2</span>.数据的复用性<span class="token punctuation">;</span>
    <span class="token number">3</span>.缓存数据源，避免filebeat无法采集数据的场景，可以直接先写入kafka<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_1-单机部署es" class="sidebar-link reco-side-_1-单机部署es" data-v-b57cc07c>1，单机部署ES</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_2-单节点升级为es集群" class="sidebar-link reco-side-_2-单节点升级为es集群" data-v-b57cc07c>2，单节点升级为ES集群</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_3-es常见术语" class="sidebar-link reco-side-_3-es常见术语" data-v-b57cc07c>3，ES常见术语</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_4-es的索引api管理实战" class="sidebar-link reco-side-_4-es的索引api管理实战" data-v-b57cc07c>4，ES的索引API管理实战</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_5-部署kibana软件" class="sidebar-link reco-side-_5-部署kibana软件" data-v-b57cc07c>5，部署kibana软件</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_6-扩展与面试题" class="sidebar-link reco-side-_6-扩展与面试题" data-v-b57cc07c>6，扩展与面试题**</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_7-filebeat环境搭建" class="sidebar-link reco-side-_7-filebeat环境搭建" data-v-b57cc07c>7，filebeat环境搭建</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_8-filebeat的基本使用" class="sidebar-link reco-side-_8-filebeat的基本使用" data-v-b57cc07c>8，filebeat的基本使用</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_9-filebeat采集nginx日志" class="sidebar-link reco-side-_9-filebeat采集nginx日志" data-v-b57cc07c>9，filebeat采集nginx日志</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_10-efk架构" class="sidebar-link reco-side-_10-efk架构" data-v-b57cc07c>10，EFK架构</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_11-filebeat采集tomcat" class="sidebar-link reco-side-_11-filebeat采集tomcat" data-v-b57cc07c>11，filebeat采集tomcat</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_12-filebeat写入es自定义索引" class="sidebar-link reco-side-_12-filebeat写入es自定义索引" data-v-b57cc07c>12，filebeat写入ES自定义索引</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_13-filebeat的模块处理" class="sidebar-link reco-side-_13-filebeat的模块处理" data-v-b57cc07c>13，filebeat的模块处理</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_14-常见报错" class="sidebar-link reco-side-_14-常见报错" data-v-b57cc07c>14，常见报错</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_15-案例-efk架构分析nginx日志并kibana出图展示" class="sidebar-link reco-side-_15-案例-efk架构分析nginx日志并kibana出图展示" data-v-b57cc07c>15，案例（EFK架构分析nginx日志并kibana出图展示）</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_16-filebeat多实例" class="sidebar-link reco-side-_16-filebeat多实例" data-v-b57cc07c>16，filebeat多实例</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_17-扩展与面试题" class="sidebar-link reco-side-_17-扩展与面试题" data-v-b57cc07c>17，扩展与面试题**</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_18-logstash环境搭建" class="sidebar-link reco-side-_18-logstash环境搭建" data-v-b57cc07c>18，logstash环境搭建</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_19-logstash架构" class="sidebar-link reco-side-_19-logstash架构" data-v-b57cc07c>19，logstash架构</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_20-logstash两种启动方法" class="sidebar-link reco-side-_20-logstash两种启动方法" data-v-b57cc07c>20，logstash两种启动方法</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_21-logstash采集日志" class="sidebar-link reco-side-_21-logstash采集日志" data-v-b57cc07c>21，logstash采集日志</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_22-mutate插件" class="sidebar-link reco-side-_22-mutate插件" data-v-b57cc07c>22，mutate插件</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_23-date插件" class="sidebar-link reco-side-_23-date插件" data-v-b57cc07c>23，date插件</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_24-logstash对接filebeat" class="sidebar-link reco-side-_24-logstash对接filebeat" data-v-b57cc07c>24，Logstash对接filebeat</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_25-logstash基于grok分析nginx的访问日志" class="sidebar-link reco-side-_25-logstash基于grok分析nginx的访问日志" data-v-b57cc07c>25，Logstash基于grok分析nginx的访问日志</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_26-基于geoip分析nginx的ip地址经纬度" class="sidebar-link reco-side-_26-基于geoip分析nginx的ip地址经纬度" data-v-b57cc07c>26，基于geoip分析nginx的IP地址经纬度</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_27-基于useragent分析用户的设备类型" class="sidebar-link reco-side-_27-基于useragent分析用户的设备类型" data-v-b57cc07c>27，基于useragent分析用户的设备类型</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_28-基于date分析nginx的访问时间" class="sidebar-link reco-side-_28-基于date分析nginx的访问时间" data-v-b57cc07c>28，基于date分析nginx的访问时间</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_29-将数据写入到es集群" class="sidebar-link reco-side-_29-将数据写入到es集群" data-v-b57cc07c>29，将数据写入到ES集群</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_30-扩展与面试题" class="sidebar-link reco-side-_30-扩展与面试题" data-v-b57cc07c>30，扩展与面试题**</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_31-数据映射之带宽统计案例" class="sidebar-link reco-side-_31-数据映射之带宽统计案例" data-v-b57cc07c>31，数据映射之带宽统计案例</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_32-logstash的多实例" class="sidebar-link reco-side-_32-logstash的多实例" data-v-b57cc07c>32，Logstash的多实例</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_33-logstash的if多分支语法" class="sidebar-link reco-side-_33-logstash的if多分支语法" data-v-b57cc07c>33，Logstash的if多分支语法</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_34-logstash的pipeline实战" class="sidebar-link reco-side-_34-logstash的pipeline实战" data-v-b57cc07c>34，logstash的pipeline实战</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_35-logstash自定义正则" class="sidebar-link reco-side-_35-logstash自定义正则" data-v-b57cc07c>35，logstash自定义正则</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_36-logstash的jvm优化" class="sidebar-link reco-side-_36-logstash的jvm优化" data-v-b57cc07c>36，Logstash的JVM优化</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_37-filebeat自定义nginx的json格式日志" class="sidebar-link reco-side-_37-filebeat自定义nginx的json格式日志" data-v-b57cc07c>37，filebeat自定义NGINX的JSON格式日志</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_38-配置kibana的安全认证" class="sidebar-link reco-side-_38-配置kibana的安全认证" data-v-b57cc07c>38，配置kibana的安全认证</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_39-配置kibana访问es加密集群" class="sidebar-link reco-side-_39-配置kibana访问es加密集群" data-v-b57cc07c>39，配置kibana访问ES加密集群</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_40-zabbix监控es集群-filebeat-logstash-kibana程序" class="sidebar-link reco-side-_40-zabbix监控es集群-filebeat-logstash-kibana程序" data-v-b57cc07c>40，zabbix监控ES集群，filebeat，Logstash,kibana程序</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_41-虚拟机科学上网" class="sidebar-link reco-side-_41-虚拟机科学上网" data-v-b57cc07c>41，虚拟机科学上网</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_42-扩展与面试题" class="sidebar-link reco-side-_42-扩展与面试题" data-v-b57cc07c>42，扩展与面试题**</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_43-filebeat对接es加密集群" class="sidebar-link reco-side-_43-filebeat对接es加密集群" data-v-b57cc07c>43，filebeat对接ES加密集群</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_44-logstash对接es加密集群" class="sidebar-link reco-side-_44-logstash对接es加密集群" data-v-b57cc07c>44，Logstash对接ES加密集群</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_45-kibana实现rbac" class="sidebar-link reco-side-_45-kibana实现rbac" data-v-b57cc07c>45，kibana实现RBAC</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_46-filestream输入类型采集tomcat的json格式日志" class="sidebar-link reco-side-_46-filestream输入类型采集tomcat的json格式日志" data-v-b57cc07c>46，filestream输入类型采集tomcat的JSON格式日志</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_47-filebeat的多行处理采集tomcat错误日志案例" class="sidebar-link reco-side-_47-filebeat的多行处理采集tomcat错误日志案例" data-v-b57cc07c>47，filebeat的多行处理采集tomcat错误日志案例</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_48-多行匹配按行数匹配案例" class="sidebar-link reco-side-_48-多行匹配按行数匹配案例" data-v-b57cc07c>48，多行匹配按行数匹配案例</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_49-elasticsearch的jvm调优" class="sidebar-link reco-side-_49-elasticsearch的jvm调优" data-v-b57cc07c>49，elasticsearch的JVM调优</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_50-zookeeper单点部署" class="sidebar-link reco-side-_50-zookeeper单点部署" data-v-b57cc07c>50，zookeeper单点部署</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_51-zookeeper集群搭建" class="sidebar-link reco-side-_51-zookeeper集群搭建" data-v-b57cc07c>51，zookeeper集群搭建</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_52-zookeeper的使用" class="sidebar-link reco-side-_52-zookeeper的使用" data-v-b57cc07c>52，zookeeper的使用</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_52-zookeeper的watch机制-了解-和图形化管理" class="sidebar-link reco-side-_52-zookeeper的watch机制-了解-和图形化管理" data-v-b57cc07c>52，zookeeper的watch机制(了解)和图形化管理</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_53-zookeeper的jvm配置" class="sidebar-link reco-side-_53-zookeeper的jvm配置" data-v-b57cc07c>53，zookeeper的JVM配置</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_54-常见的mq对比" class="sidebar-link reco-side-_54-常见的mq对比" data-v-b57cc07c>54，常见的MQ对比</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_55-kafka单点部署" class="sidebar-link reco-side-_55-kafka单点部署" data-v-b57cc07c>55，kafka单点部署</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_56-kafka集群环境搭建" class="sidebar-link reco-side-_56-kafka集群环境搭建" data-v-b57cc07c>56，kafka集群环境搭建</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_57-kafka常见术语" class="sidebar-link reco-side-_57-kafka常见术语" data-v-b57cc07c>57，kafka常见术语</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_58-topic管理" class="sidebar-link reco-side-_58-topic管理" data-v-b57cc07c>58，topic管理</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_58-生产者和消费者案例" class="sidebar-link reco-side-_58-生产者和消费者案例" data-v-b57cc07c>58，生产者和消费者案例</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_59-消费者组-扩展" class="sidebar-link reco-side-_59-消费者组-扩展" data-v-b57cc07c>59，消费者组(扩展)</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_60-kafka集群起不来的原因" class="sidebar-link reco-side-_60-kafka集群起不来的原因" data-v-b57cc07c>60，kafka集群起不来的原因</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_61-kafka为何丢失数据" class="sidebar-link reco-side-_61-kafka为何丢失数据" data-v-b57cc07c>61，kafka为何丢失数据</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_62-kafka压测" class="sidebar-link reco-side-_62-kafka压测" data-v-b57cc07c>62，kafka压测</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_64-filebeat写入数据到kafka集群实战" class="sidebar-link reco-side-_64-filebeat写入数据到kafka集群实战" data-v-b57cc07c>64，filebeat写入数据到kafka集群实战</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_65-logstash从kafka集群拉取数据" class="sidebar-link reco-side-_65-logstash从kafka集群拉取数据" data-v-b57cc07c>65，logstash从kafka集群拉取数据</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_66-扩展与面试题" class="sidebar-link reco-side-_66-扩展与面试题" data-v-b57cc07c>66，扩展与面试题</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/45-elk/elk.html#_67-扩展与面试题" class="sidebar-link reco-side-_67-扩展与面试题" data-v-b57cc07c>67，扩展与面试题</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/devops/public/assets/js/app.7d569ec8.js" defer></script><script src="/devops/public/assets/js/118.ceed6ab6.js" defer></script><script src="/devops/public/assets/js/1.774fca24.js" defer></script><script src="/devops/public/assets/js/101.4f407383.js" defer></script>
  </body>
</html>
