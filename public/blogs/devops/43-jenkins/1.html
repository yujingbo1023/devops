<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一，线上发布流程 | devops</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/devops/public/favicon.ico">
    <meta name="description" content="快来玩devops">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/devops/public/assets/css/0.styles.4a69f283.css" as="style"><link rel="preload" href="/devops/public/assets/js/app.5825cff9.js" as="script"><link rel="preload" href="/devops/public/assets/js/113.2f71a2bc.js" as="script"><link rel="preload" href="/devops/public/assets/js/1.774fca24.js" as="script"><link rel="preload" href="/devops/public/assets/js/46.8368b159.js" as="script"><link rel="prefetch" href="/devops/public/assets/js/10.4da19cb5.js"><link rel="prefetch" href="/devops/public/assets/js/100.bbba7404.js"><link rel="prefetch" href="/devops/public/assets/js/101.639eefc9.js"><link rel="prefetch" href="/devops/public/assets/js/102.d4bd7c20.js"><link rel="prefetch" href="/devops/public/assets/js/103.5b09b74b.js"><link rel="prefetch" href="/devops/public/assets/js/104.d433eb7f.js"><link rel="prefetch" href="/devops/public/assets/js/105.2ec6002e.js"><link rel="prefetch" href="/devops/public/assets/js/106.ebe3f9be.js"><link rel="prefetch" href="/devops/public/assets/js/107.5430f265.js"><link rel="prefetch" href="/devops/public/assets/js/108.926bc99d.js"><link rel="prefetch" href="/devops/public/assets/js/109.9d522bf4.js"><link rel="prefetch" href="/devops/public/assets/js/11.2942e201.js"><link rel="prefetch" href="/devops/public/assets/js/110.e08bfd30.js"><link rel="prefetch" href="/devops/public/assets/js/111.5f88b202.js"><link rel="prefetch" href="/devops/public/assets/js/112.ca730c43.js"><link rel="prefetch" href="/devops/public/assets/js/114.f326ec9a.js"><link rel="prefetch" href="/devops/public/assets/js/115.8296a9c2.js"><link rel="prefetch" href="/devops/public/assets/js/116.a319c796.js"><link rel="prefetch" href="/devops/public/assets/js/117.0aaa6551.js"><link rel="prefetch" href="/devops/public/assets/js/118.cdc51977.js"><link rel="prefetch" href="/devops/public/assets/js/119.3d572e24.js"><link rel="prefetch" href="/devops/public/assets/js/12.40b6e2ae.js"><link rel="prefetch" href="/devops/public/assets/js/120.e63dbce1.js"><link rel="prefetch" href="/devops/public/assets/js/121.84af7eeb.js"><link rel="prefetch" href="/devops/public/assets/js/122.9f5eb9ab.js"><link rel="prefetch" href="/devops/public/assets/js/123.4bc47ab1.js"><link rel="prefetch" href="/devops/public/assets/js/124.425c0443.js"><link rel="prefetch" href="/devops/public/assets/js/125.448d8d46.js"><link rel="prefetch" href="/devops/public/assets/js/126.0e917f73.js"><link rel="prefetch" href="/devops/public/assets/js/127.d56bb020.js"><link rel="prefetch" href="/devops/public/assets/js/128.cdf4c71a.js"><link rel="prefetch" href="/devops/public/assets/js/129.b020e6f9.js"><link rel="prefetch" href="/devops/public/assets/js/13.19ff0e37.js"><link rel="prefetch" href="/devops/public/assets/js/130.e5476d9a.js"><link rel="prefetch" href="/devops/public/assets/js/131.df2f9c72.js"><link rel="prefetch" href="/devops/public/assets/js/132.02667eb4.js"><link rel="prefetch" href="/devops/public/assets/js/133.0432cad1.js"><link rel="prefetch" href="/devops/public/assets/js/134.b216bd39.js"><link rel="prefetch" href="/devops/public/assets/js/135.ef2e3bf9.js"><link rel="prefetch" href="/devops/public/assets/js/136.75976e52.js"><link rel="prefetch" href="/devops/public/assets/js/137.73c7c9a1.js"><link rel="prefetch" href="/devops/public/assets/js/138.5001691b.js"><link rel="prefetch" href="/devops/public/assets/js/139.a582a594.js"><link rel="prefetch" href="/devops/public/assets/js/14.f248a219.js"><link rel="prefetch" href="/devops/public/assets/js/140.a6fdda38.js"><link rel="prefetch" href="/devops/public/assets/js/141.7b3e148c.js"><link rel="prefetch" href="/devops/public/assets/js/142.e85c7899.js"><link rel="prefetch" href="/devops/public/assets/js/143.9b145154.js"><link rel="prefetch" href="/devops/public/assets/js/144.f749ba37.js"><link rel="prefetch" href="/devops/public/assets/js/145.e5a9047d.js"><link rel="prefetch" href="/devops/public/assets/js/146.e3a150c2.js"><link rel="prefetch" href="/devops/public/assets/js/147.4a3759fd.js"><link rel="prefetch" href="/devops/public/assets/js/148.c937eb65.js"><link rel="prefetch" href="/devops/public/assets/js/149.4c7277fa.js"><link rel="prefetch" href="/devops/public/assets/js/15.a088b999.js"><link rel="prefetch" href="/devops/public/assets/js/150.2192b064.js"><link rel="prefetch" href="/devops/public/assets/js/151.faa54761.js"><link rel="prefetch" href="/devops/public/assets/js/152.8bff3d58.js"><link rel="prefetch" href="/devops/public/assets/js/153.a39e8324.js"><link rel="prefetch" href="/devops/public/assets/js/154.742d3624.js"><link rel="prefetch" href="/devops/public/assets/js/155.2566a8d6.js"><link rel="prefetch" href="/devops/public/assets/js/156.96e10476.js"><link rel="prefetch" href="/devops/public/assets/js/157.789457c1.js"><link rel="prefetch" href="/devops/public/assets/js/158.543aa74d.js"><link rel="prefetch" href="/devops/public/assets/js/159.afb1cf83.js"><link rel="prefetch" href="/devops/public/assets/js/16.0d9934f1.js"><link rel="prefetch" href="/devops/public/assets/js/160.d11fc47d.js"><link rel="prefetch" href="/devops/public/assets/js/161.68085c48.js"><link rel="prefetch" href="/devops/public/assets/js/162.4d4733a7.js"><link rel="prefetch" href="/devops/public/assets/js/163.1459f57a.js"><link rel="prefetch" href="/devops/public/assets/js/164.af88778b.js"><link rel="prefetch" href="/devops/public/assets/js/165.f90528f0.js"><link rel="prefetch" href="/devops/public/assets/js/166.e528f5b0.js"><link rel="prefetch" href="/devops/public/assets/js/167.30efb17e.js"><link rel="prefetch" href="/devops/public/assets/js/168.2f0790ec.js"><link rel="prefetch" href="/devops/public/assets/js/169.372f977f.js"><link rel="prefetch" href="/devops/public/assets/js/17.5fe17218.js"><link rel="prefetch" href="/devops/public/assets/js/170.22dda53f.js"><link rel="prefetch" href="/devops/public/assets/js/171.50da113a.js"><link rel="prefetch" href="/devops/public/assets/js/172.4a3784f3.js"><link rel="prefetch" href="/devops/public/assets/js/173.0ab8bd81.js"><link rel="prefetch" href="/devops/public/assets/js/174.4cbd19fe.js"><link rel="prefetch" href="/devops/public/assets/js/175.f4f007f7.js"><link rel="prefetch" href="/devops/public/assets/js/176.02b476b0.js"><link rel="prefetch" href="/devops/public/assets/js/177.3dbc9c3c.js"><link rel="prefetch" href="/devops/public/assets/js/178.9ca0661f.js"><link rel="prefetch" href="/devops/public/assets/js/179.c9ed62d7.js"><link rel="prefetch" href="/devops/public/assets/js/18.db5f4615.js"><link rel="prefetch" href="/devops/public/assets/js/180.e1cd432d.js"><link rel="prefetch" href="/devops/public/assets/js/181.ed361ef3.js"><link rel="prefetch" href="/devops/public/assets/js/182.e5e67f9c.js"><link rel="prefetch" href="/devops/public/assets/js/183.c4d604ad.js"><link rel="prefetch" href="/devops/public/assets/js/184.7ca07d6c.js"><link rel="prefetch" href="/devops/public/assets/js/185.e5907f93.js"><link rel="prefetch" href="/devops/public/assets/js/186.a992f87b.js"><link rel="prefetch" href="/devops/public/assets/js/187.938c4584.js"><link rel="prefetch" href="/devops/public/assets/js/188.39ad7861.js"><link rel="prefetch" href="/devops/public/assets/js/189.79618cb6.js"><link rel="prefetch" href="/devops/public/assets/js/19.8b63e315.js"><link rel="prefetch" href="/devops/public/assets/js/190.cdee4b88.js"><link rel="prefetch" href="/devops/public/assets/js/191.d8e36956.js"><link rel="prefetch" href="/devops/public/assets/js/192.a7d92fb4.js"><link rel="prefetch" href="/devops/public/assets/js/193.1d1b97f5.js"><link rel="prefetch" href="/devops/public/assets/js/194.caab0079.js"><link rel="prefetch" href="/devops/public/assets/js/195.66c16643.js"><link rel="prefetch" href="/devops/public/assets/js/196.6c2fbf22.js"><link rel="prefetch" href="/devops/public/assets/js/197.4aaf761f.js"><link rel="prefetch" href="/devops/public/assets/js/198.2cf0f907.js"><link rel="prefetch" href="/devops/public/assets/js/199.b0ed054b.js"><link rel="prefetch" href="/devops/public/assets/js/20.f6db8c9e.js"><link rel="prefetch" href="/devops/public/assets/js/200.b0217582.js"><link rel="prefetch" href="/devops/public/assets/js/201.1d5eeee9.js"><link rel="prefetch" href="/devops/public/assets/js/202.552095ca.js"><link rel="prefetch" href="/devops/public/assets/js/203.c02af648.js"><link rel="prefetch" href="/devops/public/assets/js/204.ecd5b121.js"><link rel="prefetch" href="/devops/public/assets/js/205.aae12631.js"><link rel="prefetch" href="/devops/public/assets/js/206.30947e5f.js"><link rel="prefetch" href="/devops/public/assets/js/207.975516e6.js"><link rel="prefetch" href="/devops/public/assets/js/208.53f42b19.js"><link rel="prefetch" href="/devops/public/assets/js/209.5db96a62.js"><link rel="prefetch" href="/devops/public/assets/js/21.4b22d1e5.js"><link rel="prefetch" href="/devops/public/assets/js/210.53c76907.js"><link rel="prefetch" href="/devops/public/assets/js/211.5f627b59.js"><link rel="prefetch" href="/devops/public/assets/js/212.ecf1b0e6.js"><link rel="prefetch" href="/devops/public/assets/js/213.8e7cb1bd.js"><link rel="prefetch" href="/devops/public/assets/js/214.ed34c0e4.js"><link rel="prefetch" href="/devops/public/assets/js/215.186eaa4f.js"><link rel="prefetch" href="/devops/public/assets/js/216.ab54cc52.js"><link rel="prefetch" href="/devops/public/assets/js/217.23915005.js"><link rel="prefetch" href="/devops/public/assets/js/218.c0560695.js"><link rel="prefetch" href="/devops/public/assets/js/219.b2cfda52.js"><link rel="prefetch" href="/devops/public/assets/js/22.0c7f6537.js"><link rel="prefetch" href="/devops/public/assets/js/220.051e75db.js"><link rel="prefetch" href="/devops/public/assets/js/221.9ee65b3d.js"><link rel="prefetch" href="/devops/public/assets/js/222.251e5b74.js"><link rel="prefetch" href="/devops/public/assets/js/223.a23e49e4.js"><link rel="prefetch" href="/devops/public/assets/js/224.7b9de25a.js"><link rel="prefetch" href="/devops/public/assets/js/225.b2e6949a.js"><link rel="prefetch" href="/devops/public/assets/js/226.9a999711.js"><link rel="prefetch" href="/devops/public/assets/js/227.86062e4b.js"><link rel="prefetch" href="/devops/public/assets/js/228.1ba6d2b4.js"><link rel="prefetch" href="/devops/public/assets/js/229.21562b32.js"><link rel="prefetch" href="/devops/public/assets/js/23.0808e8c1.js"><link rel="prefetch" href="/devops/public/assets/js/230.65c5474b.js"><link rel="prefetch" href="/devops/public/assets/js/231.dd279d2f.js"><link rel="prefetch" href="/devops/public/assets/js/232.dbf7160b.js"><link rel="prefetch" href="/devops/public/assets/js/233.4c5d241c.js"><link rel="prefetch" href="/devops/public/assets/js/234.33fab0be.js"><link rel="prefetch" href="/devops/public/assets/js/235.9f9263bf.js"><link rel="prefetch" href="/devops/public/assets/js/236.b23af8d9.js"><link rel="prefetch" href="/devops/public/assets/js/237.8ac4091e.js"><link rel="prefetch" href="/devops/public/assets/js/238.f1970e0f.js"><link rel="prefetch" href="/devops/public/assets/js/239.c940fc58.js"><link rel="prefetch" href="/devops/public/assets/js/24.6c65bc57.js"><link rel="prefetch" href="/devops/public/assets/js/240.49a7b890.js"><link rel="prefetch" href="/devops/public/assets/js/241.9e02b296.js"><link rel="prefetch" href="/devops/public/assets/js/242.0601c484.js"><link rel="prefetch" href="/devops/public/assets/js/243.b8f96062.js"><link rel="prefetch" href="/devops/public/assets/js/244.7fe9c17f.js"><link rel="prefetch" href="/devops/public/assets/js/245.cd619c39.js"><link rel="prefetch" href="/devops/public/assets/js/246.400d6277.js"><link rel="prefetch" href="/devops/public/assets/js/247.b7150aea.js"><link rel="prefetch" href="/devops/public/assets/js/248.eadd3b79.js"><link rel="prefetch" href="/devops/public/assets/js/249.0157c75e.js"><link rel="prefetch" href="/devops/public/assets/js/25.0bd47b72.js"><link rel="prefetch" href="/devops/public/assets/js/250.b5a5964d.js"><link rel="prefetch" href="/devops/public/assets/js/251.53b0d8dd.js"><link rel="prefetch" href="/devops/public/assets/js/252.15cff207.js"><link rel="prefetch" href="/devops/public/assets/js/253.cdc27e5e.js"><link rel="prefetch" href="/devops/public/assets/js/254.192b5df0.js"><link rel="prefetch" href="/devops/public/assets/js/255.37f28525.js"><link rel="prefetch" href="/devops/public/assets/js/256.df0f9287.js"><link rel="prefetch" href="/devops/public/assets/js/257.f8e9cfd7.js"><link rel="prefetch" href="/devops/public/assets/js/26.35c553a0.js"><link rel="prefetch" href="/devops/public/assets/js/27.58296125.js"><link rel="prefetch" href="/devops/public/assets/js/28.2f944e5a.js"><link rel="prefetch" href="/devops/public/assets/js/29.a2a98aa2.js"><link rel="prefetch" href="/devops/public/assets/js/3.34eb11b1.js"><link rel="prefetch" href="/devops/public/assets/js/30.5453ef8f.js"><link rel="prefetch" href="/devops/public/assets/js/31.9b77b69c.js"><link rel="prefetch" href="/devops/public/assets/js/32.4825fbea.js"><link rel="prefetch" href="/devops/public/assets/js/33.c390335b.js"><link rel="prefetch" href="/devops/public/assets/js/34.14d4f1be.js"><link rel="prefetch" href="/devops/public/assets/js/35.e531e3c0.js"><link rel="prefetch" href="/devops/public/assets/js/36.9bc1bacc.js"><link rel="prefetch" href="/devops/public/assets/js/37.0f53acf8.js"><link rel="prefetch" href="/devops/public/assets/js/38.91acdbcb.js"><link rel="prefetch" href="/devops/public/assets/js/39.85802f01.js"><link rel="prefetch" href="/devops/public/assets/js/4.1fd2fdb5.js"><link rel="prefetch" href="/devops/public/assets/js/40.2c002e71.js"><link rel="prefetch" href="/devops/public/assets/js/41.cd4bdd2d.js"><link rel="prefetch" href="/devops/public/assets/js/42.26a4fe54.js"><link rel="prefetch" href="/devops/public/assets/js/43.7116914a.js"><link rel="prefetch" href="/devops/public/assets/js/44.0c2c15b8.js"><link rel="prefetch" href="/devops/public/assets/js/45.2abc19b6.js"><link rel="prefetch" href="/devops/public/assets/js/47.140e61e1.js"><link rel="prefetch" href="/devops/public/assets/js/48.6cd060f9.js"><link rel="prefetch" href="/devops/public/assets/js/49.5d5ca41c.js"><link rel="prefetch" href="/devops/public/assets/js/5.a90fcb6b.js"><link rel="prefetch" href="/devops/public/assets/js/50.d63f3c8c.js"><link rel="prefetch" href="/devops/public/assets/js/51.d4122a4d.js"><link rel="prefetch" href="/devops/public/assets/js/52.e1fec5e3.js"><link rel="prefetch" href="/devops/public/assets/js/53.9670f5e6.js"><link rel="prefetch" href="/devops/public/assets/js/54.b7dfc65c.js"><link rel="prefetch" href="/devops/public/assets/js/55.c8f48aa2.js"><link rel="prefetch" href="/devops/public/assets/js/56.d643bca1.js"><link rel="prefetch" href="/devops/public/assets/js/57.2801576d.js"><link rel="prefetch" href="/devops/public/assets/js/58.5304e194.js"><link rel="prefetch" href="/devops/public/assets/js/59.877539e5.js"><link rel="prefetch" href="/devops/public/assets/js/6.8288c75c.js"><link rel="prefetch" href="/devops/public/assets/js/60.e2908ba7.js"><link rel="prefetch" href="/devops/public/assets/js/61.2fb56d6b.js"><link rel="prefetch" href="/devops/public/assets/js/62.1ac6f2a8.js"><link rel="prefetch" href="/devops/public/assets/js/63.b8e12589.js"><link rel="prefetch" href="/devops/public/assets/js/64.c0432fde.js"><link rel="prefetch" href="/devops/public/assets/js/65.ccf81088.js"><link rel="prefetch" href="/devops/public/assets/js/66.0e05e5ba.js"><link rel="prefetch" href="/devops/public/assets/js/67.9954a7f2.js"><link rel="prefetch" href="/devops/public/assets/js/68.327e9900.js"><link rel="prefetch" href="/devops/public/assets/js/69.6efd4d3d.js"><link rel="prefetch" href="/devops/public/assets/js/7.08e4ee8c.js"><link rel="prefetch" href="/devops/public/assets/js/70.01768eb3.js"><link rel="prefetch" href="/devops/public/assets/js/71.96b53d33.js"><link rel="prefetch" href="/devops/public/assets/js/72.23fb881c.js"><link rel="prefetch" href="/devops/public/assets/js/73.46788df2.js"><link rel="prefetch" href="/devops/public/assets/js/74.bf4e2788.js"><link rel="prefetch" href="/devops/public/assets/js/75.38bb6c74.js"><link rel="prefetch" href="/devops/public/assets/js/76.cc745417.js"><link rel="prefetch" href="/devops/public/assets/js/77.9b1c7581.js"><link rel="prefetch" href="/devops/public/assets/js/78.8da7267c.js"><link rel="prefetch" href="/devops/public/assets/js/79.1d6b0822.js"><link rel="prefetch" href="/devops/public/assets/js/8.7d3e31a7.js"><link rel="prefetch" href="/devops/public/assets/js/80.080a771e.js"><link rel="prefetch" href="/devops/public/assets/js/81.dddabd25.js"><link rel="prefetch" href="/devops/public/assets/js/82.8f766d2b.js"><link rel="prefetch" href="/devops/public/assets/js/83.1b1ea4e5.js"><link rel="prefetch" href="/devops/public/assets/js/84.450e5f6f.js"><link rel="prefetch" href="/devops/public/assets/js/85.cd47d195.js"><link rel="prefetch" href="/devops/public/assets/js/86.c8d0c479.js"><link rel="prefetch" href="/devops/public/assets/js/87.3a16dafb.js"><link rel="prefetch" href="/devops/public/assets/js/88.3512bc9b.js"><link rel="prefetch" href="/devops/public/assets/js/89.f8082a19.js"><link rel="prefetch" href="/devops/public/assets/js/9.f6097e11.js"><link rel="prefetch" href="/devops/public/assets/js/90.83c37b49.js"><link rel="prefetch" href="/devops/public/assets/js/91.6a1ba0b9.js"><link rel="prefetch" href="/devops/public/assets/js/92.798df04e.js"><link rel="prefetch" href="/devops/public/assets/js/93.fb9d290b.js"><link rel="prefetch" href="/devops/public/assets/js/94.4b02b73a.js"><link rel="prefetch" href="/devops/public/assets/js/95.5b0d9879.js"><link rel="prefetch" href="/devops/public/assets/js/96.39fa603e.js"><link rel="prefetch" href="/devops/public/assets/js/97.9d9b34a7.js"><link rel="prefetch" href="/devops/public/assets/js/98.7bb39cc0.js"><link rel="prefetch" href="/devops/public/assets/js/99.4d52d3be.js">
    <link rel="stylesheet" href="/devops/public/assets/css/0.styles.4a69f283.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>devops</h3> <p class="description" data-v-59e6cb88>快来玩devops</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>devops</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/devops/public/" class="home-link router-link-active"><img src="/devops/public/logo.png" alt="devops" class="logo"> <span class="site-name">devops</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/devops/public/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      devops
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/public/categories/HarmonyOS/" class="nav-link"><i class="undefined"></i>
  HarmonyOS
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/base/" class="nav-link"><i class="undefined"></i>
  base
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/data analysis/" class="nav-link"><i class="undefined"></i>
  data analysis
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/devops/" class="nav-link"><i class="undefined"></i>
  devops
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/每日一题/" class="nav-link"><i class="undefined"></i>
  每日一题
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/javabase/" class="nav-link"><i class="undefined"></i>
  javabase
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/javaweb/" class="nav-link"><i class="undefined"></i>
  javaweb
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/linux/" class="nav-link"><i class="undefined"></i>
  linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/pybase/" class="nav-link"><i class="undefined"></i>
  pybase
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/springcloud/" class="nav-link"><i class="undefined"></i>
  springcloud
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/spider/" class="nav-link"><i class="undefined"></i>
  spider
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/springcloudalibaba/" class="nav-link"><i class="undefined"></i>
  springcloudalibaba
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/ssm/" class="nav-link"><i class="undefined"></i>
  ssm
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/storage/" class="nav-link"><i class="undefined"></i>
  storage
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/zhifu/" class="nav-link"><i class="undefined"></i>
  zhifu
</a></li></ul></div></div><div class="nav-item"><a href="/devops/public/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/devops/public/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/public/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/devops/public/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    devops
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>232</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>43</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/devops/public/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      devops
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/public/categories/HarmonyOS/" class="nav-link"><i class="undefined"></i>
  HarmonyOS
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/base/" class="nav-link"><i class="undefined"></i>
  base
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/data analysis/" class="nav-link"><i class="undefined"></i>
  data analysis
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/devops/" class="nav-link"><i class="undefined"></i>
  devops
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/每日一题/" class="nav-link"><i class="undefined"></i>
  每日一题
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/javabase/" class="nav-link"><i class="undefined"></i>
  javabase
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/javaweb/" class="nav-link"><i class="undefined"></i>
  javaweb
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/linux/" class="nav-link"><i class="undefined"></i>
  linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/pybase/" class="nav-link"><i class="undefined"></i>
  pybase
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/springcloud/" class="nav-link"><i class="undefined"></i>
  springcloud
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/spider/" class="nav-link"><i class="undefined"></i>
  spider
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/springcloudalibaba/" class="nav-link"><i class="undefined"></i>
  springcloudalibaba
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/ssm/" class="nav-link"><i class="undefined"></i>
  ssm
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/storage/" class="nav-link"><i class="undefined"></i>
  storage
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/zhifu/" class="nav-link"><i class="undefined"></i>
  zhifu
</a></li></ul></div></div><div class="nav-item"><a href="/devops/public/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/devops/public/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/public/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88></h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>devops</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">一，线上发布流程</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>devops</span></i> <!----> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h2 id="一-线上发布流程"><a href="#一-线上发布流程" class="header-anchor">#</a> 一，线上发布流程</h2> <p><img src="/devops/public/assets/img/1728520422002.aaaf8c2f.png" alt="1728520422002"></p> <h3 id="_1-配置jenkins获取gitlab中所有的版本"><a href="#_1-配置jenkins获取gitlab中所有的版本" class="header-anchor">#</a> 1，配置jenkins获取gitlab中所有的版本</h3> <p>新建一个项目：</p> <p><img src="/devops/public/assets/img/1728523717303.584e84f8.png" alt="1728523717303"></p> <p><img src="/devops/public/assets/img/1728523778946.b6b977f4.png" alt="1728523778946"></p> <p><img src="/devops/public/assets/img/1728523914475.90533760.png" alt="1728523914475"></p> <p><img src="/devops/public/assets/img/1728524009382.5dc64f51.png" alt="1728524009382"></p> <p><img src="/devops/public/assets/img/1728524039158.61a18a5b.png" alt="1728524039158"></p> <p>loader拉取最新的代码：</p> <p><img src="/devops/public/assets/img/1728524645928.756c0f10.png" alt="1728524645928"></p> <p>把当前的版本打上tag</p> <p><img src="/devops/public/assets/img/1728524710633.3b7f29a6.png" alt="1728524710633"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>malu@malu:~/game$ <span class="token function">git</span> tag <span class="token parameter variable">-a</span> v4.0 <span class="token parameter variable">-m</span> <span class="token string">&quot;v4.0稳定版本&quot;</span>
malu@malu:~/game$ <span class="token function">git</span> push <span class="token parameter variable">-u</span> origin v4.0
Enumerating objects: <span class="token number">9</span>, done.
Counting objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">9</span>/9<span class="token punctuation">)</span>, done.
Delta compression using up to <span class="token number">2</span> threads
Compressing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">5</span>/5<span class="token punctuation">)</span>, done.
Writing objects: <span class="token number">100</span>% <span class="token punctuation">(</span><span class="token number">5</span>/5<span class="token punctuation">)</span>, <span class="token number">606</span> bytes <span class="token operator">|</span> <span class="token number">606.00</span> KiB/s, done.
Total <span class="token number">5</span> <span class="token punctuation">(</span>delta <span class="token number">2</span><span class="token punctuation">)</span>, reused <span class="token number">0</span> <span class="token punctuation">(</span>delta <span class="token number">0</span><span class="token punctuation">)</span>, pack-reused <span class="token number">0</span>
To <span class="token number">10.0</span>.0.201:malu/game.git
 * <span class="token punctuation">[</span>new tag<span class="token punctuation">]</span>         v4.0 -<span class="token operator">&gt;</span> v4.0
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>看一下gitlab上有没有这个标签：</p> <p><img src="/devops/public/assets/img/1728524767084.98382b6d.png" alt="1728524767084"></p> <p>回到jenkins上：</p> <p><img src="/devops/public/assets/img/1728524870302.37411084.png" alt="1728524870302"></p> <p>点击v4.0，此时git_version这个变量的值就是v4.0，点击开始构建，那么jenkins就去拉取v4.0版本的代码：</p> <p><img src="/devops/public/assets/img/1728524959310.ee9ede97.png" alt="1728524959310"></p> <p><img src="/devops/public/assets/img/1728524972769.3431c013.png" alt="1728524972769"></p> <p><img src="/devops/public/assets/img/1728525041338.af03ea6b.png" alt="1728525041338"></p> <p>让leader再发发一个版本：</p> <p><img src="/devops/public/assets/img/1728525069901.9e6abaae.png" alt="1728525069901"></p> <p><img src="/devops/public/assets/img/1728525184323.264cf02f.png" alt="1728525184323"></p> <p>看一下远程仓库：</p> <p><img src="/devops/public/assets/img/1728525208909.e686d6b4.png" alt="1728525208909"></p> <p>回到jenkins:</p> <p><img src="/devops/public/assets/img/1728525246651.8a388fe8.png" alt="1728525246651"></p> <p>看一下，是否拉取的是4.1版本的代码：</p> <p><img src="/devops/public/assets/img/1728525304457.5a3783c9.png" alt="1728525304457"></p> <p>现在如果要重新拉取v4.0版本的代码，测试如下：</p> <p><img src="/devops/public/assets/img/1728525939486.def0359e.png" alt="1728525939486"></p> <p>查看：</p> <p><img src="/devops/public/assets/img/1728525962796.2d4db962.png" alt="1728525962796"></p> <p>原因是有个地方没有写对：</p> <p><img src="/devops/public/assets/img/1728526077549.ba4375f6.png" alt="1728526077549"></p> <p>写完后，再次测试：</p> <p><img src="/devops/public/assets/img/1728526104992.582424c3.png" alt="1728526104992"></p> <p><img src="/devops/public/assets/img/1728526125547.af0c277e.png" alt="1728526125547"></p> <h3 id="_2-让web02充当生产环境"><a href="#_2-让web02充当生产环境" class="header-anchor">#</a> 2，让web02充当生产环境</h3> <p><img src="/devops/public/assets/img/1728525452844.1c5d9fe8.png" alt="1728525452844"></p> <p><img src="/devops/public/assets/img/1728525607989.cdcdfea7.png" alt="1728525607989"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@web02-8:conf.d<span class="token punctuation">]</span><span class="token comment">#cat wordpress.conf </span>
server <span class="token punctuation">{</span>
        listen <span class="token number">80</span><span class="token punctuation">;</span>
        server_name _<span class="token punctuation">;</span>
        root /code/game<span class="token punctuation">;</span>

        location / <span class="token punctuation">{</span>
                index index.html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      
<span class="token punctuation">}</span>
<span class="token punctuation">[</span>root@web02-8:conf.d<span class="token punctuation">]</span><span class="token comment">#nginx -t</span>
nginx: the configuration <span class="token function">file</span> /etc/nginx/nginx.conf syntax is ok
nginx: configuration <span class="token function">file</span> /etc/nginx/nginx.conf <span class="token builtin class-name">test</span> is successful
<span class="token punctuation">[</span>root@web02-8:conf.d<span class="token punctuation">]</span><span class="token comment">#systemctl restart nginx</span>

jenkins和web02做免秘钥：
root@jenkins:deploy_game<span class="token punctuation">]</span><span class="token comment">#ssh-copy-id 10.0.0.8</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="_3-发版"><a href="#_3-发版" class="header-anchor">#</a> 3，发版</h3> <p><img src="/devops/public/assets/img/1728528312694.26b3a94a.png" alt="1728528312694"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> zcvf /opt/web.tar.gz ./*
<span class="token function">scp</span> /opt/web.tar.gz <span class="token number">10.0</span>.0.8:/code/
<span class="token function">ssh</span> <span class="token number">10.0</span>.0.8 <span class="token string">&quot;mkdir -p /code/web_code_<span class="token variable">$git_version</span>&quot;</span>
<span class="token function">ssh</span> <span class="token number">10.0</span>.0.8 <span class="token string">&quot;cd /code; tar xf web.tar.gz -C web_code_<span class="token variable">$git_version</span> &amp;&amp; rm -rf web.tar.gz&quot;</span>
<span class="token function">ssh</span> <span class="token number">10.0</span>.0.8 <span class="token string">&quot;rm -rf /code/game &amp;&amp; ln -s /code/web_code_<span class="token variable">$git_version</span> /code/game&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>测试：</p> <p><img src="/devops/public/assets/img/1728528368347.83b95738.png" alt="1728528368347"></p> <p><img src="/devops/public/assets/img/1728528377468.760428d0.png" alt="1728528377468"></p> <h3 id="_4-配置代码回滚"><a href="#_4-配置代码回滚" class="header-anchor">#</a> 4，配置代码回滚</h3> <p><img src="/devops/public/assets/img/1728528497163.2dea47ff.png" alt="1728528497163"></p> <p>配置一个菜单，让用户可以选择是部署新的版本还是回滚。</p> <p><img src="/devops/public/assets/img/1728528624738.5a294aec.png" alt="1728528624738"></p> <p><img src="/devops/public/assets/img/1728528719552.513763a7.png" alt="1728528719552"></p> <p><img src="/devops/public/assets/img/1728528821738.d4200df8.png" alt="1728528821738"></p> <p>看一下之前写的脚本：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">tar</span> zcvf /opt/web.tar.gz ./*
<span class="token function">scp</span> /opt/web.tar.gz <span class="token number">10.0</span>.0.8:/code/
<span class="token function">ssh</span> <span class="token number">10.0</span>.0.8 <span class="token string">&quot;mkdir -p /code/web_code_<span class="token variable">$git_version</span>&quot;</span>
<span class="token function">ssh</span> <span class="token number">10.0</span>.0.8 <span class="token string">&quot;cd /code; tar xf web.tar.gz -C web_code_<span class="token variable">$git_version</span> &amp;&amp; rm -rf web.tar.gz&quot;</span>
<span class="token function">ssh</span> <span class="token number">10.0</span>.0.8 <span class="token string">&quot;rm -rf /code/game &amp;&amp; ln -s /code/web_code_<span class="token variable">$git_version</span> /code/game&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>我们可以创建一个deploy.sh脚本文件：</p> <p><img src="/devops/public/assets/img/1728528976140.d63d3de1.png" alt="1728528976140"></p> <p>创建脚本：</p> <p><img src="/devops/public/assets/img/1728530024840.690e7001.png" alt="1728530024840"></p> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token shebang important">#!/bin/bash</span>

<span class="token function-name function">code_tar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">tar</span> zcvf /opt/web.tar.gz ./*
<span class="token punctuation">}</span>

<span class="token function-name function">code_cp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">scp</span> /opt/web.tar.gz <span class="token number">10.0</span>.0.8:/code/
<span class="token punctuation">}</span>

<span class="token function-name function">code_un</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token function">ssh</span> <span class="token number">10.0</span>.0.8 <span class="token string">&quot;mkdir -p /code/web_code_<span class="token variable">$git_version</span>&quot;</span>
   <span class="token function">ssh</span> <span class="token number">10.0</span>.0.8 <span class="token string">&quot;cd /code; tar xf web.tar.gz -C web_code_<span class="token variable">$git_version</span> &amp;&amp; rm -rf web.tar.gz&quot;</span> 
<span class="token punctuation">}</span>

<span class="token function-name function">code_ln</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">ssh</span> <span class="token number">10.0</span>.0.8 <span class="token string">&quot;rm -rf /code/game &amp;&amp; ln -s /code/web_code_<span class="token variable">$git_version</span> /code/game&quot;</span>
<span class="token punctuation">}</span>

<span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    code_tar
    code_cp
    code_un
    code_ln
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$deploy_env</span> <span class="token operator">=</span> <span class="token string">&quot;deploy&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
   main
<span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$deploy_env</span> <span class="token operator">=</span> <span class="token string">&quot;rollback&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
   code_ln
<span class="token keyword">fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>测试：</p> <p><img src="/devops/public/assets/img/1728529635039.3accc240.png" alt="1728529635039"></p> <p><img src="/devops/public/assets/img/1728529742559.0a610c29.png" alt="1728529742559"></p> <p>看一个远程仓库：</p> <p><img src="/devops/public/assets/img/1728529761682.d26c8ad8.png" alt="1728529761682"></p> <p>看jenkins：</p> <p><img src="/devops/public/assets/img/1728529795610.33404611.png" alt="1728529795610"></p> <p><img src="/devops/public/assets/img/1728529986817.434b9d56.png" alt="1728529986817"></p> <p>现在最新版本是v5.0，我要回到v4.0，操作如下：</p> <p><img src="/devops/public/assets/img/1728530188768.53dea159.png" alt="1728530188768"></p> <p><img src="/devops/public/assets/img/1728530203760.5020489d.png" alt="1728530203760"></p> <p>现在还面临一个问题，如下：</p> <p><img src="/devops/public/assets/img/1728530310918.7aa1cbc2.png" alt="1728530310918"></p> <h3 id="_5-避免重复构建"><a href="#_5-避免重复构建" class="header-anchor">#</a> 5，避免重复构建</h3> <p><img src="/devops/public/assets/img/1728530348977.507b2fb9.png" alt="1728530348977"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
Te <span class="token operator">=</span> <span class="token variable"><span class="token variable">`</span><span class="token function">ssh</span> <span class="token number">10.0</span>.0.8 <span class="token string">&quot;ls -l /code | grep <span class="token variable">$git_version</span>&quot;</span> <span class="token operator">|</span> <span class="token function">wc</span> <span class="token parameter variable">-l</span><span class="token variable">`</span></span>
<span class="token function-name function">code_tar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">tar</span> zcvf /opt/web.tar.gz ./*
<span class="token punctuation">}</span>

<span class="token function-name function">code_cp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">scp</span> /opt/web.tar.gz <span class="token number">10.0</span>.0.8:/code/
<span class="token punctuation">}</span>

<span class="token function-name function">code_un</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token function">ssh</span> <span class="token number">10.0</span>.0.8 <span class="token string">&quot;mkdir -p /code/web_code_<span class="token variable">$git_version</span>&quot;</span>
   <span class="token function">ssh</span> <span class="token number">10.0</span>.0.8 <span class="token string">&quot;cd /code; tar xf web.tar.gz -C web_code_<span class="token variable">$git_version</span> &amp;&amp; rm -rf web.tar.gz&quot;</span> 
<span class="token punctuation">}</span>

<span class="token function-name function">code_ln</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">ssh</span> <span class="token number">10.0</span>.0.8 <span class="token string">&quot;rm -rf /code/game &amp;&amp; ln -s /code/web_code_<span class="token variable">$git_version</span> /code/game&quot;</span>
<span class="token punctuation">}</span>

<span class="token function-name function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    code_tar
    code_cp
    code_un
    code_ln
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$deploy_env</span> <span class="token operator">=</span> <span class="token string">&quot;deploy&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
   <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token variable">$Te</span> <span class="token parameter variable">-eq</span> <span class="token number">0</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
      main
   <span class="token keyword">else</span>
      <span class="token builtin class-name">echo</span> <span class="token string">&quot;该版本已经部署过,不可以重复构建&quot;</span>
      <span class="token builtin class-name">exit</span>
   <span class="token keyword">fi</span>
<span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token variable">$deploy_env</span> <span class="token operator">=</span> <span class="token string">&quot;rollback&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
   code_ln
<span class="token keyword">fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br></div></div><p>测试：</p> <p><img src="/devops/public/assets/img/1728530794148.a4d75293.png" alt="1728530794148"></p> <p>还可以这样做：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>避免重复构建
当重复执行构建后会生成多个相同版本的文件，利用jenkins变量值解决重复性构建问题

jenkins变量
<span class="token number">1</span>. GIT_COMMIT 当前版本提交产生的哈希唯一值
<span class="token number">2</span>. GIT_PREVIOUS_SUCCESSFUL_COMMIT 已经提交过的版本的哈希唯一值

使用以上两个值做比较，如果已提交则退出，如果没有提交过则
继续执行构建，更改脚本做判断
<span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$deploy_env</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;deploy&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$GIT_COMMIT</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;<span class="token variable">$GIT_PREVIOUS_SUCCESSFUL_COMMIT</span>&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    	<span class="token builtin class-name">echo</span> <span class="token string">&quot;构建失败该 <span class="token variable">$git_version</span> 版本号已部署&quot;</span>
    <span class="token keyword">else</span>
    	main
    <span class="token keyword">fi</span>
<span class="token keyword">elif</span> <span class="token punctuation">[</span> <span class="token string">&quot;<span class="token variable">$deploy_env</span>&quot;</span> <span class="token operator">==</span> <span class="token string">&quot;rollback&quot;</span> <span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">then</span>
    code_ln
<span class="token keyword">fi</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h2 id="二-流水线"><a href="#二-流水线" class="header-anchor">#</a> 二，流水线</h2> <h3 id="_1-cicd"><a href="#_1-cicd" class="header-anchor">#</a> 1，CICD</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>持续集成<span class="token punctuation">(</span>Continuous integration<span class="token punctuation">)</span>是一种软件开发实践，即团队开发成员经常集成它们的工作，通过每个成员
每天至少集成一次，也就意味着每天可能会发生多次集成。每次集成都通过自动化的构建（包括编译，发布，自动
化测试）来验证，从而尽早地发现集成错误。
比如（你家装修厨房，其中一项是铺地砖，边角地砖要切割大小。如果一次全切割完再铺上去，发现尺寸有误的话
浪费和返工时间就大了，不如切一块铺一块。这就是持续集成。）

持续部署（continuous deployment）是通过自动化的构建、测试和部署循环来快速交付高质量的产品。某种程度
上代表了一个开发团队工程化的程度，毕竟快速运转的互联网公司人力成本会高于机器，投资机器优化开发流程化
相对也提高了人的效率。
比如（装修厨房有很多部分，每个部分都有检测手段，如地砖铺完了要测试漏水与否，线路铺完了要通电测试电路
通顺，水管装好了也要测试冷水热水。如果全部装完了再测，出现问题可能会互相影响，比如电路不行可能要把地
砖给挖开……。那么每完成一部分就测试，这是持续部署。）

持续交付 Continuous Delivery:频繁地将软件的新版本，交付给质量团队或者用户，以供评审尽早发现生产环境
中存在的问题；如果评审通过，代码就进入生产阶段
比如（全部装修完了，你去验收，发现地砖颜色不合意，水池太小，灶台位置不对，返工吗？所以不如没完成一部分，你就去用一下试用验收，这就是持续交付。）
敏捷思想中提出的这三个观点，还强调一件事：通过技术手段自动化这三个工作。加快交付速度
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h3 id="_2-pipline介绍"><a href="#_2-pipline介绍" class="header-anchor">#</a> 2，pipline介绍</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.什么是pipeline
Jenkins <span class="token number">2.0</span>的精髓是Pipeline as Code，是帮助Jenkins实现CI到CD转变的重要角色。什么是Pipeline，简单
来说，就是一套运行于Jenkins上的工作流框架，将原本独立运行于单个或者多个节点的任务连接起来，实现单个
任务难以完成的复杂发布流程。Pipeline的实现方式是一套Groovy DSL，任何发布流程都可以表述为一段Groovy
脚本，并且Jenkins支持从代码库直接读取脚本，从而实现了Pipeline as Code的理念。

<span class="token number">2</span>.Pipeline 概念
Pipeline 是一个用户定义的 CD 流水线模式。Pipeline 代码定义了通常包含构建、测试和发布步骤的完整的构
建过程。
Node
	<span class="token function">node</span> 是一个机器，它是 Jenkins 环境的一部分，并且能够执行 Pipeline。同时，node 代码块也是脚本式
Pipeline 语法的关键特性。

Stage
	Stage 块定义了在整个 Pipeline 中执行的概念上不同的任务子集（例如“构建”，“测试”和“部署”阶段），
许多插件使用它来可视化或呈现 Jenkins 管道状态/进度。

Step
	一项任务。从根本上讲，一个步骤告诉 Jenkins 在特定时间点（或过程中的“步骤”）要做什么。例如，使用
<span class="token function">sh</span> step：sh <span class="token string">'make'</span> 可以执行 <span class="token function">make</span> 这个 shell 命令。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>创建一个流水线：</p> <p><img src="/devops/public/assets/img/1728531884115.a433edc9.png" alt="1728531884115"></p> <p><img src="/devops/public/assets/img/1728531988857.644fea6f.png" alt="1728531988857"></p> <p><img src="/devops/public/assets/img/1728532023913.2cb71836.png" alt="1728532023913"></p> <p><img src="/devops/public/assets/img/1728532086200.65759198.png" alt="1728532086200"></p> <p>实操作一下：</p> <p><img src="/devops/public/assets/img/1728532247733.e53a5183.png" alt="1728532247733"></p> <p><img src="/devops/public/assets/img/1728532279922.0a413401.png" alt="1728532279922"></p> <p>在gtilab的game项目中创建Jenkinsfile文件</p> <p><img src="/devops/public/assets/img/1728532343428.abb05db3.png" alt="1728532343428"></p> <p><img src="/devops/public/assets/img/1728532453505.d872fd2a.png" alt="1728532453505"></p> <p><img src="/devops/public/assets/img/1728532521586.b6f297eb.png" alt="1728532521586"></p> <p><img src="/devops/public/assets/img/1728532545549.3ccde261.png" alt="1728532545549"></p> <p><img src="/devops/public/assets/img/1728532730222.92067544.png" alt="1728532730222"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>声明式 脚本式
脚本式语法格式：

pipeline<span class="token punctuation">{</span>
    agent any
    stages<span class="token punctuation">{</span>
        stage<span class="token punctuation">(</span><span class="token string">&quot;get code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           steps<span class="token punctuation">{</span>
               <span class="token builtin class-name">echo</span> <span class="token string">&quot;get code from scm&quot;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage<span class="token punctuation">(</span><span class="token string">&quot;package&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps<span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&quot;packge code&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage<span class="token punctuation">(</span><span class="token string">&quot;deploy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps<span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&quot;deploy packge to node1&quot;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


pipeline<span class="token punctuation">{</span>
    agent any
    stages<span class="token punctuation">{</span>
        stage<span class="token punctuation">(</span><span class="token string">&quot;get code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           steps<span class="token punctuation">{</span>
                <span class="token builtin class-name">echo</span> <span class="token string">&quot;get code&quot;</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage<span class="token punctuation">(</span><span class="token string">&quot;unit test&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
           steps<span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">'/usr/local/sonar-scanner/bin/sonar-scanner -Dsonar.projectKey=html  -Dsonar.projectName=${JOB_NAME} -Dsonar.sources=.'</span>
           <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage<span class="token punctuation">(</span><span class="token string">&quot;package&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps<span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">'tar zcf /opt/web-${BUILD_ID}.tar.gz ./*'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        stage<span class="token punctuation">(</span><span class="token string">&quot;deploy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            steps<span class="token punctuation">{</span>
                <span class="token function">sh</span> <span class="token string">'ssh 10.0.0.8 &quot;cd /code &amp;&amp; mkdir web-${BUILD_ID}&quot;'</span>
                <span class="token function">sh</span> <span class="token string">'scp /opt/web-${BUILD_ID}.tar.gz 10.0.0.8:/code/web-${BUILD_ID}'</span>
                <span class="token function">sh</span> <span class="token string">'ssh 10.0.0.8 &quot;cd /code/web-${BUILD_ID} &amp;&amp; tar xf web-${BUILD_ID}.tar.gz &amp;&amp; rm -rf web-${BUILD_ID}.tar.gz&quot;'</span>
                <span class="token function">sh</span> <span class="token string">'ssh 10.0.0.8 &quot;cd /code &amp;&amp; rm -rf game &amp;&amp; ln -s web-${BUILD_ID} /code/game&quot;'</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br></div></div><h2 id="三-java项目发布流程"><a href="#三-java项目发布流程" class="header-anchor">#</a> 三，java项目发布流程</h2> <h3 id="_1-maven介绍"><a href="#_1-maven介绍" class="header-anchor">#</a> 1，Maven介绍</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>Maven是一个项目管理和综合工具。Maven提供给开发人员构建一个完整的生命周期框架。开发团队可以自动完成该项目的基础设施建设，Maven使用标准的目录结构和默认构建生命周期。Apache的开源项目主要服务于JAVA平台的构建、依赖管理、项目管理。Project Object Model，项目对象模型。通过xml格式保存的pom.xml文件。该文件用于管理：源代码、配置文件、开发者的信息和角色、问题追踪系统、组织信息、项目授权、项目的url、项目的依赖关系等等。该文件是由开发维护，我们运维人员可以不用去关心。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>、下载Maven <span class="token number">3</span>安装包
官网：http://maven.apache.org/download.cgi
清华镜像：https://mirrors.tuna.tsinghua.edu.cn/apache/maven/

<span class="token number">2</span>、安装Maven
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#ll apache-maven-3.3.9-bin.tar.gz </span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">8491533</span> Oct  <span class="token number">8</span> <span class="token number">13</span>:23 apache-maven-3.3.9-bin.tar.gz
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#tar xf apache-maven-3.3.9-bin.tar.gz </span>
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#ll</span>
total <span class="token number">319140</span>
-rw-r--r-- <span class="token number">1</span> root root         <span class="token number">0</span> Aug <span class="token number">19</span> 09:50 <span class="token number">111</span>.txt
drwxr-xr-x <span class="token number">6</span> root root        <span class="token number">99</span> Oct <span class="token number">10</span> <span class="token number">12</span>:03 apache-maven-3.3.9
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#mv apache-maven-3.3.9 /usr/local/</span>
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#ln -s /usr/local/apache-maven-3.3.9/ /usr/local/maven</span>
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#/usr/local/maven/bin/mvn -v</span>
Apache Maven <span class="token number">3.3</span>.9 <span class="token punctuation">(</span>bb52d8

<span class="token number">3</span>、编辑/etc/profile文件，在末尾添加
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/root/bin:/opt/:/usr/local/sonar-scanner/bin:/usr/local/maven/bin
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#source /etc/profile</span>
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#mvn -v</span>
Apache Maven <span class="token number">3.3</span>.9 

配置maven的阿里源：
<span class="token punctuation">[</span>root@jenkins:conf<span class="token punctuation">]</span><span class="token comment">#pwd</span>
/usr/local/maven/conf
<span class="token punctuation">[</span>root@jenkins:conf<span class="token punctuation">]</span><span class="token comment"># vim settings.conf</span>

阿里云：
<span class="token operator">&lt;</span>mirror<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>id<span class="token operator">&gt;</span>nexus-aliyun<span class="token operator">&lt;</span>/id<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>mirrorOf<span class="token operator">&gt;</span>*<span class="token operator">&lt;</span>/mirrorOf<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>name<span class="token operator">&gt;</span>Nexus aliyun<span class="token operator">&lt;</span>/name<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>url<span class="token operator">&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="token operator">&lt;</span>/url<span class="token operator">&gt;</span> 
<span class="token operator">&lt;</span>/mirror<span class="token operator">&gt;</span>


<span class="token number">4</span>.上传一个简单的java项目包hello-world.tar.gz进行解压
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#ll hello-world.tar.gz </span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">18950</span> Oct  <span class="token number">8</span> <span class="token number">13</span>:23 hello-world.tar.gz
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#tar xf hello-world.tar.gz </span>
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#cd hello-world-war/</span>
<span class="token punctuation">[</span>root@jenkins:hello-world-war<span class="token punctuation">]</span><span class="token comment">#ls</span>
dist  pom.xml  README.md  src
<span class="token punctuation">[</span>root@jenkins:hello-world-war<span class="token punctuation">]</span><span class="token comment">#tree .</span>
<span class="token builtin class-name">.</span>
├── dist
│   └── hello-world.war
├── pom.xml
├── README.md
└── src
    └── main
        └── webapp
            ├── index.jsp
            └── WEB-INF
                └── web.xml

<span class="token number">5</span> directories, <span class="token number">5</span> files

<span class="token punctuation">[</span>root@jenkins:hello-world-war<span class="token punctuation">]</span><span class="token comment">#mvn package</span>
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span> Scanning <span class="token keyword">for</span> projects<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>    

<span class="token punctuation">[</span>root@jenkins:hello-world-war<span class="token punctuation">]</span><span class="token comment">#ll target/</span>
total <span class="token number">4</span>
drwxr-xr-x <span class="token number">4</span> root root   <span class="token number">54</span> Oct <span class="token number">10</span> <span class="token number">12</span>:19 hello-world-war-1.0.0
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1934</span> Oct <span class="token number">10</span> <span class="token number">12</span>:19 hello-world-war-1.0.0.war


<span class="token number">5</span>.web02部署tomcat
<span class="token punctuation">[</span>root@web02-8:~<span class="token punctuation">]</span><span class="token comment">#systemctl start tomcat</span>
<span class="token punctuation">[</span>root@web02-8:~<span class="token punctuation">]</span><span class="token comment">#systemctl status tomcat</span>
<span class="token punctuation">[</span>root@web02-8:ROOT<span class="token punctuation">]</span><span class="token comment">#pwd</span>
/usr/local/tomcat/webapps/ROOT  <span class="token comment"># tomcat部署项目的目录</span>

<span class="token number">6</span>.将war包拷贝tomcat的站点目录下
<span class="token punctuation">[</span>root@jenkins:target<span class="token punctuation">]</span><span class="token comment">#pwd</span>
/root/hello-world-war/target
<span class="token punctuation">[</span>root@jenkins:target<span class="token punctuation">]</span><span class="token comment">#scp hello-world-war-1.0.0.war  10.0.0.8:/usr/local/tomcat/webapps/ROOT</span>
<span class="token punctuation">[</span>root@web02-8:ROOT<span class="token punctuation">]</span><span class="token comment">#pwd</span>
/usr/local/tomcat/webapps/ROOT
<span class="token punctuation">[</span>root@web02-8:ROOT<span class="token punctuation">]</span><span class="token comment">#ll</span>
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">1934</span> Oct <span class="token number">10</span> <span class="token number">12</span>:22 hello-world-war-1.0.0.war
                                                                 
<span class="token number">7</span>.解压war包 启动tomcat访问
<span class="token punctuation">[</span>root@web02-8:ROOT<span class="token punctuation">]</span><span class="token comment">#unzip hello-world-war-1.0.0.war </span>
<span class="token punctuation">[</span>root@web02-8:ROOT<span class="token punctuation">]</span><span class="token comment">#ll</span>
total <span class="token number">8</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">1934</span> Oct <span class="token number">10</span> <span class="token number">12</span>:24 hello-world-war-1.0.0.war
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">210</span> Oct <span class="token number">15</span>  <span class="token number">2019</span> index.jsp
drwxr-xr-x <span class="token number">3</span> root root   <span class="token number">38</span> Oct <span class="token number">10</span> <span class="token number">12</span>:24 META-INF
drwxr-xr-x <span class="token number">3</span> root root   <span class="token number">36</span> Oct <span class="token number">10</span> <span class="token number">12</span>:19 WEB-INF


</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br></div></div><p><img src="/devops/public/assets/img/1728536043164.4de48efd.png" alt="1728536043164"></p> <p>环境变量：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/usr/lib/jvm/jdk-17-oracle-x64

<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin:/root/bin:/opt/:<span class="token variable">$JAVA_HOME</span>/bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>确定java安装路径：</p> <p><img src="/devops/public/assets/img/1728547765381.d7d2aeb3.png" alt="1728547765381"></p> <h3 id="_2-集成jenkins"><a href="#_2-集成jenkins" class="header-anchor">#</a> 2，集成jenkins</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.将java代码推送到gitlab
<span class="token number">2</span>.jenkins创建java项目拉取java代码
<span class="token number">3</span>.使用maven编译拿到war包
<span class="token number">4</span>.将war包推送到web服务器的tomcat站点目录下
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.将java代码推送到gitlab
malu@malu:~$ ll hello-world.tar.gz 
-rw-r--r-- <span class="token number">1</span> malu malu <span class="token number">18950</span> Oct  <span class="token number">8</span> 05:23 hello-world.tar.gz
malu@malu:~$ <span class="token function">tar</span> xf hello-world.tar.gz 
malu@malu:~/hello-world-war$ <span class="token function">git</span> remote
origin
malu@malu:~/hello-world-war$ <span class="token function">git</span> remote remove origin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>在gitlab上创建项目：</p> <p><img src="/devops/public/assets/img/1728548464051.0b0884bb.png" alt="1728548464051"></p> <p>项目地址：git@10.0.0.201:malu/java.git</p> <p>本地仓库关联远程仓库：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>malu@malu:~/hello-world-war$ <span class="token function">git</span> remote <span class="token function">add</span> origin git@10.0.0.201:malu/java.git
malu@malu:~/hello-world-war$ <span class="token function">git</span> remote <span class="token parameter variable">-v</span>
origin	git@10.0.0.201:malu/java.git <span class="token punctuation">(</span>fetch<span class="token punctuation">)</span>
origin	git@10.0.0.201:malu/java.git <span class="token punctuation">(</span>push<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>推送代码：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>malu@malu:~/hello-world-war$ <span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
malu@malu:~/hello-world-war$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">&quot;java项目完成&quot;</span>
<span class="token punctuation">[</span>master 276eb07<span class="token punctuation">]</span> java项目完成
 <span class="token number">2</span> files changed, <span class="token number">3</span> insertions<span class="token punctuation">(</span>+<span class="token punctuation">)</span>, <span class="token number">3</span> deletions<span class="token punctuation">(</span>-<span class="token punctuation">)</span>
malu@malu:~/hello-world-war$ <span class="token function">git</span> branch
* master
malu@malu:~/hello-world-war$ <span class="token function">git</span> branch <span class="token parameter variable">-m</span> master main
malu@malu:~/hello-world-war$ <span class="token function">git</span> branch
* main
malu@malu:~/hello-world-war$ <span class="token function">git</span> push <span class="token parameter variable">-u</span> origin main
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p><img src="/devops/public/assets/img/1728548671565.0abb728f.png" alt="1728548671565"></p> <p>再次推送：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>malu@malu:~/hello-world-war$ <span class="token function">git</span> push <span class="token parameter variable">-uf</span> origin main
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看：</p> <p><img src="/devops/public/assets/img/1728548724532.592b0278.png" alt="1728548724532"></p> <p>jenkins创建java项目拉取java代码</p> <p><img src="/devops/public/assets/img/1728549023959.60d11399.png" alt="1728549023959"></p> <p><img src="/devops/public/assets/img/1728549197758.8c0039bd.png" alt="1728549197758"></p> <p><img src="/devops/public/assets/img/1728549234212.f0948379.png" alt="1728549234212"></p> <p><img src="/devops/public/assets/img/1728549295782.9d2e2e98.png" alt="1728549295782"></p> <p><img src="/devops/public/assets/img/1728549408544.548f43d7.png" alt="1728549408544"></p> <p><img src="/devops/public/assets/img/1728549562107.6c91b721.png" alt="1728549562107"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">scp</span> target/hello-world-war-1.0.0.war <span class="token number">10.0</span>.0.8:/opt/
<span class="token function">ssh</span> <span class="token number">10.0</span>.0.8 <span class="token string">&quot;cd /usr/local/tomcat/webapps/ROOT/ &amp;&amp; rm -rf * &amp;&amp; unzip /opt/*.war -d ./ &amp;&amp; rm -rf *.war&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/devops/public/assets/img/1728549826620.d0dffa4d.png" alt="1728549826620"></p> <p><img src="/devops/public/assets/img/1728549881099.d68abdf4.png" alt="1728549881099"></p> <p><img src="/devops/public/assets/img/1728549895533.0ea93d44.png" alt="1728549895533"></p> <p><img src="/devops/public/assets/img/1728549911532.ddc64c42.png" alt="1728549911532"></p> <p>修改代码：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>malu@malu:~/hello-world-war/src/main/webapp$ <span class="token builtin class-name">pwd</span>
/home/malu/hello-world-war/src/main/webapp
malu@malu:~/hello-world-war/src/main/webapp$ ll
total <span class="token number">16</span>
drwxr-xr-x <span class="token number">3</span> malu malu <span class="token number">4096</span> Oct <span class="token number">14</span>  <span class="token number">2019</span> ./
drwxr-xr-x <span class="token number">3</span> malu malu <span class="token number">4096</span> May <span class="token number">23</span>  <span class="token number">2014</span> <span class="token punctuation">..</span>/
-rw-r--r-- <span class="token number">1</span> malu malu  <span class="token number">210</span> Oct <span class="token number">14</span>  <span class="token number">2019</span> index.jsp
drwxr-xr-x <span class="token number">2</span> malu malu <span class="token number">4096</span> May <span class="token number">23</span>  <span class="token number">2014</span> WEB-INF/

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><img src="/devops/public/assets/img/1728549980038.6ca41158.png" alt="1728549980038"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>malu@malu:~/hello-world-war/src/main/webapp$ <span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
malu@malu:~/hello-world-war/src/main/webapp$ <span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">&quot;v1.1&quot;</span>
<span class="token punctuation">[</span>main 0e0536e<span class="token punctuation">]</span> v1.1
 <span class="token number">1</span> <span class="token function">file</span> changed, <span class="token number">1</span> insertion<span class="token punctuation">(</span>+<span class="token punctuation">)</span>, <span class="token number">1</span> deletion<span class="token punctuation">(</span>-<span class="token punctuation">)</span>
malu@malu:~/hello-world-war/src/main/webapp$ <span class="token function">git</span> push <span class="token parameter variable">-u</span> origin main
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>手动点一下：</p> <p><img src="/devops/public/assets/img/1728550064769.30fed69a.png" alt="1728550064769"></p> <p>测试：</p> <p><img src="/devops/public/assets/img/1728550088411.1a58f8ca.png" alt="1728550088411"></p> <h3 id="_3-配置nexus私服"><a href="#_3-配置nexus私服" class="header-anchor">#</a> 3，配置nexus私服</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>如果公司部分java代码 不需要配置nexus私服，只需要将maven配置文件仓库指向阿里云仓库。如果公司是重java项目，则需要搭建私有的仓库nexus

<span class="token number">10.0</span>.0.204 nexus <span class="token number">2</span>核2G
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 上传JDK</span>
<span class="token punctuation">[</span>root@nexus:~<span class="token punctuation">]</span><span class="token comment">#ll</span>
total <span class="token number">286068</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">170023183</span> Oct  <span class="token number">8</span> <span class="token number">13</span>:24 jdk-8u181-linux-x64.rpm
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">122904706</span> Oct  <span class="token number">8</span> <span class="token number">13</span>:24 nexus-3.13.0-01-unix.tar.gz
<span class="token punctuation">[</span>root@nexus:~<span class="token punctuation">]</span><span class="token comment">#rpm -ivh jdk-8u181-linux-x64.rpm</span>
<span class="token punctuation">[</span>root@nexus:~<span class="token punctuation">]</span><span class="token comment">#java -version</span>
<span class="token function">java</span> version <span class="token string">&quot;1.8.0_181&quot;</span>

<span class="token comment"># 上传nexus安装包</span>
<span class="token punctuation">[</span>root@nexus:~<span class="token punctuation">]</span><span class="token comment">#ll</span>
total <span class="token number">286068</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">170023183</span> Oct  <span class="token number">8</span> <span class="token number">13</span>:24 jdk-8u181-linux-x64.rpm
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">122904706</span> Oct  <span class="token number">8</span> <span class="token number">13</span>:24 nexus-3.13.0-01-unix.tar.gz
<span class="token punctuation">[</span>root@nexus:~<span class="token punctuation">]</span><span class="token comment">#tar xf nexus-3.13.0-01-unix.tar.gz </span>

<span class="token comment">#移动到/usr/local</span>
<span class="token punctuation">[</span>root@nexus:~<span class="token punctuation">]</span><span class="token comment">#mv nexus-3.13.0-01 /usr/local/nexus</span>

<span class="token comment"># 启动nexus</span>
<span class="token punctuation">[</span>root@nexus:~<span class="token punctuation">]</span><span class="token comment">#/usr/local/nexus/bin/nexus start</span>
WARNING: ************************************************************
WARNING: Detected execution as <span class="token string">&quot;root&quot;</span> user.  This is NOT recommended<span class="token operator">!</span>
WARNING: ************************************************************
Starting nexus

<span class="token comment"># 浏览器访问</span>
<span class="token number">10.0</span>.0.204:8081 admin admin123
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p><img src="/devops/public/assets/img/1728550913059.e00ce02f.png" alt="1728550913059"></p> <p><img src="/devops/public/assets/img/1728551018483.b28146e7.png" alt="1728551018483"></p> <p><img src="/devops/public/assets/img/1728551073696.9539f88d.png" alt="1728551073696"></p> <p>告诉私服，如果没有对应的依赖，就去阿里云上拉取：</p> <p><img src="/devops/public/assets/img/1728552004529.8dae58d5.png" alt="1728552004529"></p> <p><img src="/devops/public/assets/img/1728552072102.e50fa9d3.png" alt="1728552072102"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>http://maven.aliyun.com/nexus/content/groups/public
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/devops/public/assets/img/1728552151454.bca854d9.png" alt="1728552151454"></p> <p>开始设置maven，让maven从10.0.0.204这个私服上拉：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@jenkins:hello-world-war<span class="token punctuation">]</span><span class="token comment">#cd /usr/local/maven/conf/</span>
<span class="token punctuation">[</span>root@jenkins:conf<span class="token punctuation">]</span><span class="token comment">#ll</span>
total <span class="token number">16</span>
drwxr-xr-x <span class="token number">2</span> root root    <span class="token number">37</span> Nov <span class="token number">11</span>  <span class="token number">2015</span> logging
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">10401</span> Oct <span class="token number">10</span> <span class="token number">12</span>:17 settings.xml
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">3649</span> Nov <span class="token number">11</span>  <span class="token number">2015</span> toolchains.xml
<span class="token punctuation">[</span>root@jenkins:conf<span class="token punctuation">]</span><span class="token comment">#mv settings.xml settings.xml.bak</span>
<span class="token punctuation">[</span>root@jenkins:conf<span class="token punctuation">]</span><span class="token comment">#ll</span>
total <span class="token number">16</span>
drwxr-xr-x <span class="token number">2</span> root root    <span class="token number">37</span> Nov <span class="token number">11</span>  <span class="token number">2015</span> logging
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">10401</span> Oct <span class="token number">10</span> <span class="token number">12</span>:17 settings.xml.bak
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">3649</span> Nov <span class="token number">11</span>  <span class="token number">2015</span> toolchains.xml

把群里中的settings.xml上传
<span class="token punctuation">[</span>root@jenkins:conf<span class="token punctuation">]</span><span class="token comment">#ll</span>
total <span class="token number">28</span>
drwxr-xr-x <span class="token number">2</span> root root    <span class="token number">37</span> Nov <span class="token number">11</span>  <span class="token number">2015</span> logging
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">11280</span> Oct <span class="token number">10</span> <span class="token number">17</span>:26 settings.xml    --这是私服的
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">10401</span> Oct <span class="token number">10</span> <span class="token number">12</span>:17 settings.xml.bak  --这是阿里云的
-rw-r--r-- <span class="token number">1</span> root root  <span class="token number">3649</span> Nov <span class="token number">11</span>  <span class="token number">2015</span> toolchains.xml

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>

<span class="token comment">&lt;!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
&quot;License&quot;); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
&quot;AS IS&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
--&gt;</span>

<span class="token comment">&lt;!--
 | This is the configuration file for Maven. It can be specified at two levels:
 |
 |  1. User Level. This settings.xml file provides configuration for a single user,
 |                 and is normally provided in ${user.home}/.m2/settings.xml.
 |
 |                 NOTE: This location can be overridden with the CLI option:
 |
 |                 -s /path/to/user/settings.xml
 |
 |  2. Global Level. This settings.xml file provides configuration for all Maven
 |                 users on a machine (assuming they're all using the same Maven
 |                 installation). It's normally provided in
 |                 ${maven.home}/conf/settings.xml.
 |
 |                 NOTE: This location can be overridden with the CLI option:
 |
 |                 -gs /path/to/global/settings.xml
 |
 | The sections in this sample file are intended to give you a running start at
 | getting the most out of your Maven installation. Where appropriate, the default
 | values (values used when the setting is not specified) are provided.
 |
 |--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>settings</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/SETTINGS/1.0.0<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- localRepository
   | The path to the local repository maven will use to store artifacts.
   |
   | Default: ${user.home}/.m2/repository
  &lt;localRepository&gt;/path/to/local/repo&lt;/localRepository&gt;
  --&gt;</span>

  <span class="token comment">&lt;!-- interactiveMode
   | This will determine whether maven prompts you when it needs input. If set to false,
   | maven will use a sensible default value, perhaps based on some other setting, for
   | the parameter in question.
   |
   | Default: true
  &lt;interactiveMode&gt;true&lt;/interactiveMode&gt;
  --&gt;</span>

  <span class="token comment">&lt;!-- offline
   | Determines whether maven should attempt to connect to the network when executing a build.
   | This will have an effect on artifact downloads, artifact deployment, and others.
   |
   | Default: false
  &lt;offline&gt;false&lt;/offline&gt;
  --&gt;</span>

  <span class="token comment">&lt;!-- pluginGroups
   | This is a list of additional group identifiers that will be searched when resolving plugins by their prefix, i.e.
   | when invoking a command line like &quot;mvn prefix:goal&quot;. Maven will automatically add the group identifiers
   | &quot;org.apache.maven.plugins&quot; and &quot;org.codehaus.mojo&quot; if these are not already contained in the list.
   |--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginGroups</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- pluginGroup
     | Specifies a further group identifier to use for plugin lookup.
    &lt;pluginGroup&gt;com.your.plugins&lt;/pluginGroup&gt;
    --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginGroups</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- proxies
   | This is a list of proxies which can be used on this machine to connect to the network.
   | Unless otherwise specified (by system property or command-line switch), the first proxy
   | specification in this list marked as active will be used.
   |--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>proxies</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- proxy
     | Specification for one proxy, to be used in connecting to the network.
     |
    &lt;proxy&gt;
      &lt;id&gt;optional&lt;/id&gt;
      &lt;active&gt;true&lt;/active&gt;
      &lt;protocol&gt;http&lt;/protocol&gt;
      &lt;username&gt;proxyuser&lt;/username&gt;
      &lt;password&gt;proxypass&lt;/password&gt;
      &lt;host&gt;proxy.host.net&lt;/host&gt;
      &lt;port&gt;80&lt;/port&gt;
      &lt;nonProxyHosts&gt;local.net|some.host.com&lt;/nonProxyHosts&gt;
    &lt;/proxy&gt;
    --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>proxies</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- servers
   | This is a list of authentication profiles, keyed by the server-id used within the system.
   | Authentication profiles can be used whenever maven must make a connection to a remote server.
   |--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>servers</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- server
     | Specifies the authentication information to use when connecting to a particular server, identified by
     | a unique name within the system (referred to by the 'id' attribute below).
     |
     | NOTE: You should either specify username/password OR privateKey/passphrase, since these pairings are
     |       used together.
     |
    &lt;server&gt;
      &lt;id&gt;deploymentRepo&lt;/id&gt;
      &lt;username&gt;repouser&lt;/username&gt;
      &lt;password&gt;repopwd&lt;/password&gt;
    &lt;/server&gt;
    --&gt;</span>

    <span class="token comment">&lt;!-- Another sample, using keys to authenticate.
    &lt;server&gt;
      &lt;id&gt;siteServer&lt;/id&gt;
      &lt;privateKey&gt;/path/to/private/key&lt;/privateKey&gt;
      &lt;passphrase&gt;optional; leave empty if not used.&lt;/passphrase&gt;
    &lt;/server&gt;
    --&gt;</span>
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>server</span><span class="token punctuation">&gt;</span></span>   
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>my-nexus-releases<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>   
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">&gt;</span></span>admin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">&gt;</span></span>   
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">&gt;</span></span>admin123<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">&gt;</span></span>   
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>server</span><span class="token punctuation">&gt;</span></span>   
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>server</span><span class="token punctuation">&gt;</span></span>   
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>my-nexus-snapshot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>   
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>username</span><span class="token punctuation">&gt;</span></span>admin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>username</span><span class="token punctuation">&gt;</span></span>   
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>password</span><span class="token punctuation">&gt;</span></span>admin123<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>password</span><span class="token punctuation">&gt;</span></span>   
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>server</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>servers</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- mirrors
   | This is a list of mirrors to be used in downloading artifacts from remote repositories.
   |
   | It works like this: a POM may declare a repository to use in resolving certain artifacts.
   | However, this repository may have problems with heavy traffic at times, so people have mirrored
   | it to several places.
   |
   | That repository definition will have a unique id, so we can create a mirror reference for that
   | repository, to be used as an alternate download site. The mirror site will be the preferred
   | server for that repository.
   |--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrors</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirror</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>nexus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrorOf</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://10.0.0.204:8081/repository/maven-public/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirror</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- mirror
     | Specifies a repository mirror site to use instead of a given repository. The repository that
     | this mirror serves has an ID that matches the mirrorOf element of this mirror. IDs are used
     | for inheritance and direct lookup purposes, and must be unique across the set of mirrors.
     |
    &lt;mirror&gt;
      &lt;id&gt;mirrorId&lt;/id&gt;
      &lt;mirrorOf&gt;repositoryId&lt;/mirrorOf&gt;
      &lt;name&gt;Human Readable Name for this Mirror.&lt;/name&gt;
      &lt;url&gt;http://my.repository.com/repo/path&lt;/url&gt;
    &lt;/mirror&gt;
     --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mirrors</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- profiles
   | This is a list of profiles which can be activated in a variety of ways, and which can modify
   | the build process. Profiles provided in the settings.xml are intended to provide local machine-
   | specific paths and repository locations which allow the build to work in the local environment.
   |
   | For example, if you have an integration testing plugin - like cactus - that needs to know where
   | your Tomcat instance is installed, you can provide a variable here such that the variable is
   | dereferenced during the build process to configure the cactus plugin.
   |
   | As noted above, profiles can be activated in a variety of ways. One way - the activeProfiles
   | section of this document (settings.xml) - will be discussed later. Another way essentially
   | relies on the detection of a system property, either matching a particular value for the property,
   | or merely testing its existence. Profiles can also be activated by JDK version prefix, where a
   | value of '1.4' might activate a profile when the build is executed on a JDK version of '1.4.2_07'.
   | Finally, the list of active profiles can be specified directly from the command line.
   |
   | NOTE: For profiles defined in the settings.xml, you are restricted to specifying only artifact
   |       repositories, plugin repositories, and free-form properties to be used as configuration
   |       variables for plugins in the POM.
   |
   |--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profiles</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- profile
     | Specifies a set of introductions to the build process, to be activated using one or more of the
     | mechanisms described above. For inheritance purposes, and to activate profiles via &lt;activatedProfiles/&gt;
     | or the command line, profiles have to have an ID that is unique.
     |
     | An encouraged best practice for profile identification is to use a consistent naming convention
     | for profiles, such as 'env-dev', 'env-test', 'env-production', 'user-jdcasey', 'user-brett', etc.
     | This will make it more intuitive to understand what the set of introduced profiles is attempting
     | to accomplish, particularly when you only have a list of profile id's for debug.
     |
     | This profile example uses the JDK version to trigger activation, and provides a JDK-specific repo.
    &lt;profile&gt;
      &lt;id&gt;jdk-1.4&lt;/id&gt;

      &lt;activation&gt;
        &lt;jdk&gt;1.4&lt;/jdk&gt;
      &lt;/activation&gt;

      &lt;repositories&gt;
        &lt;repository&gt;
          &lt;id&gt;jdk14&lt;/id&gt;
          &lt;name&gt;Repository for JDK 1.4 builds&lt;/name&gt;
          &lt;url&gt;http://www.myhost.com/maven/jdk14&lt;/url&gt;
          &lt;layout&gt;default&lt;/layout&gt;
          &lt;snapshotPolicy&gt;always&lt;/snapshotPolicy&gt;
        &lt;/repository&gt;
      &lt;/repositories&gt;
    &lt;/profile&gt;
    --&gt;</span>

    <span class="token comment">&lt;!--
     | Here is another profile, activated by the system property 'target-env' with a value of 'dev',
     | which provides a specific path to the Tomcat instance. To use this, your plugin configuration
     | might hypothetically look like:
     |
     | ...
     | &lt;plugin&gt;
     |   &lt;groupId&gt;org.myco.myplugins&lt;/groupId&gt;
     |   &lt;artifactId&gt;myplugin&lt;/artifactId&gt;
     |
     |   &lt;configuration&gt;
     |     &lt;tomcatLocation&gt;${tomcatPath}&lt;/tomcatLocation&gt;
     |   &lt;/configuration&gt;
     | &lt;/plugin&gt;
     | ...
     |
     | NOTE: If you just wanted to inject this configuration whenever someone set 'target-env' to
     |       anything, you could just leave off the &lt;value/&gt; inside the activation-property.
     |
    &lt;profile&gt;
      &lt;id&gt;env-dev&lt;/id&gt;

      &lt;activation&gt;
        &lt;property&gt;
          &lt;name&gt;target-env&lt;/name&gt;
          &lt;value&gt;dev&lt;/value&gt;
        &lt;/property&gt;
      &lt;/activation&gt;

      &lt;properties&gt;
        &lt;tomcatPath&gt;/path/to/tomcat/instance&lt;/tomcatPath&gt;
      &lt;/properties&gt;
    &lt;/profile&gt;
    --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>profile</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>nexus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://10.0.0.204:8081/repository/maven-public/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>releases</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>releases</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginRepositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pluginRepository</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>central<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://10.0.0.204:8081/repository/maven-public/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>releases</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>releases</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>snapshots</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>enabled</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>enabled</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>snapshots</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginRepository</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pluginRepositories</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profile</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>profiles</span><span class="token punctuation">&gt;</span></span>

  <span class="token comment">&lt;!-- activeProfiles
   | List of profiles that are active for all builds.
   |
  &lt;activeProfiles&gt;
    &lt;activeProfile&gt;alwaysActiveProfile&lt;/activeProfile&gt;
    &lt;activeProfile&gt;anotherAlwaysActiveProfile&lt;/activeProfile&gt;
  &lt;/activeProfiles&gt;
  --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeProfiles</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>activeProfile</span><span class="token punctuation">&gt;</span></span>nexus<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeProfile</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>activeProfiles</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>settings</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br><span class="line-number">149</span><br><span class="line-number">150</span><br><span class="line-number">151</span><br><span class="line-number">152</span><br><span class="line-number">153</span><br><span class="line-number">154</span><br><span class="line-number">155</span><br><span class="line-number">156</span><br><span class="line-number">157</span><br><span class="line-number">158</span><br><span class="line-number">159</span><br><span class="line-number">160</span><br><span class="line-number">161</span><br><span class="line-number">162</span><br><span class="line-number">163</span><br><span class="line-number">164</span><br><span class="line-number">165</span><br><span class="line-number">166</span><br><span class="line-number">167</span><br><span class="line-number">168</span><br><span class="line-number">169</span><br><span class="line-number">170</span><br><span class="line-number">171</span><br><span class="line-number">172</span><br><span class="line-number">173</span><br><span class="line-number">174</span><br><span class="line-number">175</span><br><span class="line-number">176</span><br><span class="line-number">177</span><br><span class="line-number">178</span><br><span class="line-number">179</span><br><span class="line-number">180</span><br><span class="line-number">181</span><br><span class="line-number">182</span><br><span class="line-number">183</span><br><span class="line-number">184</span><br><span class="line-number">185</span><br><span class="line-number">186</span><br><span class="line-number">187</span><br><span class="line-number">188</span><br><span class="line-number">189</span><br><span class="line-number">190</span><br><span class="line-number">191</span><br><span class="line-number">192</span><br><span class="line-number">193</span><br><span class="line-number">194</span><br><span class="line-number">195</span><br><span class="line-number">196</span><br><span class="line-number">197</span><br><span class="line-number">198</span><br><span class="line-number">199</span><br><span class="line-number">200</span><br><span class="line-number">201</span><br><span class="line-number">202</span><br><span class="line-number">203</span><br><span class="line-number">204</span><br><span class="line-number">205</span><br><span class="line-number">206</span><br><span class="line-number">207</span><br><span class="line-number">208</span><br><span class="line-number">209</span><br><span class="line-number">210</span><br><span class="line-number">211</span><br><span class="line-number">212</span><br><span class="line-number">213</span><br><span class="line-number">214</span><br><span class="line-number">215</span><br><span class="line-number">216</span><br><span class="line-number">217</span><br><span class="line-number">218</span><br><span class="line-number">219</span><br><span class="line-number">220</span><br><span class="line-number">221</span><br><span class="line-number">222</span><br><span class="line-number">223</span><br><span class="line-number">224</span><br><span class="line-number">225</span><br><span class="line-number">226</span><br><span class="line-number">227</span><br><span class="line-number">228</span><br><span class="line-number">229</span><br><span class="line-number">230</span><br><span class="line-number">231</span><br><span class="line-number">232</span><br><span class="line-number">233</span><br><span class="line-number">234</span><br><span class="line-number">235</span><br><span class="line-number">236</span><br><span class="line-number">237</span><br><span class="line-number">238</span><br><span class="line-number">239</span><br><span class="line-number">240</span><br><span class="line-number">241</span><br><span class="line-number">242</span><br><span class="line-number">243</span><br><span class="line-number">244</span><br><span class="line-number">245</span><br><span class="line-number">246</span><br><span class="line-number">247</span><br><span class="line-number">248</span><br><span class="line-number">249</span><br><span class="line-number">250</span><br><span class="line-number">251</span><br><span class="line-number">252</span><br><span class="line-number">253</span><br><span class="line-number">254</span><br><span class="line-number">255</span><br><span class="line-number">256</span><br><span class="line-number">257</span><br><span class="line-number">258</span><br><span class="line-number">259</span><br><span class="line-number">260</span><br><span class="line-number">261</span><br><span class="line-number">262</span><br><span class="line-number">263</span><br><span class="line-number">264</span><br><span class="line-number">265</span><br><span class="line-number">266</span><br><span class="line-number">267</span><br><span class="line-number">268</span><br><span class="line-number">269</span><br><span class="line-number">270</span><br><span class="line-number">271</span><br><span class="line-number">272</span><br><span class="line-number">273</span><br><span class="line-number">274</span><br><span class="line-number">275</span><br><span class="line-number">276</span><br><span class="line-number">277</span><br><span class="line-number">278</span><br><span class="line-number">279</span><br><span class="line-number">280</span><br><span class="line-number">281</span><br><span class="line-number">282</span><br><span class="line-number">283</span><br><span class="line-number">284</span><br><span class="line-number">285</span><br><span class="line-number">286</span><br><span class="line-number">287</span><br><span class="line-number">288</span><br><span class="line-number">289</span><br><span class="line-number">290</span><br><span class="line-number">291</span><br><span class="line-number">292</span><br><span class="line-number">293</span><br><span class="line-number">294</span><br></div></div><p>测试是否走的私服：</p> <p><img src="/devops/public/assets/img/1728552539148.03184ce8.png" alt="1728552539148"></p> <p><img src="/devops/public/assets/img/1728552634638.551a5337.png" alt="1728552634638"></p> <h2 id="四-配置jenkins的分布式"><a href="#四-配置jenkins的分布式" class="header-anchor">#</a> 四，配置Jenkins的分布式</h2> <p><img src="/devops/public/assets/img/1728551788240.b10b9986.png" alt="1728551788240"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>如果项目需要定期集成，同时每次集成都需要较长时间。如果都运行在master服务器上，会消耗过多资源，导致其他项
目搁置无法集成，这时就需要在建立多台设备，并配置作为slave机器来为master提供负载服务。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>部署分布式服务器</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.找一台或者目前已有的服务器配置为slave端 <span class="token comment">#当前使用lb02服务器作为slave测试</span>
在lb02上安装java jdk git和soanr客户端 <span class="token comment"># 如已安装则略过</span>
<span class="token punctuation">[</span>root@lb02:~<span class="token punctuation">]</span><span class="token comment">#ll</span>
total <span class="token number">179428</span>
-rw-r--r-- <span class="token number">1</span> root root <span class="token number">182486159</span> Sep <span class="token number">27</span> <span class="token number">2024</span> jdk-17_linux-x64_bin.rpm
<span class="token punctuation">[</span>root@lb02:~<span class="token punctuation">]</span><span class="token comment">#rpm -ivh jdk-17_linux-x64_bin.rpm</span>

<span class="token number">2</span>.jenkins服务器操作 注意带版本号做软链接
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#ssh-copy-id 10.0.0.6</span>
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#scp -r /usr/local/sonar-scanner 10.0.0.6:/usr/local/</span>
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#scp -r /usr/local/maven/ 10.0.0.6:/usr/local/</span>

<span class="token number">3</span>.将所有用到的shell脚本拷贝到lb02
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#scp jenkins_notify.py 10.0.0.6:/root/</span>
<span class="token punctuation">[</span>root@lb02:~<span class="token punctuation">]</span><span class="token comment">#mkdir /server/scripts -p</span>
<span class="token punctuation">[</span>root@jenkins:~<span class="token punctuation">]</span><span class="token comment">#scp /server/scripts/* 10.0.0.6:/server/scripts/</span>

<span class="token number">4</span>.jenkins服务端添加从节点lb02
PS: 把lb02的公钥上传至gitlab 拥有下载代码的权限
点击系统管理-<span class="token operator">&gt;</span>节点管理-<span class="token operator">&gt;</span>新建节点
<span class="token punctuation">[</span>root@lb02:~<span class="token punctuation">]</span><span class="token comment">#ssh-keygen</span>
<span class="token punctuation">[</span>root@lb02:~<span class="token punctuation">]</span><span class="token comment">#cat .ssh/id_rsa.pub</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p><img src="/devops/public/assets/img/1728553755307.5eb63322.png" alt="1728553755307"></p> <p>jenkins添加从节点lb02</p> <p><img src="/devops/public/assets/img/1728553800445.072efed7.png" alt="1728553800445"></p> <p><img src="/devops/public/assets/img/1728553813071.2b13140b.png" alt="1728553813071"></p> <p><img src="/devops/public/assets/img/1728553834941.38259a3b.png" alt="1728553834941"></p> <p><img src="/devops/public/assets/img/1728553967748.bf6cc95a.png" alt="1728553967748"></p> <p><img src="/devops/public/assets/img/1728554072324.d4f9cb72.png" alt="1728554072324"></p> <p><img src="/devops/public/assets/img/1728554354662.1f72111b.png" alt="1728554354662"></p> <p><img src="/devops/public/assets/img/1728554363413.08d5d1b2.png" alt="1728554363413"></p> <p><img src="/devops/public/assets/img/1728554438085.ec31c691.png" alt="1728554438085"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@lb02-6:~<span class="token punctuation">]</span><span class="token comment">#umount -lf /tmp</span>
<span class="token punctuation">[</span>root@jenkins:.~<span class="token punctuation">]</span><span class="token comment">#systemctl restart jenkins</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p><img src="/devops/public/assets/img/1728556652234.bbd2e71f.png" alt="1728556652234"></p> <p><img src="/devops/public/assets/img/1728556775307.60426141.png" alt="1728556775307"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>lb02和web服务器做免秘钥
<span class="token punctuation">[</span>root@lb02:~<span class="token punctuation">]</span><span class="token comment">#ssh-copy-id 10.0.0.8</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>还需要手动打通：</p> <p><img src="/devops/public/assets/img/1728557251403.fc58ad30.png" alt="1728557251403"></p> <p>立即构建：</p> <p><img src="/devops/public/assets/img/1728557405687.b953543d.png" alt="1728557405687"></p> <p><img src="/devops/public/assets/img/1728557390581.91891b01.png" alt="1728557390581"></p> <p><img src="/devops/public/assets/img/1728557608171.e41f9697.png" alt="1728557608171"></p> <h2 id="五-代码发布流程"><a href="#五-代码发布流程" class="header-anchor">#</a> 五，代码发布流程</h2> <h3 id="_1-直接发布"><a href="#_1-直接发布" class="header-anchor">#</a> 1，直接发布</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>使用拷贝或者直接使用FTP方式进行发布代码，早期使用此种发布方式
优点: 成本较低，发布速度快，简单粗暴
缺点: 出现问题直接影响用户，回退代码较慢

适用场景:
<span class="token number">1</span>.开发测试场景
<span class="token number">2</span>.不影响用户的业务
<span class="token number">3</span>.初创型公司，流量较少，可以选择流量低谷期发布代码
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><img src="/devops/public/assets/img/1728544276691.fc122e6f.png" alt="1728544276691"></p> <p><img src="/devops/public/assets/img/1728544284586.7c35e716.png" alt="1728544284586"></p> <h3 id="_2-金丝雀发布"><a href="#_2-金丝雀发布" class="header-anchor">#</a> 2，金丝雀发布</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>.金丝雀发布一般先发 <span class="token number">1</span> 台，或者一个小比例，例如 <span class="token number">2</span>% 的服务器，主要做流量验证用，也称为金丝雀 <span class="token punctuation">(</span>Canary<span class="token punctuation">)</span> 测试（国内常称灰度测试）。以前旷工开矿下矿洞前，先会放一只金丝雀进去探是否有有毒气体，看金丝雀能否活下来，金丝
雀发布由此得名。简单的金丝雀测试一般通过手工测试验证，复杂的金丝雀测试需要比较完善的监控基础设施配合，通过
监控指标反馈，观察金丝雀的健康状况，作为后续发布或回退的依据。

<span class="token number">2</span>.如果金丝测试通过，则把剩余的 V1 版本全部升级为 V2 版本。如果金丝雀测试失败，则直接回退金丝雀，发布失败

优点: 用户体验影响小，出现问题只对少数用户有影响
缺点: 自动化程度不够，发布期间可能引发服务的中断

适用场合:
<span class="token number">1</span>.对新代码缺乏自信，在判断测试过程中的项目
<span class="token number">2</span>.用户体验要求较高的网站业务
<span class="token number">3</span>.缺乏足够自动化发布的公司
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p><img src="/devops/public/assets/img/1728544333852.0b707c79.png" alt="1728544333852"></p> <p><img src="/devops/public/assets/img/1728544343492.2085182c.png" alt="1728544343492"></p> <p><img src="/devops/public/assets/img/1728544349673.e594b652.png" alt="1728544349673"></p> <h3 id="_3-滚动式发布"><a href="#_3-滚动式发布" class="header-anchor">#</a> 3，滚动式发布</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>在金丝雀发布基础上的进一步优化改进，是一种自动化程度较高的发布方式，用户体验比较平滑，是目前成熟型技术组织
所采用的主流发布方式。单服务器组下的滚动发布的简化步骤如下图所示：
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/devops/public/assets/img/1728544379439.267b16fb.png" alt="1728544379439"></p> <p><img src="/devops/public/assets/img/1728544392996.0f1c98ba.png" alt="1728544392996"></p> <p><img src="/devops/public/assets/img/1728544401349.82d9d7b7.png" alt="1728544401349"></p> <p><img src="/devops/public/assets/img/1728544408677.eb1eff94.png" alt="1728544408677"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>. 滚动式发布一般先发 <span class="token number">1</span> 台，或者一个小比例，如 <span class="token number">2</span>% 服务器，主要做流量验证用，类似金丝雀 <span class="token punctuation">(</span>Canary<span class="token punctuation">)</span> 测试。

<span class="token number">2</span>. 滚动式发布需要比较复杂的发布工具和智能 LB，支持平滑的版本替换和流量拉入拉出。

<span class="token number">3</span>. 每次发布时，先将老版本 V1 流量从 LB 上摘除，然后清除老版本，发新版本 V2，再将 LB 流量接入新版本。这样
可以尽量保证用户体验不受影响。

<span class="token number">4</span>. 一次滚动式发布一般由若干个发布批次组成，每批的数量一般是可以配置的（可以通过发布模板定义）。例如第一
批 <span class="token number">1</span> 台（金丝雀），第二批 <span class="token number">10</span>%，第三批 <span class="token number">50</span>%，第四批 <span class="token number">100</span>%。每个批次之间留观察间隔，通过手工验证或监控
反馈确保没有问题再发下一批次，所以总体上滚动式发布过程是比较缓慢的 <span class="token punctuation">(</span>其中金丝雀的时间一般会比后续批次
更长，比如金丝雀 <span class="token number">10</span> 分钟，后续间隔 <span class="token number">2</span> 分钟<span class="token punctuation">)</span>。

<span class="token number">5</span>. 回退是发布的逆过程，将新版本流量从 LB 上摘除，清除新版本，发老版本，再将 LB 流量接入老版本。和发布过程
一样，回退过程一般也比较慢的。

<span class="token number">6</span>. 滚动式发布国外术语通常叫 Rolling Update Deployment。

优点: 用户体验影响小
缺点: 发布和回滚时间比较缓慢，发布工具比较复杂，负载需要平滑的流量摘除和拉入能力

使用场景:
<span class="token number">1</span>.用户体验不能中断的业务
<span class="token number">2</span>.有一定复杂发布工具的研发能力
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_4-双服务器级发布"><a href="#_4-双服务器级发布" class="header-anchor">#</a> 4，双服务器级发布</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>随着云计算和虚拟化技术的成熟，特别是容器等轻量级虚拟化技术的引入，计算资源受限和申请缓慢问题已经逐步解决，
可以做到弹性按需分配。为一次发布分配两组服务器，一组运行现有的 V1 老版本，一组运行待上线的 V2 新版本，再通
过 LB 切换流量方式完成发布，这就是所谓的双服务器组发布方式。

01.蓝绿发布
蓝绿发布仅适用于双服务器组发布，可以认为是对直接发布的一种简单优化发布方式。简化过程如下图所示：
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p><img src="/devops/public/assets/img/1728544467874.ab718f59.png" alt="1728544467874"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>. V1 版本称为蓝组，V2 版本称为绿组，发布时通过 LB 一次性将流量从蓝组直接切换到绿组，不经过金丝雀和滚动
发布，蓝绿发布由此得名；
<span class="token number">2</span>. 出现问题回退也很直接，通过 LB 直接将流量切回蓝组。
<span class="token number">3</span>. 发布初步成功后，蓝组机器一般不直接回收，而是留一个待观察期，视具体情况观察期的时间可长可短，观察期过
后确认发布无问题，则可以回收蓝组机器。

优势：升级切换和回退速度非常快
缺点: 切换是全量的，如果 V2 版本有问题，则对用户体验有直接影响；需要两倍的机器资源，成本较高

使用场合:
<span class="token number">1</span>.对用户体验有一定容忍度的场景
<span class="token number">2</span>.机器资源有富余或者可以按需分配（AWS 云，或自建容器云）
<span class="token number">3</span>.暂不具备复杂滚动发布工具研发能力
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="_5-金丝雀发布-双组服务器"><a href="#_5-金丝雀发布-双组服务器" class="header-anchor">#</a> 5，金丝雀发布 双组服务器</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>对蓝绿部署的一种简单优化，发布时先从绿组拉入 <span class="token number">1</span> 台金丝雀，待金丝雀验证通过再发全量。对比蓝绿发布，该发布方
式的优势是有一个生产流量的金丝雀验证过程，可以减轻 V2 可能有问题的风险和影响面。简化发布过程如下图所示：
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/devops/public/assets/img/1728544536224.f4eab9ac.png" alt="1728544536224"></p> <h3 id="_6-滚动式发布-双组服务器"><a href="#_6-滚动式发布-双组服务器" class="header-anchor">#</a> 6，滚动式发布 双组服务器</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>滚动式发布是对上面的蓝绿和金丝雀发布的进一步优化，按批次增量滚动发布，提供更平滑的用户体验。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="/devops/public/assets/img/1728544573621.381c0e1f.png" alt="1728544573621"></p> <p><img src="/devops/public/assets/img/1728544582549.566e7a1f.png" alt="1728544582549"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token number">1</span>. 发布前先申请一批新服务器，数量一般和 V1 版本相同，将 V2 版本应用发布到新服务器上。例如如果在 AWS 云
上，则可以直接调用 API 申请一批新 VM，如果用容器云 Kubernetes，则可以直接启动一批新容器（使用 V2 版
本容器镜像）。
<span class="token number">2</span>. 一般会先通过 LB 拉入 <span class="token number">1</span> 台 V2 版本的机器，这台机器也相当于金丝雀，用于流量验证。
<span class="token number">3</span>. 逐步按批次完成发布，每批只需要通过 LB 拉入 V2 版本，再拉出对应数量的 V1 版本。批次之间留有观察间隔，通
过手工或监控反馈确保没有问题再继续发布。
<span class="token number">4</span>. 发布有问题回退很快，直接通过 LB 将流量切回 V1 即可。
<span class="token number">5</span>. 完成发布后，一般 V1 版本要保留观察以备万一，比如留 <span class="token number">1</span> 天，1 天后没有问题则回收 V1 机器资源。

优点: 用户体验影响小，升级切换回退速度比单服务器组滚动发布速度快，LB切流量即可
缺点: 成本较高，需要两倍机器资源，发布工具比较复杂，LB需要流量切换能力

使用场景：
<span class="token number">1</span>.用户体验不能中断的网站业务场景
<span class="token number">2</span>.机器资源有富余或者可以按需分配（AWS 云，或自建容器云）
<span class="token number">3</span>.有一定的发布工具研发能力

其他发布方式:
<span class="token number">1</span>.功能开关
<span class="token number">2</span>.A/B测试
<span class="token number">3</span>.影子测试
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><h2 id="六-项目经验"><a href="#六-项目经验" class="header-anchor">#</a> 六，项目经验</h2> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>项目经验: 代码自动化发布

项目需求:
<span class="token number">1</span>.运维配合开发测试占用大量的时间
<span class="token number">2</span>.快速实现CICD从而尽早发现代码或部署过程中存在的问题
<span class="token number">3</span>.使用参数化构建进行线上发布降低出错率、实现秒级回滚
<span class="token number">4</span>.发布结果通知相关人员

实现项目:
<span class="token number">1</span>.搭建Gitlab服务器并控制项目权限
<span class="token number">2</span>.搭建并配置Jenkins服务器
<span class="token number">3</span>.按项目需求创建
    TAG项目<span class="token punctuation">(</span>为MASTER主干打标签<span class="token punctuation">)</span>
    测试项目<span class="token punctuation">(</span>快速CI CD及早发现问题并且配置自动触发不要运维干预<span class="token punctuation">)</span>
    JAVA项目<span class="token punctuation">(</span>jenkins集成mvn编译并发布测试环境<span class="token punctuation">)</span>
    发布项目<span class="token punctuation">(</span>利用tag标签进行线上发布和秒级回滚<span class="token punctuation">)</span>
<span class="token number">4</span>.搭建SonarQube代码质量检测平台<span class="token punctuation">(</span>Jenkins集成Sonar进行自动化代码分析检测<span class="token punctuation">)</span>
<span class="token number">5</span>.搭建Nexus私服<span class="token punctuation">(</span>java代码下载依赖快速编译<span class="token punctuation">)</span>
<span class="token number">6</span>.编写Jenkins-pipeline流水线<span class="token punctuation">(</span>看板方式快速定位问题<span class="token punctuation">)</span>
<span class="token number">7</span>.Jenkins增加三台从节点实现分布式构建<span class="token punctuation">(</span>提高项目的构建速度和稳定性<span class="token punctuation">)</span>
<span class="token number">8</span>.Jenkins集成第三方插件发送构建结果到运维开发组
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#一-线上发布流程" class="sidebar-link reco-side-一-线上发布流程" data-v-b57cc07c>一，线上发布流程</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_1-配置jenkins获取gitlab中所有的版本" class="sidebar-link reco-side-_1-配置jenkins获取gitlab中所有的版本" data-v-b57cc07c>1，配置jenkins获取gitlab中所有的版本</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_2-让web02充当生产环境" class="sidebar-link reco-side-_2-让web02充当生产环境" data-v-b57cc07c>2，让web02充当生产环境</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_3-发版" class="sidebar-link reco-side-_3-发版" data-v-b57cc07c>3，发版</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_4-配置代码回滚" class="sidebar-link reco-side-_4-配置代码回滚" data-v-b57cc07c>4，配置代码回滚</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_5-避免重复构建" class="sidebar-link reco-side-_5-避免重复构建" data-v-b57cc07c>5，避免重复构建</a></li><li class="level-2" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#二-流水线" class="sidebar-link reco-side-二-流水线" data-v-b57cc07c>二，流水线</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_1-cicd" class="sidebar-link reco-side-_1-cicd" data-v-b57cc07c>1，CICD</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_2-pipline介绍" class="sidebar-link reco-side-_2-pipline介绍" data-v-b57cc07c>2，pipline介绍</a></li><li class="level-2" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#三-java项目发布流程" class="sidebar-link reco-side-三-java项目发布流程" data-v-b57cc07c>三，java项目发布流程</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_1-maven介绍" class="sidebar-link reco-side-_1-maven介绍" data-v-b57cc07c>1，Maven介绍</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_2-集成jenkins" class="sidebar-link reco-side-_2-集成jenkins" data-v-b57cc07c>2，集成jenkins</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_3-配置nexus私服" class="sidebar-link reco-side-_3-配置nexus私服" data-v-b57cc07c>3，配置nexus私服</a></li><li class="level-2" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#四-配置jenkins的分布式" class="sidebar-link reco-side-四-配置jenkins的分布式" data-v-b57cc07c>四，配置Jenkins的分布式</a></li><li class="level-2" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#五-代码发布流程" class="sidebar-link reco-side-五-代码发布流程" data-v-b57cc07c>五，代码发布流程</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_1-直接发布" class="sidebar-link reco-side-_1-直接发布" data-v-b57cc07c>1，直接发布</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_2-金丝雀发布" class="sidebar-link reco-side-_2-金丝雀发布" data-v-b57cc07c>2，金丝雀发布</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_3-滚动式发布" class="sidebar-link reco-side-_3-滚动式发布" data-v-b57cc07c>3，滚动式发布</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_4-双服务器级发布" class="sidebar-link reco-side-_4-双服务器级发布" data-v-b57cc07c>4，双服务器级发布</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_5-金丝雀发布-双组服务器" class="sidebar-link reco-side-_5-金丝雀发布-双组服务器" data-v-b57cc07c>5，金丝雀发布 双组服务器</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#_6-滚动式发布-双组服务器" class="sidebar-link reco-side-_6-滚动式发布-双组服务器" data-v-b57cc07c>6，滚动式发布 双组服务器</a></li><li class="level-2" data-v-b57cc07c><a href="/devops/public/blogs/devops/43-jenkins/1.html#六-项目经验" class="sidebar-link reco-side-六-项目经验" data-v-b57cc07c>六，项目经验</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/devops/public/assets/js/app.5825cff9.js" defer></script><script src="/devops/public/assets/js/113.2f71a2bc.js" defer></script><script src="/devops/public/assets/js/1.774fca24.js" defer></script><script src="/devops/public/assets/js/46.8368b159.js" defer></script>
  </body>
</html>
