(window.webpackJsonp=window.webpackJsonp||[]).push([[232],{14619:function(s,e,a){"use strict";a.r(e);var t=a(2),r=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h2",{attrs:{id:"修改自-https-github-com-lisong-code-push-server"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改自-https-github-com-lisong-code-push-server"}},[s._v("#")]),s._v(" 修改自 "),e("a",{attrs:{href:"https://github.com/lisong/code-push-server",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://github.com/lisong/code-push-server"),e("OutboundLink")],1)]),s._v(" "),e("h1",{attrs:{id:"docker-部署-code-push-server"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#docker-部署-code-push-server"}},[s._v("#")]),s._v(" docker 部署 code-push-server")]),s._v(" "),e("blockquote",[e("p",[s._v("该文档用于描述docker部署code-push-server，实例包含三个部分")])]),s._v(" "),e("ul",[e("li",[s._v("code-push-server部分\n"),e("ul",[e("li",[s._v("更新包默认采用"),e("code",[s._v("local")]),s._v("存储(即存储在本地机器上)。使用docker volume存储方式，容器销毁不会导致数据丢失，除非人为删除volume。")]),s._v(" "),e("li",[s._v("内部使用pm2 cluster模式管理进程，默认开启进程数为cpu数，可以根据自己机器配置设置docker-compose.yml文件中deploy参数。")]),s._v(" "),e("li",[s._v("docker-compose.yml只提供了应用的一部分参数设置，如需要设置其他配置，可以修改文件config.js。")])])]),s._v(" "),e("li",[s._v("mysql部分\n"),e("ul",[e("li",[s._v("数据使用docker volume存储方式，容器销毁不会导致数据丢失，除非人为删除volume。")]),s._v(" "),e("li",[s._v("应用请勿使用root用户，为了安全可以创建权限相对较小的权限供code-push-server使用，只需要给予"),e("code",[s._v("select,update,insert")]),s._v("权限即可。初始化数据库需要使用root或有建表权限用户")])])]),s._v(" "),e("li",[s._v("redis部分\n"),e("ul",[e("li",[e("code",[s._v("tryLoginTimes")]),s._v(" 登录错误次数限制")]),s._v(" "),e("li",[e("code",[s._v("updateCheckCache")]),s._v(" 提升应用性能")]),s._v(" "),e("li",[e("code",[s._v("rolloutClientUniqueIdCache")]),s._v(" 灰度发布")])])])]),s._v(" "),e("h2",{attrs:{id:"安装docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#安装docker"}},[s._v("#")]),s._v(" 安装docker")]),s._v(" "),e("p",[s._v("参考docker官方安装教程")]),s._v(" "),e("ul",[e("li",[e("a",{attrs:{href:"https://docs.docker.com/docker-for-mac/install/",target:"_blank",rel:"noopener noreferrer"}},[s._v(">>mac点这里"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://docs.docker.com/docker-for-windows/install/",target:"_blank",rel:"noopener noreferrer"}},[s._v(">>windows点这里"),e("OutboundLink")],1)]),s._v(" "),e("li",[e("a",{attrs:{href:"https://docs.docker.com/install/linux/docker-ce/ubuntu/",target:"_blank",rel:"noopener noreferrer"}},[s._v(">>linux点这里"),e("OutboundLink")],1)])]),s._v(" "),e("p",[e("code",[s._v("$ docker info")]),s._v(" 能成功输出相关信息，则安装成功，才能继续下面步骤")]),s._v(" "),e("h2",{attrs:{id:"启动swarm"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#启动swarm"}},[s._v("#")]),s._v(" 启动swarm")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm init\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h2",{attrs:{id:"获取代码"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#获取代码"}},[s._v("#")]),s._v(" 获取代码")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" clone https://github.com/lisong/code-push-server.git\n$ "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" code-push-server/docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h2",{attrs:{id:"修改配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#修改配置文件"}},[s._v("#")]),s._v(" 修改配置文件")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" docker-compose.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[e("em",[s._v("将"),e("code",[s._v("DOWNLOAD_URL")]),s._v("中"),e("code",[s._v("YOU_MACHINE_IP")]),s._v("替换成本机外网ip或者域名")])]),s._v(" "),e("p",[e("em",[s._v("将"),e("code",[s._v("MYSQL_HOST")]),s._v("中"),e("code",[s._v("YOU_MACHINE_IP")]),s._v("替换成本机内网ip")])]),s._v(" "),e("p",[e("em",[s._v("将"),e("code",[s._v("REDIS_HOST")]),s._v("中"),e("code",[s._v("YOU_MACHINE_IP")]),s._v("替换成本机内网ip")])]),s._v(" "),e("h2",{attrs:{id:"jwt-tokensecret修改"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#jwt-tokensecret修改"}},[s._v("#")]),s._v(" jwt.tokenSecret修改")]),s._v(" "),e("blockquote",[e("p",[s._v("code-push-server 验证登录验证方式使用的json web token加密方式,该对称加密算法是公开的，所以修改config.js中tokenSecret值很重要。")])]),s._v(" "),e("p",[e("em",[s._v("非常重要！非常重要！ 非常重要！")])]),s._v(" "),e("blockquote",[e("p",[s._v("可以打开连接"),e("code",[s._v("https://www.grc.com/passwords.htm")]),s._v("获取 "),e("code",[s._v("63 random alpha-numeric characters")]),s._v("类型的随机生成数作为密钥")])]),s._v(" "),e("h2",{attrs:{id:"部署"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#部署"}},[s._v("#")]),s._v(" 部署")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stack deploy "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" docker-compose.yml code-push-server\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("blockquote",[e("p",[s._v("如果网速不佳，需要漫长而耐心的等待。。。去和妹子聊会天吧^_^")])]),s._v(" "),e("h2",{attrs:{id:"查看进展"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看进展"}},[s._v("#")]),s._v(" 查看进展")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v("\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" code-push-server_db\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" code-push-server_redis\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("ps")]),s._v(" code-push-server_server\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br")])]),e("blockquote",[e("p",[s._v("确认"),e("code",[s._v("CURRENT STATE")]),s._v(" 为 "),e("code",[s._v("Running about ...")]),s._v(", 则已经部署完成")])]),s._v(" "),e("h2",{attrs:{id:"访问接口简单验证"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#访问接口简单验证"}},[s._v("#")]),s._v(" 访问接口简单验证")]),s._v(" "),e("p",[e("code",[s._v("$ curl -I http://YOUR_CODE_PUSH_SERVER_IP:3000/")])]),s._v(" "),e("p",[s._v("返回"),e("code",[s._v("200 OK")])]),s._v(" "),e("div",{staticClass:"language-http line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-http"}},[e("code",[e("span",{pre:!0,attrs:{class:"token response-status"}},[e("span",{pre:!0,attrs:{class:"token http-version property"}},[s._v("HTTP/1.1")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token status-code number"}},[s._v("200")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token reason-phrase string"}},[s._v("OK")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("X-DNS-Prefetch-Control")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[s._v("off")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("X-Frame-Options")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[s._v("SAMEORIGIN")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("Strict-Transport-Security")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token header-value hsts languages-hsts"}},[s._v("max-age=15552000; includeSubDomains")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("X-Download-Options")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[s._v("noopen")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("X-Content-Type-Options")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[s._v("nosniff")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("X-XSS-Protection")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[s._v("1; mode=block")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("Content-Type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[s._v("text/html; charset=utf-8")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("Content-Length")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[s._v("592")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("ETag")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[s._v('W/"250-IiCMcM1ZUFSswSYCU0KeFYFEMO8"')])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("Date")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[s._v("Sat, 25 Aug 2018 15:45:46 GMT")])]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token header"}},[e("span",{pre:!0,attrs:{class:"token header-name keyword"}},[s._v("Connection")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token header-value"}},[s._v("keep-alive")])]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br")])]),e("h2",{attrs:{id:"浏览器登录"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#浏览器登录"}},[s._v("#")]),s._v(" 浏览器登录")]),s._v(" "),e("blockquote",[e("p",[s._v("默认用户名:admin 密码:123456 记得要修改默认密码哦\n如果登录连续输错密码超过一定次数，会限定无法再登录. 需要清空redis缓存")])]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ redis-cli "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-p6388")]),s._v("  "),e("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入redis")]),s._v("\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" flushall\n"),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" quit\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"查看服务日志"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看服务日志"}},[s._v("#")]),s._v(" 查看服务日志")]),s._v(" "),e("div",{staticClass:"language-shell line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-shell"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" logs code-push-server_server\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" logs code-push-server_db\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" logs code-push-server_redis\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h2",{attrs:{id:"查看存储-docker-volume-ls"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#查看存储-docker-volume-ls"}},[s._v("#")]),s._v(" 查看存储 "),e("code",[s._v("docker volume ls")])]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("DRIVER")]),s._v(" "),e("th",[s._v("VOLUME NAME")]),s._v(" "),e("th",[s._v("描述")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("local")]),s._v(" "),e("td",[s._v("code-push-server_data-mysql")]),s._v(" "),e("td",[s._v("数据库存储数据目录")])]),s._v(" "),e("tr",[e("td",[s._v("local")]),s._v(" "),e("td",[s._v("code-push-server_data-storage")]),s._v(" "),e("td",[s._v("存储打包文件目录")])]),s._v(" "),e("tr",[e("td",[s._v("local")]),s._v(" "),e("td",[s._v("code-push-server_data-tmp")]),s._v(" "),e("td",[s._v("用于计算更新包差异文件临时目录")])]),s._v(" "),e("tr",[e("td",[s._v("local")]),s._v(" "),e("td",[s._v("code-push-server_data-redis")]),s._v(" "),e("td",[s._v("redis落地数据")])])])]),s._v(" "),e("h2",{attrs:{id:"销毁退出应用"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#销毁退出应用"}},[s._v("#")]),s._v(" 销毁退出应用")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" stack "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" code-push-server\n$ "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v(" swarm leave "),e("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--force")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])])])}),[],!1,null,null,null);e.default=r.exports}}]);