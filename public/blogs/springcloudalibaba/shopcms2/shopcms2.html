<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>09-shoping项目02 | devops</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/devops/public/favicon.ico">
    <meta name="description" content="快来玩devops">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/devops/public/assets/css/0.styles.4a69f283.css" as="style"><link rel="preload" href="/devops/public/assets/js/app.dadcdc75.js" as="script"><link rel="preload" href="/devops/public/assets/js/105.a42e65d8.js" as="script"><link rel="preload" href="/devops/public/assets/js/1.774fca24.js" as="script"><link rel="preload" href="/devops/public/assets/js/50.02485a08.js" as="script"><link rel="prefetch" href="/devops/public/assets/js/10.ad22e743.js"><link rel="prefetch" href="/devops/public/assets/js/100.31e7e1df.js"><link rel="prefetch" href="/devops/public/assets/js/101.4a774685.js"><link rel="prefetch" href="/devops/public/assets/js/102.9037ecd4.js"><link rel="prefetch" href="/devops/public/assets/js/103.70dfad9b.js"><link rel="prefetch" href="/devops/public/assets/js/104.0e5c92d2.js"><link rel="prefetch" href="/devops/public/assets/js/106.0cacd048.js"><link rel="prefetch" href="/devops/public/assets/js/107.f36ea571.js"><link rel="prefetch" href="/devops/public/assets/js/108.8577b053.js"><link rel="prefetch" href="/devops/public/assets/js/109.c3fce4f6.js"><link rel="prefetch" href="/devops/public/assets/js/11.b9bf58c5.js"><link rel="prefetch" href="/devops/public/assets/js/110.37fac6ac.js"><link rel="prefetch" href="/devops/public/assets/js/111.f5b56db0.js"><link rel="prefetch" href="/devops/public/assets/js/112.733ae51b.js"><link rel="prefetch" href="/devops/public/assets/js/113.579075b7.js"><link rel="prefetch" href="/devops/public/assets/js/114.c0f57d7e.js"><link rel="prefetch" href="/devops/public/assets/js/115.a94a2269.js"><link rel="prefetch" href="/devops/public/assets/js/116.b6148eb1.js"><link rel="prefetch" href="/devops/public/assets/js/117.7398e0b4.js"><link rel="prefetch" href="/devops/public/assets/js/118.d026029a.js"><link rel="prefetch" href="/devops/public/assets/js/119.d06a9d2f.js"><link rel="prefetch" href="/devops/public/assets/js/12.7ef8a4d6.js"><link rel="prefetch" href="/devops/public/assets/js/120.9fc5d076.js"><link rel="prefetch" href="/devops/public/assets/js/121.e6b69fb5.js"><link rel="prefetch" href="/devops/public/assets/js/122.5b7b52fe.js"><link rel="prefetch" href="/devops/public/assets/js/123.6bbe18eb.js"><link rel="prefetch" href="/devops/public/assets/js/124.76db2368.js"><link rel="prefetch" href="/devops/public/assets/js/125.69f51a88.js"><link rel="prefetch" href="/devops/public/assets/js/126.b5c5e332.js"><link rel="prefetch" href="/devops/public/assets/js/127.d80e7068.js"><link rel="prefetch" href="/devops/public/assets/js/128.be063492.js"><link rel="prefetch" href="/devops/public/assets/js/129.96e0a67f.js"><link rel="prefetch" href="/devops/public/assets/js/13.f43eb2c8.js"><link rel="prefetch" href="/devops/public/assets/js/130.be1b8431.js"><link rel="prefetch" href="/devops/public/assets/js/131.85c70099.js"><link rel="prefetch" href="/devops/public/assets/js/132.c8804efc.js"><link rel="prefetch" href="/devops/public/assets/js/133.0e86b8cc.js"><link rel="prefetch" href="/devops/public/assets/js/134.87a1586f.js"><link rel="prefetch" href="/devops/public/assets/js/135.8ccb33f9.js"><link rel="prefetch" href="/devops/public/assets/js/136.8f6fb866.js"><link rel="prefetch" href="/devops/public/assets/js/137.65f421c6.js"><link rel="prefetch" href="/devops/public/assets/js/138.89bb38e7.js"><link rel="prefetch" href="/devops/public/assets/js/139.b8de5ba4.js"><link rel="prefetch" href="/devops/public/assets/js/14.d78e49be.js"><link rel="prefetch" href="/devops/public/assets/js/140.cb281f53.js"><link rel="prefetch" href="/devops/public/assets/js/141.5a123915.js"><link rel="prefetch" href="/devops/public/assets/js/142.796e2565.js"><link rel="prefetch" href="/devops/public/assets/js/143.c50719dd.js"><link rel="prefetch" href="/devops/public/assets/js/144.64142ae2.js"><link rel="prefetch" href="/devops/public/assets/js/145.bb5ee5e5.js"><link rel="prefetch" href="/devops/public/assets/js/146.6d25174f.js"><link rel="prefetch" href="/devops/public/assets/js/147.51b777f2.js"><link rel="prefetch" href="/devops/public/assets/js/148.ea33221e.js"><link rel="prefetch" href="/devops/public/assets/js/149.50b52f31.js"><link rel="prefetch" href="/devops/public/assets/js/15.666ea4ca.js"><link rel="prefetch" href="/devops/public/assets/js/150.a5d1a71d.js"><link rel="prefetch" href="/devops/public/assets/js/151.12424a57.js"><link rel="prefetch" href="/devops/public/assets/js/152.67fafd80.js"><link rel="prefetch" href="/devops/public/assets/js/153.4aea3556.js"><link rel="prefetch" href="/devops/public/assets/js/154.bbafe3fd.js"><link rel="prefetch" href="/devops/public/assets/js/155.24ef0762.js"><link rel="prefetch" href="/devops/public/assets/js/156.bcde06c8.js"><link rel="prefetch" href="/devops/public/assets/js/157.96c0c565.js"><link rel="prefetch" href="/devops/public/assets/js/158.68ab2c03.js"><link rel="prefetch" href="/devops/public/assets/js/159.b5518f12.js"><link rel="prefetch" href="/devops/public/assets/js/16.f9331704.js"><link rel="prefetch" href="/devops/public/assets/js/160.0a428205.js"><link rel="prefetch" href="/devops/public/assets/js/161.015d72c6.js"><link rel="prefetch" href="/devops/public/assets/js/162.3481a4a7.js"><link rel="prefetch" href="/devops/public/assets/js/163.d15cf813.js"><link rel="prefetch" href="/devops/public/assets/js/164.27f761fc.js"><link rel="prefetch" href="/devops/public/assets/js/165.d9cb9a99.js"><link rel="prefetch" href="/devops/public/assets/js/166.c6e43ea4.js"><link rel="prefetch" href="/devops/public/assets/js/167.4e8916d9.js"><link rel="prefetch" href="/devops/public/assets/js/168.82bcd636.js"><link rel="prefetch" href="/devops/public/assets/js/169.27f2eab4.js"><link rel="prefetch" href="/devops/public/assets/js/17.958bd5d1.js"><link rel="prefetch" href="/devops/public/assets/js/170.db0bd3a2.js"><link rel="prefetch" href="/devops/public/assets/js/171.1c1dce86.js"><link rel="prefetch" href="/devops/public/assets/js/172.86467bf5.js"><link rel="prefetch" href="/devops/public/assets/js/173.f43ca193.js"><link rel="prefetch" href="/devops/public/assets/js/174.1bb4ea63.js"><link rel="prefetch" href="/devops/public/assets/js/175.d5d2d98e.js"><link rel="prefetch" href="/devops/public/assets/js/176.9f3f1ea6.js"><link rel="prefetch" href="/devops/public/assets/js/177.e2c2a318.js"><link rel="prefetch" href="/devops/public/assets/js/178.299e7827.js"><link rel="prefetch" href="/devops/public/assets/js/179.1bea63a9.js"><link rel="prefetch" href="/devops/public/assets/js/18.161aa7b3.js"><link rel="prefetch" href="/devops/public/assets/js/180.171868de.js"><link rel="prefetch" href="/devops/public/assets/js/181.1cb8486b.js"><link rel="prefetch" href="/devops/public/assets/js/182.0071b32a.js"><link rel="prefetch" href="/devops/public/assets/js/183.a6828b7f.js"><link rel="prefetch" href="/devops/public/assets/js/184.a0e06434.js"><link rel="prefetch" href="/devops/public/assets/js/185.3bee6142.js"><link rel="prefetch" href="/devops/public/assets/js/186.1662e60e.js"><link rel="prefetch" href="/devops/public/assets/js/187.16dee212.js"><link rel="prefetch" href="/devops/public/assets/js/188.9f998460.js"><link rel="prefetch" href="/devops/public/assets/js/189.d8b69ef1.js"><link rel="prefetch" href="/devops/public/assets/js/19.32a1e02e.js"><link rel="prefetch" href="/devops/public/assets/js/190.fd0e065f.js"><link rel="prefetch" href="/devops/public/assets/js/191.294b7ebb.js"><link rel="prefetch" href="/devops/public/assets/js/192.7fa6e7f5.js"><link rel="prefetch" href="/devops/public/assets/js/193.1edb4b73.js"><link rel="prefetch" href="/devops/public/assets/js/194.5a0faecf.js"><link rel="prefetch" href="/devops/public/assets/js/195.6cb830ed.js"><link rel="prefetch" href="/devops/public/assets/js/196.bcd44458.js"><link rel="prefetch" href="/devops/public/assets/js/197.775fb954.js"><link rel="prefetch" href="/devops/public/assets/js/198.1bb3608a.js"><link rel="prefetch" href="/devops/public/assets/js/199.e589aa6c.js"><link rel="prefetch" href="/devops/public/assets/js/20.7d3999d7.js"><link rel="prefetch" href="/devops/public/assets/js/200.793c3f93.js"><link rel="prefetch" href="/devops/public/assets/js/201.4a4c0ca6.js"><link rel="prefetch" href="/devops/public/assets/js/202.24c7f2f6.js"><link rel="prefetch" href="/devops/public/assets/js/203.fa1738e9.js"><link rel="prefetch" href="/devops/public/assets/js/204.6e6b8519.js"><link rel="prefetch" href="/devops/public/assets/js/205.defc2d50.js"><link rel="prefetch" href="/devops/public/assets/js/206.cdafce98.js"><link rel="prefetch" href="/devops/public/assets/js/207.0d76d50e.js"><link rel="prefetch" href="/devops/public/assets/js/208.e25188af.js"><link rel="prefetch" href="/devops/public/assets/js/209.b1e1dcc0.js"><link rel="prefetch" href="/devops/public/assets/js/21.7f772cf1.js"><link rel="prefetch" href="/devops/public/assets/js/210.95239011.js"><link rel="prefetch" href="/devops/public/assets/js/211.ddab5901.js"><link rel="prefetch" href="/devops/public/assets/js/212.71f72d76.js"><link rel="prefetch" href="/devops/public/assets/js/213.f5fd03e5.js"><link rel="prefetch" href="/devops/public/assets/js/214.9040b0fa.js"><link rel="prefetch" href="/devops/public/assets/js/215.83af0916.js"><link rel="prefetch" href="/devops/public/assets/js/216.4b9a3ef9.js"><link rel="prefetch" href="/devops/public/assets/js/217.6823b1a5.js"><link rel="prefetch" href="/devops/public/assets/js/218.24efe08b.js"><link rel="prefetch" href="/devops/public/assets/js/219.c43d3aa6.js"><link rel="prefetch" href="/devops/public/assets/js/22.b8ab2964.js"><link rel="prefetch" href="/devops/public/assets/js/23.db0544ec.js"><link rel="prefetch" href="/devops/public/assets/js/24.8c07adbe.js"><link rel="prefetch" href="/devops/public/assets/js/25.8f9ae246.js"><link rel="prefetch" href="/devops/public/assets/js/26.0cf95822.js"><link rel="prefetch" href="/devops/public/assets/js/27.80eb1ad5.js"><link rel="prefetch" href="/devops/public/assets/js/28.300805c8.js"><link rel="prefetch" href="/devops/public/assets/js/29.27445554.js"><link rel="prefetch" href="/devops/public/assets/js/3.7af58235.js"><link rel="prefetch" href="/devops/public/assets/js/30.a28f6c42.js"><link rel="prefetch" href="/devops/public/assets/js/31.8d010838.js"><link rel="prefetch" href="/devops/public/assets/js/32.a2be080b.js"><link rel="prefetch" href="/devops/public/assets/js/33.0b1b1bc7.js"><link rel="prefetch" href="/devops/public/assets/js/34.cf0c2544.js"><link rel="prefetch" href="/devops/public/assets/js/35.8fc9f8dd.js"><link rel="prefetch" href="/devops/public/assets/js/36.bb781215.js"><link rel="prefetch" href="/devops/public/assets/js/37.d4ab26f9.js"><link rel="prefetch" href="/devops/public/assets/js/38.017ab8c7.js"><link rel="prefetch" href="/devops/public/assets/js/39.58f15df8.js"><link rel="prefetch" href="/devops/public/assets/js/4.66cb6407.js"><link rel="prefetch" href="/devops/public/assets/js/40.c2416770.js"><link rel="prefetch" href="/devops/public/assets/js/41.791b307f.js"><link rel="prefetch" href="/devops/public/assets/js/42.ee21cf07.js"><link rel="prefetch" href="/devops/public/assets/js/43.3316267a.js"><link rel="prefetch" href="/devops/public/assets/js/44.de0c00d8.js"><link rel="prefetch" href="/devops/public/assets/js/45.3b40572e.js"><link rel="prefetch" href="/devops/public/assets/js/46.bc869e38.js"><link rel="prefetch" href="/devops/public/assets/js/47.7bfba321.js"><link rel="prefetch" href="/devops/public/assets/js/48.bb1b1ecc.js"><link rel="prefetch" href="/devops/public/assets/js/49.190da466.js"><link rel="prefetch" href="/devops/public/assets/js/5.4ab64804.js"><link rel="prefetch" href="/devops/public/assets/js/51.580a3e12.js"><link rel="prefetch" href="/devops/public/assets/js/52.829f4a04.js"><link rel="prefetch" href="/devops/public/assets/js/53.75b8086f.js"><link rel="prefetch" href="/devops/public/assets/js/54.cf38e3cb.js"><link rel="prefetch" href="/devops/public/assets/js/55.c26ae42f.js"><link rel="prefetch" href="/devops/public/assets/js/56.3bb7820a.js"><link rel="prefetch" href="/devops/public/assets/js/57.406a0ba8.js"><link rel="prefetch" href="/devops/public/assets/js/58.67381781.js"><link rel="prefetch" href="/devops/public/assets/js/59.ce780c58.js"><link rel="prefetch" href="/devops/public/assets/js/6.574a025d.js"><link rel="prefetch" href="/devops/public/assets/js/60.67c3bd36.js"><link rel="prefetch" href="/devops/public/assets/js/61.e302699d.js"><link rel="prefetch" href="/devops/public/assets/js/62.d5857c11.js"><link rel="prefetch" href="/devops/public/assets/js/63.bae3b65b.js"><link rel="prefetch" href="/devops/public/assets/js/64.93bcda4b.js"><link rel="prefetch" href="/devops/public/assets/js/65.de4945b6.js"><link rel="prefetch" href="/devops/public/assets/js/66.ecc68498.js"><link rel="prefetch" href="/devops/public/assets/js/67.45fb1d80.js"><link rel="prefetch" href="/devops/public/assets/js/68.33a06539.js"><link rel="prefetch" href="/devops/public/assets/js/69.7ef74474.js"><link rel="prefetch" href="/devops/public/assets/js/7.6f498a1e.js"><link rel="prefetch" href="/devops/public/assets/js/70.67aa431d.js"><link rel="prefetch" href="/devops/public/assets/js/71.6915b42e.js"><link rel="prefetch" href="/devops/public/assets/js/72.36c8bdaa.js"><link rel="prefetch" href="/devops/public/assets/js/73.79676ec0.js"><link rel="prefetch" href="/devops/public/assets/js/74.add3f32a.js"><link rel="prefetch" href="/devops/public/assets/js/75.7a216ff5.js"><link rel="prefetch" href="/devops/public/assets/js/76.d8174ebc.js"><link rel="prefetch" href="/devops/public/assets/js/77.3935cbcd.js"><link rel="prefetch" href="/devops/public/assets/js/78.cfc22475.js"><link rel="prefetch" href="/devops/public/assets/js/79.bd3b6e81.js"><link rel="prefetch" href="/devops/public/assets/js/8.2b0883e0.js"><link rel="prefetch" href="/devops/public/assets/js/80.8e9b965e.js"><link rel="prefetch" href="/devops/public/assets/js/81.c6890953.js"><link rel="prefetch" href="/devops/public/assets/js/82.fe273387.js"><link rel="prefetch" href="/devops/public/assets/js/83.50245f77.js"><link rel="prefetch" href="/devops/public/assets/js/84.b231f654.js"><link rel="prefetch" href="/devops/public/assets/js/85.ce27f9b0.js"><link rel="prefetch" href="/devops/public/assets/js/86.8763fc9b.js"><link rel="prefetch" href="/devops/public/assets/js/87.448c44c3.js"><link rel="prefetch" href="/devops/public/assets/js/88.58975deb.js"><link rel="prefetch" href="/devops/public/assets/js/89.617db810.js"><link rel="prefetch" href="/devops/public/assets/js/9.c0cd8842.js"><link rel="prefetch" href="/devops/public/assets/js/90.d0247cce.js"><link rel="prefetch" href="/devops/public/assets/js/91.57bc5f54.js"><link rel="prefetch" href="/devops/public/assets/js/92.896fb01e.js"><link rel="prefetch" href="/devops/public/assets/js/93.b8c8bd68.js"><link rel="prefetch" href="/devops/public/assets/js/94.b0dd6719.js"><link rel="prefetch" href="/devops/public/assets/js/95.702f212c.js"><link rel="prefetch" href="/devops/public/assets/js/96.d9e511f3.js"><link rel="prefetch" href="/devops/public/assets/js/97.c8fad16c.js"><link rel="prefetch" href="/devops/public/assets/js/98.7b90cbb1.js"><link rel="prefetch" href="/devops/public/assets/js/99.fccb37ee.js">
    <link rel="stylesheet" href="/devops/public/assets/css/0.styles.4a69f283.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>devops</h3> <p class="description" data-v-59e6cb88>快来玩devops</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>devops</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/devops/public/" class="home-link router-link-active"><img src="/devops/public/logo.png" alt="devops" class="logo"> <span class="site-name">devops</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/devops/public/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      devops
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/public/categories/HarmonyOS/" class="nav-link"><i class="undefined"></i>
  HarmonyOS
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/base/" class="nav-link"><i class="undefined"></i>
  base
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/data analysis/" class="nav-link"><i class="undefined"></i>
  data analysis
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/devops/" class="nav-link"><i class="undefined"></i>
  devops
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/每日一题/" class="nav-link"><i class="undefined"></i>
  每日一题
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/javabase/" class="nav-link"><i class="undefined"></i>
  javabase
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/javaweb/" class="nav-link"><i class="undefined"></i>
  javaweb
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/linux/" class="nav-link"><i class="undefined"></i>
  linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/pybase/" class="nav-link"><i class="undefined"></i>
  pybase
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/springcloud/" class="nav-link"><i class="undefined"></i>
  springcloud
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/spider/" class="nav-link"><i class="undefined"></i>
  spider
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/springcloudalibaba/" class="nav-link"><i class="undefined"></i>
  springcloudalibaba
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/ssm/" class="nav-link"><i class="undefined"></i>
  ssm
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/storage/" class="nav-link"><i class="undefined"></i>
  storage
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/zhifu/" class="nav-link"><i class="undefined"></i>
  zhifu
</a></li></ul></div></div><div class="nav-item"><a href="/devops/public/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/devops/public/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/public/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/devops/public/avatar.png" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    devops
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>206</h3> <h6 data-v-1fad0c41>Articles</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>43</h3> <h6 data-v-1fad0c41>Tags</h6></div></div> <ul class="social-links" data-v-1fad0c41></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/devops/public/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      devops
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/public/categories/HarmonyOS/" class="nav-link"><i class="undefined"></i>
  HarmonyOS
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/base/" class="nav-link"><i class="undefined"></i>
  base
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/data analysis/" class="nav-link"><i class="undefined"></i>
  data analysis
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/devops/" class="nav-link"><i class="undefined"></i>
  devops
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/每日一题/" class="nav-link"><i class="undefined"></i>
  每日一题
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/javabase/" class="nav-link"><i class="undefined"></i>
  javabase
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/javaweb/" class="nav-link"><i class="undefined"></i>
  javaweb
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/linux/" class="nav-link"><i class="undefined"></i>
  linux
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/pybase/" class="nav-link"><i class="undefined"></i>
  pybase
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/node/" class="nav-link"><i class="undefined"></i>
  node
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/python/" class="nav-link"><i class="undefined"></i>
  python
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/springcloud/" class="nav-link"><i class="undefined"></i>
  springcloud
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/spider/" class="nav-link"><i class="undefined"></i>
  spider
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/springcloudalibaba/" class="nav-link"><i class="undefined"></i>
  springcloudalibaba
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/ssm/" class="nav-link"><i class="undefined"></i>
  ssm
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/storage/" class="nav-link"><i class="undefined"></i>
  storage
</a></li><li class="dropdown-item"><!----> <a href="/devops/public/categories/zhifu/" class="nav-link"><i class="undefined"></i>
  zhifu
</a></li></ul></div></div><div class="nav-item"><a href="/devops/public/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/devops/public/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/devops/public/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>09-shoping项目02</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>devops</span>
          
        <span data-v-59e6cb88>2017 - </span>
        2024
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">09-shoping项目02</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>devops</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>12/15/2028</span></i> <!----> <i class="tags iconfont reco-tag" data-v-8a445198><span class="tag-item" data-v-8a445198>sentinel</span></i></div></div> <div class="theme-reco-content content__default"><h3 id="_1-申请阿里云短信"><a href="#_1-申请阿里云短信" class="header-anchor">#</a> 1，申请阿里云短信</h3> <p>访问阿里云<a href="https://www.aliyun.com/" target="_blank" rel="noopener noreferrer">https://www.aliyun.com/<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>，完成登录</p> <p><img src="/devops/public/assets/img/1726637853841.ff8a2c85.png" alt="1726637853841"></p> <p>进入短信服务</p> <p><img src="/devops/public/assets/img/1726637872293.7dd8f335.png" alt="1726637872293"></p> <p>开通短信服务</p> <p><img src="/devops/public/assets/img/1726637889858.b7bd1157.png" alt="1726637889858"></p> <p>购买短信条数</p> <p><img src="/devops/public/assets/img/1726637909843.21c9ba7a.png" alt="1726637909843"></p> <p>购买完成进入阿里云短信控制台<a href="https://dysms.console.aliyun.com/overview" target="_blank" rel="noopener noreferrer">https://dysms.console.aliyun.com/overview<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/devops/public/assets/img/1726637932525.abdd80eb.png" alt="1726637932525"></p> <p>绑定测试手机号</p> <p><img src="/devops/public/assets/img/1726637984393.7ddd599d.png" alt="1726637984393"></p> <p><img src="/devops/public/assets/img/1726637960677.ab6d9bc1.png" alt="1726637960677"></p> <p>点击调用API发送短信，可以看到发送短信的JAVA代码。</p> <p><img src="/devops/public/assets/img/1726638008550.5bb84b7c.png" alt="1726638008550"></p> <p><img src="/devops/public/assets/img/1726638025405.44f60269.png" alt="1726638025405"></p> <p>申请阿里云秘钥，该秘钥在发送短信时会作为参数传入</p> <p><img src="/devops/public/assets/img/1726638046702.113cab93.png" alt="1726638046702"></p> <p><img src="/devops/public/assets/img/1726638059330.bae2fdc1.png" alt="1726638059330"></p> <h3 id="_2-创建短信服务模块"><a href="#_2-创建短信服务模块" class="header-anchor">#</a> 2，创建短信服务模块</h3> <p>创建名为<code>shoping_message_service</code>的SpringBoot工程，添加相关依赖。</p> <p><img src="/devops/public/assets/img/1726800446534.14f85abc.png" alt="1726800446534"></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ityls<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shoping_common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 阿里短信平台 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>alibabacloud-dysmsapi20170525<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.0.24<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- dubbo --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.dubbo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dubbo-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.dubbo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dubbo-registry-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- nacos --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br></div></div><p>在Nacos配置中心创建配置文件<code>shoping_message_service-dev.yaml</code></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment"># 端口号</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9007</span>

<span class="token comment"># 日志格式</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">pattern</span><span class="token punctuation">:</span>
   <span class="token key atrule">console</span><span class="token punctuation">:</span> <span class="token string">'%d{HH:mm:ss.SSS} %clr(%-5level) ---  [%-15thread] %cyan(%-50logger{50}):%msg%n'</span>


<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
   <span class="token key atrule">name</span><span class="token punctuation">:</span> shoping_message_service <span class="token comment">#服务名</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
    <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
     <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 10.0.0.41<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># 注册中心地址</span>
<span class="token key atrule">dubbo</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
   <span class="token key atrule">name</span><span class="token punctuation">:</span> shoping_message_service <span class="token comment"># 项目名</span>
   <span class="token key atrule">serialize-check-status</span><span class="token punctuation">:</span> DISABLE
   <span class="token key atrule">check-serializable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">protocol</span><span class="token punctuation">:</span>
   <span class="token key atrule">name</span><span class="token punctuation">:</span> dubbo <span class="token comment"># 通讯协议</span>
   <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">-1</span> <span class="token comment"># 端口号，-1表示自动扫描可用端口。</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
   <span class="token key atrule">address</span><span class="token punctuation">:</span> nacos<span class="token punctuation">:</span>//10.0.0.41<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># 注册中心</span>


<span class="token key atrule">message</span><span class="token punctuation">:</span>
  <span class="token key atrule">accessKeyId</span><span class="token punctuation">:</span> LTAI5t6eNJyD98utmXqJHpH1
  <span class="token key atrule">accessKeySecret</span><span class="token punctuation">:</span> ViCEeUaCJzETV56TANhoogKDLcv1QA
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><p>编写配置文件<code>bootstrap.yml</code>，连接配置中心</p> <p><img src="/devops/public/assets/img/1726800592514.164726b4.png" alt="1726800592514"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
  <span class="token comment"># 环境</span>
   <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
   <span class="token comment"># 注册中心</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
     <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 10.0.0.41<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#注册中心地址</span>
     <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 9d7f5ef3<span class="token punctuation">-</span>29be<span class="token punctuation">-</span>4710<span class="token punctuation">-</span>85bd<span class="token punctuation">-</span>7b293e633ff6 <span class="token comment">#命名空间</span>
     <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#文件名后缀</span>
     <span class="token key atrule">prefix</span><span class="token punctuation">:</span> shoping_message_service <span class="token comment">#文件名</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>配置启动类</p> <p><img src="/devops/public/assets/img/1726800649889.35708cb4.png" alt="1726800649889"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@EnableDubbo</span>
<span class="token annotation punctuation">@RefreshScope</span>
<span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude<span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShoppingMessageServiceApplication</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ShoppingMessageServiceApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在<strong>通用模块</strong>编写发送短信服务接口</p> <p><img src="/devops/public/assets/img/1726800705586.433fed28.png" alt="1726800705586"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 短信服务
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">MessageService</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * 发送短信
   * @param phoneNumber 手机号
   * @param code 验证码
   * @return 返回结果
   */</span>
  <span class="token class-name">BaseResult</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> phoneNumber<span class="token punctuation">,</span><span class="token class-name">String</span> code<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>在<strong>短信服务</strong>模块编写发送短信实现类</p> <p><img src="/devops/public/assets/img/1726800876233.7137614b.png" alt="1726800876233"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DubboService</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MessageServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">MessageService</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${message.accessKeyId}&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> accessKeyId<span class="token punctuation">;</span>
  <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">&quot;${message.accessKeySecret}&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">private</span> <span class="token class-name">String</span> accessKeySecret<span class="token punctuation">;</span>


  <span class="token annotation punctuation">@SneakyThrows</span>
  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token class-name">BaseResult</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> phoneNumber<span class="token punctuation">,</span> <span class="token class-name">String</span> code<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Configure Credentials authentication information, including ak, secret, token</span>
    <span class="token class-name">StaticCredentialProvider</span> provider <span class="token operator">=</span> <span class="token class-name">StaticCredentialProvider</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Credential</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">// Please ensure that the environment variables ALIBABA_CLOUD_ACCESS_KEY_ID and ALIBABA_CLOUD_ACCESS_KEY_SECRET are set.</span>
         <span class="token punctuation">.</span><span class="token function">accessKeyId</span><span class="token punctuation">(</span>accessKeyId<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">accessKeySecret</span><span class="token punctuation">(</span>accessKeySecret<span class="token punctuation">)</span>
        <span class="token comment">//.securityToken(System.getenv(&quot;ALIBABA_CLOUD_SECURITY_TOKEN&quot;)) // use STS token</span>
         <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// Configure the Client</span>
    <span class="token class-name">AsyncClient</span> client <span class="token operator">=</span> <span class="token class-name">AsyncClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">region</span><span class="token punctuation">(</span><span class="token string">&quot;cn-hangzhou&quot;</span><span class="token punctuation">)</span> <span class="token comment">// Region ID</span>
        <span class="token comment">//.httpClient(httpClient) // Use the configured HttpClient, otherwise use the default HttpClient (Apache HttpClient)</span>
         <span class="token punctuation">.</span><span class="token function">credentialsProvider</span><span class="token punctuation">(</span>provider<span class="token punctuation">)</span>
        <span class="token comment">//.serviceConfiguration(Configuration.create()) // Service-level configuration</span>
        <span class="token comment">// Client-level configuration rewrite, can set Endpoint, Http request parameters, etc.</span>
         <span class="token punctuation">.</span><span class="token function">overrideConfiguration</span><span class="token punctuation">(</span>
            <span class="token class-name">ClientOverrideConfiguration</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment">// Endpoint 请参考 https://api.aliyun.com/product/Dysmsapi</span>
                 <span class="token punctuation">.</span><span class="token function">setEndpointOverride</span><span class="token punctuation">(</span><span class="token string">&quot;dysmsapi.aliyuncs.com&quot;</span><span class="token punctuation">)</span>
            <span class="token comment">//.setConnectTimeout(Duration.ofSeconds(30))</span>
         <span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// Parameter settings for API request</span>
    <span class="token class-name">SendSmsRequest</span> sendSmsRequest <span class="token operator">=</span> <span class="token class-name">SendSmsRequest</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">signName</span><span class="token punctuation">(</span><span class="token string">&quot;阿里云短信测试&quot;</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">templateCode</span><span class="token punctuation">(</span><span class="token string">&quot;SMS_154950909&quot;</span><span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">phoneNumbers</span><span class="token punctuation">(</span>phoneNumber<span class="token punctuation">)</span>
         <span class="token punctuation">.</span><span class="token function">templateParam</span><span class="token punctuation">(</span><span class="token string">&quot;{\&quot;code\&quot;:\&quot;&quot;</span> <span class="token operator">+</span> code <span class="token operator">+</span> <span class="token string">&quot;\&quot;}&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">// Request-level configuration rewrite, can set Http request parameters, etc.</span>
        <span class="token comment">// .requestConfiguration(RequestConfiguration.create().setHttpHeaders(new HttpHeaders()))</span>
         <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token comment">// Asynchronously get the return value of the API request</span>
    <span class="token class-name">CompletableFuture</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SendSmsResponse</span><span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">sendSms</span><span class="token punctuation">(</span>sendSmsRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Synchronously get the return value of the API request</span>
    <span class="token class-name">SendSmsResponse</span> resp <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Finally, close the client</span>
    client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


    <span class="token class-name">SendSmsResponseBody</span> respBody <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;OK&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>respBody<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BaseResult</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> respBody<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> respBody<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">BaseResult</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> respBody<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> respBody<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br></div></div><p>测试该方法:</p> <p><img src="/devops/public/assets/img/1726801043046.178a8005.png" alt="1726801043046"></p> <h3 id="_3-创建网站用户模块"><a href="#_3-创建网站用户模块" class="header-anchor">#</a> 3，创建网站用户模块</h3> <p>创建名为<code>shoping_user_service</code>的SpringBoot工程，添加相关依赖。</p> <p><img src="/devops/public/assets/img/1726801156773.f7c3f7f6.png" alt="1726801156773"></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- MyBatisPlus --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.baomidou<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mybatis-plus-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- mysql驱动 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>runtime<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ityls<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shopping_common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- dubbo --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.dubbo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dubbo-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.dubbo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dubbo-registry-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- nacos --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- redis --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br></div></div><p>在Nacos配置中心创建配置文件<code>shoping_user_service-dev.yaml</code></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment"># 端口号</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">9006</span>


<span class="token comment"># 日志格式</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">pattern</span><span class="token punctuation">:</span>
   <span class="token key atrule">console</span><span class="token punctuation">:</span> <span class="token string">'%d{HH:mm:ss.SSS} %clr(%-5level) ---  [%-15thread] %cyan(%-50logger{50}):%msg%n'</span>


<span class="token comment">#配置mybatis-plus</span>
<span class="token key atrule">mybatis-plus</span><span class="token punctuation">:</span>
  <span class="token key atrule">global-config</span><span class="token punctuation">:</span>
   <span class="token key atrule">db-config</span><span class="token punctuation">:</span>
   <span class="token comment"># 表名前缀</span>
    <span class="token key atrule">table-prefix</span><span class="token punctuation">:</span> ml_
   <span class="token comment"># 主键生成策略为自增</span>
    <span class="token key atrule">id-type</span><span class="token punctuation">:</span> auto
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span>
  <span class="token comment"># 关闭列名自动驼峰命名规则映射</span>
   <span class="token key atrule">map-underscore-to-camel-case</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
   <span class="token key atrule">log-impl</span><span class="token punctuation">:</span> org.apache.ibatis.logging.stdout.StdOutImpl <span class="token comment">#开启sql日志</span>


<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
   <span class="token key atrule">name</span><span class="token punctuation">:</span> shoping_user_service <span class="token comment">#服务名</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
    <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
     <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 10.0.0.41<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># 注册中心地址</span>
 <span class="token comment"># 数据源</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//10.0.0.41<span class="token punctuation">:</span>3306/mlshoping<span class="token punctuation">?</span>serverTimezone=UTC
    <span class="token key atrule">username</span><span class="token punctuation">:</span> malu
    <span class="token key atrule">password</span><span class="token punctuation">:</span> 123456Abc.com
 <span class="token comment"># redis</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
   <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> 10.0.0.41
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">6379</span>
    <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">30000</span>
    <span class="token key atrule">jedis</span><span class="token punctuation">:</span>
     <span class="token key atrule">pool</span><span class="token punctuation">:</span>
      <span class="token key atrule">max-active</span><span class="token punctuation">:</span> <span class="token number">8</span>
      <span class="token key atrule">max-wait</span><span class="token punctuation">:</span> <span class="token number">-1</span>
      <span class="token key atrule">max-idle</span><span class="token punctuation">:</span> <span class="token number">8</span>
      <span class="token key atrule">min-idle</span><span class="token punctuation">:</span> <span class="token number">0</span>


<span class="token key atrule">dubbo</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
   <span class="token key atrule">name</span><span class="token punctuation">:</span> shoping_user_service <span class="token comment"># 项目名</span>
   <span class="token key atrule">serialize-check-status</span><span class="token punctuation">:</span> DISABLE
   <span class="token key atrule">check-serializable</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">protocol</span><span class="token punctuation">:</span>
   <span class="token key atrule">name</span><span class="token punctuation">:</span> dubbo <span class="token comment"># 通讯协议</span>
   <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">-1</span> <span class="token comment"># 端口号，-1表示自动扫描可用端口。</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
   <span class="token key atrule">address</span><span class="token punctuation">:</span> nacos<span class="token punctuation">:</span>//10.0.0.41<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment"># 注册中心</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br></div></div><p>编写配置文件<code>bootstrap.yml</code>，连接配置中心</p> <p><img src="/devops/public/assets/img/1726801361896.d71db50d.png" alt="1726801361896"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
  <span class="token comment"># 环境</span>
   <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
   <span class="token comment"># 注册中心</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
     <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 10.0.0.41<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#注册中心地址</span>
     <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 9d7f5ef3<span class="token punctuation">-</span>29be<span class="token punctuation">-</span>4710<span class="token punctuation">-</span>85bd<span class="token punctuation">-</span>7b293e633ff6 <span class="token comment">#命名空间</span>
     <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#文件名后缀</span>
     <span class="token key atrule">prefix</span><span class="token punctuation">:</span> shoping_user_service <span class="token comment">#文件名</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>配置启动类</p> <p><img src="/devops/public/assets/img/1726801436786.b4a66058.png" alt="1726801436786"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@EnableDiscoveryClient</span>
<span class="token annotation punctuation">@EnableDubbo</span>
<span class="token annotation punctuation">@RefreshScope</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@MapperScan</span><span class="token punctuation">(</span><span class="token string">&quot;com.ityls.shoping_user_service.mapper&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShoppingUserServiceApplication</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ShoppingUserServiceApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>创建网站用户Api模块，创建名为<code>shoping_user_customer_api</code>的SpringBoot工程，添加相关依赖。</p> <p><img src="/devops/public/assets/img/1726801523978.536efe3b.png" alt="1726801523978"></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- dubbo --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.dubbo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dubbo-spring-boot-starter<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.dubbo<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>dubbo-registry-nacos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- nacos --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-alibaba-nacos-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.ityls<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>shoping_common<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>在Nacos配置中心编写配置文件<code>shoping_user_customer_api-dev.yaml</code></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token comment"># 端口号</span>
<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8003</span>


<span class="token comment"># 日志格式</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">pattern</span><span class="token punctuation">:</span>
   <span class="token key atrule">console</span><span class="token punctuation">:</span> <span class="token string">'%d{HH:mm:ss.SSS} %clr(%-5level) ---  [%-15thread] %cyan(%-50logger{50}):%msg%n'</span>


<span class="token comment"># Nacos</span>
<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
   <span class="token key atrule">name</span><span class="token punctuation">:</span> shoping_user_customer_api
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
    <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
     <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 10.0.0.41<span class="token punctuation">:</span><span class="token number">8848</span>


<span class="token key atrule">dubbo</span><span class="token punctuation">:</span>
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
  <span class="token comment">#项目名字</span>
   <span class="token key atrule">name</span><span class="token punctuation">:</span> shoping_user_customer_api
  <span class="token key atrule">protocol</span><span class="token punctuation">:</span>
   <span class="token key atrule">name</span><span class="token punctuation">:</span> dubbo
   <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">-1</span>
  <span class="token key atrule">registry</span><span class="token punctuation">:</span>
  <span class="token comment"># 注册地址</span>
   <span class="token key atrule">address</span><span class="token punctuation">:</span> nacos<span class="token punctuation">:</span>//10.0.0.41<span class="token punctuation">:</span><span class="token number">8848</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>编写配置文件<code>bootstrap.yml</code>，连接配置中心</p> <p><img src="/devops/public/assets/img/1726801625275.0483c6e2.png" alt="1726801625275"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">profiles</span><span class="token punctuation">:</span>
  <span class="token comment"># 环境</span>
   <span class="token key atrule">active</span><span class="token punctuation">:</span> dev
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
   <span class="token key atrule">nacos</span><span class="token punctuation">:</span>
   <span class="token comment"># 注册中心</span>
    <span class="token key atrule">config</span><span class="token punctuation">:</span>
     <span class="token key atrule">server-addr</span><span class="token punctuation">:</span> 10.0.0.41<span class="token punctuation">:</span><span class="token number">8848</span> <span class="token comment">#注册中心地址</span>
     <span class="token key atrule">namespace</span><span class="token punctuation">:</span> 9d7f5ef3<span class="token punctuation">-</span>29be<span class="token punctuation">-</span>4710<span class="token punctuation">-</span>85bd<span class="token punctuation">-</span>7b293e633ff6 <span class="token comment">#命名空间</span>
     <span class="token key atrule">file-extension</span><span class="token punctuation">:</span> yaml <span class="token comment">#文件名后缀</span>
     <span class="token key atrule">prefix</span><span class="token punctuation">:</span> shoping_user_customer_api
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>编写启动类</p> <p><img src="/devops/public/assets/img/1726801679018.59cb459f.png" alt="1726801679018"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@SpringBootApplication</span><span class="token punctuation">(</span>exclude<span class="token operator">=</span> <span class="token punctuation">{</span><span class="token class-name">DataSourceAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@EnableDiscoveryClient</span> <span class="token comment">//向注册中心注册该服务</span>
<span class="token annotation punctuation">@RefreshScope</span> <span class="token comment">// 配置动态刷新</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShoppingUserCustomerApiApplication</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">ShoppingUserCustomerApiApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="_4-编写用户服务接口"><a href="#_4-编写用户服务接口" class="header-anchor">#</a> 4，编写用户服务接口</h3> <p>在<strong>通用模块</strong>编写用户服务接口：</p> <p><img src="/devops/public/assets/img/1726804225789.759d50cc.png" alt="1726804225789"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 商城用户服务
 */</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">ShoppingUserService</span> <span class="token punctuation">{</span>
  <span class="token comment">// 注册时向redis保存手机号+验证码</span>
  <span class="token keyword">void</span> <span class="token function">saveRegisterCheckCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span><span class="token class-name">String</span> checkCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 注册时验证手机号+验证码</span>
  <span class="token keyword">void</span> <span class="token function">registerCheckCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span><span class="token class-name">String</span> checkCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 用户注册</span>
  <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">ShoppingUser</span> shoppingUser<span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">// 用户名密码登录</span>
  <span class="token class-name">String</span> <span class="token function">loginPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span><span class="token class-name">String</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 登录时向redis保存手机号+验证码</span>
  <span class="token keyword">void</span> <span class="token function">saveLoginCheckCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span><span class="token class-name">String</span> checkCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 手机号验证码登录</span>
  <span class="token class-name">String</span> <span class="token function">loginCheckCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span> <span class="token class-name">String</span> checkCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 获取登录用户名</span>
  <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 根据id获取用户</span>
  <span class="token class-name">ShoppingUser</span> <span class="token function">getLoginUser</span><span class="token punctuation">(</span><span class="token class-name">Long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_5-用户注册"><a href="#_5-用户注册" class="header-anchor">#</a> 5，用户注册</h3> <p>在用户注册时，我们要保证用户输入的手机号就是他本人使用的手机号，一方面方便后期的广告推送、另一方面可以保证用户账户的安全。所以在注册前，系统会给用户手机发送一个四位随机数验证码，如果用户能获取到该验证码，证明该手机就是用户本人使用。用户注册的步骤如下：</p> <ol><li>用户输入手机号，提交到网站后台。</li> <li>后台接收手机号后，向手机发送验证码，并将手机+验证码保存到redis中。</li> <li>用户查看自己的手机，将验证码提交到网站后台。</li> <li>后台在redis中进行验证码+手机验证，如果匹配成功，证明该手机属于该用户。</li> <li>输入其它信息完成注册。</li></ol> <div class="language- line-numbers-mode"><pre class="language-text"><code>第一步：用户输入手机号，点击获取验证码，向后端发请求。

第二步：后端接收到的手机号后，后端需要借助阿里云向手机发送验证码。验证码是后端随机生成的。后端需要把手机号和验证码保存redis中。

第三步：用户查看自己的手机，得到验证码，再把验证码提交到后端。

第四步：后端得到用户提交过来的验证码，在redis中进行手机号+验证码的校验。如果匹配成功，证明该手机属于该用户。

第五步：输入其它信息完成注册。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p>在<strong>通用模块</strong>编写生成随机数的工具类</p> <p><img src="/devops/public/assets/img/1726804283138.37a6976d.png" alt="1726804283138"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RandomUtil</span> <span class="token punctuation">{</span>
  <span class="token comment">/**
   * 生成验证码
   * @param digit 位数
   * @return
   */</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">buildCheckCode</span><span class="token punctuation">(</span><span class="token keyword">int</span> digit<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token class-name">String</span> str <span class="token operator">=</span> <span class="token string">&quot;0123456789&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">StringBuilder</span> sb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> digit<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">char</span> ch <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">nextInt</span><span class="token punctuation">(</span>str<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      sb<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
    <span class="token keyword">return</span> sb<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>在<strong>用户服务模块</strong>编写用户服务接口实现类</p> <p><img src="/devops/public/assets/img/1726804384479.92bbaf29.png" alt="1726804384479"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@DubboService</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShoppingUserServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">ShoppingUserService</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@Autowired</span>
  <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>
  <span class="token annotation punctuation">@Autowired</span>
  <span class="token keyword">private</span> <span class="token class-name">ShoppingUserMapper</span> shoppingUserMapper<span class="token punctuation">;</span>


  <span class="token annotation punctuation">@Override</span>
  <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveRegisterCheckCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span> <span class="token class-name">String</span> checkCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">ValueOperations</span> valueOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// redis键为手机号，值为验证码，过期时间5分钟</span>
    <span class="token comment">// registerCode:19335765133  ===&gt; 1234</span>
    valueOperations<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;registerCode:&quot;</span> <span class="token operator">+</span> phone<span class="token punctuation">,</span> checkCode<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>在<strong>用户API模块</strong>编写控制器</p> <p><img src="/devops/public/assets/img/1726804450483.764d7c57.png" alt="1726804450483"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 商城用户
 */</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/user/shoppingUser&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ShoppingUserController</span> <span class="token punctuation">{</span>
  <span class="token annotation punctuation">@DubboReference</span>
  <span class="token keyword">private</span> <span class="token class-name">ShoppingUserService</span> shoppingUserService<span class="token punctuation">;</span>
  <span class="token annotation punctuation">@DubboReference</span>
  <span class="token keyword">private</span> <span class="token class-name">MessageService</span> messageService<span class="token punctuation">;</span>
  <span class="token comment">/**
   * 发送注册短信
   * @param phone 注册手机号
   * @return 操作结果
   */</span>
  <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sendMessage&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">public</span> <span class="token class-name">BaseResult</span> <span class="token function">sendMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 1.生成随机四位数</span>
    <span class="token class-name">String</span> checkCode <span class="token operator">=</span> <span class="token class-name">RandomUtil</span><span class="token punctuation">.</span><span class="token function">buildCheckCode</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 2.发送短信</span>
    <span class="token class-name">BaseResult</span> result <span class="token operator">=</span> messageService<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span> checkCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 3.发送成功，将验证码保存到redis中,发送失败，返回发送结果</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">200</span> <span class="token operator">==</span> result<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      shoppingUserService<span class="token punctuation">.</span><span class="token function">saveRegisterCheckCode</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span> checkCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span> <span class="token class-name">BaseResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> result<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>在Higress中配置用户Api的路由</p> <p><img src="/devops/public/assets/img/1726804970099.12e81c36.png" alt="1726804970099"></p> <p><img src="/devops/public/assets/img/1726805079429.d474639d.png" alt="1726805079429"></p> <p>测试控制器</p> <p><img src="/devops/public/assets/img/1726805188543.354d689e.png" alt="1726805188543"></p> <p><img src="/devops/public/assets/img/1726805201716.8c369b38.png" alt="1726805201716"></p> <h3 id="_6-验证注册验证码"><a href="#_6-验证注册验证码" class="header-anchor">#</a> 6，验证注册验证码</h3> <p>在<strong>用户服务模块</strong>编写用户服务接口实现类</p> <p><img src="/devops/public/assets/img/1726805323076.545c7a5e.png" alt="1726805323076"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>shoping_common<span class="token punctuation">.</span>result</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">AllArgsConstructor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">Getter</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * 返回状态码枚举类
 */</span>
<span class="token annotation punctuation">@Getter</span>
<span class="token annotation punctuation">@AllArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">enum</span> <span class="token class-name">CodeEnum</span> <span class="token punctuation">{</span>
    <span class="token comment">// 正常</span>
    <span class="token function">SUCCESS</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">&quot;OK&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 系统异常</span>
    <span class="token function">SYSTEM_ERROR</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token string">&quot;系统异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// 业务异常</span>
    <span class="token function">PARAMETER_ERROR</span><span class="token punctuation">(</span><span class="token number">601</span><span class="token punctuation">,</span> <span class="token string">&quot;参数异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// 添加商品类型异常</span>
    <span class="token function">INSERT_PRODUCT_TYPE_ERROR</span><span class="token punctuation">(</span><span class="token number">602</span><span class="token punctuation">,</span><span class="token string">&quot;3级商品类型不能添加子类型&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// 删除商品类型异常</span>
    <span class="token function">DELETE_PRODUCT_TYPE_ERROR</span><span class="token punctuation">(</span><span class="token number">603</span><span class="token punctuation">,</span> <span class="token string">&quot;此商品类型下面有子类型&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token comment">// 文件上传异常</span>
    <span class="token function">UPLOAD_FILE_ERROR</span><span class="token punctuation">(</span><span class="token number">604</span><span class="token punctuation">,</span> <span class="token string">&quot;文件上传异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REGISTER_CODE_ERROR</span><span class="token punctuation">(</span><span class="token number">605</span><span class="token punctuation">,</span><span class="token string">&quot;注册验证码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REGISTER_REPEAT_PHONE_ERROR</span><span class="token punctuation">(</span><span class="token number">606</span><span class="token punctuation">,</span><span class="token string">&quot;注册手机号重复&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">REGISTER_REPEAT_NAME_ERROR</span><span class="token punctuation">(</span><span class="token number">607</span><span class="token punctuation">,</span><span class="token string">&quot;注册用户名重复&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">LOGIN_NAME_PASSWORD_ERROR</span><span class="token punctuation">(</span><span class="token number">608</span><span class="token punctuation">,</span><span class="token string">&quot;用户名或密码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">LOGIN_CODE_ERROR</span><span class="token punctuation">(</span><span class="token number">609</span><span class="token punctuation">,</span><span class="token string">&quot;验证码错误&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">LOGIN_NOPHONE_ERROR</span><span class="token punctuation">(</span><span class="token number">610</span><span class="token punctuation">,</span><span class="token string">&quot;该手机号没有注册&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">LOGIN_USER_STATUS_ERROR</span><span class="token punctuation">(</span><span class="token number">611</span><span class="token punctuation">,</span><span class="token string">&quot;该用户状态异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">QR_CODE_ERROR</span><span class="token punctuation">(</span><span class="token number">612</span><span class="token punctuation">,</span><span class="token string">&quot;二维码生成异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">CHECK_SIGN_ERROR</span><span class="token punctuation">(</span><span class="token number">613</span><span class="token punctuation">,</span><span class="token string">&quot;支付宝验签异常&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">NO_STOCK_ERROR</span><span class="token punctuation">(</span><span class="token number">614</span><span class="token punctuation">,</span><span class="token string">&quot;商品库存不足&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ORDER_EXPIRED_ERROR</span><span class="token punctuation">(</span><span class="token number">615</span><span class="token punctuation">,</span><span class="token string">&quot;订单不存在或订单超时&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">ORDER_STATUS_ERROR</span><span class="token punctuation">(</span><span class="token number">616</span><span class="token punctuation">,</span><span class="token string">&quot;订单状态异常&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">;</span>


    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">Integer</span> code<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">String</span> message<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br></div></div><p><img src="/devops/public/assets/img/1726805398195.7afadad4.png" alt="1726805398195"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">registerCheckCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span> <span class="token class-name">String</span> checkCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 验证验证码</span>
  <span class="token class-name">ValueOperations</span> valueOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Object</span> checkCodeRedis <span class="token operator">=</span> valueOperations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;registerCode:&quot;</span> <span class="token operator">+</span> phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>checkCode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>checkCodeRedis<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusException</span><span class="token punctuation">(</span><span class="token class-name">CodeEnum</span><span class="token punctuation">.</span><span class="token constant">REGISTER_CODE_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>在<strong>用户API模块</strong>编写控制器</p> <p><img src="/devops/public/assets/img/1726805429613.411523b5.png" alt="1726805429613"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 验证用户注册验证码
 * @param phone 手机号
 * @param checkCode 验证码
 * @return 200验证成功，605验证码不正确
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/registerCheckCode&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">BaseResult</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span><span class="token class-name">String</span> checkCode<span class="token punctuation">)</span><span class="token punctuation">{</span>
  shoppingUserService<span class="token punctuation">.</span><span class="token function">registerCheckCode</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span>checkCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token class-name">BaseResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>测试控制器，先发送验证码：</p> <p><img src="/devops/public/assets/img/1726805747470.6e9c82ea.png" alt="1726805747470"></p> <p><img src="/devops/public/assets/img/1726805845645.fdac7c9c.png" alt="1726805845645"></p> <p><img src="/devops/public/assets/img/1726805869965.c9a0c094.png" alt="1726805869965"></p> <p><img src="/devops/public/assets/img/1726805902685.afc3704e.png" alt="1726805902685"></p> <p><img src="/devops/public/assets/img/1726805923314.8e0b78b6.png" alt="1726805923314"></p> <p>网站验证：等一会再试，1分钟只能发一个。如果发的太频繁，会触发小时级别限流。</p> <p><img src="/devops/public/assets/img/1726806021485.5460d4c0.png" alt="1726806021485"></p> <p><img src="/devops/public/assets/img/1726806180425.c2133086.png" alt="1726806180425"></p> <h3 id="_7-用户注册"><a href="#_7-用户注册" class="header-anchor">#</a> 7，用户注册</h3> <p>在<strong>通用模块</strong>编写MD5加密工具类，用于给用户密码进行加密和验证</p> <p><img src="/devops/public/assets/img/1726806291955.32c55794.png" alt="1726806291955"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Md5Util</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> md5key <span class="token operator">=</span> <span class="token string">&quot;MALU&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 秘钥</span>


  <span class="token comment">/**
   * 加密
   * @param text 明文
   * @return 密文
   */</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token class-name">DigestUtils</span><span class="token punctuation">.</span><span class="token function">md5Hex</span><span class="token punctuation">(</span>text <span class="token operator">+</span> md5key<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>


  <span class="token comment">/**
   * 验证
   *
   * @param text 明文
   * @param cipher  密文
   * @return true/false
   */</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">,</span> <span class="token class-name">String</span> cipher<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 将明文转为密文进行比对</span>
    <span class="token class-name">String</span> md5Text <span class="token operator">=</span> <span class="token function">encode</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>md5Text<span class="token punctuation">.</span><span class="token function">equalsIgnoreCase</span><span class="token punctuation">(</span>cipher<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br></div></div><p>mapper:</p> <p><img src="/devops/public/assets/img/1726806462099.f35f0868.png" alt="1726806462099"></p> <p><img src="/devops/public/assets/img/1726806926092.e4a0dabe.png" alt="1726806926092"></p> <p>在<strong>用户服务模块</strong>编写用户服务接口实现类</p> <p><img src="/devops/public/assets/img/1726806523298.cbf90538.png" alt="1726806523298"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">ShoppingUser</span> shoppingUser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.验证手机号是否存在</span>
  <span class="token class-name">String</span> phone <span class="token operator">=</span> shoppingUser<span class="token punctuation">.</span><span class="token function">getPhone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingUser</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingUser</span><span class="token punctuation">&gt;</span></span> shoppingUsers <span class="token operator">=</span> shoppingUserMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>shoppingUsers <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> shoppingUsers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusException</span><span class="token punctuation">(</span><span class="token class-name">CodeEnum</span><span class="token punctuation">.</span><span class="token constant">REGISTER_REPEAT_PHONE_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>


  <span class="token comment">// 2.验证用户名是否存在</span>
  <span class="token class-name">String</span> username <span class="token operator">=</span> shoppingUser<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingUser</span><span class="token punctuation">&gt;</span></span> queryWrapper1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  queryWrapper1<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingUser</span><span class="token punctuation">&gt;</span></span> shoppingUsers1 <span class="token operator">=</span> shoppingUserMapper<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span>queryWrapper1<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>shoppingUsers1 <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> shoppingUsers1<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusException</span><span class="token punctuation">(</span><span class="token class-name">CodeEnum</span><span class="token punctuation">.</span><span class="token constant">REGISTER_REPEAT_NAME_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>


  <span class="token comment">// 3.新增用户</span>
  shoppingUser<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token string">&quot;Y&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  shoppingUser<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span><span class="token class-name">Md5Util</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>shoppingUser<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  shoppingUserMapper<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>shoppingUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><p>在<strong>用户API模块</strong>编写控制器</p> <p><img src="/devops/public/assets/img/1726806573978.b40dc933.png" alt="1726806573978"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 用户注册
 * @param shoppingUser 用户信息
 * @return 注册结果
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/register&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">BaseResult</span> <span class="token function">register</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">ShoppingUser</span> shoppingUser<span class="token punctuation">)</span><span class="token punctuation">{</span>
  shoppingUserService<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span>shoppingUser<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token class-name">BaseResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>测试控制器</p> <p><img src="/devops/public/assets/img/1726806667468.f65c5bd7.png" alt="1726806667468"></p> <p><img src="/devops/public/assets/img/1726806783688.fe03588d.png" alt="1726806783688"></p> <p><img src="/devops/public/assets/img/1726807045287.9f5794ed.png" alt="1726807045287"></p> <p><img src="/devops/public/assets/img/1726807030015.ee97213e.png" alt="1726807030015"></p> <p><img src="/devops/public/assets/img/1726807102929.c49260d0.png" alt="1726807102929"></p> <p><img src="/devops/public/assets/img/1726807134692.16008f67.png" alt="1726807134692"></p> <p>然后输入用户名和密码进行注册：</p> <p><img src="/devops/public/assets/img/1726807192875.bd76c8c7.png" alt="1726807192875"></p> <p>看数据库：</p> <p><img src="/devops/public/assets/img/1726807220954.087c40a0.png" alt="1726807220954"></p> <h3 id="_8-用户名密码登录"><a href="#_8-用户名密码登录" class="header-anchor">#</a> 8，用户名密码登录</h3> <p>在<strong>用户服务模块</strong>编写用户服务接口实现类</p> <p><img src="/devops/public/assets/img/1726807318056.240849e5.png" alt="1726807318056"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">loginPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingUser</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">ShoppingUser</span> shoppingUser <span class="token operator">=</span> shoppingUserMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 验证用户名</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>shoppingUser <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusException</span><span class="token punctuation">(</span><span class="token class-name">CodeEnum</span><span class="token punctuation">.</span><span class="token constant">LOGIN_NAME_PASSWORD_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
  <span class="token comment">// 验证密码</span>
  <span class="token keyword">boolean</span> verify <span class="token operator">=</span> <span class="token class-name">Md5Util</span><span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> shoppingUser<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>verify<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusException</span><span class="token punctuation">(</span><span class="token class-name">CodeEnum</span><span class="token punctuation">.</span><span class="token constant">LOGIN_NAME_PASSWORD_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
  <span class="token comment">// 返回用户名</span>
  <span class="token keyword">return</span> username<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>在<strong>用户API模块</strong>编写控制器</p> <p><img src="/devops/public/assets/img/1726807345976.d4b0526a.png" alt="1726807345976"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 用户名密码登录
 * @param shoppingUser 用户对象
 * @return 登录结果
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/loginPassword&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">BaseResult</span> <span class="token function">loginPassword</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">ShoppingUser</span> shoppingUser<span class="token punctuation">)</span><span class="token punctuation">{</span>
  shoppingUserService<span class="token punctuation">.</span><span class="token function">loginPassword</span><span class="token punctuation">(</span>shoppingUser<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shoppingUser<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token class-name">BaseResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>重启微服务，然后测试控制器</p> <p><img src="/devops/public/assets/img/1726807578802.326968b4.png" alt="1726807578802"></p> <h3 id="_9-发送登录验证码"><a href="#_9-发送登录验证码" class="header-anchor">#</a> 9，发送登录验证码</h3> <p>手机号验证码登录的流程为：</p> <ol><li>用户先输入手机号，向该手机号发送随机验证码，并将验证码保存到redis中。</li> <li>用户收到短信后将验证码输入，如果验证码和redis中的验证码匹配成功，证明登录者就是使用该手机的用户，登录成功。</li></ol> <p>向用户发送登录验证码，在<strong>用户服务模块</strong>编写用户服务接口实现类</p> <p><img src="/devops/public/assets/img/1726807651686.5e7593f6.png" alt="1726807651686"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 保存登录验证码到redis</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">saveLoginCheckCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span> <span class="token class-name">String</span> checkCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">ValueOperations</span> valueOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// redis键为手机号，值为验证码，过期时间5分钟</span>
  valueOperations<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">&quot;loginCode:&quot;</span> <span class="token operator">+</span> phone<span class="token punctuation">,</span> checkCode<span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>在<strong>用户API模块</strong>编写控制器</p> <p><img src="/devops/public/assets/img/1726807677824.c9e0afd4.png" alt="1726807677824"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 发送登录短信验证码
 *
 * @param phone 手机号
 * @return 操作结果
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sendLoginCheckCode&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">BaseResult</span> <span class="token function">sendLoginCheckCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.生成随机四位数</span>
  <span class="token class-name">String</span> checkCode <span class="token operator">=</span> <span class="token class-name">RandomUtil</span><span class="token punctuation">.</span><span class="token function">buildCheckCode</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 2.发送短信</span>
  <span class="token class-name">BaseResult</span> result <span class="token operator">=</span> messageService<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span> checkCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 3.发送成功，将验证码保存到redis中,发送失败，返回发送结果</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">200</span> <span class="token operator">==</span> result<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    shoppingUserService<span class="token punctuation">.</span><span class="token function">saveLoginCheckCode</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span> checkCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">BaseResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>测试：</p> <p><img src="/devops/public/assets/img/1726807742460.05f5d90c.png" alt="1726807742460"></p> <p><img src="/devops/public/assets/img/1726807784660.e32ee8d0.png" alt="1726807784660"></p> <h3 id="_10-验证登录验证码"><a href="#_10-验证登录验证码" class="header-anchor">#</a> 10，验证登录验证码</h3> <p>在<strong>用户服务模块</strong>编写用户服务接口实现类</p> <p><img src="/devops/public/assets/img/1726807853565.bb27abc5.png" alt="1726807853565"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 验证登录验证码</span>
<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">loginCheckCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span> <span class="token class-name">String</span> checkCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 验证用户传入的手机号验证码是否在redis中存在</span>
  <span class="token class-name">ValueOperations</span> valueOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Object</span> checkCodeRedis <span class="token operator">=</span> valueOperations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;loginCode:&quot;</span> <span class="token operator">+</span> phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>checkCode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>checkCodeRedis<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusException</span><span class="token punctuation">(</span><span class="token class-name">CodeEnum</span><span class="token punctuation">.</span><span class="token constant">LOGIN_CODE_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
  <span class="token comment">// 登录成功，查询用户</span>
  <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingUser</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">,</span> phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">ShoppingUser</span> shoppingUser <span class="token operator">=</span> shoppingUserMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 返回用户名</span>
  <span class="token keyword">return</span> shoppingUser<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>在<strong>用户API模块</strong>编写控制器</p> <p><img src="/devops/public/assets/img/1726807878571.83b7282f.png" alt="1726807878571"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
   * 手机号验证码登录
   * @param phone 手机号
   * @param checkCode 验证码
   * @return 登录结果
   */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/loginCheckCode&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">BaseResult</span> <span class="token function">loginCheckCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span> <span class="token class-name">String</span> checkCode<span class="token punctuation">)</span><span class="token punctuation">{</span>
  shoppingUserService<span class="token punctuation">.</span><span class="token function">loginCheckCode</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span> checkCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token class-name">BaseResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="_11-优化手机号验证码登录"><a href="#_11-优化手机号验证码登录" class="header-anchor">#</a> 11，优化手机号验证码登录</h3> <p>在手机号验证码登录的方法中，存在一个小bug，即给用户发送登录验证码前，需要判断该手机是否注册过，状态是否正常。所以我们需要优化发送登录验证码的功能：用户服务接口添加方法</p> <p><img src="/devops/public/assets/img/1726807965777.acbb1b7e.png" alt="1726807965777"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 判断用户手机号是否存在，状态是否正常</span>
<span class="token keyword">void</span> <span class="token function">checkPhone</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>重新该方法</p> <p><img src="/devops/public/assets/img/1726808008313.8cd86eb0.png" alt="1726808008313"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">checkPhone</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.判断手机号是否存在</span>
  <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingUser</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">,</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">ShoppingUser</span> shoppingUser <span class="token operator">=</span> shoppingUserMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>shoppingUser <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusException</span><span class="token punctuation">(</span><span class="token class-name">CodeEnum</span><span class="token punctuation">.</span><span class="token constant">LOGIN_NOPHONE_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
  <span class="token comment">// 2.判断用户状态</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">&quot;Y&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>shoppingUser<span class="token punctuation">.</span><span class="token function">getStatus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusException</span><span class="token punctuation">(</span><span class="token class-name">CodeEnum</span><span class="token punctuation">.</span><span class="token constant">LOGIN_NOPHONE_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>修改发送登录验证码控制器</p> <p><img src="/devops/public/assets/img/1726808062269.71e8de08.png" alt="1726808062269"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 发送登录短信验证码
 * @param phone 手机号
 * @return 操作结果
 */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/sendLoginCheckCode&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">BaseResult</span> <span class="token function">sendLoginCheckCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 1.判断该用户是否已经注册，状态是否正常</span>
  shoppingUserService<span class="token punctuation">.</span><span class="token function">checkPhone</span><span class="token punctuation">(</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 2.生成随机四位数验证码</span>
  <span class="token class-name">String</span> checkCode <span class="token operator">=</span> <span class="token class-name">RandomUtil</span><span class="token punctuation">.</span><span class="token function">buildCheckCode</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 3.发送短信</span>
  <span class="token class-name">BaseResult</span> result <span class="token operator">=</span> messageService<span class="token punctuation">.</span><span class="token function">sendMessage</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span> checkCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 4.发送成功，将验证码保存到redis中，发送失败，返回发送结果</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">200</span> <span class="token operator">==</span> result<span class="token punctuation">.</span><span class="token function">getCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    shoppingUserService<span class="token punctuation">.</span><span class="token function">saveLoginCheckCode</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span>checkCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token class-name">BaseResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>自行测试。</p> <h3 id="_12-单点登录"><a href="#_12-单点登录" class="header-anchor">#</a> 12，单点登录</h3> <p>目前登录成功后我们并没有保存用户信息，也没有在访问接口前验证用户信息。如果使用传统的session保存用户信息，使用filter验证用户是否登录。存在一个问题：session保存在服务器中，而我们的系统存在诸多子系统，这些子系统是分别部署在不同的服务器中，互相无法访问（<strong>登录后的session保存在用户模块，搜索模块无法访问用户模块的session，无法验证用户是否登录</strong>）。此时我们需要使用单点登录技术解决这一问题。</p> <p><img src="/devops/public/assets/img/1726660304564.8e114aff.png" alt="1726660304564"></p> <p>单点登录（Single Sign On）简称为 SSO。即在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。JWT是一种常用的单点登录解决方案。</p> <p>JWT是Json Web Token的简称，是一种令牌生成算法。使用JWT能够保证Token的安全性，且能够进行Token时效性的检验。</p> <p>使用JWT时，登录成功后将<strong>用户信息</strong>生成一串令牌字符串。将该字符串返回给客户端，客户端<strong>每次</strong>请求时都在请求头携带该令牌字符串。在其他模块验证令牌，通过则证明用户处于登录状态，并拿到解析后的用户信息，未通过证明用户处于未登录状态。</p> <p><img src="/devops/public/assets/img/1726660374646.eacca854.png" alt="1726660374646"></p> <p>单点登录功能的编写如下：</p> <ol><li>引入JWT工具类，编写生成令牌和解析令牌的方法。</li> <li>用户登录成功后生成令牌字符串返回给前端。</li> <li>前端每次请求时都在请求头带入令牌字符串。</li> <li>在Higress中配置哪些路由需要令牌才可以访问，Higress会针对配置的路由，对请求时的令牌进行解析。</li></ol> <h3 id="_13-编写jwt工具类"><a href="#_13-编写jwt工具类" class="header-anchor">#</a> 13，编写JWT工具类</h3> <p>在<strong>网站用户服务模块</strong>引入JWT依赖</p> <p><img src="/devops/public/assets/img/1726808310542.39659092.png" alt="1726808310542"></p> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code><span class="token comment">&lt;!-- jwt --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.bitbucket.b_c<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jose4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.7.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>在<strong>网站用户服务模块</strong>编写生成公钥和私钥的工具类</p> <p><img src="/devops/public/assets/img/1726808429512.165c1a64.png" alt="1726808429512"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">// 生成公钥和私钥</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GenerateJwtDemo</span> <span class="token punctuation">{</span>
  <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">JoseException</span> <span class="token punctuation">{</span>
    <span class="token class-name">RsaJsonWebKey</span> rsaJsonWebKey <span class="token operator">=</span> <span class="token class-name">RsaJwkGenerator</span><span class="token punctuation">.</span><span class="token function">generateJwk</span><span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> publicKeyString <span class="token operator">=</span> rsaJsonWebKey<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token class-name">JsonWebKey<span class="token punctuation">.</span>OutputControlLevel</span><span class="token punctuation">.</span><span class="token constant">PUBLIC_ONLY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">final</span> <span class="token class-name">String</span> privateKeyString <span class="token operator">=</span> rsaJsonWebKey<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token class-name">JsonWebKey<span class="token punctuation">.</span>OutputControlLevel</span><span class="token punctuation">.</span><span class="token constant">INCLUDE_PRIVATE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>publicKeyString<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>privateKeyString<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>在<strong>网站用户服务模块</strong>编写JWT工具类</p> <p><img src="/devops/public/assets/img/1726808621782.c6d8a0c3.png" alt="1726808621782"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>ityls<span class="token punctuation">.</span>shoping_user_service<span class="token punctuation">.</span>util</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span></span><span class="token class-name">SneakyThrows</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jose4j<span class="token punctuation">.</span>json<span class="token punctuation">.</span></span><span class="token class-name">JsonUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jose4j<span class="token punctuation">.</span>jwa<span class="token punctuation">.</span></span><span class="token class-name">AlgorithmConstraints</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jose4j<span class="token punctuation">.</span>jwk<span class="token punctuation">.</span></span><span class="token class-name">RsaJsonWebKey</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jose4j<span class="token punctuation">.</span>jws<span class="token punctuation">.</span></span><span class="token class-name">AlgorithmIdentifiers</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jose4j<span class="token punctuation">.</span>jws<span class="token punctuation">.</span></span><span class="token class-name">JsonWebSignature</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jose4j<span class="token punctuation">.</span>jwt<span class="token punctuation">.</span></span><span class="token class-name">JwtClaims</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jose4j<span class="token punctuation">.</span>jwt<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">JwtConsumer</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>jose4j<span class="token punctuation">.</span>jwt<span class="token punctuation">.</span>consumer<span class="token punctuation">.</span></span><span class="token class-name">JwtConsumerBuilder</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">PrivateKey</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>security<span class="token punctuation">.</span></span><span class="token class-name">PublicKey</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">HashMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Map</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JwtUtils</span> <span class="token punctuation">{</span>
    <span class="token comment">// 公钥</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">PUBLIC_JSON</span> <span class="token operator">=</span> <span class="token string">&quot;{\&quot;kty\&quot;:\&quot;RSA\&quot;,\&quot;n\&quot;:\&quot;kkMFB482qG5cjMouvhn0ZuUwTtLvRsI3Q3CoIOcphHwFddggJpXCVno4nDNBoB74OwFn1cncIvsuUC2b7U1U0V3ra9EJnPd1xbitXst0Yd6CTKh9aDRBNAu0Hrq-BhF_wUqzLzzMLnM5XTbwq0Et9BFkwqCaBUfTJ_qco0UuGRmpeeqEIVZC0IxfSUszQQcgkkMicfCBVfvFzdEm8MHN0e9NX65Ae_rnMUCaGW3122tq8UYoBp5SZ6jwoNw2I2xCda3DHu3WYXhjx2VHd2B-C45jVDs77J_2w7fmYpXsH2WL_axe3m_e8P7UEt6mxVnRtevIdVIlv51Wnls5DJw1Aw\&quot;,\&quot;e\&quot;:\&quot;AQAB\&quot;}\n&quot;</span><span class="token punctuation">;</span>
    <span class="token comment">// 私钥</span>
    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token constant">PRIVATE_JSON</span> <span class="token operator">=</span> <span class="token string">&quot;{\&quot;kty\&quot;:\&quot;RSA\&quot;,\&quot;n\&quot;:\&quot;kkMFB482qG5cjMouvhn0ZuUwTtLvRsI3Q3CoIOcphHwFddggJpXCVno4nDNBoB74OwFn1cncIvsuUC2b7U1U0V3ra9EJnPd1xbitXst0Yd6CTKh9aDRBNAu0Hrq-BhF_wUqzLzzMLnM5XTbwq0Et9BFkwqCaBUfTJ_qco0UuGRmpeeqEIVZC0IxfSUszQQcgkkMicfCBVfvFzdEm8MHN0e9NX65Ae_rnMUCaGW3122tq8UYoBp5SZ6jwoNw2I2xCda3DHu3WYXhjx2VHd2B-C45jVDs77J_2w7fmYpXsH2WL_axe3m_e8P7UEt6mxVnRtevIdVIlv51Wnls5DJw1Aw\&quot;,\&quot;e\&quot;:\&quot;AQAB\&quot;,\&quot;d\&quot;:\&quot;MleyG_t9zzSJU4Zl11X8qwv4-DCfXkYMGoDkxcp7HlhH0tuMmWtTpEtWP-FelbwDKeAeetYLmNjHBJ7mPCQxbQz8MrSVL_t3BJK_zdCOov8g7zzRSXQu-ziKC0ewj0sno4LQMRKmnthXJs_5v6BkLk1sVpdL3ERwGCMpFgOCTe3jhhhJw4i7VeSLhFZq3p7D24_sGV5klhc5oo8GelLQtA9Kk2zaTHz_OfPH8eCtS7u3PQacI6CpBFYzBxqck-lm-7cEoyGhUWRbAOjr54CEk1B7tGVept9I65_lIkp6UQ1qjRr3WzbfaMz953-C0L4WoPhCzUxwNHmzY2IfmoF_lQ\&quot;,\&quot;p\&quot;:\&quot;xyDhGyOMvJrUGOJqX2O9kPZjj8YP9OmWwy-h0DJdZzwAV4buVLCRzTGd3nwfEcUNE9yh6li7A89YWFOTwEjj3V54JajAgAkkIZ0oKABoTRaRIvMRfVsye9QZNvBGGfKQwly23nRYIXjR-lmWWoPdldmvEYp3zUy6DiIhKup7XBc\&quot;,\&quot;q\&quot;:\&quot;vAjWS_3YEEK3LNn3h0nB5eDpEe12OOzL-Cx_Kmw8LiweFaejgE5zldwUcuJRlZbDQ-Ax5nBCu0bMvxPEEEDjO08OhqHCUDAllnpLO0aYojg8WytxWslyKIQ9ZpRhKpfUmtfaUl1eP6eqTxH5W5_1khrK-VjGQKDxNasEhHuIZfU\&quot;,\&quot;dp\&quot;:\&quot;hpSVLydepdWqhUr5A5FAfGnZrkD5Zdg9mZtmrHRtpijqPj2mdDyFvf3LqaOPyA26ofLax6zCcHfBSKjr0egxgNqpLyKXP7Ft5v31NtvXokofO1S2PFfXjdMyW2wWpNDIv2O0ADL3oV-r4pyLvo8iwnVGGf_QqkMx9_1fF0c0qm8\&quot;,\&quot;dq\&quot;:\&quot;JzfcomrmdrXDiMpJc2Ex3OVlF0Uk5EiXXkLBnzKF9sdi2vdlBazXNMl7Rl7nz0Brp6uKHNsLQA5LRAs2WIGAI22gxPnWEm2IWXNWX52g1izOgeF0ug_MDKFQQSXvgje6szUUJxusPbCVt_oyvSaGzJtj_E_EwdQPmzb5MTymvUU\&quot;,\&quot;qi\&quot;:\&quot;jJa3zcjDk5E0pa1JyuC_e58GC_dWzm_CAfbl75qcLrNUKGu_LOUQg5RwmJSRKVw475lahrP-tsN5Pp1mwk3D_YzBZp6oJqKYzhheU0Hq6zokqDe8JmSxAac040jqd-46LIDJccm8XpM1vx-Ep8F6Fxupn7-Ak5Xk4iRZ1_Aidqo\&quot;}\n&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">/**
     * 生成token
     *
     * @param userId       用户id
     * @param username 用户名字
     * @return
     */</span>
    <span class="token annotation punctuation">@SneakyThrows</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token class-name">Long</span> userId<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 1、 创建jwtclaims  jwt内容载荷部分</span>
        <span class="token class-name">JwtClaims</span> claims <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JwtClaims</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 是谁创建了令牌并且签署了它</span>
        claims<span class="token punctuation">.</span><span class="token function">setIssuer</span><span class="token punctuation">(</span><span class="token string">&quot;malu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 令牌将被发送给谁</span>
        claims<span class="token punctuation">.</span><span class="token function">setAudience</span><span class="token punctuation">(</span><span class="token string">&quot;audience&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 失效时间长（分钟）</span>
        claims<span class="token punctuation">.</span><span class="token function">setExpirationTimeMinutesInTheFuture</span><span class="token punctuation">(</span><span class="token number">60</span> <span class="token operator">*</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 令牌唯一标识符</span>
        claims<span class="token punctuation">.</span><span class="token function">setGeneratedJwtId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 当令牌被发布或者创建</span>
        claims<span class="token punctuation">.</span><span class="token function">setIssuedAtToNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 再次之前令牌无效</span>
        claims<span class="token punctuation">.</span><span class="token function">setNotBeforeMinutesInThePast</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 主题</span>
        claims<span class="token punctuation">.</span><span class="token function">setSubject</span><span class="token punctuation">(</span><span class="token string">&quot;shopping&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 可以添加关于这个主题得声明属性</span>
        claims<span class="token punctuation">.</span><span class="token function">setClaim</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        claims<span class="token punctuation">.</span><span class="token function">setClaim</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span> username<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 2、签名</span>
        <span class="token class-name">JsonWebSignature</span> jws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JsonWebSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//赋值载荷</span>
        jws<span class="token punctuation">.</span><span class="token function">setPayload</span><span class="token punctuation">(</span>claims<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 3、jwt使用私钥签署</span>
        <span class="token class-name">PrivateKey</span> privateKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RsaJsonWebKey</span><span class="token punctuation">(</span><span class="token class-name">JsonUtil</span><span class="token punctuation">.</span><span class="token function">parseJson</span><span class="token punctuation">(</span><span class="token constant">PRIVATE_JSON</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrivateKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        jws<span class="token punctuation">.</span><span class="token function">setKey</span><span class="token punctuation">(</span>privateKey<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 4、设置关键 kid</span>
        jws<span class="token punctuation">.</span><span class="token function">setKeyIdHeaderValue</span><span class="token punctuation">(</span><span class="token string">&quot;keyId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 5、设置签名算法</span>
        jws<span class="token punctuation">.</span><span class="token function">setAlgorithmHeaderValue</span><span class="token punctuation">(</span><span class="token class-name">AlgorithmIdentifiers</span><span class="token punctuation">.</span><span class="token constant">RSA_USING_SHA256</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 6、生成jwt</span>
        <span class="token class-name">String</span> jwt <span class="token operator">=</span> jws<span class="token punctuation">.</span><span class="token function">getCompactSerialization</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> jwt<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 解密token，获取token中的信息
     *
     * @param token
     */</span>
    <span class="token annotation punctuation">@SneakyThrows</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">verify</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 1、引入公钥</span>
        <span class="token class-name">PublicKey</span> publicKey <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RsaJsonWebKey</span><span class="token punctuation">(</span><span class="token class-name">JsonUtil</span><span class="token punctuation">.</span><span class="token function">parseJson</span><span class="token punctuation">(</span><span class="token constant">PUBLIC_JSON</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPublicKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2、使用jwtcoonsumer  验证和处理jwt</span>
        <span class="token class-name">JwtConsumer</span> jwtConsumer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JwtConsumerBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">setRequireExpirationTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//过期时间</span>
                <span class="token punctuation">.</span><span class="token function">setAllowedClockSkewInSeconds</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token comment">//允许在验证得时候留有一些余地 计算时钟偏差  秒</span>
                <span class="token punctuation">.</span><span class="token function">setRequireSubject</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 主题生命</span>
                <span class="token punctuation">.</span><span class="token function">setExpectedIssuer</span><span class="token punctuation">(</span><span class="token string">&quot;malu&quot;</span><span class="token punctuation">)</span> <span class="token comment">// jwt需要知道谁发布得 用来验证发布人</span>
                <span class="token punctuation">.</span><span class="token function">setExpectedAudience</span><span class="token punctuation">(</span><span class="token string">&quot;audience&quot;</span><span class="token punctuation">)</span> <span class="token comment">//jwt目的是谁 用来验证观众</span>
                <span class="token punctuation">.</span><span class="token function">setVerificationKey</span><span class="token punctuation">(</span>publicKey<span class="token punctuation">)</span> <span class="token comment">// 用公钥验证签名  验证密钥</span>
                <span class="token punctuation">.</span><span class="token function">setJwsAlgorithmConstraints</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AlgorithmConstraints</span><span class="token punctuation">(</span><span class="token class-name">AlgorithmConstraints<span class="token punctuation">.</span>ConstraintType</span><span class="token punctuation">.</span><span class="token constant">WHITELIST</span><span class="token punctuation">,</span> <span class="token class-name">AlgorithmIdentifiers</span><span class="token punctuation">.</span><span class="token constant">RSA_USING_SHA256</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 3、验证jwt 并将其处理为 claims</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token class-name">JwtClaims</span> jwtClaims <span class="token operator">=</span> jwtConsumer<span class="token punctuation">.</span><span class="token function">processToClaims</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> jwtClaims<span class="token punctuation">.</span><span class="token function">getClaimsMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 生成</span>
        <span class="token class-name">String</span> baizhan <span class="token operator">=</span> <span class="token function">sign</span><span class="token punctuation">(</span><span class="token number">1001L</span><span class="token punctuation">,</span> <span class="token string">&quot;malu&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>baizhan<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> stringObjectMap <span class="token operator">=</span> <span class="token function">verify</span><span class="token punctuation">(</span>baizhan<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringObjectMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>stringObjectMap<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br></div></div><h3 id="_14-登录成功后生成令牌"><a href="#_14-登录成功后生成令牌" class="header-anchor">#</a> 14，登录成功后生成令牌</h3> <p>登录成功后生成令牌</p> <p><img src="/devops/public/assets/img/1726808785650.7cc0ed10.png" alt="1726808785650"></p> <p><img src="/devops/public/assets/img/1726808830731.6bb1e59a.png" alt="1726808830731"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">loginPassword</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1.验证用户名</span>
  <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingUser</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">,</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">ShoppingUser</span> shoppingUser <span class="token operator">=</span> shoppingUserMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>shoppingUser <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusException</span><span class="token punctuation">(</span><span class="token class-name">CodeEnum</span><span class="token punctuation">.</span><span class="token constant">LOGIN_NAME_PASSWORD_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
  <span class="token comment">// 2.验证密码</span>
  <span class="token keyword">boolean</span> verify <span class="token operator">=</span> <span class="token class-name">Md5Util</span><span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> shoppingUser<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>verify<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusException</span><span class="token punctuation">(</span><span class="token class-name">CodeEnum</span><span class="token punctuation">.</span><span class="token constant">LOGIN_NAME_PASSWORD_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
  <span class="token comment">// 3.生成JWT令牌，返回令牌</span>
  <span class="token class-name">String</span> sign <span class="token operator">=</span> <span class="token class-name">JwtUtils</span><span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>shoppingUser<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>shoppingUser<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> sign<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">loginCheckCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span> <span class="token class-name">String</span> checkCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">ValueOperations</span> valueOperations <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Object</span> checkCodeRedis <span class="token operator">=</span> valueOperations<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;loginCode:&quot;</span> <span class="token operator">+</span> phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>checkCode<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>checkCodeRedis<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusException</span><span class="token punctuation">(</span><span class="token class-name">CodeEnum</span><span class="token punctuation">.</span><span class="token constant">LOGIN_CODE_ERROR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
  <span class="token comment">// 登录成功，查找用户，返回用户名</span>
  <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingUser</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;phone&quot;</span><span class="token punctuation">,</span>phone<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">ShoppingUser</span> shoppingUser <span class="token operator">=</span> shoppingUserMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">// 生成JWT令牌，返回令牌</span>
  <span class="token class-name">String</span> sign <span class="token operator">=</span> <span class="token class-name">JwtUtils</span><span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span>shoppingUser<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>shoppingUser<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> sign<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><p>将令牌返回给客户端</p> <p><img src="/devops/public/assets/img/1726808873827.27163258.png" alt="1726808873827"></p> <p><img src="/devops/public/assets/img/1726808917014.6a0dff65.png" alt="1726808917014"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 用户名密码登录
 * @param shoppingUser 用户对象
 * @return 登录结果
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/loginPassword&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">BaseResult</span> <span class="token function">loginPassword</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestBody</span> <span class="token class-name">ShoppingUser</span> shoppingUser<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">String</span> sign <span class="token operator">=</span> shoppingUserService<span class="token punctuation">.</span><span class="token function">loginPassword</span><span class="token punctuation">(</span>shoppingUser<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> shoppingUser<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token class-name">BaseResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>




<span class="token comment">/**
 * 手机号验证码登录
 * @param phone 手机号
 * @param checkCode 验证码
 * @return 操作结果
 */</span>
<span class="token annotation punctuation">@PostMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/loginCheckCode&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">BaseResult</span> <span class="token function">loginCheckCode</span><span class="token punctuation">(</span><span class="token class-name">String</span> phone<span class="token punctuation">,</span><span class="token class-name">String</span> checkCode<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">String</span> sign <span class="token operator">=</span> shoppingUserService<span class="token punctuation">.</span><span class="token function">loginCheckCode</span><span class="token punctuation">(</span>phone<span class="token punctuation">,</span> checkCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token class-name">BaseResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>sign<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><p>测试：</p> <p><img src="/devops/public/assets/img/1726809034412.91467a9b.png" alt="1726809034412"></p> <h3 id="_15-higress配置jwt认证"><a href="#_15-higress配置jwt认证" class="header-anchor">#</a> 15，Higress配置JWT认证</h3> <p>在Higress的插件市场配置JWT认证</p> <p><img src="/devops/public/assets/img/1726809065868.0ae87cf9.png" alt="1726809065868"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">consumers</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;consumer1&quot;</span>
  <span class="token key atrule">issuer</span><span class="token punctuation">:</span> <span class="token string">&quot;malu&quot;</span>
  <span class="token key atrule">jwks</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    {
      &quot;keys&quot;: [
        {
          &quot;kty&quot;: &quot;RSA&quot;,
          &quot;kid&quot;: &quot;keyId&quot;,
          &quot;n&quot;: &quot;kkMFB482qG5cjMouvhn0ZuUwTtLvRsI3Q3CoIOcphHwFddggJpXCVno4nDNBoB74OwFn1cncIvsuUC2b7U1U0V3ra9EJnPd1xbitXst0Yd6CTKh9aDRBNAu0Hrq-BhF_wUqzLzzMLnM5XTbwq0Et9BFkwqCaBUfTJ_qco0UuGRmpeeqEIVZC0IxfSUszQQcgkkMicfCBVfvFzdEm8MHN0e9NX65Ae_rnMUCaGW3122tq8UYoBp5SZ6jwoNw2I2xCda3DHu3WYXhjx2VHd2B-C45jVDs77J_2w7fmYpXsH2WL_axe3m_e8P7UEt6mxVnRtevIdVIlv51Wnls5DJw1Aw&quot;,
          &quot;e&quot;: &quot;AQAB&quot;
        }
      ]
    }</span>
<span class="token key atrule">global_auth</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p><img src="/devops/public/assets/img/1726810381882.adeada98.png" alt="1726810381882"></p> <p>在路由配置开启JWT认证</p> <p><img src="/devops/public/assets/img/1726809440514.686f0148.png" alt="1726809440514"></p> <p><img src="/devops/public/assets/img/1726809482563.ddb16a06.png" alt="1726809482563"></p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">allow</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token string">&quot;consumer1&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>注：请求时，前端需要在请求头添加 Authorization=Bearer 令牌数据</p> <p>测试：</p> <p><img src="/devops/public/assets/img/1726810709960.485f5024.png" alt="1726810709960"></p> <p><img src="/devops/public/assets/img/1726810798489.2e4a1cff.png" alt="1726810798489"></p> <p><img src="/devops/public/assets/img/1726810825875.8a4e7bd0.png" alt="1726810825875"></p> <p><img src="/devops/public/assets/img/1726811007073.f29e2071.png" alt="1726810950091"></p> <h3 id="_16-获取用户和退出登录"><a href="#_16-获取用户和退出登录" class="header-anchor">#</a> 16，获取用户和退出登录</h3> <p>在<strong>用户服务模块</strong>编写用户服务接口实现类</p> <p><img src="/devops/public/assets/img/1726811175238.73d457ea.png" alt="1726811175238"></p> <p><img src="/devops/public/assets/img/1726811193982.e8d73b21.png" alt="1726811193982"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token class-name">JwtUtils</span><span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> username <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;username&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> username<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">ShoppingUser</span> <span class="token function">getLoginUser</span><span class="token punctuation">(</span><span class="token class-name">String</span> token<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 从令牌中获取用户id</span>
  <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> map <span class="token operator">=</span> <span class="token class-name">JwtUtils</span><span class="token punctuation">.</span><span class="token function">verify</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">Long</span> userId <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> map<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;userId&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 根据id查询用户</span>
  <span class="token class-name">QueryWrapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ShoppingUser</span><span class="token punctuation">&gt;</span></span> queryWrapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">QueryWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  queryWrapper<span class="token punctuation">.</span><span class="token function">eq</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">ShoppingUser</span> shoppingUser <span class="token operator">=</span> shoppingUserMapper<span class="token punctuation">.</span><span class="token function">selectOne</span><span class="token punctuation">(</span>queryWrapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> shoppingUser<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>在<strong>用户API模块</strong>编写控制器</p> <p><img src="/devops/public/assets/img/1726811223952.b49f603d.png" alt="1726811223952"></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
   * 获取登录的用户名
   * @param authorization 令牌
   * @return 用户名
   */</span>
<span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/getName&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">BaseResult</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token annotation punctuation">@RequestHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Authorization&quot;</span><span class="token punctuation">)</span> <span class="token class-name">String</span> authorization<span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token class-name">String</span> token <span class="token operator">=</span> authorization<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">&quot;Bearer &quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token class-name">String</span> name <span class="token operator">=</span> shoppingUserService<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token class-name">BaseResult</span><span class="token punctuation">.</span><span class="token function">ok</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>使用Postman测试控制器</p> <p><img src="/devops/public/assets/img/1726811459812.1e9154ae.png" alt="1726811459812"></p> <p>编写退出登录功能，后端无需编写退出登录功能，前端删除令牌即可退出登录。</p> <p><img src="/devops/public/assets/img/1726811539147.6f6ff2a9.png" alt="1726811539147"></p></div></section> <footer class="page-edit"><!----> <!----></footer> <!----> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_1-申请阿里云短信" class="sidebar-link reco-side-_1-申请阿里云短信" data-v-b57cc07c>1，申请阿里云短信</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_2-创建短信服务模块" class="sidebar-link reco-side-_2-创建短信服务模块" data-v-b57cc07c>2，创建短信服务模块</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_3-创建网站用户模块" class="sidebar-link reco-side-_3-创建网站用户模块" data-v-b57cc07c>3，创建网站用户模块</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_4-编写用户服务接口" class="sidebar-link reco-side-_4-编写用户服务接口" data-v-b57cc07c>4，编写用户服务接口</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_5-用户注册" class="sidebar-link reco-side-_5-用户注册" data-v-b57cc07c>5，用户注册</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_6-验证注册验证码" class="sidebar-link reco-side-_6-验证注册验证码" data-v-b57cc07c>6，验证注册验证码</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_7-用户注册" class="sidebar-link reco-side-_7-用户注册" data-v-b57cc07c>7，用户注册</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_8-用户名密码登录" class="sidebar-link reco-side-_8-用户名密码登录" data-v-b57cc07c>8，用户名密码登录</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_9-发送登录验证码" class="sidebar-link reco-side-_9-发送登录验证码" data-v-b57cc07c>9，发送登录验证码</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_10-验证登录验证码" class="sidebar-link reco-side-_10-验证登录验证码" data-v-b57cc07c>10，验证登录验证码</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_11-优化手机号验证码登录" class="sidebar-link reco-side-_11-优化手机号验证码登录" data-v-b57cc07c>11，优化手机号验证码登录</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_12-单点登录" class="sidebar-link reco-side-_12-单点登录" data-v-b57cc07c>12，单点登录</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_13-编写jwt工具类" class="sidebar-link reco-side-_13-编写jwt工具类" data-v-b57cc07c>13，编写JWT工具类</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_14-登录成功后生成令牌" class="sidebar-link reco-side-_14-登录成功后生成令牌" data-v-b57cc07c>14，登录成功后生成令牌</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_15-higress配置jwt认证" class="sidebar-link reco-side-_15-higress配置jwt认证" data-v-b57cc07c>15，Higress配置JWT认证</a></li><li class="level-3" data-v-b57cc07c><a href="/devops/public/blogs/springcloudalibaba/shopcms2/shopcms2.html#_16-获取用户和退出登录" class="sidebar-link reco-side-_16-获取用户和退出登录" data-v-b57cc07c>16，获取用户和退出登录</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/devops/public/assets/js/app.dadcdc75.js" defer></script><script src="/devops/public/assets/js/105.a42e65d8.js" defer></script><script src="/devops/public/assets/js/1.774fca24.js" defer></script><script src="/devops/public/assets/js/50.02485a08.js" defer></script>
  </body>
</html>
