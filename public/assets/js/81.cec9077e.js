(window.webpackJsonp=window.webpackJsonp||[]).push([[81],{14950:function(s,a,t){"use strict";t.r(a);var n=t(2),e=Object(n.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"_1-面试题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-面试题"}},[s._v("#")]),s._v(" 1，面试题")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("Q87:你刚入职，发现grafana查询不到数据请问你该如何排查?\n\n\nQ88:Prometheus监控服务的流程?\n\n\nQ89:你们公司用的什么监控系统?都监控了什么服务呢?监控了多少台机器?\n\n\nQ90:Prometheus监控一个MySQL服务，数据流走向是啥?\n\n\nQ91:在使用Prometheus时，你都遇到了哪些印象比较深刻的故障?\n\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("h3",{attrs:{id:"_2-监控window-server"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-监控window-server"}},[s._v("#")]),s._v(" 2，监控window server")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".下载windows的exporter\nhttps://github.com/prometheus-community/windows_exporter/releases/download/v0.28.2/windows_exporter-0.28.2-amd64.exe\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".启动服务\nwindows_exporter-0.28.2-amd64.exe --web.listen-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(":9182 "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--telemetry.path")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/metrics"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".访问metrics测试\nhttp://10.0.0.1:9182/metrics\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".修改Prometheus的配置文件 \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-windows"')]),s._v("\n    static_configs:\n      - targets: \n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.1:9182\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".热加载配置文件\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl  -X POST 10.0.0.31:9090/-/reload")]),s._v("\n\n\t\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".验证服务是否生效 \nhttp://10.0.0.31:9090/targets\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".导入grafana的模板ID\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("20763")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14694")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br")])]),a("h3",{attrs:{id:"_3-监控mongodb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-监控mongodb"}},[s._v("#")]),s._v(" 3，监控mongoDB")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".部署MongoDB\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter43 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker run -d --name mongodb-server --network host mongodb/mongodb-community-server:5.0.23-ubuntu2004")]),s._v("\n2dc7c724eb169a3046bf18ebe79d9075b44d8d46db3e30bf032b3acb5c5a827a\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter43 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter43 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -ntl | grep 27017")]),s._v("\nLISTEN "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("         "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:27017      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*          \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter43 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".部署mongoDB的exporter\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/percona/mongodb_exporter/releases/download/v0.42.0/mongodb_exporter-0.42.0.linux-amd64.tar.gz\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".解压软件包 \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf mongodb_exporter-0.42.0.linux-amd64.tar.gz -C /usr/local/bin/ mongodb_exporter-0.42.0.linux-amd64/mongodb_exporter --strip-components=1")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".启动MongoDB_exporter\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# mongodb_exporter  --mongodb.uri=mongodb://10.0.0.43:27017/admin --web.listen-address=":9216" --web.telemetry-path="/metrics"')]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".验证mongoDB的metrics\nhttp://10.0.0.42:9216/metrics\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".prometheus配置MongoDB的监控\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-mongoDB"')]),s._v("\n    static_configs:\n      - targets: \n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:9216\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".热加载配置文件\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl  -X POST 10.0.0.31:9090/-/reload")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".验证服务是否生效\nhttp://10.0.0.31:9090/targets\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(".导入grafana的模板ID\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("12079")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16490")]),s._v("\n\t\n\t\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(".后续优化点【ToDO添加mangoDB的授权配置】\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# mongodb_exporter  --mongodb.uri=mongodb://linux94:malu@10.0.0.43:27017/admin --web.listen-address=":9216" --web.telemetry-path="/metrics" --mongodb.collstats-colls=yinzhengjie')]),s._v("\nERRO"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("0000"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Cannot connect to MongoDB: cannot connect to MongoDB: connection"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" error occurred during connection handshake: auth error: sasl conversation error: unable to authenticate using mechanism "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SCRAM-SHA-1"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("AuthenticationFailed"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" Authentication failed.\n\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n\n参考文档:\n\thttps://www.mongodb.com/zh-cn/docs/v5.0/faq/sharding/\n\t\n\t\ndb.createUser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("user:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu"')]),s._v(",pwd:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"123456"')]),s._v(",roles:"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("role:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clusterMonitor"')]),s._v(",db:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("role:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"read"')]),s._v(",db:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"local"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndb.grantRolesToUser"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("role:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"clusterMonitor"')]),s._v(",db:"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"admin"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br")])]),a("h3",{attrs:{id:"_4-blackbox黑盒监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-blackbox黑盒监控"}},[s._v("#")]),s._v(" 4，blackbox黑盒监控")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".blackbox_exporter概述\nblackbox exporter支持基于HTTP, HTTPS, DNS, TCP, ICMP, gRPC协议来对目标节点进行监控。\n- 比如基于http协议我们可以探测一个网站的返回状态码为200判读服务是否正常。\n- 比如基于TCP协议我们可以探测一个主机端口是否监听。\n- 比如基于ICMP协议来ping一个主机的连通性。\n- 比如基于gRPC协议来调用接口并验证服务是否正常工作。\n- 比如基于DNS协议可以来检测域名解析。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".下载blockbox\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/prometheus/blackbox_exporter/releases/download/v0.25.0/blackbox_exporter-0.25.0.linux-amd64.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll blackbox_exporter-0.25.0.linux-amd64.tar.gz ")]),s._v("\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("11269099")]),s._v(" Nov "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":55 blackbox_exporter-0.25.0.linux-amd64.tar.gz\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".解压软件包 \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf blackbox_exporter-0.25.0.linux-amd64.tar.gz  -C /malu/softwares/")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".编写启动脚本\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat > /lib/systemd/system/blackbox_exporter.service <<EOF")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Unit"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Description")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("blackbox "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Documentation")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://www.malu.com/\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("After")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("network.target\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ExecStart")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/malu/softwares/blackbox_exporter-0.25.0.linux-amd64/blackbox_exporter "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--config.file")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/malu/softwares/blackbox_exporter-0.25.0.linux-amd64/blackbox.yml"')]),s._v(" --web.listen-address"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(":9115\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("WantedBy")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("multi-user.target\nEOF\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".启动blackbox\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable --now blackbox_exporter")]),s._v("\nCreated symlink /etc/systemd/system/multi-user.target.wants/blackbox_exporter.service → /lib/systemd/system/blackbox_exporter.service.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -ntl | grep 9115")]),s._v("\nLISTEN "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("               *:9115            *:*          \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\t\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".访问blackbox的WebUI\nhttp://10.0.0.42:9115/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7295),alt:"1731588791006"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7296),alt:"1731588817354"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7297),alt:"1731588842560"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".查看blackbox内置的模块列表\nhttp://10.0.0.42:9115/config\t\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7298),alt:"1731588871657"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".手动实现http_2xx探测百度网站:\nhttp://10.0.0.42:9115/probe?target"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("baidu.com"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("module")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http_2xx"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("debug")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7299),alt:"1731589023968"}})]),s._v(" "),a("h3",{attrs:{id:"_5-http-2xx实现网站监控"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-http-2xx实现网站监控"}},[s._v("#")]),s._v(" 5，http_2xx实现网站监控")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".修改Prometheus的配置文件\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-blackbox"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定探针路径")]),s._v("\n    metrics_path: probe \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递模块参数，若不不指定，则默认就是http_2xx模块。")]),s._v("\n    params:\n      module: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("http_2xx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    static_configs:\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置需要监控的目标")]),s._v("\n      - targets: \n          - www.jd.com\n          - www.qq.com\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.51:3000\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示监控目标并不直接监控，而是有blackbox进行监控")]),s._v("\n    relabel_configs:\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加一个target参数")]),s._v("\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__address__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: __param_target\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改Endpoint地址，而此时Endpoint地址和instance的__address__是一致的。")]),s._v("\n      - target_label: __address__\n        replacement: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:9115\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由于修改了__address__,instance也会跟着变化，因此需要将target再重新赋值。")]),s._v("\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__param_target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: instance\n\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'malu_blackbox_exporter'")]),s._v("\n    static_configs:\n      - targets: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.0.0.42:9115'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".热加载配置文件\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl  -X POST 10.0.0.31:9090/-/reload ")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".验证服务是否生效\nhttp://10.0.0.31:9090/targets\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7300),alt:"1731589303549"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7301),alt:"1731589460023"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".blackbox_exporter的http_2xx探针指标说明\nprobe_http_ssl:\n\t当probe_http_ssl的值为1时，表示该instance使用的是https协议。为0表示使用的http协议。\n\t\nprobe_http_status_code\n\t表示网站返回的状态码，如果为0表示探测失败！\n\nprobe_http_duration_seconds：\n\t表示分阶段耗时统计。\n\t\nprobe_duration_seconds:\n\t表示总耗时。\n\t\nprobe_success:\n\t表示探测是否成功，其中1表示探测成功，0表示探测失败。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7302),alt:"1731589663438"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7303),alt:"1731589683399"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7304),alt:"1731589722332"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7305),alt:"1731589743801"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7306),alt:"1731589761792"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".grafana导入模板 \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7587")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13659")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7307),alt:"1731589870152"}})]),s._v(" "),a("h3",{attrs:{id:"_6-icmp监控目标主机是否存活"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_6-icmp监控目标主机是否存活"}},[s._v("#")]),s._v(" 6，ICMP监控目标主机是否存活")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 修改Prometheus配置文件\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'malu-blackbox-exporter-icmp'")]),s._v("\n    metrics_path: /probe\n    params:\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 如果不指定模块，则默认类型为"http_2xx"，不能乱写!乱写监控不到服务啦!')]),s._v("\n      module: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("icmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    static_configs:\n      - targets:\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.41\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42\n    relabel_configs:\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__address__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: __param_target\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__param_target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: instance\n      - target_label: __address__\n        replacement: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:9115  \n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".重新加载配置\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl  -X POST 10.0.0.31:9090/-/reload ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" 访问prometheus的WebUI\nhttp://10.0.0.31:9090/targets\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" 访问blackbox的WebUI \nhttp://10.0.0.42:9115/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7308),alt:"1731590551160"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7309),alt:"1731590573050"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" grafana过滤jobs数据\n基于"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-blackbox-exporter-icmp"')]),s._v("标签进行过滤。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7310),alt:"1731590765965"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7311),alt:"1731590855620"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7312),alt:"1731590876436"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7313),alt:"1731590886232"}})]),s._v(" "),a("h3",{attrs:{id:"_7-tcp监控端口是否存活"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_7-tcp监控端口是否存活"}},[s._v("#")]),s._v(" 7，TCP监控端口是否存活")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 修改Prometheus配置文件\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'malu-blackox-exporter-tcp'")]),s._v("\n    metrics_path: /probe\n    params:\n      module: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("tcp_connect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    static_configs:\n      - targets:\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.41:80\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:22\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.31:9090\n    relabel_configs:\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__address__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: __param_target\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__param_target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: instance\n      - target_label: __address__\n        replacement: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:9115\n\t\t\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 重新加载配置文件\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -X POST http://10.0.0.31:9090/-/reload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".访问prometheus的WebUI\nhttp://10.0.0.31:9090/targets\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".访问blackbox exporter的WebUI\nhttp://10.0.0.41:9115/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7314),alt:"1731591455363"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7315),alt:"1731591485948"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".使用grafana查看数据\n基于"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-blackox-exporter-top"')]),s._v("标签进行过滤。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7316),alt:"1731591531314"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7317),alt:"1731591643647"}})]),s._v(" "),a("h3",{attrs:{id:"_8-ssh监控ssh服务是否存活"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_8-ssh监控ssh服务是否存活"}},[s._v("#")]),s._v(" 8，ssh监控ssh服务是否存活")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 修改Prometheus配置文件\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'malu-blackox-exporter-ssh'")]),s._v("\n    metrics_path: /probe\n    params:\n      module: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ssh_banner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    static_configs:\n      - targets:\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.41:22\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43:22\n    relabel_configs:\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__address__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: __param_target\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__param_target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: instance\n      - target_label: __address__\n        replacement: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:9115    \n\t\t\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 重新加载配置文件\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -X POST http://10.0.0.31:9090/-/reload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".访问prometheus的WebUI\nhttp://10.0.0.31:9090/targets\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".访问blackbox exporter的WebUI\nhttp://10.0.0.41:9115/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7318),alt:"1731591807227"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7319),alt:"1731591836023"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".使用grafana查看数据\n基于"),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-blackox-exporter-ssh"')]),s._v("标签进行过滤。\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7320),alt:"1731591883083"}})]),s._v(" "),a("h3",{attrs:{id:"_9-部署pushgateway组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_9-部署pushgateway组件"}},[s._v("#")]),s._v(" 9，部署pushgateway组件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".pushgateway的作用\n就是用来用户自定义监控指标，一般用于临时存储。\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".下载pushgateway\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/prometheus/pushgateway/releases/download/v1.10.0/pushgateway-1.10.0.linux-amd64.tar.gz\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".解压软件包 \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf pushgateway-1.10.0.linux-amd64.tar.gz -C /usr/local/bin/ pushgateway-1.10.0.linux-amd64/pushgateway --strip-components=1")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".创建数据目录\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir -pv /malu/data/pushgateway")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".编写启动脚本 \n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /lib/systemd/system/pushgateway.service "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n[Unit]\nDescription=pushgateway services\nDocumentation=https://www.malu.com\nAfter=network.target\n\n[Service]\nExecStart=/usr/local/bin/pushgateway --web.telemetry-path="/metrics" --web.listen-address=:9091 --web.enable-lifecycle --persistence.file=/malu/data/pushgateway/pushgateway.data --persistence.interval=1m\n\n\n[Install]\nWantedBy=multi-user.target\nEOF')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".启动服务\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl daemon-reload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable --now pushgateway.service ")]),s._v("\nCreated symlink /etc/systemd/system/multi-user.target.wants/pushgateway.service → /lib/systemd/system/pushgateway.service.\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -ntl | grep 9091")]),s._v("\nLISTEN "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("               *:9091            *:*          \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".查看pushgateway的WebUI\nhttp://10.0.0.42:9091/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7321),alt:"1731593814262"}})]),s._v(" "),a("h3",{attrs:{id:"_10-prometheus集成pushgateway组件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_10-prometheus集成pushgateway组件"}},[s._v("#")]),s._v(" 10，Prometheus集成pushgateway组件")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".修改Prometheus的配置文件\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'malu-pushgateway'")]),s._v("\n    static_configs:\n      - targets: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.0.0.42:9091'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".热加载配置文件\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl  -X POST 10.0.0.31:9090/-/reload  ")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".验证配置是否生效\nhttp://10.0.0.31:9090/targets\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7322),alt:"1731593873083"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".发生测试数据到pushgateway\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.1")]),s._v(" 发送单条数据\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "students_online_count 78" | curl --data-binary @- http://10.0.0.42:9091/metrics/job/malu-student-online')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7323),alt:"1731594333601"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7324),alt:"1731594396049"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(" 发送多条数据\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF"),a("span",{pre:!0,attrs:{class:"token bash punctuation"}},[s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --data-binary @- http://10.0.0.42:9091/metrics/job/malu_hobby/instance/10.0.0.99")]),s._v('\n# TYPE xijiao_count counter\nxijiao_count{name="wanghaonan",age="22"} 365\nxijiao_count{name="songlpngyang",age="22"} 366\nxijiao_count{name="wanghuifeng",age="21"} 98\nxijiao_count{name="yuanshuhao",age="23"} 86\nxijiao_count{name="libowen",age="23"} 66\nxijiao_count{name="luozhiyang",age="24"} 32\n# TYPE game_seconds gauge\n# HELP game_seconds play game times.\ngame_seconds{name="yanbo"} 3600\nEOF')]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7325),alt:"1731594810129"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7326),alt:"1731594863774"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".grafana展示数据\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7327),alt:"1731594973696"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7328),alt:"1731594994595"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7329),alt:"1731595096571"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7330),alt:"1731595194071"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7331),alt:"1731595391434"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7332),alt:"1731595535432"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7333),alt:"1731595655065"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7334),alt:"1731595769539"}})]),s._v(" "),a("h3",{attrs:{id:"_11-监控tcp的12种状态"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_11-监控tcp的12种状态"}},[s._v("#")]),s._v(" 11，监控tcp的12种状态")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".编写脚本采集12种状态\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat > /usr/local/bin/tcp_status.sh  <<'EOF'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义TCP的12种状态")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ESTABLISHED_COUNT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SYN_SENT_COUNT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("SYN_RECV_COUNT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FIN_WAIT1_COUNT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("FIN_WAIT2_COUNT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TIME_WAIT_COUNT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLOSE_COUNT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLOSE_WAIT_COUNT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LAST_ACK_COUNT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("LISTEN_COUNT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("CLOSING_COUNT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("UNKNOWN_COUNT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义任务名称")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("JOB_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp_status\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义实例名称")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("INSTANCE_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("harbor250\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义pushgateway主机")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("HOST")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义pushgateway端口")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PORT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9091")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TCP的12种状态")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ALL_STATUS")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ESTABLISHED SYN_SENT SYN_RECV FIN_WAIT1 FIN_WAIT2 TIME_WAIT CLOSE CLOSE_WAIT LAST_ACK LISTEN CLOSING UNKNOWN"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 声明一个关联数组,类似于py的dict,go的map")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("declare")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-A")]),s._v(" tcp_status\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 统计TCP的12种状态")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${ALL_STATUS"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("temp")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("netstat")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-untalp")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" $i  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n  tcp_status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${i}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$temp")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将统计后的结果发送到pushgateway")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("tcp_status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("@"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v(" \n   "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("data")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${tcp_status"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("$i"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("}")]),s._v('"')]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TODO: shell如果想要设计成相同key不同标签的方式存在问题，只会有最后一种状态被发送")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 目前我怀疑是pushgateway组件不支持同一个metrics中key所对应的value不同的情况。")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#data="malu_tcp_all_status{status=\\"$i\\"} ${tcp_status[$i]}"')]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#echo $data")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$data")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --data-binary @-  http://"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${HOST}")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${PORT}")]),s._v("/metrics/job/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${JOB_NAME}")]),s._v("/instance/"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${INSTANCE_NAME}")]),s._v("\n   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sleep 1")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\nEOF\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".编写定时任务推送数据到pushgateway\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# echo "*/5 * * * * /usr/local/bin/tcp_status.sh" >> /var/spool/cron/crontabs/root')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# crontab -l")]),s._v("\n*/5 * * * * /usr/local/bin/tcp_status.sh\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod +x /usr/local/bin/tcp_status.sh ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /usr/local/bin/tcp_status.sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".观察pushgateway的WebUI\nhttp://10.0.0.42:9091/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7335),alt:"1731597456112"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7336),alt:"1731597501398"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7337),alt:"1731597535236"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7338),alt:"1731597575732"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7339),alt:"1731597591338"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".其他同学参考\n使用文件输出\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sed -i 's/\\xc2\\xa0/ /g' /usr/local/bin/tcp_status2.sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat -A /usr/local/bin/tcp_status2.sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("pushgateway_url")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://10.0.0.42:9091/metrics/job/tcp_status"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("time")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("date")]),s._v(" +%Y-%m-%d+%H:%M:%S"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("state")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"SYN-SENT SYN-RECV FIN-WAIT-1 FIN-WAIT-2 TIME-WAIT CLOSE CLOSE-WAIT LAST-ACK LISTEN CLOSING ESTAB"')]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("i")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$state")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("t")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("ss "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-tan")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" $i "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wc")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\n "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" tcp_connections"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("state"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v('"'),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v('"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v('"'),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$t")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("/tmp/tcp.txt\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /tmp/tcp.txt "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" --data-binary @- "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$pushgateway_url")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-rf")]),s._v("  /tmp/tcp.txt\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#bash /usr/local/bin/tcp_status2.sh")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7340),alt:"1731597832043"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7341),alt:"1731597875187"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7342),alt:"1731597897491"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7343),alt:"1731597956733"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7344),alt:"1731598038024"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7345),alt:"1731598115640"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7346),alt:"1731598147829"}})]),s._v(" "),a("h3",{attrs:{id:"_12-python自定义exporter"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_12-python自定义exporter"}},[s._v("#")]),s._v(" 12，python自定义exporter")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 安装pip3工具包\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  apt update")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#  apt install -y python3-pip")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.2")]),s._v(" pip配置加速\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir ~/.pip")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim ~/.pip/pip.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat ~/.pip/pip.conf")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [global]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# index-url=https://pypi.tuna.tsinghua.edu.cn/simple")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [install]")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# trusted-host=pypi.douban.com")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("global"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nindex-url"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://mirrors.aliyun.com/pypi/simple\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("install"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ntrusted-host"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mirrors.aliyun.com\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.3")]),s._v(" 安装实际环境中相关模块库\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pip3 install flask prometheus_client")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pip3 list")]),s._v("\n\n\n \n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.4")]),s._v(" 编写代码\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat flask_metric.py ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/usr/bin/python3")]),s._v("\n\nfrom prometheus_client "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" start_http_server,Counter, Summary\nfrom flask "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" Flask, jsonify\nfrom wsgiref.simple_server "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" make_server\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v("\n\napp "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Flask"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("__name__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Create a metric to track time spent and requests made")]),s._v("\nREQUEST_TIME "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Summary"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'request_processing_seconds'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Time spent processing request'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nCOUNTER_TIME  "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" Counter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"request_count"')]),s._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Total request count of the host"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n@app.route"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/apps"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n@REQUEST_TIME.time"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\ndef requests_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(":\n    COUNTER_TIME.inc"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v(" jsonify"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"office"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://www.ok.com"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(","),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"auther"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"sy"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" __name__ "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"__main__"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n    start_http_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    httpd "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" make_server"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0.0.0.0'")]),s._v(", "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8001")]),s._v(", app "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    httpd.serve_forever"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.5")]),s._v(" 启动python程序\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter41 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# python3 flask_metric.py ")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当启动客户端测试时，可能会出现如下的信息")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("/Nov/2024 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":31:57"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /apps HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("/Nov/2024 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":31:57"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /apps HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("/Nov/2024 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":31:57"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /apps HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("/Nov/2024 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":31:57"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /apps HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("/Nov/2024 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":31:57"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /apps HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("/Nov/2024 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":31:57"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /apps HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("/Nov/2024 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":31:57"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /apps HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("/Nov/2024 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":31:57"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /apps HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("/Nov/2024 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":31:57"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"GET /apps HTTP/1.1"')]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.6")]),s._v(" 客户端测试\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter43 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat curl_metrics.sh")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("URL")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http://10.0.0.42:8001/apps\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("curl_num")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$((")]),s._v(" $RANDOM"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("))")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("sleep_num")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$((")]),s._v(" $RANDOM"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("%")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("))")])]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("c_num")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("seq")]),s._v(" $curl_num"),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("do")]),s._v("\n        "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$URL")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" /dev/null\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sleep")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sleep_num")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("done")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter43 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter43 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# bash curl_metrics.sh")]),s._v("\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.7")]),s._v(" prometheus监控python自定义的exporter实战\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-python"')]),s._v("\n    static_configs:\n      - targets:\n        - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:8000\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.8")]),s._v(" 重新加载配置文件\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-X")]),s._v(" POST http://10.0.0.31:9090/-/reload \n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.9")]),s._v(" 验证prometheus是否采集到数据\nhttp://10.0.0.31:9090/targets\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7347),alt:"1731633150855"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.10")]),s._v(" grafana作图展示\nrequest_count_total\napps请求总数。\n\t\n\t\nincrease"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request_count_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("job"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-python"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n每分钟请求数量曲线QPS。\n\n\nirate"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request_count_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("job"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-python"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("1m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n每分钟请求量变化率曲线QPS \n\t\nrequest_processing_seconds_sum"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("job"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-python"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" / request_processing_seconds_count"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("job"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-python"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n请求处理平均耗时\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7348),alt:"1731633193050"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7349),alt:"1731633235741"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7350),alt:"1731633331990"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7351),alt:"1731633347719"}})]),s._v(" "),a("p",[s._v("作图：略")]),s._v(" "),a("h3",{attrs:{id:"_13-prometheus联邦模式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_13-prometheus联邦模式"}},[s._v("#")]),s._v(" 13，Prometheus联邦模式")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".修改Prometheus32节点 \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'malu-prometheus32'")]),s._v("\n    static_configs:\n      - targets: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.41:9100"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl  -X POST 10.0.0.32:9090/-/reload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".修改Prometheus33节点 \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'malu-prometheus33'")]),s._v("\n    static_configs:\n      - targets: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.42:9100"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.43:9100"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl  -X POST 10.0.0.33:9090/-/reload")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".验证各节点的配置是否生效 \nhttp://10.0.0.32:9090/targets\nhttp://10.0.0.33:9090/targets\n\n\n\n温馨提示:\n\t并在2个Prometheus server服务端使用PromQL查询： node_cpu_guest_seconds_total\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7352),alt:"1731633754446"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7353),alt:"1731633767115"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("已经做过的配置，备份一下：\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# my global config")]),s._v("\nglobal:\n  scrape_interval: 3s "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set the scrape interval to every 15 seconds. Default is every 1 minute.")]),s._v("\n  evaluation_interval: 15s "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Evaluate rules every 15 seconds. The default is every 1 minute.")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scrape_timeout is set to the global default (10s).")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Alertmanager configuration")]),s._v("\nalerting:\n  alertmanagers:\n    - static_configs:\n        - targets:\n          "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - alertmanager:9093")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.")]),s._v("\nrule_files:\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "first_rules.yml"')]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "second_rules.yml"')]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A scrape configuration containing exactly one endpoint to scrape:")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Here it's Prometheus itself.")]),s._v("\nscrape_configs:\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.")]),s._v("\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prometheus"')]),s._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# metrics_path defaults to '/metrics'")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scheme defaults to 'http'.")]),s._v("\n\n    static_configs:\n      - targets: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9090"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-node-exporter"')]),s._v("\n    metrics_path: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/metrics"')]),s._v("\n    scheme: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http"')]),s._v("\n    params:\n      collect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":\n        - meminfo\n    static_configs:\n       - targets: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.41:9100"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.42:9100"')]),s._v(","),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.43:9100"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("   \n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-zookeeper"')]),s._v("\n    static_configs:\n       - targets:\n           - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.91:7000 \n           - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.92:7000 \n           - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.93:7000 \n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-kafka"')]),s._v("\n    static_configs:\n       - targets:\n           - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.91:9308 \n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-elasticsearch"')]),s._v("\n    static_configs:\n       - targets:\n           - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.91:9114\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-mysqld"')]),s._v("\n    static_configs:\n       - targets:\n           - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.92:9104\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-redis"')]),s._v("\n    static_configs:\n       - targets:\n           - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.92:9121\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-nginx"')]),s._v("\n    static_configs:\n       - targets:\n           - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.93:9913\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-docker"')]),s._v("\n    static_configs:\n       - targets:\n           - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.93:18080\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-blackbox"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定探针路径")]),s._v("\n    metrics_path: probe \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 传递模块参数，若不不指定，则默认就是http_2xx模块。")]),s._v("\n    params:\n      module: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("http_2xx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    static_configs:\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置需要监控的目标")]),s._v("\n      - targets: \n          - www.jd.com\n          - www.qq.com\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.51:3000\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示监控目标并不直接监控，而是有blackbox进行监控")]),s._v("\n    relabel_configs:\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加一个target参数")]),s._v("\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__address__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: __param_target\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改Endpoint地址，而此时Endpoint地址和instance的__address__是一致的。")]),s._v("\n      - target_label: __address__\n        replacement: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:9115\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 由于修改了__address__,instance也会跟着变化，因此需要将target再重新赋值。")]),s._v("\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__param_target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: instance\n\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'malu_blackbox_exporter'")]),s._v("\n    static_configs:\n      - targets: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.0.0.42:9115'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'malu-blackbox-exporter-icmp'")]),s._v("\n    metrics_path: /probe\n    params:\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 如果不指定模块，则默认类型为"http_2xx"，不能乱写!乱写监控不到服务啦!')]),s._v("\n      module: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("icmp"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    static_configs:\n      - targets:\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.41\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42\n    relabel_configs:\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__address__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: __param_target\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__param_target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: instance\n      - target_label: __address_\n        replacement: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:9115_\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'malu-blackox-exporter-tcp'")]),s._v("\n    metrics_path: /probe\n    params:\n      module: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("tcp_connect"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    static_configs:\n      - targets:\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.41:80\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:22\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.31:9090\n    relabel_configs:\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__address__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: __param_target\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__param_target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: instance\n      - target_label: __address__\n        replacement: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:9115\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'malu-blackox-exporter-ssh'")]),s._v("\n    metrics_path: /probe\n    params:\n      module: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ssh_banner"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    static_configs:\n      - targets:\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.41:22\n          - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43:22\n    relabel_configs:\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__address__"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: __param_target\n      - source_labels: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__param_target"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        target_label: instance\n      - target_label: __address__\n        replacement: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:9115  \n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'malu-pushgateway'")]),s._v("\n    static_configs:\n      - targets: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.0.0.42:9091'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'malu-python'")]),s._v("\n    static_configs:\n      - targets: \n        - "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:8000\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br"),a("span",{staticClass:"line-number"},[s._v("95")]),a("br"),a("span",{staticClass:"line-number"},[s._v("96")]),a("br"),a("span",{staticClass:"line-number"},[s._v("97")]),a("br"),a("span",{staticClass:"line-number"},[s._v("98")]),a("br"),a("span",{staticClass:"line-number"},[s._v("99")]),a("br"),a("span",{staticClass:"line-number"},[s._v("100")]),a("br"),a("span",{staticClass:"line-number"},[s._v("101")]),a("br"),a("span",{staticClass:"line-number"},[s._v("102")]),a("br"),a("span",{staticClass:"line-number"},[s._v("103")]),a("br"),a("span",{staticClass:"line-number"},[s._v("104")]),a("br"),a("span",{staticClass:"line-number"},[s._v("105")]),a("br"),a("span",{staticClass:"line-number"},[s._v("106")]),a("br"),a("span",{staticClass:"line-number"},[s._v("107")]),a("br"),a("span",{staticClass:"line-number"},[s._v("108")]),a("br"),a("span",{staticClass:"line-number"},[s._v("109")]),a("br"),a("span",{staticClass:"line-number"},[s._v("110")]),a("br"),a("span",{staticClass:"line-number"},[s._v("111")]),a("br"),a("span",{staticClass:"line-number"},[s._v("112")]),a("br"),a("span",{staticClass:"line-number"},[s._v("113")]),a("br"),a("span",{staticClass:"line-number"},[s._v("114")]),a("br"),a("span",{staticClass:"line-number"},[s._v("115")]),a("br"),a("span",{staticClass:"line-number"},[s._v("116")]),a("br"),a("span",{staticClass:"line-number"},[s._v("117")]),a("br"),a("span",{staticClass:"line-number"},[s._v("118")]),a("br"),a("span",{staticClass:"line-number"},[s._v("119")]),a("br"),a("span",{staticClass:"line-number"},[s._v("120")]),a("br"),a("span",{staticClass:"line-number"},[s._v("121")]),a("br"),a("span",{staticClass:"line-number"},[s._v("122")]),a("br"),a("span",{staticClass:"line-number"},[s._v("123")]),a("br"),a("span",{staticClass:"line-number"},[s._v("124")]),a("br"),a("span",{staticClass:"line-number"},[s._v("125")]),a("br"),a("span",{staticClass:"line-number"},[s._v("126")]),a("br"),a("span",{staticClass:"line-number"},[s._v("127")]),a("br"),a("span",{staticClass:"line-number"},[s._v("128")]),a("br"),a("span",{staticClass:"line-number"},[s._v("129")]),a("br"),a("span",{staticClass:"line-number"},[s._v("130")]),a("br"),a("span",{staticClass:"line-number"},[s._v("131")]),a("br"),a("span",{staticClass:"line-number"},[s._v("132")]),a("br"),a("span",{staticClass:"line-number"},[s._v("133")]),a("br"),a("span",{staticClass:"line-number"},[s._v("134")]),a("br"),a("span",{staticClass:"line-number"},[s._v("135")]),a("br"),a("span",{staticClass:"line-number"},[s._v("136")]),a("br"),a("span",{staticClass:"line-number"},[s._v("137")]),a("br"),a("span",{staticClass:"line-number"},[s._v("138")]),a("br"),a("span",{staticClass:"line-number"},[s._v("139")]),a("br"),a("span",{staticClass:"line-number"},[s._v("140")]),a("br"),a("span",{staticClass:"line-number"},[s._v("141")]),a("br"),a("span",{staticClass:"line-number"},[s._v("142")]),a("br"),a("span",{staticClass:"line-number"},[s._v("143")]),a("br"),a("span",{staticClass:"line-number"},[s._v("144")]),a("br"),a("span",{staticClass:"line-number"},[s._v("145")]),a("br"),a("span",{staticClass:"line-number"},[s._v("146")]),a("br"),a("span",{staticClass:"line-number"},[s._v("147")]),a("br"),a("span",{staticClass:"line-number"},[s._v("148")]),a("br"),a("span",{staticClass:"line-number"},[s._v("149")]),a("br"),a("span",{staticClass:"line-number"},[s._v("150")]),a("br"),a("span",{staticClass:"line-number"},[s._v("151")]),a("br"),a("span",{staticClass:"line-number"},[s._v("152")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".配置Prometheus "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v("的联邦模式\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prometheus-federate-32"')]),s._v("\n    metrics_path: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/federate"')]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用于解决标签的冲突问题，有效值为: true和false，默认值为false")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 当设置为true时，将保留抓取的标签以忽略服务器自身的标签。说白了会覆盖原有标签。")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 当设置为false时，则不会覆盖原有标签，而是在标点前加了一个"exported_"前缀。')]),s._v("\n    honor_labels: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    params:\n       "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"match[]"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n       - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{job=\"promethues\"}'")]),s._v("\n       - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{__name__=~\"job:.*\"}'")]),s._v("\n       - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{__name__=~\"node.*\"}'")]),s._v("\n    static_configs:\n    - targets:\n        - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.32:9090"')]),s._v("\n\n  - job_name: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prometheus-federate-33"')]),s._v("\n    metrics_path: "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/federate"')]),s._v("\n    honor_labels: "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    params:\n       "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"match[]"')]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v("\n       - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{job=\"promethues\"}'")]),s._v("\n       - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{__name__=~\"job:.*\"}'")]),s._v("\n       - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{__name__=~\"node.*\"}'")]),s._v("\n    static_configs:\n    - targets:\n        - "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.33:9090"')]),s._v("\n\n\n\t\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".热加载配置文件\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl  -X POST 10.0.0.31:9090/-/reload  ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".验证配置是否生效 \nhttp://10.0.0.31:9090/targets\n\n查询PromQL指标: \n\tnode_cpu_guest_seconds_total"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("job"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=~")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu.*"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".grafana导入数据\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1860")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br")])]),a("p",[a("img",{attrs:{src:t(7354),alt:"1731634183048"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7355),alt:"1731634214840"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7356),alt:"1731634362535"}})]),s._v(" "),a("p",[a("img",{attrs:{src:t(7357),alt:"1731634518596"}})]),s._v(" "),a("h3",{attrs:{id:"_14-使用pushgateway监控网络丢包率-并使用grafana展示"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_14-使用pushgateway监控网络丢包率-并使用grafana展示"}},[s._v("#")]),s._v(" 14，使用pushgateway监控网络丢包率，并使用grafana展示")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ping")]),s._v(" baidu.com "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-c")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])])])}),[],!1,null,null,null);a.default=e.exports},7295:function(s,a,t){s.exports=t.p+"assets/img/1731588791006.9abba832.png"},7296:function(s,a,t){s.exports=t.p+"assets/img/1731588817354.0bbabb07.png"},7297:function(s,a,t){s.exports=t.p+"assets/img/1731588842560.e6c60d4f.png"},7298:function(s,a,t){s.exports=t.p+"assets/img/1731588871657.9e9c8d64.png"},7299:function(s,a,t){s.exports=t.p+"assets/img/1731589023968.e662b37e.png"},7300:function(s,a,t){s.exports=t.p+"assets/img/1731589303549.593310f8.png"},7301:function(s,a,t){s.exports=t.p+"assets/img/1731589460023.dadd897f.png"},7302:function(s,a,t){s.exports=t.p+"assets/img/1731589663438.40d19c5b.png"},7303:function(s,a,t){s.exports=t.p+"assets/img/1731589683399.d9df8a9b.png"},7304:function(s,a,t){s.exports=t.p+"assets/img/1731589722332.1bd3fca6.png"},7305:function(s,a,t){s.exports=t.p+"assets/img/1731589743801.4457f31e.png"},7306:function(s,a,t){s.exports=t.p+"assets/img/1731589761792.0fbf6e66.png"},7307:function(s,a,t){s.exports=t.p+"assets/img/1731589870152.7612a1cf.png"},7308:function(s,a,t){s.exports=t.p+"assets/img/1731590551160.69f99f2d.png"},7309:function(s,a,t){s.exports=t.p+"assets/img/1731590573050.a779ac12.png"},7310:function(s,a,t){s.exports=t.p+"assets/img/1731590765965.b97500db.png"},7311:function(s,a,t){s.exports=t.p+"assets/img/1731590855620.768b8264.png"},7312:function(s,a,t){s.exports=t.p+"assets/img/1731590876436.7150cca8.png"},7313:function(s,a,t){s.exports=t.p+"assets/img/1731590886232.60a47768.png"},7314:function(s,a,t){s.exports=t.p+"assets/img/1731591455363.568b1ebb.png"},7315:function(s,a,t){s.exports=t.p+"assets/img/1731591485948.db78499a.png"},7316:function(s,a,t){s.exports=t.p+"assets/img/1731591531314.23f5987f.png"},7317:function(s,a,t){s.exports=t.p+"assets/img/1731591643647.1f27ee7a.png"},7318:function(s,a,t){s.exports=t.p+"assets/img/1731591807227.9120d6cf.png"},7319:function(s,a,t){s.exports=t.p+"assets/img/1731591836023.9bc8eb56.png"},7320:function(s,a,t){s.exports=t.p+"assets/img/1731591883083.922d4f0c.png"},7321:function(s,a,t){s.exports=t.p+"assets/img/1731593814262.bb4005ab.png"},7322:function(s,a,t){s.exports=t.p+"assets/img/1731593873083.e04e164b.png"},7323:function(s,a,t){s.exports=t.p+"assets/img/1731594333601.c50546b1.png"},7324:function(s,a,t){s.exports=t.p+"assets/img/1731594396049.271828cf.png"},7325:function(s,a,t){s.exports=t.p+"assets/img/1731594810129.ff882084.png"},7326:function(s,a,t){s.exports=t.p+"assets/img/1731594863774.f855d9ea.png"},7327:function(s,a,t){s.exports=t.p+"assets/img/1731594973696.78ab846d.png"},7328:function(s,a,t){s.exports=t.p+"assets/img/1731594994595.aae1b172.png"},7329:function(s,a,t){s.exports=t.p+"assets/img/1731595096571.7324b09c.png"},7330:function(s,a,t){s.exports=t.p+"assets/img/1731595194071.66234489.png"},7331:function(s,a,t){s.exports=t.p+"assets/img/1731595391434.931da6ff.png"},7332:function(s,a,t){s.exports=t.p+"assets/img/1731595535432.32abc4d1.png"},7333:function(s,a,t){s.exports=t.p+"assets/img/1731595655065.ec5da69b.png"},7334:function(s,a,t){s.exports=t.p+"assets/img/1731595769539.e840c3df.png"},7335:function(s,a,t){s.exports=t.p+"assets/img/1731597456112.ed249210.png"},7336:function(s,a,t){s.exports=t.p+"assets/img/1731597501398.c50d2cf6.png"},7337:function(s,a,t){s.exports=t.p+"assets/img/1731597535236.dc579a1c.png"},7338:function(s,a,t){s.exports=t.p+"assets/img/1731597575732.272bb643.png"},7339:function(s,a,t){s.exports=t.p+"assets/img/1731597591338.d8da2aad.png"},7340:function(s,a,t){s.exports=t.p+"assets/img/1731597832043.19deeea3.png"},7341:function(s,a,t){s.exports=t.p+"assets/img/1731597875187.513b6db4.png"},7342:function(s,a,t){s.exports=t.p+"assets/img/1731597897491.b0c5e296.png"},7343:function(s,a,t){s.exports=t.p+"assets/img/1731597956733.9b9e70a2.png"},7344:function(s,a,t){s.exports=t.p+"assets/img/1731598038024.eb93eedc.png"},7345:function(s,a,t){s.exports=t.p+"assets/img/1731598115640.5cc86842.png"},7346:function(s,a,t){s.exports=t.p+"assets/img/1731598147829.961df7ad.png"},7347:function(s,a,t){s.exports=t.p+"assets/img/1731633150855.cec931d6.png"},7348:function(s,a,t){s.exports=t.p+"assets/img/1731633193050.83055420.png"},7349:function(s,a,t){s.exports=t.p+"assets/img/1731633235741.383c50c7.png"},7350:function(s,a,t){s.exports=t.p+"assets/img/1731633331990.eb26d0c1.png"},7351:function(s,a,t){s.exports=t.p+"assets/img/1731633347719.64e62729.png"},7352:function(s,a,t){s.exports=t.p+"assets/img/1731633754446.74f41d18.png"},7353:function(s,a,t){s.exports=t.p+"assets/img/1731633767115.4a0d9466.png"},7354:function(s,a,t){s.exports=t.p+"assets/img/1731634183048.f9046f5c.png"},7355:function(s,a,t){s.exports=t.p+"assets/img/1731634214840.103c6c80.png"},7356:function(s,a,t){s.exports=t.p+"assets/img/1731634362535.53cdb54d.png"},7357:function(s,a,t){s.exports=t.p+"assets/img/1731634518596.962e1c62.png"}}]);