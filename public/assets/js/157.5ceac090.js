(window.webpackJsonp=window.webpackJsonp||[]).push([[157],{13454:function(s,a,n){"use strict";n.r(a);var t=n(2),e=Object(t.a)({},(function(){var s=this,a=s._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h3",{attrs:{id:"_01-nfs共享存储介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_01-nfs共享存储介绍"}},[s._v("#")]),s._v(" 01，NFS共享存储介绍")]),s._v(" "),a("p",[s._v("NFS是Network File System的缩写及网络文件系统。"),a("code",[s._v("NFS")]),s._v("主要功能是通过局域网络让不同的主机系统之间可以共享文件或目录。"),a("code",[s._v("NFS")]),s._v("系统和"),a("code",[s._v("Windows")]),s._v("网络共享、网络驱动器类似, 只不过"),a("code",[s._v("windows")]),s._v("用于局域网, NFS用于企业集群架构中, 如果是大型网站, 会用到更复杂的分布式文件系统"),a("code",[s._v("FastDFS,glusterfs,HDFS")])]),s._v(" "),a("p",[a("strong",[s._v("为什么要使用共享存储？")])]),s._v(" "),a("ul",[a("li",[s._v("实现多台服务器之间数据共享")]),s._v(" "),a("li",[s._v("实现多台服务器之间数据一致")])]),s._v(" "),a("p",[a("strong",[s._v("集群没有共享存储：")])]),s._v(" "),a("ul",[a("li",[s._v("A用户上传图片经过负载均衡，负载均衡将上传请求调度至WEB1服务器上")]),s._v(" "),a("li",[s._v("B用户访问A用户上传的图片，此时B用户被负载均衡调度至WEB2上，因为WEB2上没有这张图片，所以B用户无法看到A用户传的图片")])]),s._v(" "),a("p",[a("img",{attrs:{src:n(5761),alt:"1724045651350"}})]),s._v(" "),a("p",[a("strong",[s._v("集群有共享存储：")])]),s._v(" "),a("ul",[a("li",[s._v("A用户上传图片无论被负载均衡调度至WEB1还是WEB2, 最终数据都被写入至共享存储")]),s._v(" "),a("li",[s._v("B用户访问A用户上传图片时，无论调度至WEB1还是WEB2，最终都会上共享存储访问对应的文件，这样就可以访问到资源了")])]),s._v(" "),a("p",[a("img",{attrs:{src:n(5762),alt:"1724045691062"}})]),s._v(" "),a("p",[a("strong",[s._v("NFS实现原理：")])]),s._v(" "),a("p",[a("img",{attrs:{src:n(5763),alt:"1724045714154"}})]),s._v(" "),a("blockquote",[a("p",[s._v("本地文件的操作方式:")]),s._v(" "),a("ol",[a("li",[s._v("当用户执行"),a("code",[s._v("mkdir")]),s._v("命令, 该命令会调用"),a("code",[s._v("shell")]),s._v("解释器翻译给内核")]),s._v(" "),a("li",[s._v("内核解析完成后会驱动对应的硬件设备，完成相应的操作")])])]),s._v(" "),a("p",[s._v("NFS原理:")]),s._v(" "),a("ol",[a("li",[s._v("用户进程访问NFS客户端，使用不同的函数对数据进行处理")]),s._v(" "),a("li",[s._v("NFS客户端通过TCP/IP的方式传递给NFS服务端")]),s._v(" "),a("li",[s._v("NFS服务端接收到请求后，会先调用portmap进程进行端口映射")]),s._v(" "),a("li",[s._v("nfsd进程用于判断NFS客户端是否拥有权限连接NFS服务端")]),s._v(" "),a("li",[s._v("Rpc.mount进程判断客户端是否有对应的权限进行验证")]),s._v(" "),a("li",[s._v("idmap进程实现用户映射和压缩")]),s._v(" "),a("li",[s._v("最后NFS服务端会将对应请求的函数转换为本地能识别的命令，传递至内核，由内核驱动硬件")])]),s._v(" "),a("p",[s._v("注意: rpc是一个远程过程调用，那么使用nfs必须有rpc服务")]),s._v(" "),a("p",[s._v("总结：NFS就是实现数据共享，实现数据一致性")]),s._v(" "),a("h3",{attrs:{id:"_02-服务搭建"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_02-服务搭建"}},[s._v("#")]),s._v(" 02，服务搭建")]),s._v(" "),a("p",[s._v("克隆一台NFS服务器：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("NFS服务器: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.31  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.31\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("如果不会克隆，看系统优化的文章。")]),s._v(" "),a("p",[a("img",{attrs:{src:n(5764),alt:"1724053635920"}})]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".安装NFS服务\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#yum -y install nfs-utils")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".配置NFS服务\n配置文件: /etc/exports 默认为空文件\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#vim /etc/exports")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /etc/exports")]),s._v("\n/data "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,sync,all_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n注释信息:\n/data           "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#共享的目录")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.0/24   "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 允许哪个网段可以挂载我")]),s._v("\nrw              "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 挂载的参数 可读写")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sync")]),s._v("            "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同步到内核和磁盘")]),s._v("\nall_squash      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将所有的用户压缩成虚拟用户")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".根据配置创建数据信息\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mkdir /data")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ll -d /data")]),s._v("\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Aug  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":05 /data\n属主属组修改为匿名用户\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#chown nobody.nobody /data/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ll -d /data/")]),s._v("\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" nobody nobody "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Aug  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":05 /data/\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".启动NFS服务\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl start nfs")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl enable nfs")]),s._v("\n\n\n查看配置文件是否正确，和默认的参数\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ll -d /data")]),s._v("\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Aug  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":05 /data\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /var/lib/nfs/etab ")]),s._v("\n/data   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,sync,wdelay,hide,nocrossmnt,secure,root_squash,all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65534")]),s._v(",anongid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65534")]),s._v(",sec"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sys,rw,secure,root_squash,all_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#grep 65534 /etc/passwd")]),s._v("\nnobody:x:65534:65534:Kernel Overflow User:/:/sbin/nologin\n\n\n\n\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".测试NFS服务\nweb01测试:\n因为需要依赖rpcbind协议，所以客户端都需要安装nfs-utils，里面包含了rpcbind协议\n第一步: 客户端只安装，不配置，不启动服务。\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#yum -y install nfs-utils")]),s._v("\n\n第二步: 查看服务端共享的目录\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#showmount -e 172.16.1.31")]),s._v("\nExport list "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.31:\n/data "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.0/24\n\n第三步: 挂载使用\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mkdir /code")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mount -t nfs 172.16.1.31:/data /code")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#df -h")]),s._v("\nFilesystem             Size  Used Avail Use% Mounted on\ndevtmpfs               459M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  459M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev\ntmpfs                  475M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  475M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev/shm\ntmpfs                  475M   43M  432M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("% /run\ntmpfs                  475M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  475M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /sys/fs/cgroup\n/dev/mapper/klas-root   47G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".8G   44G   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("% /\ntmpfs                  475M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  475M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /tmp\n/dev/sda1             1014M  169M  846M  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("% /boot\ntmpfs                   95M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   95M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /run/user/0\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.31:/data       47G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".8G   44G   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("% /code\n\n第四步: 测试否可以写入内容\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cd /code/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#touch a.txt")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody nobody "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Aug  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":21 a.txt\n\n第五步: 写入开机自动挂载 建议写到/etc/rc.local\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:code"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tail -1 /etc/fstab")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.31:/data   /code           nfs     defaults "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\n测试fstab配置\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mount -a")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#df -h")]),s._v("\nFilesystem             Size  Used Avail Use% Mounted on\ndevtmpfs               459M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  459M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev\ntmpfs                  475M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  475M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev/shm\ntmpfs                  475M   43M  432M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("% /run\ntmpfs                  475M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  475M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /sys/fs/cgroup\n/dev/mapper/klas-root   47G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".8G   44G   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("% /\ntmpfs                  475M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  475M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /tmp\n/dev/sda1             1014M  169M  846M  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("% /boot\ntmpfs                   95M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   95M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /run/user/0\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.31:/data       47G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".8G   44G   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("% /code\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br"),a("span",{staticClass:"line-number"},[s._v("77")]),a("br"),a("span",{staticClass:"line-number"},[s._v("78")]),a("br"),a("span",{staticClass:"line-number"},[s._v("79")]),a("br"),a("span",{staticClass:"line-number"},[s._v("80")]),a("br"),a("span",{staticClass:"line-number"},[s._v("81")]),a("br"),a("span",{staticClass:"line-number"},[s._v("82")]),a("br"),a("span",{staticClass:"line-number"},[s._v("83")]),a("br"),a("span",{staticClass:"line-number"},[s._v("84")]),a("br"),a("span",{staticClass:"line-number"},[s._v("85")]),a("br"),a("span",{staticClass:"line-number"},[s._v("86")]),a("br"),a("span",{staticClass:"line-number"},[s._v("87")]),a("br"),a("span",{staticClass:"line-number"},[s._v("88")]),a("br"),a("span",{staticClass:"line-number"},[s._v("89")]),a("br"),a("span",{staticClass:"line-number"},[s._v("90")]),a("br"),a("span",{staticClass:"line-number"},[s._v("91")]),a("br"),a("span",{staticClass:"line-number"},[s._v("92")]),a("br"),a("span",{staticClass:"line-number"},[s._v("93")]),a("br"),a("span",{staticClass:"line-number"},[s._v("94")]),a("br")])]),a("p",[s._v("如果不希望使用"),a("code",[s._v("NFS")]),s._v("共享, 可进行卸载：")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# umount /nfsdir ")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注意:卸载的时候如果提示”umount.nfs: /nfsdir: device is busy”  ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1.切换至其他目录, 然后在进行卸载。")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2.NFS Server宕机, 强制卸载umount -lf /nfsdir")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("增加安全性（不用练）：")]),s._v(" "),a("ul",[a("li",[s._v("在企业工作场景，通常情况NFS服务器共享的只是普通静态数据（图片、附件、视频），不需要执行"),a("code",[s._v("suid、exec")]),s._v("等权限，挂载的这个文件系统只能作为数据存取之用，无法执行程序，对于客户端来讲增加了安全性。例如: 很多木马篡改站点文件都是由上传入口上传的程序到存储目录。然后执行的。")])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#通过mount -o指定挂载参数，禁止使用suid，exec，增加安全性能")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs ~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mount -t nfs -o nosuid,noexec,nodev 172.16.1.31:/data /mnt")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("h3",{attrs:{id:"_03-挂载夯住"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_03-挂载夯住"}},[s._v("#")]),s._v(" 03，挂载夯住")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".挂载到NFS\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".将NFS的内网卡关闭\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".df -h夯住\n\n解决方法:\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".启动NFS网卡\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".强制卸载\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#umount -f /code ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".如果不知道挂载点，查看/proc/mounts信息\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /proc/mounts ")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.31:/data /code nfs4 rw,relatime,vers"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(",rsize"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v(",wsize"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("131072")]),s._v(",namlen"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("255")]),s._v(",hard,proto"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tcp,timeo"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v(",retrans"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(",sec"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sys,clientaddr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.7,local_lock"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("none,addr"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.31 "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n然后卸载:\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#umount -f /code ")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br")])]),a("p",[s._v("图示：")]),s._v(" "),a("p",[a("img",{attrs:{src:n(5765),alt:"1724046237164"}})]),s._v(" "),a("p",[s._v("多业务挂载不同的目录：")]),s._v(" "),a("p",[a("img",{attrs:{src:n(5766),alt:"1724056002957"}})]),s._v(" "),a("h3",{attrs:{id:"_04-nfs参数-了解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_04-nfs参数-了解"}},[s._v("#")]),s._v(" 04，NFS参数（了解）")]),s._v(" "),a("p",[s._v("执行man exports命令，然后切换到文件结尾，可以快速查看如下样例格式：")]),s._v(" "),a("table",[a("thead",[a("tr",[a("th",[s._v("nfs共享参数")]),s._v(" "),a("th",[s._v("参数作用")])])]),s._v(" "),a("tbody",[a("tr",[a("td",[s._v("rw*")]),s._v(" "),a("td",[s._v("读写权限")])]),s._v(" "),a("tr",[a("td",[s._v("ro")]),s._v(" "),a("td",[s._v("只读权限")])]),s._v(" "),a("tr",[a("td",[s._v("root_squash")]),s._v(" "),a("td",[s._v("当NFS客户端以root管理员访问时，映射为NFS服务器的匿名用户(不常用)")])]),s._v(" "),a("tr",[a("td",[s._v("no_root_squash")]),s._v(" "),a("td",[s._v("当NFS客户端以root管理员访问时，映射为NFS服务器的root管理员(不常用)")])]),s._v(" "),a("tr",[a("td",[s._v("all_squash")]),s._v(" "),a("td",[s._v("无论NFS客户端使用什么账户访问，均映射为NFS服务器的匿名用户(常用)")])]),s._v(" "),a("tr",[a("td",[s._v("no_all_squash")]),s._v(" "),a("td",[s._v("无论NFS客户端使用什么账户访问，都不进行压缩")])]),s._v(" "),a("tr",[a("td",[s._v("sync*")]),s._v(" "),a("td",[s._v("同时将数据写入到内存与硬盘中，保证不丢失数据")])]),s._v(" "),a("tr",[a("td",[s._v("async")]),s._v(" "),a("td",[s._v("优先将数据保存到内存，然后再写入硬盘；这样效率更高，但可能会丢失数据")])]),s._v(" "),a("tr",[a("td",[s._v("anonuid*")]),s._v(" "),a("td",[s._v("配置all_squash使用,指定NFS的用户UID,必须存在系统")])]),s._v(" "),a("tr",[a("td",[s._v("anongid*")]),s._v(" "),a("td",[s._v("配置all_squash使用,指定NFS的用户UID,必须存在系统")])])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".rw                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示读写")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".ro                       "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示只读 只能看")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".all_squash               "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所有用户进行压缩成匿名用户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("4.anonuid")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v(",anongid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定匿名用户uid为666")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".sync                     "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 同步写入磁盘和内存")]),s._v("\n\n\n测试ro和rw参数\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /etc/exports")]),s._v("\n/data/baidu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,sync,all_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n/data/taobao "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ro,sync,all_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n创建上面的两个文件夹：\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mkdir /data/{baidu,taobao}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ls")]),s._v("\na.txt  baidu  taobao  xx\n\n\n重启生效\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl stop nfs")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl start nfs")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl status nfs")]),s._v("\n● nfs-server.service - NFS server and services\n   Loaded: loaded "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib/systemd/system/nfs-server.service"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  Drop-In: /run/systemd/generator/nfs-server.service.d\n           └─order-with-mounts.conf\n   Active: active "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exited"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   \n修改目录的属主和属组：\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ll /data/")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody nobody "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":11 a.txt\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root   root   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":33 baidu\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root   root   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":33 taobao\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody nobody "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":12 xx\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#chown -R nobody.nobody /data")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ll /data/")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody nobody "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":11 a.txt\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" nobody nobody "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":33 baidu\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" nobody nobody "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":33 taobao\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody nobody "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":12 xx\n\n客户端挂载:\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mkdir /code/{baidu,taobao}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ll /code/")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 baidu\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":36 taobao\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mount -t nfs 172.16.1.31:/data/baidu /code/baidu")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mount -t nfs 172.16.1.31:/data/taobao /code/taobao")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#df -h")]),s._v("\nFilesystem                Size  Used Avail Use% Mounted on\ndevtmpfs                  459M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  459M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev\ntmpfs                     475M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  475M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /dev/shm\ntmpfs                     475M  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".8M  468M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("% /run\ntmpfs                     475M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  475M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /sys/fs/cgroup\n/dev/mapper/klas-root      47G  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".8G   44G   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("% /\ntmpfs                     475M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  475M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /tmp\n/dev/sda1                1014M  169M  846M  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("% /boot\ntmpfs                      95M     "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("   95M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("% /run/user/0\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.31:/data/baidu    15M  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".3M   14M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("% /code/baidu\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.31:/data/taobao   15M  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".3M   14M   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("% /code/taobao\n\n测试：\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#touch /code/baidu/baidu.txt")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#touch /code/taobao/taobao.txt")]),s._v("\ntouch: cannot "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/code/taobao/taobao.txt'")]),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" Read-only "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" system\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ls")]),s._v("\na.txt  baidu  taobao  xx\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ll /data/baidu/")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody nobody "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":37 baidu.txt\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ll /data/taobao")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br"),a("span",{staticClass:"line-number"},[s._v("41")]),a("br"),a("span",{staticClass:"line-number"},[s._v("42")]),a("br"),a("span",{staticClass:"line-number"},[s._v("43")]),a("br"),a("span",{staticClass:"line-number"},[s._v("44")]),a("br"),a("span",{staticClass:"line-number"},[s._v("45")]),a("br"),a("span",{staticClass:"line-number"},[s._v("46")]),a("br"),a("span",{staticClass:"line-number"},[s._v("47")]),a("br"),a("span",{staticClass:"line-number"},[s._v("48")]),a("br"),a("span",{staticClass:"line-number"},[s._v("49")]),a("br"),a("span",{staticClass:"line-number"},[s._v("50")]),a("br"),a("span",{staticClass:"line-number"},[s._v("51")]),a("br"),a("span",{staticClass:"line-number"},[s._v("52")]),a("br"),a("span",{staticClass:"line-number"},[s._v("53")]),a("br"),a("span",{staticClass:"line-number"},[s._v("54")]),a("br"),a("span",{staticClass:"line-number"},[s._v("55")]),a("br"),a("span",{staticClass:"line-number"},[s._v("56")]),a("br"),a("span",{staticClass:"line-number"},[s._v("57")]),a("br"),a("span",{staticClass:"line-number"},[s._v("58")]),a("br"),a("span",{staticClass:"line-number"},[s._v("59")]),a("br"),a("span",{staticClass:"line-number"},[s._v("60")]),a("br"),a("span",{staticClass:"line-number"},[s._v("61")]),a("br"),a("span",{staticClass:"line-number"},[s._v("62")]),a("br"),a("span",{staticClass:"line-number"},[s._v("63")]),a("br"),a("span",{staticClass:"line-number"},[s._v("64")]),a("br"),a("span",{staticClass:"line-number"},[s._v("65")]),a("br"),a("span",{staticClass:"line-number"},[s._v("66")]),a("br"),a("span",{staticClass:"line-number"},[s._v("67")]),a("br"),a("span",{staticClass:"line-number"},[s._v("68")]),a("br"),a("span",{staticClass:"line-number"},[s._v("69")]),a("br"),a("span",{staticClass:"line-number"},[s._v("70")]),a("br"),a("span",{staticClass:"line-number"},[s._v("71")]),a("br"),a("span",{staticClass:"line-number"},[s._v("72")]),a("br"),a("span",{staticClass:"line-number"},[s._v("73")]),a("br"),a("span",{staticClass:"line-number"},[s._v("74")]),a("br"),a("span",{staticClass:"line-number"},[s._v("75")]),a("br"),a("span",{staticClass:"line-number"},[s._v("76")]),a("br")])]),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("指定虚拟用户:\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /etc/exports")]),s._v("\n/data/baidu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,sync,all_squash,anonuid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v(",anongid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n/data/taobao "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ro,sync,all_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n重启生效:\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#systemctl restart nfs")]),s._v("\n\n检查配置结果:\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /var/lib/nfs/etab ")]),s._v("\n/data/taobao\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ro,sync,wdelay,hide,nocrossmnt,secure,root_squash,all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65534")]),s._v(",anongid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("65534")]),s._v(",sec"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sys,ro,secure,root_squash,all_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n/data/baidu\t"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,sync,wdelay,hide,nocrossmnt,secure,root_squash,all_squash,no_subtree_check,secure_locks,acl,no_pnfs,anonuid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v(",anongid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v(",sec"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sys,rw,secure,root_squash,all_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n查找虚拟用户id是666对应的用户名：\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#grep 666 /etc/passwd")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#groupadd -g666 www")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#useradd -u666 -g666 -M -s /sbin/nologin www")]),s._v("\n\n/data/baidu授权属主属组为www\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody nobody  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":11 a.txt\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" nobody nobody "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":37 baidu\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" nobody nobody  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":33 taobao\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody nobody  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":12 xx\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#chown www.www /data/baidu")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ll")]),s._v("\ntotal "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody nobody  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":11 a.txt\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" www    www    "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("23")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":37 baidu\ndrwxr-xr-x "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" nobody nobody  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":33 taobao\n-rw-r--r-- "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" nobody nobody  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Aug "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":12 xx\n\nNFS的配置：\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@nfs-31:data"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /etc/exports")]),s._v("\n/data/baidu "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,sync,all_squash,anonuid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v(",anongid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n/data/taobao "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ro,sync,all_squash"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n测试：\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#touch /code/baidu/baidu666.txt")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])]),a("h3",{attrs:{id:"_05-nfs存储小结"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_05-nfs存储小结"}},[s._v("#")]),s._v(" 05，NFS存储小结")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("作用: 实现数据一致性 网络文件系统  类似共享软件\n服务端: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.31  nfs服务器\n客户端: "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.7  "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.41\n\n服务端安装部署NFS\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".安装\n    yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nfs-utils\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".配置\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/exports\n    /data "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.0/24"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,sync,all_squash,anonuid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v(",anongid"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".创建必要的信息\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("groupadd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g666")]),s._v(" www\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("useradd")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-u666")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-g666")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-M")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-s")]),s._v(" /sbin/nologin www\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /data\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" www.www /data\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".启动服务加入开机自起\n    systemctl start nfs\n    systemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nfs\n\n\n客户端使用:\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".安装\n    yum "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-y")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nfs-utils\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".查看共享的目录\n    showmount "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.31\n"),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".挂载使用\n    web01: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" nfs "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.31:/data /mnt\n    backup: "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" nfs "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1.31:/data /code\n写入开机自动挂载\n    fstab\n    rc.local\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br")])]),a("p",[a("img",{attrs:{src:n(5767),alt:"1724057368062"}})]),s._v(" "),a("p",[s._v("1.NFS存储优点")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("NFS文件系统简单易用、方便部署、数据可靠、服务稳定、满足中小企业需求。")])]),s._v(" "),a("li",[a("p",[s._v("NFS文件系统内存放的数据都在文件系统之上，所有数据都是能看得见。")])])]),s._v(" "),a("p",[s._v("2.NFS存储局限")]),s._v(" "),a("ul",[a("li",[a("p",[s._v("存在单点故障, 如果构建高可用维护麻烦"),a("code",[s._v("web->nfs()->backup")])])]),s._v(" "),a("li",[a("p",[s._v("NFS数据明文, 并不对数据做任何校验。")])]),s._v(" "),a("li",[a("p",[s._v("客户端挂载NFS服务没有密码验证, 安全性一般(内网使用)")])])]),s._v(" "),a("p",[s._v("3.NFS应用建议")]),s._v(" "),a("ul",[a("li",[s._v("生产场景应将静态数据尽可能往前端推, 减少后端存储压力")]),s._v(" "),a("li",[s._v("必须将存储里的静态资源通过CDN缓存"),a("code",[s._v("jpg\\png\\mp4\\avi\\css\\js")])]),s._v(" "),a("li",[s._v("如果没有缓存或架构本身历史遗留问题太大, 在多存储也无用")])])])}),[],!1,null,null,null);a.default=e.exports},5761:function(s,a,n){s.exports=n.p+"assets/img/1724045651350.f68563ec.png"},5762:function(s,a,n){s.exports=n.p+"assets/img/1724045691062.19c4230f.png"},5763:function(s,a,n){s.exports=n.p+"assets/img/1724045714154.b34a2747.png"},5764:function(s,a,n){s.exports=n.p+"assets/img/1724053635920.dda5ff56.png"},5765:function(s,a,n){s.exports=n.p+"assets/img/1724046237164.4ab2fffa.png"},5766:function(s,a,n){s.exports=n.p+"assets/img/1724056002957.b0c993dd.png"},5767:function(s,a,n){s.exports=n.p+"assets/img/1724057368062.c5a28e76.png"}}]);