(window.webpackJsonp=window.webpackJsonp||[]).push([[203],{14500:function(s,n,a){"use strict";a.r(n);var t=a(2),e=Object(t.a)({},(function(){var s=this,n=s._self._c;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h3",{attrs:{id:"_1-变量的作用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_1-变量的作用"}},[s._v("#")]),s._v(" 1，变量的作用")]),s._v(" "),n("p",[s._v("变量提供了便捷的方式来管理Ansible playbook的每一个项目中的动态值，比如"),n("code",[s._v("nginx-1.6.3")]),s._v("这个软件包的版本，在其它地方或许会反复使用，那么如果讲此值设置为变量，然后再在其他的playbook中调用，会方便许多。如此一来还方便维护，减少维护的成本。")]),s._v(" "),n("p",[s._v("定义变量的方式：")]),s._v(" "),n("ul",[n("li",[s._v("通过命令行进行变量定义")]),s._v(" "),n("li",[s._v("在play文件中进行变量定义")]),s._v(" "),n("li",[s._v("通过Inventory主机信息文件中进行变量定义")])]),s._v(" "),n("p",[s._v("变量的优先级：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("如果在定义变量时，变量冲突了\n\n在上述的三个地方分别设置了：\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".命令行中：age"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".play文件中：age"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".Inventory中：age"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("\n那么，最终的age结果一定是11\n\n变量的读取优先级为：\n命令行 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" playbook文件 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Inventory文件\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"_2-vars定义变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-vars定义变量"}},[s._v("#")]),s._v(" 2，vars定义变量")]),s._v(" "),n("p",[s._v("playbook变量可以通过多种方式进行定义，最简单的方式就是在playbook的开头通过vars进行定义。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("一个变量对应一个值:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: web01\n  vars:\n    - pk1: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n    - pk2: lrzsz\n  tasks:\n    - name: Install pakcages\n      yum:\n        name: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ pk1 }}"')]),s._v("\n        state: present\n        \n        \n一个变量对应多个值:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml ")]),s._v("\n- hosts: web01\n  vars:\n    all:\n      - "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n      - lrzsz\n  tasks:\n    - name: Install pakcages\n      yum:\n        name: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ all }}"')]),s._v("\n        state: absent\n        \n        \n注意: ansible调用变量如果是路径则不需要加双引号     ansible_hostname是ansible的内置变量   \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml ")]),s._v("\n- hosts: webs\n  tasks:\n    - name: create "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n      file:\n        path: /root/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ansible_hostname "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        state: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])]),n("p",[n("img",{attrs:{src:a(6380),alt:"1725414347686"}})]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("客户端备份脚本：创建主机名称+IP地址+时间 的目录\n- web01_10.0.0.7_xxx\n- web02_10.0.0.8_xxx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("连续的变量调用：\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml ")]),s._v("\n- hosts: webs\n  vars:\n    - ngx_v: v1.1\n    - nix_n: code\n  tasks:\n    - name: create "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n      file:\n        path: /root/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" nix_n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ngx_v "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        state: directory\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("h3",{attrs:{id:"_3-文件中定义变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-文件中定义变量"}},[s._v("#")]),s._v(" 3，文件中定义变量")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat vars1.yml ")]),s._v("\npk1: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\npk2: lrzsz\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: webs\n  vars_files:\n    - vars1.yml\n  tasks:\n    - name: remove "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" pack\n      yum:\n        name: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ pk1 }}"')]),s._v(" \n        state: present\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用列表的方式调用变量")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml ")]),s._v("\n- hosts: webs\n  vars_files:\n    - vars1.yml\n  tasks:\n    - name: remove "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" pack\n      yum:\n        name: \n          - "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ pk1 }}"')]),s._v(" \n          - "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ pk2 }}"')]),s._v("\n        state: present\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#列表方式调用多个vars变量文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat vars1.yml ")]),s._v("\npk1: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\npk2: lrzsz\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat vars2.yml ")]),s._v("\npak3: tree\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml ")]),s._v("\n- hosts: webs\n  vars_files:\n    - vars1.yml\n    - vars2.yml\n  tasks:\n    - name: remove "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" pack\n      yum:\n        name: \n          - "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ pk1 }}"')]),s._v(" \n          - "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ pk2 }}"')]),s._v("\n          - "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ pak3 }}"')]),s._v("\n        state: present\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br")])]),n("h3",{attrs:{id:"_4-官方推荐的方式定义变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-官方推荐的方式定义变量"}},[s._v("#")]),s._v(" 4，官方推荐的方式定义变量")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("组定义变量: \n- 在当前目录创建  group_vars,比如为webs定义变量，在group_vars下创建webs，在webs文件中直接定义\n单台定义变量: \n- 在当前目录创建 host_vars,比如为web01定义变量,在hosts_vars目录下创建web01,直接定义变量\n\n单台定义:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mkdir host_vars")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#vim host_vars/web01")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat host_vars/web01")]),s._v("\npk1: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\npk2: lrzsz\n\n调用变量:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: webs\n  tasks:\n    - name: remove "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" pack\n      yum:\n        name: \n          - "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ pk1 }}"')]),s._v(" \n          - "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ pk2 }}"')]),s._v("\n        state: present\n\n组定义:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#mkdir group_vars")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#vim group_vars/webs")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat group_vars/webs")]),s._v("\npack1: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\npack2: lrzsz\n\n变量调用:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: webs\n  tasks:\n    - name: remove "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" pack\n      yum:\n        name: \n          - "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ pack1 }}"')]),s._v(" \n          - "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ pack2 }}"')]),s._v("\n        state: present\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br")])]),n("h3",{attrs:{id:"_6-主机清单中定义变量-了解"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_6-主机清单中定义变量-了解"}},[s._v("#")]),s._v(" 6，主机清单中定义变量（了解）")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat /etc/ansible/hosts ")]),s._v("\nnfs "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_host")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.31\ndb01 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_host")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.51\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("back"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nbackup "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_host")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.41\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nweb01 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_host")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.7\nweb02 "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ansible_ssh_host")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.8\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webs:vars"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("         "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 定义变量信息 定义注意等号")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("p1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("wget\n"),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("p2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tree\n\n调用变量:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml ")]),s._v("\n- hosts: webs\n  tasks:\n    - name: remove "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" pack\n      yum:\n        name: \n          - "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ p1 }}"')]),s._v(" \n          - "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ p2 }}"')]),s._v("\n        state: absent\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br")])]),n("h3",{attrs:{id:"_7-变量小结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_7-变量小结"}},[s._v("#")]),s._v(" 7，变量小结")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".在paly中定义\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".在varsfile中定义\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".在官方推荐的定义方式 当前目录 group_vars host_vars\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".在主机清单中定义\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".在命令行临时定义变量 ansible-playbook  test.yml "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-e")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pk1=wget"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_8-获取客户端的内置变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_8-获取客户端的内置变量"}},[s._v("#")]),s._v(" 8，获取客户端的内置变量")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("调用子级的方式:\nansible_default_ipv4.address\n或者\nansible_default_ipv4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'address'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: webs\n  tasks:\n    - name: create "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v("\n      file:\n        path: /root/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ansible_default_ipv4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'address'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(".txt\n        state: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v("\n        \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 仅显示操作系统信息        ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible web01 -m setup -a 'filter=ansible_distribution'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面有些不对")]),s._v("\nansible_all_ipv4_addresses：仅显示ipv4的信息。\nansible_devices：仅显示磁盘设备信息。\nansible_distribution：显示是什么系统，例：centos,suse等。\nansible_distribution_major_version：显示是系统主版本。\nansible_distribution_version：仅显示系统版本。\nansible_machine：显示系统类型，例：32位，还是64位。\nansible_eth0：仅显示eth0的信息。\nansible_hostname：仅显示主机名。\nansible_kernel：仅显示内核版本。\nansible_lvm：显示lvm相关信息。\nansible_memtotal_mb：显示系统总内存。\nansible_memfree_mb：显示可用系统内存。\nansible_memory_mb：详细显示内存情况。\nansible_swaptotal_mb：显示总的swap内存。\nansible_swapfree_mb：显示swap内存的可用内存。\nansible_mounts：显示系统磁盘挂载情况。\nansible_processor：显示cpu个数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("具体显示每个cpu的型号"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("。\nansible_processor_vcpus：显示cpu个数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("只显示总的个数"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br")])]),n("h3",{attrs:{id:"_9-变量注册"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_9-变量注册"}},[s._v("#")]),s._v(" 9，变量注册")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("在执行shell命令时候，默认ansible不会返回结果\n\n比如ls -l命令不会返回具体的结果信息\n- hosts: web01\n  tasks:\n    - name: print "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n      command: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n      \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  test.yml")]),s._v("\n\nPLAY "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *****************************************************************************************\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Gathering Facts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *****************************************************************************************\n\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("print "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *****************************************************************************************\n\nchanged: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n---------------------------------------------------\n\n比如nginx "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" 检查nginx配置文件\n- hosts: web01\n  tasks:\n    - name: nginx "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\n      command: nginx "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\n      \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  test.yml ")]),s._v("\n\nPLAY "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *****************************************************************************************\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Gathering Facts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *****************************************************************************************\n\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("检查nginx配置文件"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *****************************************************************************************\n\nchanged: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nPLAY RECAP *****************************************************************************************\n\nweb01                      "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ok")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("changed")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("unreachable")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("failed")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("skipped")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("rescued")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ignored")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  \n\n---------------------------------------------------\n\n使用变量注册拿到返回的结果: register模块\n将执行的结果先赋值给一个变量，然后使用debug模块输出变量中的内容。\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: web01\n  tasks:\n    - name:  检查nginx配置文件\n      command: nginx "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\n      register: nginx_re\n\n    - name:  Print nginx_re 变量的内容\n      debug: \n        msg: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ nginx_re }}"')]),s._v("\n\n\n获取内容的子级\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: web01\n  tasks:\n    - name:  检查nginx配置文件\n      command: nginx "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\n      register: nginx_re\n\n    - name:  Print nginx_re 变量的内容\n      debug: \n        msg: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ nginx_re.rc }}"')]),s._v("\n        \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  test.yml")]),s._v("\n\nPLAY "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *****************************************************************************************\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Gathering Facts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *****************************************************************************************\n\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("检查nginx配置文件"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *****************************************************************************************\n\nchanged: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Print nginx_re 变量的内容"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *************************************************************************************\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n------------------------------------------\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml ")]),s._v("\n- hosts: web01\n  tasks:\n    - name:  检查nginx配置文件\n      command: nginx "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\n      register: nginx_re\n\n    - name:  Print nginx_re 变量的内容\n      debug: \n        msg: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ nginx_re.stderr_lines }}"')]),s._v("\n\n\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  test.yml")]),s._v("\n\nPLAY "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *********************************************************************************************************\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Gathering Facts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ***********************************************************************************************\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("检查nginx配置文件"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *********************************************************************************************\nchanged: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Print nginx_re 变量的内容"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *************************************************************************************\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx: the configuration file /etc/nginx/nginx.conf syntax is ok"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx: configuration file /etc/nginx/nginx.conf test is successful"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n------------------------------------------ 通过debug模块打印内置变量\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: web01\n  tasks:\n    - name:  Print "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),s._v("\n      debug: \n        msg: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ ansible_hostname }}"')]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: webs\n  tasks:\n    - name:  Print "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),s._v("\n      debug: \n        msg: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ ansible_default_ipv4.address }}"')]),s._v("\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#fqdn和hostname相同的")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: webs\n  tasks:\n    - name:  Print "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("hostname")]),s._v("\n      debug: \n        msg: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ ansible_fqdn }}"')]),s._v("\n\n\n------------------------------------------\n\n打印/root下所有的文件\n- hosts: webs\n  tasks: \n    - name: "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v("\n      command: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-l")]),s._v(" /root\n      register: list_r\n    - name: print list_r\n      debug:\n        msg: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{list_r.stdout_lines }}"')]),s._v("\n        \n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  test.yml")]),s._v("\n\nPLAY "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("webs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" **********************************************************************************************************\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Gathering Facts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ***********************************************************************************************\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web02"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("command "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ls")]),s._v(" -l"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *************************************************************************************************\nchanged: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web02"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nchanged: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("print list_r"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" **************************************************************************************************\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"total 0"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-rw-r--r-- 1 root root 0 Aug 27 10:17 10.0.0.7.txt"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web02"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"msg"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"total 0"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-rw-r--r-- 1 root root 0 Aug 27 10:17 10.0.0.8.txt"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("\"-rw-r--r-- 1 root root 0 Aug 27 10:15 ['223.5.5.5'].txt\"")]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"drwxr-xr-x 2 root root 6 Aug 27 09:25 code_v1.1"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-rw-r--r-- 1 root root 0 Aug 27 10:11 ens33.txt"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-rw-r--r-- 1 root root 0 Aug 27 10:12 root.txt"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-rw-r--r-- 1 root root 0 Aug 27 09:21 web02"')]),s._v(",\n        "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"drwxr-xr-x 2 root root 6 Aug 27 10:05 web02_10.0.0.8"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br"),n("span",{staticClass:"line-number"},[s._v("166")]),n("br"),n("span",{staticClass:"line-number"},[s._v("167")]),n("br"),n("span",{staticClass:"line-number"},[s._v("168")]),n("br"),n("span",{staticClass:"line-number"},[s._v("169")]),n("br"),n("span",{staticClass:"line-number"},[s._v("170")]),n("br"),n("span",{staticClass:"line-number"},[s._v("171")]),n("br"),n("span",{staticClass:"line-number"},[s._v("172")]),n("br"),n("span",{staticClass:"line-number"},[s._v("173")]),n("br"),n("span",{staticClass:"line-number"},[s._v("174")]),n("br"),n("span",{staticClass:"line-number"},[s._v("175")]),n("br"),n("span",{staticClass:"line-number"},[s._v("176")]),n("br"),n("span",{staticClass:"line-number"},[s._v("177")]),n("br"),n("span",{staticClass:"line-number"},[s._v("178")]),n("br"),n("span",{staticClass:"line-number"},[s._v("179")]),n("br"),n("span",{staticClass:"line-number"},[s._v("180")]),n("br"),n("span",{staticClass:"line-number"},[s._v("181")]),n("br"),n("span",{staticClass:"line-number"},[s._v("182")]),n("br"),n("span",{staticClass:"line-number"},[s._v("183")]),n("br"),n("span",{staticClass:"line-number"},[s._v("184")]),n("br"),n("span",{staticClass:"line-number"},[s._v("185")]),n("br"),n("span",{staticClass:"line-number"},[s._v("186")]),n("br"),n("span",{staticClass:"line-number"},[s._v("187")]),n("br"),n("span",{staticClass:"line-number"},[s._v("188")]),n("br"),n("span",{staticClass:"line-number"},[s._v("189")]),n("br"),n("span",{staticClass:"line-number"},[s._v("190")]),n("br"),n("span",{staticClass:"line-number"},[s._v("191")]),n("br"),n("span",{staticClass:"line-number"},[s._v("192")]),n("br"),n("span",{staticClass:"line-number"},[s._v("193")]),n("br")])]),n("h3",{attrs:{id:"_10-流程控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-流程控制"}},[s._v("#")]),s._v(" 10，流程控制")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("案例1.判断如果客户端主机名称是web01则安装wget，其他跳过\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#所有的客户端卸载wget")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: all\n  tasks:\n    - name: Install "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n      yum:\n        name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n        state: absent\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用when判断 只有主机名称是web01的安装wget")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml ")]),s._v("\n- hosts: all\n  tasks:\n    - name: Install "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n      yum:\n        name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n        state: present\n      when: ansible_hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web01"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  test.yml")]),s._v("\n\nPLAY "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("all"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ***********************************************************************************************************\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Gathering Facts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ***********************************************************************************************\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("db01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web02"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("backup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Install wget"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" **************************************************************************************************\nskipping: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nskipping: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("db01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nskipping: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("backup"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nskipping: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web02"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\nchanged: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n------------------------------------------------\n\nwhen判断写法，下面三种写法，换着来，有的有时候可能不好使\nwhen: ansible_hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web01"')]),s._v("\nwhen: ansible_hostname is search "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web01"')]),s._v("\nwhen: ansible_hostname is match  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web01"')]),s._v("\n\n或者: \nwhen: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ansible_hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web01"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" or "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ansible_hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db01"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n并且:\nwhen: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ansible_hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web01"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" and "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ansible_hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db01"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: all\n  tasks:\n    - name: Install "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n      yum:\n        name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n        state: present\n      when: ansible_hostname is search "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web01"')]),s._v("  \n      \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# web匹配的是包含web字符串的主机名称")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: all\n  tasks:\n    - name: Install "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n      yum:\n        name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n        state: present\n      when: ansible_hostname is search "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web"')]),s._v("\n      \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# match可以匹配到web的字符串执行")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: all\n  tasks:\n    - name: Install "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n      yum:\n        name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n        state: present\n      when: ansible_hostname is match "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  test.yml")]),s._v("\n\n------------------------------------------------\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 测试当前nginx -t执行成功后 nginx重启")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: web01\n  tasks:\n    - name: Install Nginx Server\n      yum:\n        name: nginx\n        state: present\n    - name: Configure Nginx Server\n      copy:\n        src: conf/nginx.conf\n        dest: /etc/nginx/\n\n\n    - name: check Nginx Conf\n      command: nginx "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\n      register: nginx_r\n      ignore_errors: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 忽略当前的错误继续往下执行。")]),s._v("\n\n    - name: Start Nginx Server\n      systemd: \n        name: nginx\n        state: started\n        enabled: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n\n    - name: Restart Nginx Server\n      systemd:\n        name: nginx\n        state: restarted\n      when:  nginx_r.rc is match "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v("\n   \n------------------------------------------------\n   \n      \n或者: 对all所有主机操作,只对web01和db01安装wget\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat install.yml")]),s._v("\n- hosts: all\n  tasks:\n    - name: Install Wget\n      yum:\n        name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n        state: present\n      when: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ansible_hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web01"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" or "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ansible_hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"db01"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  --syntax-check install.yml")]),s._v("\n\nplaybook: install.yml\n\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  install.yml")]),s._v("\n\n------------------------------------------------\n\n并且: 对all所有主机操作，主机名称nfs 并且IP地址是10.0.0.31\n写法1:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat install.yml")]),s._v("\n- hosts: all\n  tasks:\n    - name: Install Wget\n      yum:\n        name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n        state: present\n      when: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ansible_hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nfs"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" and "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("ansible_default_ipv4.address "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.31"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  --syntax-check install.yml")]),s._v("\n\nplaybook: install.yml\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  install.yml")]),s._v("\n写法2:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat install.yml")]),s._v("\n- hosts: all\n  tasks:\n    - name: Install Wget\n      yum:\n        name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v("\n        state: present\n      when: \n        - ansible_hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nfs"')]),s._v("\n        - ansible_default_ipv4.address "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.31"')]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  --syntax-check install.yml")]),s._v("\n\nplaybook: install.yml\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  install.yml")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br"),n("span",{staticClass:"line-number"},[s._v("115")]),n("br"),n("span",{staticClass:"line-number"},[s._v("116")]),n("br"),n("span",{staticClass:"line-number"},[s._v("117")]),n("br"),n("span",{staticClass:"line-number"},[s._v("118")]),n("br"),n("span",{staticClass:"line-number"},[s._v("119")]),n("br"),n("span",{staticClass:"line-number"},[s._v("120")]),n("br"),n("span",{staticClass:"line-number"},[s._v("121")]),n("br"),n("span",{staticClass:"line-number"},[s._v("122")]),n("br"),n("span",{staticClass:"line-number"},[s._v("123")]),n("br"),n("span",{staticClass:"line-number"},[s._v("124")]),n("br"),n("span",{staticClass:"line-number"},[s._v("125")]),n("br"),n("span",{staticClass:"line-number"},[s._v("126")]),n("br"),n("span",{staticClass:"line-number"},[s._v("127")]),n("br"),n("span",{staticClass:"line-number"},[s._v("128")]),n("br"),n("span",{staticClass:"line-number"},[s._v("129")]),n("br"),n("span",{staticClass:"line-number"},[s._v("130")]),n("br"),n("span",{staticClass:"line-number"},[s._v("131")]),n("br"),n("span",{staticClass:"line-number"},[s._v("132")]),n("br"),n("span",{staticClass:"line-number"},[s._v("133")]),n("br"),n("span",{staticClass:"line-number"},[s._v("134")]),n("br"),n("span",{staticClass:"line-number"},[s._v("135")]),n("br"),n("span",{staticClass:"line-number"},[s._v("136")]),n("br"),n("span",{staticClass:"line-number"},[s._v("137")]),n("br"),n("span",{staticClass:"line-number"},[s._v("138")]),n("br"),n("span",{staticClass:"line-number"},[s._v("139")]),n("br"),n("span",{staticClass:"line-number"},[s._v("140")]),n("br"),n("span",{staticClass:"line-number"},[s._v("141")]),n("br"),n("span",{staticClass:"line-number"},[s._v("142")]),n("br"),n("span",{staticClass:"line-number"},[s._v("143")]),n("br"),n("span",{staticClass:"line-number"},[s._v("144")]),n("br"),n("span",{staticClass:"line-number"},[s._v("145")]),n("br"),n("span",{staticClass:"line-number"},[s._v("146")]),n("br"),n("span",{staticClass:"line-number"},[s._v("147")]),n("br"),n("span",{staticClass:"line-number"},[s._v("148")]),n("br"),n("span",{staticClass:"line-number"},[s._v("149")]),n("br"),n("span",{staticClass:"line-number"},[s._v("150")]),n("br"),n("span",{staticClass:"line-number"},[s._v("151")]),n("br"),n("span",{staticClass:"line-number"},[s._v("152")]),n("br"),n("span",{staticClass:"line-number"},[s._v("153")]),n("br"),n("span",{staticClass:"line-number"},[s._v("154")]),n("br"),n("span",{staticClass:"line-number"},[s._v("155")]),n("br"),n("span",{staticClass:"line-number"},[s._v("156")]),n("br"),n("span",{staticClass:"line-number"},[s._v("157")]),n("br"),n("span",{staticClass:"line-number"},[s._v("158")]),n("br"),n("span",{staticClass:"line-number"},[s._v("159")]),n("br"),n("span",{staticClass:"line-number"},[s._v("160")]),n("br"),n("span",{staticClass:"line-number"},[s._v("161")]),n("br"),n("span",{staticClass:"line-number"},[s._v("162")]),n("br"),n("span",{staticClass:"line-number"},[s._v("163")]),n("br"),n("span",{staticClass:"line-number"},[s._v("164")]),n("br"),n("span",{staticClass:"line-number"},[s._v("165")]),n("br")])]),n("h3",{attrs:{id:"_11-字典循环"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_11-字典循环"}},[s._v("#")]),s._v(" 11，字典循环")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("需求: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("次创建2个文件 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt\n使用列表不支持1次创建多个文件\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat touch.yml")]),s._v("\n- hosts: web01\n  tasks:\n    - name: create "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt\n      file:\n        path:\n          -  /root/1.txt\n          -  /root/2.txt\n        state: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v("\n\n列表不支持1次启动多个服务\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat touch.yml ")]),s._v("\n- hosts: web01\n  tasks:\n    - name: start nginx php-fpm\n      systemd:\n        name: \n          - nginx\n          - php-fpm\n        state: restarted\n\n列表不支持1次创建多个用户\n列表不支持1次拷贝多个文件\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n\n\n字典循环创建多个文件\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat touch.yml")]),s._v("\n- hosts: web01\n  tasks:\n    - name: create "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt\n      file:\n        path: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item }}"')]),s._v("\n        state: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v("\n      loop:\n        - /root/1.txt\n        - /root/2.txt\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  --syntax-check touch.yml")]),s._v("\n\nplaybook: touch.yml\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook  touch.yml")]),s._v("\n\nPLAY "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" *********************************************************************************************************\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Gathering Facts"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ***********************************************************************************************\nok: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nTASK "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("create "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" ********************************************************************************************\nchanged: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/1.txt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nchanged: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("web01"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("item"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/root/2.txt"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n------------------------------------------------------\n\n\n需求:\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt 属主属组 root 权限 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("644")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt 属主属组 www  权限 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat touch.yml ")]),s._v("\n- hosts: web01\n  tasks:\n    - name: create "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt\n      file:\n        path: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.file }}"')]),s._v("\n        owner: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.owner }}"')]),s._v("\n        group: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.group }}"')]),s._v("\n        mode:  "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.mode }}"')]),s._v("\n        state: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v("\n      loop:\n        - "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("file: /root/1.txt,owner: root,group: root, mode: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0644'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        - "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("file: /root/2.txt,owner: www,group: www, mode: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0600'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n需求: 同时重启nginx和php服务\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat systemd.yml ")]),s._v("\n- hosts: web01\n  tasks:\n    - name: Restart Nginx PHP-fpm Server\n      systemd:\n        name: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item }}"')]),s._v("\n        state: restarted\n      loop:\n        - nginx\n        - php-fpm\n\n需求: 拷贝两个文件 \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt 目标位置 /opt/  属主属主 root 权限 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("666")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt 目标位置 /root/ 属主属组 www  权限 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("600")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#touch 1.txt 2.txt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ll 1.txt 2.txt ")]),s._v("\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("157")]),s._v(" Aug "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":51 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt\n-rw-r--r-- "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Aug "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":51 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat co.yml ")]),s._v("\n- hosts: web01\n  tasks:\n    - name: copy "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt\n      copy:\n        src: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.src }}"')]),s._v("\n        dest: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.dest }}"')]),s._v("\n        owner: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.owner }}"')]),s._v("\n        group: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.group }}"')]),s._v("\n        mode: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ item.mode }}"')]),s._v("\n      loop:\n        - "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("src: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".txt,dest: /opt/,owner: root,group: root,mode: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0666'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        - "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("src: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".txt,dest: /root/,owner: www,group: www,mode: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'0600'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n创建两个用户\nmalu1 uid "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" gid "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("777")]),s._v(" 不登录 不创建家 \nmalu2 uid "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("888")]),s._v(" gid "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("888")]),s._v(" 登录 有家\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br")])]),n("h3",{attrs:{id:"_12-小结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_12-小结"}},[s._v("#")]),s._v(" 12，小结")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".变量\n在play重定义\t\t*****\n在file中定义        *****\n官网推荐方式 group_vars host_vars  *****\n主机清单中定义\n命令行中定义\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".内置变量          *****\nansible_hostname\nansible_default_ipv4.address\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".变量注册          *****\nnginx "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v(" 执行的结果赋值给变量\nregister nginx_r\n\ndebug:\n  msg: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ nginx_r }}"')]),s._v("\n  \n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".流程控制\t\t\t*****\nwhen判断 判断变量中的值\nwhen: ansible_hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web01"')]),s._v("\nwhen: ansible_hostname is search "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web01"')]),s._v("\nwhen: ansible_hostname is match "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web01"')]),s._v("\nor 或者\nand 并且\n\t\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".字典循环\t\t\t*****\nitem变量\nloop模块\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("h3",{attrs:{id:"_13-handlers"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-handlers"}},[s._v("#")]),s._v(" 13，handlers")]),s._v(" "),n("p",[n("code",[s._v("handler")]),s._v("用来执行某些条件下的任务，比如当配置文件发生变化的时候，通过notify触发handler去重启服务。")]),s._v(" "),n("p",[s._v("在saltstack中也有类似的触发器，写法相对Ansible简单，只需要watch，配置文件即可。")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: web01\n  tasks:\n    - name: Install Nginx Server\n      yum:\n        name: nginx\n        state: present\n    - name: Configure Nginx Server\n      copy:\n        src: conf/nginx.conf\n        dest: /etc/nginx/\n      notify: Restart Nginx Server\n\n\n    - name: check Nginx Conf\n      command: nginx "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\n      register: nginx_r\n      ignore_errors: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n\n    - name: Start Nginx Server\n      systemd: \n        name: nginx\n        state: started\n        enabled: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n\n  handlers:\n    - name: Restart Nginx Server\n      systemd:\n        name: nginx\n        state: restarted\n      when:  nginx_r.rc is match "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br")])]),n("p",[n("strong",[s._v("注意：")])]),s._v(" "),n("ol",[n("li",[n("p",[s._v("无论多少个task通知了相同的handlers，handlers仅会在所有tasks结束后运行一次。")])]),s._v(" "),n("li",[n("p",[s._v("Handlers只有在其所在的任务被执行时，才会被运行；如果一个任务中定义了notify调用Handlers，但是由于条件判断等原因，该任务未被执行，那么Handlers同样不会被执行。")])]),s._v(" "),n("li",[n("p",[s._v("Handlers只会在每一个play的末尾运行一次；如果想在一个playbook中间运行Handlers，则需要使用meta模块来实现。例如： -meta: flush_handlers。")])]),s._v(" "),n("li",[n("p",[s._v("如果一个play在运行到调用Handlers的语句之前失败了，那么这个Handlers将不会被执行。我们可以使用meta模块的–force-handlers选项来强制执行Handlers，即使Handlers所在的play中途运行失败也能执行。")])]),s._v(" "),n("li",[n("p",[s._v("不能使用handlers替代tasks")])])]),s._v(" "),n("h3",{attrs:{id:"_14-playbook任务标签"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_14-playbook任务标签"}},[s._v("#")]),s._v(" 14，playbook任务标签")]),s._v(" "),n("p",[s._v("默认情况下，Ansible在执行一个playbook时，会执行playbook中定义的所有任务，Ansible的标签(tag)功能可以给单独任务甚至整个playbook打上标签，然后利用这些标签来指定要运行playbook中的个别任务，或不执行指定的任务。")]),s._v(" "),n("p",[s._v("打标签的方式")]),s._v(" "),n("ol",[n("li",[s._v("对一个task打一个标签")]),s._v(" "),n("li",[s._v("对一个task打多个标签")]),s._v(" "),n("li",[s._v("对多个task打一个标签")])]),s._v(" "),n("p",[s._v("打完标签如何使用")]),s._v(" "),n("ol",[n("li",[s._v("-t: 执行指定的tag标签任务")]),s._v(" "),n("li",[s._v("–skip-tags:执行–skip-tags之外的标签任务")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("作用: 给1个或者多个task打标签，执行的时候按照标签执行\n面试可能会问到。\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml ")]),s._v("\n- hosts: web01\n  tasks:\n    - name: Install Nginx Server\n      yum:\n        name: nginx\n        state: present\n    - name: Configure Nginx Server\n      copy:\n        src: conf/nginx.conf\n        dest: /etc/nginx/\n      notify: Restart Nginx Server\n\n\n    - name: check Nginx Conf\n      command: nginx "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\n      register: nginx_r\n      ignore_errors: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n\n    - name: Start Nginx Server\n      systemd: \n        name: nginx\n        state: started\n        enabled: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n      tags: t_f\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打tags 名称自定义")]),s._v("\n\n    - name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" create\n      file:\n        path: /root/tag.txt\n        state: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v("\n      tags: t_f  \t\t\t "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打tags")]),s._v("\n\n  handlers:\n    - name: Restart Nginx Server\n      systemd:\n        name: nginx\n        state: restarted\n      when:  nginx_r.rc is match "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v("\n\n查看标签\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook test.yml --list-tags")]),s._v("\n\n按照标签执行task\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#ansible-playbook test.yml -t t_f")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat test.yml")]),s._v("\n- hosts: web01\n  tasks:\n    - name: Install Nginx Server\n      yum:\n        name: nginx\n        state: present\n    - name: Configure Nginx Server\n      copy:\n        src: conf/nginx.conf\n        dest: /etc/nginx/\n      notify: Restart Nginx Server\n\n\n    - name: check Nginx Conf\n      command: nginx "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\n      register: nginx_r\n      ignore_errors: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n      changed_when: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n\n    - name: Start Nginx Server\n      systemd: \n        name: nginx\n        state: started\n        enabled: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\n      tags: t_f\n\n    - name: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" create\n      file:\n        path: /root/tag.txt\n        state: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("touch")]),s._v("\n      tags: t_f\n      changed_when: "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将黄色提示改为绿色  笔记")]),s._v("\n\n  handlers:\n    - name: Restart Nginx Server\n      systemd:\n        name: nginx\n        state: restarted\n      when:  nginx_r.rc is match "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0"')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br")])]),n("h3",{attrs:{id:"_15-忽略错误"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_15-忽略错误"}},[s._v("#")]),s._v(" 15，忽略错误")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("    - name: check Nginx Conf\n      command: nginx "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-t")]),s._v("\n      register: nginx_r\n      ignore_errors: "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),s._v("\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 如果tasks执行失败继续往下执行。")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h3",{attrs:{id:"_16-jinja2模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_16-jinja2模块"}},[s._v("#")]),s._v(" 16，jinja2模块")]),s._v(" "),n("p",[s._v("jinja2是Python的全功能模板引擎。")]),s._v(" "),n("p",[s._v("Jinja2与Ansible啥关系")]),s._v(" "),n("ul",[n("li",[s._v("Ansible通常会使用jinja2模板来修改被管理主机的配置文件等…在saltstack中同样会使用到jinja2")]),s._v(" "),n("li",[s._v("如果在100台主机上安装nginx，每台nginx的端口都不一样，如何解决？")])]),s._v(" "),n("p",[s._v("Ansible如何使用Jinja2")]),s._v(" "),n("ul",[n("li",[s._v("使用Ansible的jinja2模板也就是使用template模块，该模块和copy模块一样，都是讲文件复制到远端主机上去，但是区别在于，template模块可以获取到文件中的变量，而copy则是原封不动的把文件内容复制过去。之前我们在推送rsync的backup脚本时，想把脚本中的变量名改成主机名，如果使用copy模块则推送过去的就是"+s._s(s.ansible_fqdn)+"，不变，如果使用template，则会变成对应的主机名。")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat env.txt")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ansible_hostname "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("_"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ansible_default_ipv4.address "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" http_url "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat j.yml ")]),s._v("\n- hosts: webs\n  vars:\n    - http_url: http://www.malu.com\n  tasks:\n    - name: copy "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" env.txt web01\n      template:\n        src: env.txt\n        dest: /root/\n\n执行后客户端的文件内容:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat env.txt ")]),s._v("\nweb01_10.0.0.7\nhttp://www.malu.com\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat motd.j2")]),s._v("\nWelcome to "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ansible_hostname "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nThis system total mem is "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ansible_memtotal_mb "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" MB\nThis system "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" mem is: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ansible_memfree_mb "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" MB\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat j.yml ")]),s._v("\n- hosts: webs\n  vars:\n    - http_url: http://www.maluedu.com\n  tasks:\n    - name: copy "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" env.txt web01\n      template:\n        src:  motd.j2\n        dest: /etc/motd\n\n重新连接web01测试\nAuthorized "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("users")]),s._v(" only. All activities may be monitored and reported.\nWelcome to web01\nThis system total mem is "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("948")]),s._v(" MB\nThis system "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("free")]),s._v(" mem is: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("234")]),s._v(" MB\nActivate the web console with: systemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--now")]),s._v(" cockpit.socket\n\nLast login: Wed Aug "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("28")]),s._v(" 09:10:32 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v(" from "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.61\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@web01:~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br")])]),n("p",[s._v("Jinja2模板逻辑判断")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#循环表达式")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("i")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" EXPR %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% endfor %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#条件判断")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" EXPR %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("elif")]),s._v(" EXPR %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% endif %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注释")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("# COMMENT "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("生成lb的配置文件:\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat j.yml ")]),s._v("\n- hosts: webs\n  vars:\n    - server_name: www.wp.com\n    - up_port: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8080")]),s._v("\n  tasks:\n    - name: copy "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" env.txt web01\n      template:\n        src:  lb.conf\n        dest: /root/\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat lb.conf ")]),s._v("\nupstream "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" server_name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[s._v("n")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" range"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7,9")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("  \n        server "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.16")]),s._v(".1."),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" n "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(":"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" up_port "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% endfor %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nserver "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        listen "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        server_name  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" server_name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n        location / "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                root /code"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                index index.html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                proxy_pass http://"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" server_name "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                proxy_set_header Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("使用jinja2的if判断生成keepalived配置文件\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat keepalived.j2 ")]),s._v("\nglobal_defs "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    router_id "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" ansible_hostname "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nvrrp_instance VI_1 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" ansible_hostname "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"web01"')]),s._v(" %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    state MASTER\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("150")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    state BACKUP\n    priority "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("% endif %"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    interface eth0\n    virtual_router_id "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("\n    advert_int "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    authentication "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        auth_type PASS\n        auth_pass "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1111")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    virtual_ipaddress "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("         \n        "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.3\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ansible:ansible"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#cat j.yml ")]),s._v("\n- hosts: webs\n  tasks:\n    - name: copy "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" env.txt web01\n      template:\n        src:  keepalived.j2\n        dest: /root/keepalived.conf\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br")])])])}),[],!1,null,null,null);n.default=e.exports},6380:function(s,n,a){s.exports=a.p+"assets/img/1725414347686.8fe11366.png"}}]);