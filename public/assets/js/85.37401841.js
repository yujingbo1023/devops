(window.webpackJsonp=window.webpackJsonp||[]).push([[85],{14953:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"_1-面试题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-面试题"}},[s._v("#")]),s._v(" 1，面试题")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Q92:你们公司用什么工具备份MySQL?备份周期多长?\n\nQ93:Prometheus联邦模式如何配置?\n\nQ94:Prometheus如何监控一个网站?如何监控主机是否存活?如何监控服务是否存活呢?\n\nQ95:Prometheus如何监控自定义指标，比如内网的丢包率?\n\nQ96:生产环境中Prometheus服务器磁盘空间不足?如何解决的?4T磁盘如何处理?\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"_2-prometheus官方文档"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-prometheus官方文档"}},[s._v("#")]),s._v(" 2，Prometheus官方文档")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("文档：https://prometheus.io/docs/prometheus/2.53/configuration/configuration/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_3-基于file-sd-configs服务发现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-基于file-sd-configs服务发现"}},[s._v("#")]),s._v(" 3，基于file_sd_configs服务发现")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".修改配置文件\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-file_sd_config-json"')]),s._v("\n    file_sd_configs:\n      - files:\n          - /malu/softwares/prometheus-2.53.3.linux-amd64/*.json\n\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-file_sd_config-yaml"')]),s._v("\n    file_sd_configs:\n      - files:\n          - /malu/softwares/prometheus-2.53.3.linux-amd64/*.yaml\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".准备文件内容\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /malu/softwares/prometheus-2.53.3.linux-amd64/linux94.yaml")]),s._v("\n- targets:\n    - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.0.0.43:9100'")]),s._v(" \n  labels:\n    address: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("863")]),s._v("\n    city: Zhengzhou\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /malu/softwares/prometheus-2.53.3.linux-amd64/linux94.json ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"targets"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.41:9100"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.42:9100"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"labels"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"school"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bd"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"class"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux94"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".配置环境变量并检查配置文件语法\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/profile.d/prometheus.sh ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("PROM_HOME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/malu/softwares/prometheus-2.53.3.linux-amd64\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$PROM_HOME")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# source /etc/profile.d/prometheus.sh ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# promtool check config $PROM_HOME/prometheus.yml")]),s._v("\nChecking /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml\n SUCCESS: /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml is valid prometheus config "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" syntax\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n温馨提示:\n\t如果遇到SUCCESS字样，说明文件检查成功！\n\t\n\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".重新加载配置使得配置文件生效\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl  -X POST 10.0.0.31:9090/-/reload  ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".访问target测试\nhttp://10.0.0.31:9090/targets\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7361),alt:"1731636275933"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("温馨提示:\n\t修改文件内容并不重启服务，观察webUI的变化\n\t\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/linux94.json ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"targets"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.41:9100"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.143:9100"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(",\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"labels"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"school"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bd"')]),s._v(",\n      "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"class"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"linux94"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/linux94.yaml ")]),s._v("\n- targets:\n    - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.0.0.41:9100'")]),s._v(" \n    - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.0.0.231:6443'")]),s._v(" \n    - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.0.0.232:10250'")]),s._v(" \n    - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'10.0.0.233:10248'")]),s._v(" \n  labels:\n    address: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("863")]),s._v("\n    city: Zhengzhou\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7362),alt:"1731636367455"}})]),s._v(" "),t("h3",{attrs:{id:"_4-二进制快速部署consul集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-二进制快速部署consul集群"}},[s._v("#")]),s._v(" 4，二进制快速部署consul集群")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("官方文档:\n\thttps://www.consul.io/\n\thttps://developer.hashicorp.com/consul/install"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#linux")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 下载consul  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v("三个节点都要做\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://releases.hashicorp.com/consul/1.20.1/consul_1.20.1_linux_amd64.zip\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 解压consul  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("42")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v("三个节点都要做\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" consul_1.20.1_linux_amd64.zip "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-d")]),s._v(" /usr/local/bin/\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" 运行consul 集群\n服务端43: Leader\nconsul agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-bootstrap")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-bind")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43 -data-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/malu/softwares/consul "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-client")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ui")]),s._v("\n\n\n客户端42: Follower\nconsul agent  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-bind")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42 -data-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/malu/softwares/consul "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-client")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ui")]),s._v(" -retry-join"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43\n\n\n客户端41: Follower\nconsul agent "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-server")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-bind")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.41 -data-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/malu/softwares/consul "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-client")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.41 "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ui")]),s._v(" -retry-join"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43\n\n\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 查看各节点的监听端口\nss "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-ntl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8500")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" 访问console服务的WebUI\nhttp://10.0.0.43:8500/ui/dc1/nodes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7363),alt:"1731636993463"}})]),s._v(" "),t("h3",{attrs:{id:"_5-基于consul-sd-config服务发现"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-基于consul-sd-config服务发现"}},[s._v("#")]),s._v(" 5，基于consul_sd_config服务发现")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 修改prometheus的配置文件\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-consul-seriver-discovery"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置基于consul的服务发现")]),s._v("\n    consul_sd_configs:\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 指定consul的服务器地址，若不指定，则默认值为"localhost:8500".')]),s._v("\n      - server: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43:8500\n      - server: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:8500\n      - server: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.41:8500\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对数据进行重新打标签设置")]),s._v("\n    relabel_configs:\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配consul的源标签字段，表示服务名称")]),s._v("\n      - source_labels: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("__meta_consul_service"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 指定源标签的正则表达式，若不定义，默认值为"(.*)"')]),s._v("\n        regex: consul\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 执行动作为删除，默认值为"replace",有效值有多种')]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#   https://prometheus.io/docs/prometheus/latest/configuration/configuration/#relabel_action")]),s._v("\n        action: drop\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 检查配置文件是否正确\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# promtool check config $PROM_HOME/prometheus.yml")]),s._v("\nChecking /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml\n SUCCESS: /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml is valid prometheus config "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" syntax\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" 重新加载配置\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -X POST http://10.0.0.31:9090/-/reload")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".验证配置是否生效:\nhttp://10.0.0.31:9090/config\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7364),alt:"1731637490149"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".被监控节点注册到console集群\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.1")]),s._v(" 注册节点\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# curl -X PUT -d \'{"id":"node42","name":"malu-prometheus-node42","address":"10.0.0.42","port":9100,"tags":["node-exporter"],"checks": [{"http":"http://10.0.0.42:9100","interval":"5m"}]}\' http://10.0.0.43:8500/v1/agent/service/register')]),s._v("\n\n \n注意观察:\n\thttp://10.0.0.43:8500/ui/dc1/services\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7365),alt:"1731637683131"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7366),alt:"1731637708634"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("注意，也可以使用postman直接进行如下操作【了解即可】\n\nPUT http://10.0.0.43:8500/v1/agent/service/register\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"id"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node43"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"name"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-prometheus-node43"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"address"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.43"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"port"')]),s._v(":9100,"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tags"')]),s._v(":"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"node-exporter"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"checks"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://10.0.0.43:9100"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"interval"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"5m"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7367),alt:"1731637864463"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7368),alt:"1731637877582"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7369),alt:"1731637893715"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.2")]),s._v(" 注销节点  node42表示注册时的那个id\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -X PUT http://10.0.0.43:8500/v1/agent/service/deregister/node42")]),s._v("\n\n\n注意观察:\n\thttp://10.0.0.43:8500/ui/dc1/services\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7370),alt:"1731638056606"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7371),alt:"1731638074271"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("TODO---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 目前有个坑"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("41,42")]),s._v(",43是一个集群，41注册，去42注销时，会报serviceID 找不到"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n你注册时找得哪个节点"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v("或42或43"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("，那么注销时也要找这个节点注销，待解决"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\n不好使\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-X")]),s._v(" PUT http://10.0.0.41:8500/v1/agent/service/deregister/node42\n\n可以\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-X")]),s._v(" PUT http://10.0.0.42:8500/v1/agent/service/deregister/node42\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h3",{attrs:{id:"_6-监控consul服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_6-监控consul服务"}},[s._v("#")]),s._v(" 6，监控consul服务")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 部署consul集群\n略\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 下载consul exporter  在32节点上操作\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/prometheus/consul_exporter/releases/download/v0.13.0/consul_exporter-0.13.0.linux-amd64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll consul_exporter-0.13.0.linux-amd64.tar.gz ")]),s._v("\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10054358")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(":15 consul_exporter-0.13.0.linux-amd64.tar.gz\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" 解压软件包   在32节点上操作\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf consul_exporter-0.13.0.linux-amd64.tar.gz -C /usr/local/bin/ consul_exporter-0.13.0.linux-amd64/consul_exporter  --strip-components=1 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" 启动consul exporter   在32节点上操作\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# consul_exporter --consul.server="http://10.0.0.43:8500" --web.listen-address=:9107 --web.telemetry-path="/metrics" ')]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" 访问consul exporter的WebUI\nhttp://10.0.0.32:9107/metrics\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7372),alt:"1731638794867"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" prometheus配置监控consul\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-consul-exporter"')]),s._v("\n    static_configs:\n      - targets: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.32:9107"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" 检查配置文件语法\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# promtool check config $PROM_HOME/prometheus.yml")]),s._v("\nChecking /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml\n SUCCESS: /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml is valid prometheus config "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" syntax\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" 重新加载配置\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -X POST http://10.0.0.31:9090/-/reload ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" 访问prometheus的WebUI\nhttp://10.0.0.31:9090/targets\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" grafana添加模板ID\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8919")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12049")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7373),alt:"1731638916806"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7374),alt:"1731638997203"}})]),s._v(" "),t("h3",{attrs:{id:"_7-prometheus配置远端存储"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_7-prometheus配置远端存储"}},[s._v("#")]),s._v(" 7，Prometheus配置远端存储")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".数据默认存储本地，默认本地存储就够用了。\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /malu/data/prometheus/")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v("\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":00 ./\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" 09:06 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" 05:00 01JCP7KK7QG4ST02XB5THQHXP3/\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" 07:00 01JCPEFAEACBGZ9NWEE3JC7SRV/\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" 07:00 01JCPEFCJ0CB695HMCY0PTVATS/\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" 09:00 01JCPNB1PFRR8R3RDRQGAAT7AM/\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":00 01JCPW6VEA5ZZ8ZZ5Z30HT70AK/\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":01 chunks_head/\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" 09:06 lock\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20001")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":02 queries.active\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":00 wal/\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n使用"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--storage.tsdb.path"')]),s._v("指的数据的存储路径。\t\n使用"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"--storage.tsdb.retention.time=60d"')]),s._v("指定数据的存储周期。\n\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--config.file")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/malu/softwares/prometheus/prometheus.yml \n\t指定prometheus的配置文件。\n\n--web.enable-lifecycle \n\t启用web方式热加载。\n\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--storage.tsdb.path")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/oldboyedu/data/prometheus"')]),s._v(" \n\t指定prometheus数据存储路径。\n\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--storage.tsdb.retention.time")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"60d"')]),s._v(" \n\t指定prometheus数据存储周期。\n\n--web.listen-address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:9090"')]),s._v(" \n\t指定prometheus的监听端口。\n\n--web.max-connections"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65535")]),s._v(" \n\t指定最大的连接数。\n\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--storage.tsdb.retention.size")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"512MB"')]),s._v(" \n\t指定prometheus数据块的滚动大小。\n\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--query.timeout")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("10s \n\t查询数据的超时时间。\n\n--query.max-concurrency"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v("\n\t最大并发查询数量。\n\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--log.level")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("info\n\t指定日志级别。\n\n"),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--log.format")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("logfmt\n\t指定日志格式。\n\n--web.read-timeout"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("5m\n\t最大的空闲超时时间。\n\t\n\t\n目录结构参考:\n\thttps://www.cnblogs.com/yinzhengjie/p/18534198\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".Prometheus远端存储VictoriaMetrics \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.1")]),s._v(" VicoriaMetrics概述\nVictoriaMetrics是一个快速、经济高效且可扩展的监控解决方案和时间序列数据库。\n\n官网地址:\n\thttps://victoriametrics.com/\n\n官方文档:\n\thttps://docs.victoriametrics.com/\n\nGitHub地址:\n\thttps://github.com/VictoriaMetrics/VictoriaMetrics\n\n部署文档:\n\thttps://docs.victoriametrics.com/quick-start/\n\t\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.2")]),s._v(" 下载victoriametrics\n版本选择建议使用93 LTS，因为使用97 LTS貌似需要企业授权，启动报错，发现如下信息:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# journalctl -u victoria-metrics.service  -f")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n\tNov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(":03:28 prometheus-server33 victoria-metrics-prod"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16999")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("-11-14T04:03:28.576Z        error        VictoriaMetrics/lib/license/copyrights.go:33        VictoriaMetrics Enterprise license is required. Please obtain it at https://victoriametrics.com/products/enterprise/trial/ and pass it via either "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-license")]),s._v(" or "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-licenseFile")]),s._v(" command-line flags. See https://docs.victoriametrics.com/enterprise/\n\n\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/VictoriaMetrics/VictoriaMetrics/releases/download/v1.93.16/victoria-metrics-linux-amd64-v1.93.16.tar.gz\n\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.3")]),s._v(" 解压软件包 \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf victoria-metrics-linux-amd64-v1.93.16.tar.gz  -C /usr/local/bin/")]),s._v("\n\n\t\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.4")]),s._v(" 编写启动脚本\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/systemd/system/victoria-metrics.service "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[Unit]\nDescription=VictoriaMetrics Server\nDocumentation=https://docs.victoriametrics.com/\nAfter=network.target\n\n[Service]\nExecStart=/usr/local/bin/victoria-metrics-prod  \\\n   -httpListenAddr=0.0.0.0:8428 \\\n   -storageDataPath=/malu/data/victoria-metrics \\\n   -retentionPeriod=3\n\n[Install]\nWantedBy=multi-user.target\nEOF")]),s._v("\nsystemctl daemon-reload\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--now")]),s._v(" victoria-metrics.service\nsystemctl status victoria-metrics\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.5")]),s._v(" 检查端口是否存活\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ss -ntl | grep 8428")]),s._v("\nLISTEN "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:8428      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*          \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.6")]),s._v(" 查看webUI\nhttp://10.0.0.32:8428/vmui/\n\n使用指标查询，发现没有数据： node_cpu_seconds_total\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7375),alt:"1731641182454"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".prometheus配置VictoriaMetrics远端存储\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.1")]),s._v(" 修改prometheus的配置文件\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在顶级字段中配置VictoriaMetrics地址")]),s._v("\nremote_write:\n  - url: http://10.0.0.32:8428/api/v1/write\n\n完整配置如下：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# my global config")]),s._v("\nglobal:\n  scrape_interval: 3s "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Set the scrape interval to every 15 seconds. Default is every 1 minute.")]),s._v("\n  evaluation_interval: 15s "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Evaluate rules every 15 seconds. The default is every 1 minute.")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scrape_timeout is set to the global default (10s).")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Alertmanager configuration")]),s._v("\nalerting:\n  alertmanagers:\n    - static_configs:\n        - targets:\n          "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# - alertmanager:9093")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.")]),s._v("\nrule_files:\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "first_rules.yml"')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# - "second_rules.yml"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A scrape configuration containing exactly one endpoint to scrape:")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Here it's Prometheus itself.")]),s._v("\nscrape_configs:\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.")]),s._v("\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prometheus"')]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# metrics_path defaults to '/metrics'")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scheme defaults to 'http'.")]),s._v("\n\n    static_configs:\n      - targets: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9090"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-node-exporter"')]),s._v("\n    static_configs:\n      - targets:\n         - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.41:9100\n         - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:9100\n         - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43:9100\nremote_write:\n  - url: http://10.0.0.32:8428/api/v1/write\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.2")]),s._v(" 重新加载prometheus的配置\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl stop prometheus-server")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 手动启动，不通过命令行的方式启动")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# prometheus  --config.file=${PROM_HOME}/prometheus.yml")]),s._v("\n温馨提示：\n\t为了避免实验干扰，我建议大家手动启动prometheus。\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.3")]),s._v(" 在VictoriaMetrics的WebUI查看数据\nnode_cpu_seconds_total"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("instance"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.41:9100"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\t\n温馨提示:\n\t如果此步骤没有数据，则不要做下面的步骤了，请先把数据搞出来。\n\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.4")]),s._v(" 配置grafana的数据源及URL\n数据源是prometheus，但是URL得写VictoriaMetric的URL哟。\n \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.5")]),s._v(" 导入grafana的模板ID并选择数据源\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1860")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7376),alt:"1731641535488"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7377),alt:"1731641565108"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7378),alt:"1731641669894"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7379),alt:"1731641678974"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7380),alt:"1731641751171"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7381),alt:"1731641766297"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7382),alt:"1731641826291"}})]),s._v(" "),t("h3",{attrs:{id:"_8-alertmanager环境搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_8-alertmanager环境搭建"}},[s._v("#")]),s._v(" 8，Alertmanager环境搭建")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".Alertmanager概述\nAlertmanager是Prometheus官方推出的一个专门用于告警功能的组件。\n\t\n\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".下载Alertmanager \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://github.com/prometheus/alertmanager/releases/download/v0.27.0/alertmanager-0.27.0.linux-amd64.tar.gz\n\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".解压Alertmanager \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf alertmanager-0.27.0.linux-amd64.tar.gz -C /malu/softwares/")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".编写启动脚本 \n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /lib/systemd/system/alertmanager.service "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n[Unit]\nDescription=alertmanager Server\nDocumentation=https://www.malu.com/\nAfter=network.target\n\n[Service]\nExecStart=/malu/softwares/alertmanager-0.27.0.linux-amd64/alertmanager --web.listen-address=:9093 --storage.path="/malu/data/alertmanager" --config.file="/malu/softwares/alertmanager-0.27.0.linux-amd64/alertmanager.yml"\n\n[Install]\nWantedBy=multi-user.target\nEOF')]),s._v("\nsystemctl daemon-reload\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("--now")]),s._v(" alertmanager\nsystemctl status alertmanager \n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".访问Alertmanager的WebUI\nhttp://10.0.0.33:9093/\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7383),alt:"1731650467524"}})]),s._v(" "),t("h3",{attrs:{id:"_9-模拟程序发送告警到alertmanager"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_9-模拟程序发送告警到alertmanager"}},[s._v("#")]),s._v(" 9，模拟程序发送告警到Alertmanager")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("环境搭建:\n\thttps://www.bilibili.com/video/BV1bwhve7EPJ/\n\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".下载golang的SDK\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://studygolang.com/dl/golang/go1.23.3.linux-amd64.tar.gz")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".解压软件包 \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# tar xf go1.23.3.linux-amd64.tar.gz -C /malu/softwares/")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".配置环境变量\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/profile.d/go.sh")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#!/bin/bash")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 表示GOLANG的安装目录")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOROOT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/malu/softwares/go\n\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("export")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("PATH")])]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PATH")]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$GOROOT")]),s._v("/bin\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# source /etc/profile.d/go.sh")]),s._v("\n\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".更换国内代理GOPROXY便于下载软件包\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go env -w GOPROXY=https://goproxy.cn,direct")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go env | grep GOPROXY")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GOPROXY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://goproxy.cn,direct'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".编写代码   alert_send.go\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pwd")]),s._v("\n/malu/script\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vim alert_send.go")]),s._v("\n\npackage main\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bytes"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"encoding/json"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"io/ioutil"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"net/http"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"flag"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fmt"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/prometheus/common/model"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nfunc AlertSend"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("alertmanagerAddress string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tlabels :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" model.LabelSet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\tlabels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"报警测试"')]),s._v("\n\tlabels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"group"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu"')]),s._v("\n\tlabels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"severity"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2"')]),s._v("\n\tlabels"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"job"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu-k8s"')]),s._v("\n\n\tannotations :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" model.LabelSet"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\tannotations"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"2024"')]),s._v("\n\n\t// Alert结构体的数据和官网一致"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("https://prometheus.io/docs/alerting/latest/clients/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\talerts :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" make"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("*model.Alert, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\talert :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("model.Alert"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tLabels:       labels,\n\t\tAnnotations:  annotations,\n\t\tGeneratorURL: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://www.yinzhengjie.com:9090"')]),s._v(",\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\talerts "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" append"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("alerts, alert"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\tjsonStr, _ :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" json.Marshal"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("alerts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\treq, err :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" http.NewRequest"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POST"')]),s._v(", alertmanagerAddress, bytes.NewBuffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("jsonStr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n\n\treq.Header.Set"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Content-Type"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"application/json"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\tclient :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("http.Client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\tresp, err :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" client.Do"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("req"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" nil "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tlog.Printf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http.post.requst.err|url:%v|err:%v"')]),s._v(", alertmanagerAddress, err"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\tdefer resp.Body.Close"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\tlog.Printf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"response Status:%v"')]),s._v(", resp.Status"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tlog.Printf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"response Headers:%v"')]),s._v(", resp.Header"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\tbody, _ :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" ioutil.ReadAll"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("resp.Body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tlog.Printf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"response Body:%v"')]),s._v(", string"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("body"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nfunc "),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tlistenAddr :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" flag.String"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"addr"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.32:9093"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"WebUI expose port"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tflag.Parse"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\talertmanagerAddress :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fmt.Sprintf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"http://%s/api/v2/alerts"')]),s._v(",*listenAddr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    fmt.Printf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alertmanagerAddress: %s'),t("span",{pre:!0,attrs:{class:"token entity",title:"\\n"}},[s._v("\\n")]),s._v('"')]),s._v(",alertmanagerAddress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\tAlertSend"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("alertmanagerAddress"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".编译\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go mod init alertmanager")]),s._v("\ngo: creating new go.mod: module alertmanager\ngo: to "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" module requirements and sums:\n\tgo mod tidy\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go mod tidy")]),s._v("\ngo: finding module "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" package github.com/prometheus/common/model\ngo: downloading github.com/prometheus/common v0.60.1\ngo: found github.com/prometheus/common/model "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" github.com/prometheus/common v0.60.1\ngo: downloading github.com/prometheus/client_model v0.6.1\ngo: downloading google.golang.org/protobuf v1.34.2\ngo: downloading github.com/google/go-cmp v0.6.0\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go build -o altermanger-sendData alert_send.go")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10148")]),s._v("\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":17 ./\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" root root     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":15 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1518")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":16 alert_send.go\n-rwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10368214")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":17 altermanger-sendData*\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("193")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":17 go.mod\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("704")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":17 go.sum\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# scp altermanger-sendData 10.0.0.33:~")]),s._v("\n\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".使用编译后的程序发送测试信息\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./alertmanger-sendData --addr 10.0.0.33:9093")]),s._v("\nalertmanagerAddress: http://10.0.0.33:9093/api/v2/alerts\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("/11/14 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":15:07 response Status:200 OK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("/11/14 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":15:07 response Headers:map"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Cache-Control:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("no-store"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Content-Length:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Date:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Thu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v(" 07:15:07 GMT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Vary:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Origin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("/11/14 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":15:07 response Body:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".观察Alertmanager的WebUI\nhttp://10.0.0.33:9093/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/alerts")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br"),t("span",{staticClass:"line-number"},[s._v("112")]),t("br"),t("span",{staticClass:"line-number"},[s._v("113")]),t("br"),t("span",{staticClass:"line-number"},[s._v("114")]),t("br"),t("span",{staticClass:"line-number"},[s._v("115")]),t("br"),t("span",{staticClass:"line-number"},[s._v("116")]),t("br"),t("span",{staticClass:"line-number"},[s._v("117")]),t("br"),t("span",{staticClass:"line-number"},[s._v("118")]),t("br"),t("span",{staticClass:"line-number"},[s._v("119")]),t("br"),t("span",{staticClass:"line-number"},[s._v("120")]),t("br"),t("span",{staticClass:"line-number"},[s._v("121")]),t("br"),t("span",{staticClass:"line-number"},[s._v("122")]),t("br"),t("span",{staticClass:"line-number"},[s._v("123")]),t("br"),t("span",{staticClass:"line-number"},[s._v("124")]),t("br"),t("span",{staticClass:"line-number"},[s._v("125")]),t("br"),t("span",{staticClass:"line-number"},[s._v("126")]),t("br"),t("span",{staticClass:"line-number"},[s._v("127")]),t("br"),t("span",{staticClass:"line-number"},[s._v("128")]),t("br"),t("span",{staticClass:"line-number"},[s._v("129")]),t("br"),t("span",{staticClass:"line-number"},[s._v("130")]),t("br"),t("span",{staticClass:"line-number"},[s._v("131")]),t("br"),t("span",{staticClass:"line-number"},[s._v("132")]),t("br"),t("span",{staticClass:"line-number"},[s._v("133")]),t("br"),t("span",{staticClass:"line-number"},[s._v("134")]),t("br"),t("span",{staticClass:"line-number"},[s._v("135")]),t("br"),t("span",{staticClass:"line-number"},[s._v("136")]),t("br"),t("span",{staticClass:"line-number"},[s._v("137")]),t("br"),t("span",{staticClass:"line-number"},[s._v("138")]),t("br"),t("span",{staticClass:"line-number"},[s._v("139")]),t("br"),t("span",{staticClass:"line-number"},[s._v("140")]),t("br"),t("span",{staticClass:"line-number"},[s._v("141")]),t("br"),t("span",{staticClass:"line-number"},[s._v("142")]),t("br"),t("span",{staticClass:"line-number"},[s._v("143")]),t("br"),t("span",{staticClass:"line-number"},[s._v("144")]),t("br"),t("span",{staticClass:"line-number"},[s._v("145")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7384),alt:"1731651568126"}})]),s._v(" "),t("h3",{attrs:{id:"_10-alertmanager发送数据到其他程序"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_10-alertmanager发送数据到其他程序"}},[s._v("#")]),s._v(" 10，Alertmanager发送数据到其他程序")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("源码：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat alter_receive.go ")]),s._v("\npackage main\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"errors"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fmt"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"net/http"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"flag"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/gin-gonic/gin"')]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"github.com/prometheus/alertmanager/notify/webhook"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nfunc AlertReceiveFunc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c *gin.Context"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\tvar msg webhook.Message\n\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" err :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c.BindJSON"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("msg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" err "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" nil "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\tc.JSON"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("400")]),s._v(", errors.New"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"invalid args"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n\t\t"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("return")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\tbaseMsg :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" fmt.Sprintf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"状态: %s|报警条数: %d"')]),s._v(", msg.Status, len"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg.Alerts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("))")]),s._v("\n\n\tlog.Printf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alertReceive|baseMsg:%+v"')]),s._v(", baseMsg"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\t"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" len"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg.Alerts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i++ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\talert :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" msg.Alerts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t\tlog.Printf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"detail|%d%d|alert:%+v"')]),s._v(", i+1, len"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("msg.Alerts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(", alert"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\tc.JSON"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("http.StatusOK, "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"ok"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nfunc "),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n\tlistenAddr :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" flag.String"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"addr"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('":8888"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"WebUI expose port"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tflag.Parse"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\tr :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" gin.Default"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\tr.POST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/malu/alert"')]),s._v(", AlertReceiveFunc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\tr.Run"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*listenAddr"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go mod tidy")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# go build -o altermanger-receiveData alter_receive.go")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 script"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll")]),s._v("\ntotal "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("36780")]),s._v("\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" root root     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":28 ./\ndrwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" root root     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":15 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("/\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1518")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":16 alert_send.go\n-rwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27203322")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":28 altermanger-receiveData*\n-rwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10368214")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":17 altermanger-sendData*\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("801")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":24 alter_receive.go\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3577")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":28 go.mod\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64457")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":28 go.sum\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".启动撑起监听服务模拟接受Alertmanager的消息\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 scripts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 scripts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod +x alertmanger-receiveData")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 scripts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server32 scripts"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./alertmanger-receiveData ")]),s._v("\n\n温馨提示:\n\t默认监听的是8888端口。\n\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".修改Alertmanager的配置文件 \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /malu/softwares/alertmanager-0.27.0.linux-amd64/alertmanager.yml ")]),s._v("\nroute:\n  group_by: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alertname'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  group_wait: 10s\n  group_interval: 30s\n  repeat_interval: 5m\n  receiver: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'web.hook'")]),s._v("\nreceivers:\n  - name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'web.hook'")]),s._v("\n    webhook_configs:\n      - url: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://10.0.0.32:8888/malu/alert'")]),s._v("\n        http_config: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        max_alerts: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\ninhibit_rules:\n  - source_match:\n      severity: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'critical'")]),s._v("\n    target_match:\n      severity: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'warning'")]),s._v("\n    equal: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alertname'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dev'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'instance'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart alertmanager.service ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".发送数据到Alertmanager测试\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll altermanger-sendData ")]),s._v("\n-rwxr-xr-x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10368214")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":37 altermanger-sendData*\n\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chmod +x oldboyedu-alertmanger-sendData ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./alertmanger-sendData --addr 10.0.0.33:9093")]),s._v("\nalertmanagerAddress: http://10.0.0.33:9093/api/v2/alerts\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("/11/14 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":36:39 response Status:200 OK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("/11/14 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":36:39 response Headers:map"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Cache-Control:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("no-store"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Content-Length:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Date:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Thu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" Nov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v(" 07:36:39 GMT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Vary:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Origin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("/11/14 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":36:39 response Body:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".查看Alertmanager是否有告警发出\nhttp://10.0.0.33:9093/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/alerts")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7385),alt:"1731652760290"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".再次查看终端发现是否消息接收\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("GIN-debug"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Listening and serving HTTP on :8888\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("/11/15 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":38:53 alertReceive"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("baseMsg:状态: firing"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("报警条数: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("/11/15 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":38:53 detail"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("alert:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("Status:firing Labels:group"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("malu, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("job")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("malu-k8s, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("malu")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("报警测试, "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("severity")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" Annotations:value"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v(" StartsAt:2024-11-15 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":38:43.09783275 +0800 CST EndsAt:0001-01-01 00:00:00 +0000 UTC GeneratorURL:https://www.yinzhengjie.com:9090 Fingerprint:821a7da7dc7bb6a4"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("GIN"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("/11/15 - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":38:53 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("377.681")]),s._v("µs "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.33 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" POST     "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/malu/alert"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7386),alt:"1731652780488"}})]),s._v(" "),t("h3",{attrs:{id:"_11-alertmanager实现分组路由-route"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_11-alertmanager实现分组路由-route"}},[s._v("#")]),s._v(" 11，alertmanager实现分组路由(route)")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("场景说明:\n\t假设有4个部门的同事，根据消息发送给不同的部门，使用Prometheus实现告警，借助Alertmanager发送告警\n\t\t- sre_bidata:  （6666）\n\t\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.41:9100\n\t\t\t\n\t\t- sre_dba:  （7777）\n\t\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:9100\n\t\t\t\n\t\t- sre_k8s:  （8888）\n\t\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43:9100\n\t\t\t\n\t\t- sre_system:  （9999）\n\t\t\t你是系统组的，所有邮件都得接受。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".启动测试服务用于接受告警\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./alertmanger-receiveData --addr :6666")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./alertmanger-receiveData --addr :7777")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./alertmanger-receiveData --addr :8888")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@node-exporter42 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./alertmanger-receiveData --addr :9999")]),s._v("\n\n\t\n\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".修改Alertmanager的配置文件\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /malu/softwares/alertmanager-0.27.0.linux-amd64/alertmanager.yml ")]),s._v("\nroute:\n  group_by: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alertname'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  group_wait: 1s\n  group_interval: 3s\n  repeat_interval: 1m\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 默认发给"sre_system"组用户')]),s._v("\n  receiver: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_system'")]),s._v("\n  continue: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置子路由")]),s._v("\n  routes:\n    - receiver: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_dba'")]),s._v("\n      match_re:\n        job: malu_mysqld_exporter\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 建议将continue的值设置为true，表示当前的条件是否匹配，都将继续向下匹配规则")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这样做的目的是将消息发给最后的系统组(sre_system)")]),s._v("\n      continue: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    - receiver: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_bigdata'")]),s._v("\n      match_re:\n        job: malu_flink_exporter\n      continue: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    - receiver: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_k8s'")]),s._v("\n      match_re:\n        job: malu_istio_exporter\n      continue: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    - receiver: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_system'")]),s._v("\n      match_re:\n        job: .*\n      continue: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nreceivers:\n  - name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_dba'")]),s._v("\n    webhook_configs:\n      - url: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://10.0.0.42:6666/malu/alert'")]),s._v("\n        http_config: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        max_alerts: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  - name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_bigdata'")]),s._v("\n    webhook_configs:\n      - url: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://10.0.0.42:7777/malu/alert'")]),s._v("\n        http_config: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        max_alerts: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  - name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_k8s'")]),s._v("\n    webhook_configs:\n      - url: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://10.0.0.42:8888/malu/alert'")]),s._v("\n        http_config: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        max_alerts: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  - name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_system'")]),s._v("\n    webhook_configs:\n      - url: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://10.0.0.42:9999/malu/alert'")]),s._v("\n        http_config: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        max_alerts: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart alertmanager.service ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".修改Prometheus server的配置文件 \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml ")]),s._v("\nglobal:\n  scrape_interval: 3s\n  evaluation_interval: 15s\nalerting:\n  alertmanagers:\n    - static_configs:\n        - targets:\n            - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.33:9093\nrule_files:\n  - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/malu/softwares/prometheus-2.53.3.linux-amd64/malu_rules.yml"')]),s._v("\nscrape_configs:\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"prometheus"')]),s._v("\n    static_configs:\n      - targets: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost:9090"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu_mysqld_exporter"')]),s._v("\n    static_configs:\n      - targets:\n          - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.41:9100\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu_flink_exporter"')]),s._v("\n    static_configs:\n      - targets:\n          - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.42:9100\n  - job_name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu_istio_exporter"')]),s._v("\n    static_configs:\n      - targets:\n          - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.0")]),s._v(".0.43:9100\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".prometheus编写告警规则文件\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/malu_rules.yml")]),s._v("\ngroups:\n  - name: xixi\n    rules:\n      - alert: malu_mysqld_exporter-alert\n        expr: up"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("job"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu_mysqld_exporter"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        labels:\n          severity: critical\n          apps: mysql80\n        annotations:\n          summary: DBA机器异常\n  \n  - name: haha\n    rules:\n      - alert: malu_bigdata_exporter-alert\n        expr: up"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("job"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu_flink_exporter"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        labels:\n          severity: warning\n          apps: flink\n        annotations:\n          summary: 大数据集群机器异常\n\n  - name: hehe\n    rules:\n      - alert: malu_k8s_exporter-alert\n        expr: up"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("job"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu_istio_exporter"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        labels:\n          severity: warning\n          apps: k8s\n        annotations:\n          summary: k8s集群机器异常\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".检查配置文件是否正确\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# promtool check config $PROM_HOME/prometheus.yml")]),s._v("\nChecking /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml\n  SUCCESS: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" rule files found\n SUCCESS: /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml is valid prometheus config "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" syntax\n\nChecking /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/oldboyedu_rules.yml\n  SUCCESS: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" rules found\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(".热加载配置文件观察是否正常\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -X POST http://10.0.0.31:9090/-/reload")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7387),alt:"1731654966867"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7388),alt:"1731654994626"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".添加一台机器，模拟故障，观察控制台输出。\n测试告警会一直不断地发，直到你解决为止。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7389),alt:"1731655122849"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7390),alt:"1731655150081"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7391),alt:"1731655170190"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7392),alt:"1731655193199"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7393),alt:"1731655215482"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7394),alt:"1731655240687"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7395),alt:"1731655284626"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7396),alt:"1731655299512"}})]),s._v(" "),t("h3",{attrs:{id:"_12-alertmanager实现告警抑制-inhibit"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_12-alertmanager实现告警抑制-inhibit"}},[s._v("#")]),s._v(" 12，alertmanager实现告警抑制(inhibit)")]),s._v(" "),t("p",[s._v("先恢复正常。")]),s._v(" "),t("p",[t("img",{attrs:{src:a(7397),alt:"1731656244761"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7398),alt:"1731656259138"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7399),alt:"1731656267933"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7400),alt:"1731656284863"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7401),alt:"1731656293652"}})]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".告警抑制的应用场景\n所谓的告警抑制指的是某些其他告警已经触发，则抑制某些告警的通知。\n\n告警抑制多用于某些高等级的告警已触发，然后低等级的被抑制:\n- 如机器宕机告警触发，则机器上的进程存活监控都被抑制"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n- 如region基础网络组件告警触发，region内部的服务端口探活都被抑制"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".修改prometheus的配置文件，就在三个地方添加了region: beijing\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /malu/softwares/prometheus-2.53.3.linux-amd64/malu_rules.yml")]),s._v("\ngroups:\n  - name: xixi\n    rules:\n      - alert: malu_mysqld_exporter-alert\n        expr: up"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("job"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu_mysqld_exporter"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        labels:\n          severity: critical\n          apps: mysql80\n          region: beijing\n        annotations:\n          summary: DBA机器异常\n  \n  - name: haha\n    rules:\n      - alert: malu_bigdata_exporter-alert\n        expr: up"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("job"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu_flink_exporter"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        labels:\n          severity: warning\n          apps: flink\n          region: beijing\n        annotations:\n          summary: 大数据集群机器异常\n\n  - name: hehe\n    rules:\n      - alert: malu_k8s_exporter-alert\n        expr: up"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("job"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"malu_istio_exporter"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        labels:\n          severity: warning\n          apps: k8s\n          region: beijing\n        annotations:\n          summary: k8s集群机器异常\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(".检查配置文件语法及热加载 \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# promtool check config $PROM_HOME/prometheus.yml")]),s._v("\nChecking /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml\n  SUCCESS: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" rule files found\n SUCCESS: /malu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml is valid prometheus config "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" syntax\n\nChecking /malu/softwares/prometheus-2.53.3.linux-amd64/oldboyedu_rules.yml\n  SUCCESS: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" rules found\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -X POST http://10.0.0.31:9090/-/reload")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".alertmanager配置告警抑制\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /malu/softwares/alertmanager-0.27.0.linux-amd64/alertmanager.yml")]),s._v("\nroute:\n  group_by: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alertname'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  group_wait: 1s\n  group_interval: 3s\n  repeat_interval: 1m\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 默认发给"sre_system"组用户')]),s._v("\n  receiver: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_system'")]),s._v("\n  continue: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置子路由")]),s._v("\n  routes:\n    - receiver: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_dba'")]),s._v("\n      match_re:\n        job: malu_mysqld_exporter\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 建议将continue的值设置为true，表示当前的条件是否匹配，都将继续向下匹配规则")]),s._v("\n      "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 这样做的目的是将消息发给最后的系统组(sre_system)")]),s._v("\n      continue: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    - receiver: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_bigdata'")]),s._v("\n      match_re:\n        job: malu_flink_exporter\n      continue: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    - receiver: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_k8s'")]),s._v("\n      match_re:\n        job: malu_istio_exporter\n      continue: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    - receiver: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_system'")]),s._v("\n      match_re:\n        job: .*\n      continue: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\nreceivers:\n  - name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_dba'")]),s._v("\n    webhook_configs:\n      - url: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://10.0.0.42:6666/malu/alert'")]),s._v("\n        http_config: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        max_alerts: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  - name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_bigdata'")]),s._v("\n    webhook_configs:\n      - url: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://10.0.0.42:7777/malu/alert'")]),s._v("\n        http_config: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        max_alerts: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  - name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_k8s'")]),s._v("\n    webhook_configs:\n      - url: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://10.0.0.42:8888/malu/alert'")]),s._v("\n        http_config: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        max_alerts: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  - name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sre_system'")]),s._v("\n    webhook_configs:\n      - url: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'http://10.0.0.42:9999/malu/alert'")]),s._v("\n        http_config: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        max_alerts: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置告警抑制规则")]),s._v("\ninhibit_rules:\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 如果"region"的值相同的前提条件下。')]),s._v("\n  "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#\t则当触发了"severity: critical"告警，就会抑制"severity: warning"的告警信息。')]),s._v("\n- source_match:\n    severity: critical\n  target_match:\n    severity: warning\n  equal:\n  - region\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart alertmanager.service ")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".测试验证 \n注意，测试时，建议将prometheus的数据清空在测试，这样做的目的是方式旧数据被查到，因为我们写的up语句举例不太好。\n\n思路就是先让dba的机器告警出来，然后在让大数据和K8S的机器告警，发现最终发送告警的只有DBA。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br"),t("span",{staticClass:"line-number"},[s._v("112")]),t("br"),t("span",{staticClass:"line-number"},[s._v("113")]),t("br"),t("span",{staticClass:"line-number"},[s._v("114")]),t("br"),t("span",{staticClass:"line-number"},[s._v("115")]),t("br"),t("span",{staticClass:"line-number"},[s._v("116")]),t("br"),t("span",{staticClass:"line-number"},[s._v("117")]),t("br"),t("span",{staticClass:"line-number"},[s._v("118")]),t("br"),t("span",{staticClass:"line-number"},[s._v("119")]),t("br"),t("span",{staticClass:"line-number"},[s._v("120")]),t("br"),t("span",{staticClass:"line-number"},[s._v("121")]),t("br"),t("span",{staticClass:"line-number"},[s._v("122")]),t("br"),t("span",{staticClass:"line-number"},[s._v("123")]),t("br"),t("span",{staticClass:"line-number"},[s._v("124")]),t("br"),t("span",{staticClass:"line-number"},[s._v("125")]),t("br"),t("span",{staticClass:"line-number"},[s._v("126")]),t("br"),t("span",{staticClass:"line-number"},[s._v("127")]),t("br"),t("span",{staticClass:"line-number"},[s._v("128")]),t("br"),t("span",{staticClass:"line-number"},[s._v("129")]),t("br"),t("span",{staticClass:"line-number"},[s._v("130")]),t("br"),t("span",{staticClass:"line-number"},[s._v("131")]),t("br"),t("span",{staticClass:"line-number"},[s._v("132")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7402),alt:"1731656532731"}})]),s._v(" "),t("p",[s._v("先让mysql告警：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(7403),alt:"1731656986846"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7404),alt:"1731657010673"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7405),alt:"1731657019586"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7406),alt:"1731657031449"}})]),s._v(" "),t("p",[s._v("再让另外两个告警：")]),s._v(" "),t("p",[t("img",{attrs:{src:a(7407),alt:"1731657087778"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7408),alt:"1731657099577"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7409),alt:"1731657113210"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7410),alt:"1731657141054"}})]),s._v(" "),t("h3",{attrs:{id:"_13-alertmanager实现告警静默-silence"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_13-alertmanager实现告警静默-silence"}},[s._v("#")]),s._v(" 13，alertmanager实现告警静默(Silence)")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(".告警静默的应用场景\n当我们需要发布上线，或者下线节点做维护动作时，这些事情是我们提前预知的，就可以阻止警告发生，我们称之为静默。\n\nalertmanager的静默接口:\n\t/api/v2/silences\n\n\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".实战案例\nhttps://www.cnblogs.com/yinzhengjie/p/18542942"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#二alertmanager实现告警静默silence")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("p",[t("img",{attrs:{src:a(7411),alt:"1731657553663"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7412),alt:"1731657562270"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7413),alt:"1731657578873"}})]),s._v(" "),t("p",[t("img",{attrs:{src:a(7414),alt:"1731657665591"}})]),s._v(" "),t("p",[s._v("再测试，也不会告警。")]),s._v(" "),t("h3",{attrs:{id:"_14-alertmanager实现告警并发送钉钉"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_14-alertmanager实现告警并发送钉钉"}},[s._v("#")]),s._v(" 14，Alertmanager实现告警并发送钉钉")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("prometheus配置alermanager邮箱作为告警媒介\n\n\nhttps://www.cnblogs.com/yinzhengjie/p/18545112"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#1编写源代码接收告警处理")]),s._v("\n\t\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 修改Alertmanager配置文件\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /oldboyedu/softwares/alertmanager-0.27.0.linux-amd64/alertmanager.yml")]),s._v("\nglobal:\n  resolve_timeout: 5m\n  smtp_from: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1365107710@qq.com'")]),s._v("\n  smtp_smarthost: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'smtp.qq.com:465'")]),s._v("\n  smtp_auth_username: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1365107710@qq.com'")]),s._v("\n  smtp_auth_password: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'lptqthmnmpftjhfd'")]),s._v("\n  smtp_require_tls: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  smtp_hello: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'qq.com'")]),s._v("\nroute:\n  group_by: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alertname'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  group_wait: 5s\n  group_interval: 5s\n  repeat_interval: 5m\n  receiver: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'email'")]),s._v("\nreceivers:\n- name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'email'")]),s._v("\n  email_configs:\n  - to: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3066469132@qq.com'")]),s._v("\n    send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  - to: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1421117408@qq.com'")]),s._v("\n    send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n  - to: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1615428685@qq.com'")]),s._v("\n    send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\ninhibit_rules:\n  - source_match:\n      severity: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'critical'")]),s._v("\n    target_match:\n      severity: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'warning'")]),s._v("\n    equal: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alertname'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dev'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'instance'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n\n相关参数说明:\n\tglobal:\n\t  resolve_timeout:\n\t\t解析超时时间。\n\t  smtp_from:\n\t\t发件人邮箱地址。\n\t  smtp_smarthost:\n\t\t邮箱的服务器的地址及端口，例如:  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'smtp.qq.com:465'")]),s._v("。\n\t  smtp_auth_username:\n\t\t发送人的邮箱用户名。\n\t  smtp_auth_password:\n\t\t发送人的邮箱密码。\n\t  smtp_require_tls:\n\t\t是否基于tls加密。\n\t  smtp_hello:\n\t\t邮箱服务器，例如: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'qq.com'")]),s._v("。\n\troute:\n\t  group_by: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alertname'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t  group_wait: 5s\n\t  group_interval: 5s\n\t  repeat_interval:\n\t\t重复报警的间隔时间，如果没有解即报警问题，则会间隔指定时间一直触发报警，比如:5m。\n\t  receiver: \n\t\t采用什么方式接收报警，例如"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'email'")]),s._v("。\n\treceivers:\n\t- name: \n\t\t定义接收者的名称，注意这里的name要和上面的route对应，例如: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'email'")]),s._v("\n\t  email_configs:\n\t  - to: \n\t\t邮箱发给谁。\n\t\tsend_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n\tinhibit_rules:\n\t  - source_match:\n\t\t  severity: \n\t\t\t匹配报警级别，例如: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'critical'")]),s._v("。\n\t\ttarget_match:\n\t\t  severity: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'warning'")]),s._v("\n\t\tequal: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alertname'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dev'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'instance'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    \n \n推荐阅读:\n\thttps://prometheus.io/docs/alerting/latest/configuration/\n    \n温馨提示:\n\t- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.163")]),s._v("邮箱修改授权码步骤很简单，依次点击"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"设置"')]),s._v(" ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"POP3/SMTP/IMAP"')]),s._v(" ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"新增授权密码"')]),s._v("\n\t- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".我的授权码已经更改了，每次讲课需要重新获取最新的授权码哟！！\n\t\n\n\n\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(".prometheus修改规则\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart prometheus-server.service ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/oldboyedu_rules.yml")]),s._v("\ngroups:\n  - name: xixi\n    rules:\n      - alert: yinzhengjie_mysqld_exporter-alert\n        expr: up"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("instance"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.41:9100"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("job")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"oldboyedu_mysqld_exporter"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        labels:\n          severity: critical\n          apps: mysql80\n          region: beijing\n        annotations:\n          summary: DBA机器异常\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart prometheus-server.service ")]),s._v("\n\n\n\n\n- 表示授权码认证失败，需要确认无误：\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# journalctl -u alertmanager.service -f")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nNov "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(":26:22 prometheus-server33 alertmanager"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18115")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ts")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2024")]),s._v("-11-14T11:26:22.723Z "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("caller")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("notify.go:848 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("level")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("warn "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("component")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("dispatcher "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("receiver")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("email "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("integration")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("email"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("aggrGroup")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{}:{alertname='),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v("yinzhengjie_mysqld_exporter-alert"),t("span",{pre:!0,attrs:{class:"token entity",title:'\\"'}},[s._v('\\"')]),s._v('}"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("msg")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Notify attempt failed, will retry later"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("attempts")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("err")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"*email.loginAuth auth: 535 Login Fail. Please enter your authorization code to login. More information in https://service.mail.qq.com/detail/0/53"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br"),t("span",{staticClass:"line-number"},[s._v("112")]),t("br"),t("span",{staticClass:"line-number"},[s._v("113")]),t("br"),t("span",{staticClass:"line-number"},[s._v("114")]),t("br"),t("span",{staticClass:"line-number"},[s._v("115")]),t("br")])]),t("h3",{attrs:{id:"_15-alertmanager实现自定义告警模板"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_15-alertmanager实现自定义告警模板"}},[s._v("#")]),s._v(" 15，Alertmanager实现自定义告警模板")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 告警模板介绍\n默认的告警信息界面有些简单，可以借助告警的模板信息，对告警信息进行丰富，需要借助于Alertmanager的模板功能来实现。\n\n告警模板的使用流程如下:\n    - 分析关键信息\n    - 定制模板内容\n    - Alertmanager加载模板文件\n    - 告警信息使用模板内容属性\n\n\n模板文件使用标准Go模板语法，并暴露一些包含时间标签和值的变量。\n    - 标签引用: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$label")]),s._v("."),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("label_name"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    - 指标样本值引用: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$value")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    \n为了显式效果，需要了解一些html相关技术，参考链接:\n    https://www.w3school.com.cn/html/index.asp\n    \n    \n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" altertmanger节点自定义告警模板参考案例\n\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.1")]),s._v(" 创建邮件模板文件工作目录\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mkdir -pv /oldboyedu/softwares/alertmanager/tmpl")]),s._v("\n\n\n\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.2")]),s._v(" 创建模板实例，工作中可以考虑嵌入公司的logo\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /oldboyedu/softwares/alertmanager/tmpl/email.tmpl ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" define "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"oldboyedu.html"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("h"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("老男孩IT教育欢迎您:  https://www.oldboyedu.com/"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/h"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("1")]),s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("h3 "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("style")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'color: green;'")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 学IT老来老男孩，月薪过万不是梦"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/h"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("3")]),s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("table "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("border")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("th"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("报警项"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/th"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("th"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("实例"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/th"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("th"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("报警阀值"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/th"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("th"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("开始时间"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/th"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/tr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" range "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$i")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$alert")]),s._v(" :"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" .Alerts "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("tr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("td"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" index "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$alert")]),s._v(".Labels "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"alertname"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/td"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("td"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" index "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$alert")]),s._v(".Labels "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"instance"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/td"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("td"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" index "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$alert")]),s._v(".Annotations "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"value"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/td"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                        "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("td"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$alert")]),s._v(".StartsAt "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/td"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/tr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("/table"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("img "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://www.oldboyedu.com/static/images/header/logo.png"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" end "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" alertmanager引用自定义模板文件\n\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.1")]),s._v(" alermanager引用自定义模板文件\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /oldboyedu/softwares/alertmanager-0.27.0.linux-amd64/alertmanager.yml")]),s._v("\nglobal:\n  resolve_timeout: 5m\n  smtp_from: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1365107710@qq.com'")]),s._v("\n  smtp_smarthost: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'smtp.qq.com:465'")]),s._v("\n  smtp_auth_username: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1365107710@qq.com'")]),s._v("\n  smtp_auth_password: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'lptqthmnmpftjhfd'")]),s._v("\n  smtp_require_tls: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n  smtp_hello: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'qq.com'")]),s._v("\nroute:\n  group_by: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alertname'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  group_wait: 5s\n  group_interval: 5s\n  repeat_interval: 5m\n  receiver: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'email'")]),s._v("\nreceivers:\n- name: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'email'")]),s._v("\n  email_configs:\n  - to: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3066469132@qq.com'")]),s._v("\n    send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 添加此行，定制邮件的标题，对于"{{}}"属性用于加载其他信息，需要使用单引号括住。')]),s._v("\n    headers: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" Subject: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[WARN] 报警邮件"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# 添加此行，调用模板显式邮件正文，对于"{}"不需要使用单引号，否则服务启动不成功。')]),s._v("\n    html: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{ template \"oldboyedu.html\" . }}'")]),s._v("\n  - to: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1421117408@qq.com'")]),s._v("\n    send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n    headers: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" Subject: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"[WARN] 报警邮件"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    html: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'{{ template \"oldboyedu.html\" . }}'")]),s._v("\n  - to: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1615428685@qq.com'")]),s._v("\n    send_resolved: "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\ninhibit_rules:\n  - source_match:\n      severity: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'critical'")]),s._v("\n    target_match:\n      severity: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'warning'")]),s._v("\n    equal: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'alertname'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'dev'")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'instance'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n\ntemplates:\n  - "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/oldboyedu/softwares/alertmanager/tmpl/*.tmpl'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.2")]),s._v(" alertmanager语法检查\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /oldboyedu/softwares/alertmanager-0.27.0.linux-amd64/")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 alertmanager-0.27.0.linux-amd64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 alertmanager-0.27.0.linux-amd64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 alertmanager-0.27.0.linux-amd64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ./amtool check-config ./alertmanager.yml ")]),s._v("\nChecking "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./alertmanager.yml'")]),s._v("  SUCCESS\nFound:\n - global config\n - route\n - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" inhibit rules\n - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" receivers\n - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" templates\n  SUCCESS\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 alertmanager-0.27.0.linux-amd64"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n    \n\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.3")]),s._v(" 重新加载配置信息\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server33 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl restart alertmanager.service ")]),s._v("\n\n\n\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.4")]),s._v(" 查看WebUi观察配置是否生效\nhttp://10.0.0.33:9093/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#/status")]),s._v("\n\n\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(".上面我们定制邮件内容中包含阈值的部分，而我们在规则中并没有指定，所以prometheus需要修改以下规则文件。\n\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.1")]),s._v(" 修改规则文件\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/oldboyedu_rules.yml")]),s._v("\ngroups:\n  - name: xixi\n    rules:\n      - alert: yinzhengjie_mysqld_exporter-alert\n        expr: up"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("instance"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"10.0.0.41:9100"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("job")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"oldboyedu_mysqld_exporter"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n        labels:\n          severity: critical\n          apps: mysql80\n          region: beijing\n        annotations:\n          summary: DBA机器异常\n          value: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"{{ '),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$value")]),s._v(' }}"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.2")]),s._v(" 检查语法\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# promtool check config ${PROM_HOME}/prometheus.yml")]),s._v("\nChecking /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml\n  SUCCESS: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" rule files found\n SUCCESS: /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/prometheus.yml is valid prometheus config "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" syntax\n\nChecking /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/oldboyedu_rules.yml\n  SUCCESS: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" rules found\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# promtool check rules ${PROM_HOME}/oldboyedu_rules.yml")]),s._v("\nChecking /oldboyedu/softwares/prometheus-2.53.3.linux-amd64/oldboyedu_rules.yml\n  SUCCESS: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" rules found\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ")]),s._v("\n\n\n\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.3")]),s._v(" 重新加载配置文件\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@prometheus-server31 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl -X POST http://10.0.0.31:9090/-/reload")]),s._v("\n\n\n\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(".停止41节点的node_exporter观察邮件告警恢复情况。\n略，见视频。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br"),t("span",{staticClass:"line-number"},[s._v("76")]),t("br"),t("span",{staticClass:"line-number"},[s._v("77")]),t("br"),t("span",{staticClass:"line-number"},[s._v("78")]),t("br"),t("span",{staticClass:"line-number"},[s._v("79")]),t("br"),t("span",{staticClass:"line-number"},[s._v("80")]),t("br"),t("span",{staticClass:"line-number"},[s._v("81")]),t("br"),t("span",{staticClass:"line-number"},[s._v("82")]),t("br"),t("span",{staticClass:"line-number"},[s._v("83")]),t("br"),t("span",{staticClass:"line-number"},[s._v("84")]),t("br"),t("span",{staticClass:"line-number"},[s._v("85")]),t("br"),t("span",{staticClass:"line-number"},[s._v("86")]),t("br"),t("span",{staticClass:"line-number"},[s._v("87")]),t("br"),t("span",{staticClass:"line-number"},[s._v("88")]),t("br"),t("span",{staticClass:"line-number"},[s._v("89")]),t("br"),t("span",{staticClass:"line-number"},[s._v("90")]),t("br"),t("span",{staticClass:"line-number"},[s._v("91")]),t("br"),t("span",{staticClass:"line-number"},[s._v("92")]),t("br"),t("span",{staticClass:"line-number"},[s._v("93")]),t("br"),t("span",{staticClass:"line-number"},[s._v("94")]),t("br"),t("span",{staticClass:"line-number"},[s._v("95")]),t("br"),t("span",{staticClass:"line-number"},[s._v("96")]),t("br"),t("span",{staticClass:"line-number"},[s._v("97")]),t("br"),t("span",{staticClass:"line-number"},[s._v("98")]),t("br"),t("span",{staticClass:"line-number"},[s._v("99")]),t("br"),t("span",{staticClass:"line-number"},[s._v("100")]),t("br"),t("span",{staticClass:"line-number"},[s._v("101")]),t("br"),t("span",{staticClass:"line-number"},[s._v("102")]),t("br"),t("span",{staticClass:"line-number"},[s._v("103")]),t("br"),t("span",{staticClass:"line-number"},[s._v("104")]),t("br"),t("span",{staticClass:"line-number"},[s._v("105")]),t("br"),t("span",{staticClass:"line-number"},[s._v("106")]),t("br"),t("span",{staticClass:"line-number"},[s._v("107")]),t("br"),t("span",{staticClass:"line-number"},[s._v("108")]),t("br"),t("span",{staticClass:"line-number"},[s._v("109")]),t("br"),t("span",{staticClass:"line-number"},[s._v("110")]),t("br"),t("span",{staticClass:"line-number"},[s._v("111")]),t("br"),t("span",{staticClass:"line-number"},[s._v("112")]),t("br"),t("span",{staticClass:"line-number"},[s._v("113")]),t("br"),t("span",{staticClass:"line-number"},[s._v("114")]),t("br"),t("span",{staticClass:"line-number"},[s._v("115")]),t("br"),t("span",{staticClass:"line-number"},[s._v("116")]),t("br"),t("span",{staticClass:"line-number"},[s._v("117")]),t("br"),t("span",{staticClass:"line-number"},[s._v("118")]),t("br"),t("span",{staticClass:"line-number"},[s._v("119")]),t("br"),t("span",{staticClass:"line-number"},[s._v("120")]),t("br"),t("span",{staticClass:"line-number"},[s._v("121")]),t("br"),t("span",{staticClass:"line-number"},[s._v("122")]),t("br"),t("span",{staticClass:"line-number"},[s._v("123")]),t("br"),t("span",{staticClass:"line-number"},[s._v("124")]),t("br"),t("span",{staticClass:"line-number"},[s._v("125")]),t("br"),t("span",{staticClass:"line-number"},[s._v("126")]),t("br"),t("span",{staticClass:"line-number"},[s._v("127")]),t("br"),t("span",{staticClass:"line-number"},[s._v("128")]),t("br"),t("span",{staticClass:"line-number"},[s._v("129")]),t("br"),t("span",{staticClass:"line-number"},[s._v("130")]),t("br"),t("span",{staticClass:"line-number"},[s._v("131")]),t("br"),t("span",{staticClass:"line-number"},[s._v("132")]),t("br"),t("span",{staticClass:"line-number"},[s._v("133")]),t("br"),t("span",{staticClass:"line-number"},[s._v("134")]),t("br"),t("span",{staticClass:"line-number"},[s._v("135")]),t("br"),t("span",{staticClass:"line-number"},[s._v("136")]),t("br"),t("span",{staticClass:"line-number"},[s._v("137")]),t("br"),t("span",{staticClass:"line-number"},[s._v("138")]),t("br"),t("span",{staticClass:"line-number"},[s._v("139")]),t("br"),t("span",{staticClass:"line-number"},[s._v("140")]),t("br"),t("span",{staticClass:"line-number"},[s._v("141")]),t("br"),t("span",{staticClass:"line-number"},[s._v("142")]),t("br"),t("span",{staticClass:"line-number"},[s._v("143")]),t("br"),t("span",{staticClass:"line-number"},[s._v("144")]),t("br"),t("span",{staticClass:"line-number"},[s._v("145")]),t("br"),t("span",{staticClass:"line-number"},[s._v("146")]),t("br"),t("span",{staticClass:"line-number"},[s._v("147")]),t("br"),t("span",{staticClass:"line-number"},[s._v("148")]),t("br"),t("span",{staticClass:"line-number"},[s._v("149")]),t("br"),t("span",{staticClass:"line-number"},[s._v("150")]),t("br"),t("span",{staticClass:"line-number"},[s._v("151")]),t("br"),t("span",{staticClass:"line-number"},[s._v("152")]),t("br"),t("span",{staticClass:"line-number"},[s._v("153")]),t("br"),t("span",{staticClass:"line-number"},[s._v("154")]),t("br"),t("span",{staticClass:"line-number"},[s._v("155")]),t("br"),t("span",{staticClass:"line-number"},[s._v("156")]),t("br"),t("span",{staticClass:"line-number"},[s._v("157")]),t("br"),t("span",{staticClass:"line-number"},[s._v("158")]),t("br"),t("span",{staticClass:"line-number"},[s._v("159")]),t("br"),t("span",{staticClass:"line-number"},[s._v("160")]),t("br"),t("span",{staticClass:"line-number"},[s._v("161")]),t("br"),t("span",{staticClass:"line-number"},[s._v("162")]),t("br"),t("span",{staticClass:"line-number"},[s._v("163")]),t("br"),t("span",{staticClass:"line-number"},[s._v("164")]),t("br"),t("span",{staticClass:"line-number"},[s._v("165")]),t("br"),t("span",{staticClass:"line-number"},[s._v("166")]),t("br")])])])}),[],!1,null,null,null);t.default=e.exports},7361:function(s,t,a){s.exports=a.p+"assets/img/1731636275933.e96f5144.png"},7362:function(s,t,a){s.exports=a.p+"assets/img/1731636367455.e7b3fb2c.png"},7363:function(s,t,a){s.exports=a.p+"assets/img/1731636993463.785834c2.png"},7364:function(s,t,a){s.exports=a.p+"assets/img/1731637490149.9fd7a298.png"},7365:function(s,t,a){s.exports=a.p+"assets/img/1731637683131.f0f3dc1d.png"},7366:function(s,t,a){s.exports=a.p+"assets/img/1731637708634.9645697d.png"},7367:function(s,t,a){s.exports=a.p+"assets/img/1731637864463.d9b668d3.png"},7368:function(s,t,a){s.exports=a.p+"assets/img/1731637877582.86ad71c1.png"},7369:function(s,t,a){s.exports=a.p+"assets/img/1731637893715.1da8b518.png"},7370:function(s,t,a){s.exports=a.p+"assets/img/1731638056606.67625c66.png"},7371:function(s,t,a){s.exports=a.p+"assets/img/1731638074271.e0f0889a.png"},7372:function(s,t,a){s.exports=a.p+"assets/img/1731638794867.5b4eb020.png"},7373:function(s,t,a){s.exports=a.p+"assets/img/1731638916806.d771215d.png"},7374:function(s,t,a){s.exports=a.p+"assets/img/1731638997203.4821e205.png"},7375:function(s,t,a){s.exports=a.p+"assets/img/1731641182454.aafc080f.png"},7376:function(s,t,a){s.exports=a.p+"assets/img/1731641535488.e2b34824.png"},7377:function(s,t,a){s.exports=a.p+"assets/img/1731641565108.49484ee1.png"},7378:function(s,t,a){s.exports=a.p+"assets/img/1731641669894.acb65d94.png"},7379:function(s,t,a){s.exports=a.p+"assets/img/1731641678974.178abea8.png"},7380:function(s,t,a){s.exports=a.p+"assets/img/1731641751171.ae056496.png"},7381:function(s,t,a){s.exports=a.p+"assets/img/1731641766297.c8cb72ab.png"},7382:function(s,t,a){s.exports=a.p+"assets/img/1731641826291.610f6faf.png"},7383:function(s,t,a){s.exports=a.p+"assets/img/1731650467524.34a75389.png"},7384:function(s,t,a){s.exports=a.p+"assets/img/1731651568126.dc4e3d0a.png"},7385:function(s,t,a){s.exports=a.p+"assets/img/1731652760290.94df2e33.png"},7386:function(s,t,a){s.exports=a.p+"assets/img/1731652780488.084acca2.png"},7387:function(s,t,a){s.exports=a.p+"assets/img/1731654966867.2a82b415.png"},7388:function(s,t,a){s.exports=a.p+"assets/img/1731654994626.3ac7d021.png"},7389:function(s,t,a){s.exports=a.p+"assets/img/1731655122849.34e34348.png"},7390:function(s,t,a){s.exports=a.p+"assets/img/1731655150081.3c21cce3.png"},7391:function(s,t,a){s.exports=a.p+"assets/img/1731655170190.6f117fb3.png"},7392:function(s,t,a){s.exports=a.p+"assets/img/1731655193199.769681bc.png"},7393:function(s,t,a){s.exports=a.p+"assets/img/1731655215482.5e2ca43c.png"},7394:function(s,t,a){s.exports=a.p+"assets/img/1731655240687.c54358e9.png"},7395:function(s,t,a){s.exports=a.p+"assets/img/1731655284626.b7f97de4.png"},7396:function(s,t,a){s.exports=a.p+"assets/img/1731655299512.90f932c9.png"},7397:function(s,t,a){s.exports=a.p+"assets/img/1731656244761.5fb37611.png"},7398:function(s,t,a){s.exports=a.p+"assets/img/1731656259138.b3c4608c.png"},7399:function(s,t,a){s.exports=a.p+"assets/img/1731656267933.6f7dd8ca.png"},7400:function(s,t,a){s.exports=a.p+"assets/img/1731656284863.49d7c165.png"},7401:function(s,t,a){s.exports=a.p+"assets/img/1731656293652.c39a6b12.png"},7402:function(s,t,a){s.exports=a.p+"assets/img/1731656532731.2540983b.png"},7403:function(s,t,a){s.exports=a.p+"assets/img/1731656986846.a42937be.png"},7404:function(s,t,a){s.exports=a.p+"assets/img/1731657010673.40180206.png"},7405:function(s,t,a){s.exports=a.p+"assets/img/1731657019586.18f70e08.png"},7406:function(s,t,a){s.exports=a.p+"assets/img/1731657031449.a573fbaa.png"},7407:function(s,t,a){s.exports=a.p+"assets/img/1731657087778.128910bb.png"},7408:function(s,t,a){s.exports=a.p+"assets/img/1731657099577.5adf4f7f.png"},7409:function(s,t,a){s.exports=a.p+"assets/img/1731657113210.2b89e563.png"},7410:function(s,t,a){s.exports=a.p+"assets/img/1731657141054.87e878de.png"},7411:function(s,t,a){s.exports=a.p+"assets/img/1731657553663.32ba462c.png"},7412:function(s,t,a){s.exports=a.p+"assets/img/1731657562270.34127c64.png"},7413:function(s,t,a){s.exports=a.p+"assets/img/1731657578873.317785f3.png"},7414:function(s,t,a){s.exports=a.p+"assets/img/1731657665591.8aeffa70.png"}}]);